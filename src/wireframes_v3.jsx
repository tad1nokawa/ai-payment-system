import React, { useState, useContext, useCallback, useRef, useEffect, createContext } from "react";

// â”€â”€â”€ ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  â”€â”€â”€
const ToastContext = createContext(() => {});
const ToastProvider = ({ children }) => {
  const [toasts, setToasts] = useState([]);
  const idRef = useRef(0);
  const addToast = useCallback((message, type = "success", duration = 3000) => {
    const id = ++idRef.current;
    setToasts(prev => [...prev, { id, message, type }]);
    setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), duration);
  }, []);
  return (
    <ToastContext.Provider value={addToast}>
      {children}
      <div className="fixed top-4 right-4 z-[100] space-y-2 pointer-events-none" style={{minWidth:"320px"}}>
        {toasts.map(t => (
          <div key={t.id} className={`pointer-events-auto px-4 py-3 rounded-lg shadow-lg border text-xs font-semibold flex items-center gap-2 animate-slide-in ${
            t.type === "success" ? "bg-emerald-50 text-emerald-800 border-emerald-200" :
            t.type === "error" ? "bg-rose-50 text-rose-800 border-rose-200" :
            t.type === "warning" ? "bg-amber-50 text-amber-800 border-amber-200" :
            "bg-blue-50 text-blue-800 border-blue-200"
          }`}>
            <span>{t.type === "success" ? "âœ…" : t.type === "error" ? "âŒ" : t.type === "warning" ? "âš ï¸" : "â„¹ï¸"}</span>
            <span>{t.message}</span>
          </div>
        ))}
      </div>
    </ToastContext.Provider>
  );
};
const useToast = () => useContext(ToastContext);

// â”€â”€â”€ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³Context â”€â”€â”€
const NavigationContext = createContext({});
const useNav = () => useContext(NavigationContext);

// â”€â”€â”€ æ±ç”¨ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° â”€â”€â”€
const ConfirmDialog = ({ config, onClose }) => {
  const [inputVal, setInputVal] = useState("");
  if (!config) return null;
  const colors = {
    approve: { bg: "bg-emerald-50 border-emerald-200", btn: "bg-emerald-600 hover:bg-emerald-700" },
    reject: { bg: "bg-rose-50 border-rose-200", btn: "bg-rose-600 hover:bg-rose-700" },
    danger: { bg: "bg-rose-50 border-rose-200", btn: "bg-rose-600 hover:bg-rose-700" },
    warning: { bg: "bg-amber-50 border-amber-200", btn: "bg-amber-600 hover:bg-amber-700" },
    info: { bg: "bg-blue-50 border-blue-200", btn: "bg-blue-600 hover:bg-blue-700" },
  };
  const c = colors[config.type] || colors.info;
  const canConfirm = config.inputConfirm ? inputVal === config.inputConfirm : true;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      <div className="absolute inset-0 bg-black/30" onClick={onClose} />
      <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
        <div className={`p-4 border-b rounded-t-xl ${c.bg}`}>
          <h3 className="text-sm font-bold text-slate-800">{config.icon || "âš¡"} {config.title}</h3>
        </div>
        <div className="p-5 space-y-3">
          <p className="text-xs text-slate-600">{config.description}</p>
          {config.details && (
            <div className="bg-slate-50 rounded border p-2 space-y-1">
              {config.details.map(([l,v], i) => (
                <div key={i} className="flex text-xs"><span className="w-28 text-slate-400">{l}:</span><span className="font-semibold text-slate-700">{v}</span></div>
              ))}
            </div>
          )}
          {config.warning && (
            <div className="bg-yellow-50 rounded border border-yellow-200 p-2 text-xs text-yellow-700">âš ï¸ {config.warning}</div>
          )}
          {config.inputConfirm && (
            <div>
              <label className="text-xs text-slate-500">ç¢ºèªã®ãŸã‚ã€Œ{config.inputConfirm}ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„</label>
              <input value={inputVal} onChange={e => setInputVal(e.target.value)} className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 focus:ring-2 focus:ring-blue-300" />
            </div>
          )}
        </div>
        <div className="p-4 border-t flex gap-2 justify-end">
          <button onClick={onClose} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button disabled={!canConfirm} onClick={() => { config.onConfirm?.(); onClose(); }}
            className={`px-4 py-2 text-xs text-white rounded font-semibold ${canConfirm ? c.btn : "bg-slate-300 cursor-not-allowed"}`}>
            {config.confirmLabel || "å®Ÿè¡Œã™ã‚‹"}
          </button>
        </div>
      </div>
    </div>
  );
};

// â”€â”€â”€ å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â”€â”€â”€
const Sidebar = ({ items, active, onSelect, title, color, user, switchableUsers, currentUserId, onSwitchUser }) => {
  const [showSwitcher, setShowSwitcher] = useState(false);
  const switcherRef = useRef(null);

  // å¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
  useEffect(() => {
    if (!showSwitcher) return;
    const handler = (e) => { if (switcherRef.current && !switcherRef.current.contains(e.target)) setShowSwitcher(false); };
    document.addEventListener("mousedown", handler);
    return () => document.removeEventListener("mousedown", handler);
  }, [showSwitcher]);

  // æ¨©é™ã«å¿œã˜ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  const currentUser = switchableUsers?.find(u => u.id === currentUserId);
  const filteredItems = currentUser ? items.map(item => {
    if (item.separator) return item;
    // ã‚µã‚¤ãƒ‰ãƒãƒ¼IDã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼IDã‚’é€†å¼•ã
    const menuEntry = Object.entries(MENU_TO_SIDEBAR).find(([, sid]) => sid === item.id);
    if (!menuEntry) return item;
    const perm = currentUser.permissions[menuEntry[0]];
    if (perm === "none") return { ...item, hidden: true };
    if (perm === "readonly") return { ...item, readOnly: true };
    return item;
  }) : items;

  return (
  <div className="w-56 bg-slate-900 text-white flex flex-col shrink-0">
    <div className="px-5 py-4 border-b border-slate-700/50">
      <p className="text-xs font-medium text-slate-400 uppercase tracking-wider">{title}</p>
      <p className="text-base font-bold" style={{ color }}>{active}</p>
    </div>
    <nav className="flex-1 py-2 overflow-y-auto">
      {filteredItems.map((item, idx) =>
        item.separator ? (
          <div key={`sep-${idx}`} className="px-4 pt-4 pb-1.5">
            <p className="text-[10px] font-semibold text-slate-500 uppercase tracking-widest">{item.label}</p>
          </div>
        ) : item.hidden ? null : (
        <button
          key={item.id}
          onClick={() => onSelect(item.id)}
          className={`w-full text-left px-4 py-2.5 text-sm flex items-center gap-2.5 transition-all duration-200 ${
            active === item.id ? "bg-slate-700/70 text-white border-l-3 border-l-white rounded-r-lg" : "text-slate-400 hover:bg-slate-800/50 hover:text-slate-200"
          } ${item.readOnly ? "opacity-60" : ""}`}
        >
          <span>{item.icon}</span>
          <span>{item.label}</span>
          {item.readOnly && <span className="ml-auto text-[9px] text-amber-400/70 font-medium">é–²è¦§</span>}
          {!item.readOnly && item.badge && <span className="ml-auto bg-rose-500 text-white text-[10px] rounded-full min-w-5 h-5 flex items-center justify-center font-semibold">{item.badge}</span>}
        </button>
        )
      )}
    </nav>
    <div className="px-5 py-3 border-t border-slate-700/50 shrink-0 relative" ref={switcherRef}>
      {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡æ›¿ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */}
      {showSwitcher && switchableUsers && (
        <div className="absolute bottom-full left-0 w-full bg-slate-800 border border-slate-600/50 rounded-t-lg shadow-xl overflow-hidden z-50">
          <div className="px-3 py-2 bg-slate-700/50 border-b border-slate-600/30">
            <p className="text-[10px] font-semibold text-amber-400 uppercase tracking-wider">ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡æ›¿ (ãƒ‡ãƒ¢ç”¨)</p>
          </div>
          <div className="max-h-64 overflow-y-auto">
            {switchableUsers.map(u => (
              <button key={u.id} onClick={() => { onSwitchUser(u.id); setShowSwitcher(false); }}
                className={`w-full text-left px-3 py-2.5 flex items-center gap-2.5 transition-colors text-xs ${
                  currentUserId === u.id ? "bg-blue-600/20 border-l-2 border-l-blue-400" : "hover:bg-slate-700/50 border-l-2 border-l-transparent"
                }`}>
                <div className="w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold text-white shrink-0" style={{ backgroundColor: u.rColor }}>{u.initials}</div>
                <div className="flex-1 min-w-0">
                  <p className={`font-medium truncate ${currentUserId === u.id ? "text-blue-300" : "text-slate-200"}`}>{u.name}</p>
                  <p className="text-[9px] text-slate-500 truncate">{u.roleLabel}</p>
                </div>
                {currentUserId === u.id && <span className="text-blue-400 text-[10px]">â—</span>}
              </button>
            ))}
          </div>
        </div>
      )}
      {user && (
        <button onClick={() => switchableUsers && setShowSwitcher(!showSwitcher)}
          className={`flex items-center gap-2 mb-2 w-full text-left rounded-lg p-1 -m-1 transition-colors ${switchableUsers ? "hover:bg-slate-800 cursor-pointer" : ""}`}>
          <div className="w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold shrink-0" style={{ color: "#fff", backgroundColor: currentUser?.rColor || "#475569" }}>{user.initials}</div>
          <div className="flex-1 min-w-0">
            <p className="text-xs font-medium text-slate-200 truncate">{user.name}</p>
            <p className="text-[10px] text-slate-500 truncate">{user.role}</p>
          </div>
          {switchableUsers && <span className="text-slate-500 text-[10px]">{showSwitcher ? "â–¼" : "â–²"}</span>}
        </button>
      )}
      <div className="text-xs text-slate-500 flex items-center gap-2">v1.0 / AI Payment</div>
    </div>
  </div>
  );
};

const colorMap = {
  blue: "text-blue-600",
  green: "text-emerald-600",
  red: "text-rose-600",
  purple: "text-violet-600",
  yellow: "text-amber-600",
  gray: "text-slate-700",
  orange: "text-orange-600",
};

const KPICard = ({ label, value, sub, trend, color = "blue" }) => (
  <div className="bg-white rounded-xl border border-slate-200/60 p-4 lg:p-5 flex-1 min-w-0 shadow-sm hover:shadow-md transition-all duration-200">
    <p className="text-xs font-medium text-slate-500 uppercase tracking-wide">{label}</p>
    <p className={`text-2xl font-bold ${colorMap[color] || "text-blue-600"} mt-1`}>{value}</p>
    <div className="flex items-center gap-1.5 mt-1.5">
      {trend && <span className={`text-sm font-semibold ${trend > 0 ? "text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded-md" : "text-rose-600 bg-rose-50 px-1.5 py-0.5 rounded-md"}`}>{trend > 0 ? "â†‘" : "â†“"}{Math.abs(trend)}%</span>}
      {sub && <span className="text-xs text-slate-400 mt-0.5">{sub}</span>}
    </div>
  </div>
);

const TableHeader = ({ cols, children }) => (
  <table className="w-full text-left text-xs">
    <thead>
      <tr className="bg-slate-50/80 border-b border-slate-200 font-semibold text-slate-500 uppercase tracking-wider">
        {cols.map((c, i) => <th key={i} className={`px-4 py-3 whitespace-nowrap font-semibold ${c.w === "flex-1" ? "" : c.w}`}>{c.label}</th>)}
      </tr>
    </thead>
    <tbody>{children}</tbody>
  </table>
);

const Badge = ({ text, color }) => {
  const colors = {
    green: "bg-emerald-50 text-emerald-700 border-emerald-200",
    red: "bg-rose-50 text-rose-700 border-rose-200",
    yellow: "bg-amber-50 text-amber-700 border-amber-200",
    blue: "bg-sky-50 text-sky-700 border-sky-200",
    gray: "bg-slate-100 text-slate-600 border-slate-200",
    purple: "bg-violet-50 text-violet-700 border-violet-200"
  };
  return <span className={`text-xs font-medium px-2.5 py-1 rounded-full border ${colors[color] || colors.gray}`}>{text}</span>;
};

const MiniChart = ({ data, color = "#3B82F6", h = 30, w = 100 }) => {
  const max = Math.max(...data);
  const min = Math.min(...data);
  const range = max - min || 1;
  const points = data.map((v, i) => `${(i / (data.length - 1)) * w},${h - ((v - min) / range) * (h - 4) - 2}`).join(" ");
  const fillPoints = `0,${h} ${points} ${w},${h}`;
  return (
    <svg width={w} height={h}>
      <defs>
        <linearGradient id={`chartGrad-${color.replace('#','')}`} x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stopColor={color} stopOpacity="0.2"/>
          <stop offset="100%" stopColor={color} stopOpacity="0"/>
        </linearGradient>
      </defs>
      <polygon points={fillPoints} fill={`url(#chartGrad-${color.replace('#','')})`} />
      <polyline points={points} fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
    </svg>
  );
};

// â”€â”€â”€ M01: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â”€â”€â”€
const MasterDashboard = () => {
  const toast = useToast();
  const nav = useNav();
  const [kpiPeriod, setKpiPeriod] = useState("today");
  const [chartPeriod, setChartPeriod] = useState("7d");
  const [chartType, setChartType] = useState("count");
  const [showKpiDrill, setShowKpiDrill] = useState(null);
  const [expandedQueue, setExpandedQueue] = useState(null);
  const [chatOpen, setChatOpen] = useState(true);
  const [showAllNotices, setShowAllNotices] = useState(false);
  const [chatInput, setChatInput] = useState("");
  const [aiSummaryLoading, setAiSummaryLoading] = useState(false);
  const [chatMessages, setChatMessages] = useState([
    { role: "ai", text: "æœ¬æ—¥ã®çŠ¶æ³ã‚’ã¾ã¨ã‚ã¾ã—ãŸï¼šå–å¼•é‡ 1,247ä»¶ï¼ˆå‰æ—¥æ¯”+8%ï¼‰ã€æˆåŠŸç‡ 99.2%ã€‚ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã«3ä»¶ã®ä¿ç•™ã‚ã‚Šï¼ˆã†ã¡1ä»¶ãŒ2æ™‚é–“è¶…éä¸­ï¼‰ã€‚ä¸æ­£æ¤œçŸ¥ã§2ä»¶ã‚’è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯æ¸ˆã¿ã§ã™ã€‚" },
    { role: "user", text: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã®2æ™‚é–“è¶…éã®è©³ç´°ã‚’æ•™ãˆã¦" },
    { role: "ai", text: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ #1024 ã¯åŠ ç›Ÿåº—ã€Œãƒ‡ã‚£ãƒ¼ãƒ©ã‚¤ãƒ•ã€ã®å¯©æŸ»æ¡ˆä»¶ã§ã™ã€‚AIæ¨è–¦ã¯ã€Œæ‰¿èªã€ï¼ˆä¿¡é ¼ã‚¹ã‚³ã‚¢ 82/100ï¼‰ã€‚ä¸­ãƒªã‚¹ã‚¯åˆ¤å®šã®ç†ç”±ã¯ã‚«ãƒ†ã‚´ãƒªåˆå›ç”³è«‹ã®ãŸã‚ã§ã™ã€‚æ—©ã‚ã®å¯¾å¿œã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚" },
    { role: "user", text: "åŠ ç›Ÿåº— M-001 ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯ï¼Ÿ" },
    { role: "ai", text: "åŠ ç›Ÿåº— M-001 ã®æƒ…å ±ã§ã™ï¼š\nåŠ ç›Ÿåº—å: ABCãƒãƒ¼ãƒˆ\nã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æœ‰åŠ¹\næœˆé–“æ±ºæ¸ˆé«˜: Â¥2.4M\næˆåŠŸç‡: 99.2%" },
  ]);
  const aiResponses = {
    "ä¸æ­£æ¤œçŸ¥ã®çŠ¶æ³": "æœ¬æ—¥ã®ä¸æ­£æ¤œçŸ¥çŠ¶æ³ã§ã™ï¼šè‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯2ä»¶ï¼ˆåˆè¨ˆÂ¥156,000ï¼‰ã€‚ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢80ä»¥ä¸Šã®ä¿ç•™æ¡ˆä»¶ãŒ1ä»¶ã‚ã‚Šã¾ã™ã€‚å…¨ä½“ã®ä¸æ­£ç‡ã¯0.03%ã§åŸºæº–å€¤å†…ã§ã™ã€‚",
    "ä»Šæ—¥ã®æ±ºæ¸ˆä»¶æ•°": "æœ¬æ—¥ã®æ±ºæ¸ˆä»¶æ•°ã¯1,247ä»¶ï¼ˆå‰æ—¥æ¯”+8%ï¼‰ã§ã™ã€‚VISA: 486ä»¶ã€MC: 312ä»¶ã€JCB: 198ä»¶ã€AMEX: 89ä»¶ã€WEBãƒãƒãƒ¼: 162ä»¶ã€‚ãƒ”ãƒ¼ã‚¯æ™‚é–“å¸¯ã¯12:00-14:00ã§ã—ãŸã€‚",
    "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã®ç¢ºèª": "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã«3ä»¶ã®ä¿ç•™ãŒã‚ã‚Šã¾ã™ï¼š\n1. #1024 å¯©æŸ»ä¿ç•™ï¼ˆ2æ™‚é–“è¶…éï¼‰- AIæ¨è–¦: æ‰¿èª\n2. #5521 ä¸æ­£æ¤œçŸ¥ä¿ç•™ï¼ˆ30åˆ†å‰ï¼‰- Â¥89,000\n3. #1025 å¯©æŸ»ä¿ç•™ï¼ˆ15åˆ†å‰ï¼‰- AIæ¨è–¦: æ‰¿èª",
    "ç²¾ç®—çŠ¶æ³": "æœ¬æ—¥ã®ç²¾ç®—çŠ¶æ³ï¼šå‡¦ç†æ¸ˆã¿45ä»¶ï¼ˆÂ¥28.5Mï¼‰ã€ä¿ç•™ä¸­2ä»¶ï¼ˆå£åº§æƒ…å ±ä¸å‚™ï¼‰ã€‚æ¬¡å›ç²¾ç®—äºˆå®šã¯2/18ï¼ˆé‡‘ï¼‰ã§ã™ã€‚",
    "ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œç´¢": "ã‚ˆãç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼š\nãƒ»E001 ã‚«ãƒ¼ãƒ‰æœ‰åŠ¹æœŸé™åˆ‡ã‚Œï¼ˆæœ¬æ—¥12ä»¶ï¼‰\nãƒ»E003 æ®‹é«˜ä¸è¶³ï¼ˆæœ¬æ—¥8ä»¶ï¼‰\nãƒ»E007 3DSèªè¨¼å¤±æ•—ï¼ˆæœ¬æ—¥5ä»¶ï¼‰\nè©³ç´°ã¯ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ç®¡ç†ç”»é¢ã§ç¢ºèªã§ãã¾ã™ã€‚",
  };
  const sendChat = (text) => {
    if (!text.trim()) return;
    setChatMessages(prev => [...prev, { role: "user", text }]);
    setChatInput("");
    setTimeout(() => {
      const response = aiResponses[text] || `ã€Œ${text}ã€ã«ã¤ã„ã¦ç¢ºèªã—ã¾ã—ãŸã€‚ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ã¯æ­£å¸¸ã§ã™ã€‚è©³ç´°ã¯ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰è©²å½“ç”»é¢ã‚’ã”ç¢ºèªãã ã•ã„ã€‚`;
      setChatMessages(prev => [...prev, { role: "ai", text: response }]);
    }, 1200);
  };
  const handleRegenerate = () => {
    setAiSummaryLoading(true);
    setTimeout(() => { setAiSummaryLoading(false); toast("AIã‚µãƒãƒªãƒ¼ã‚’å†ç”Ÿæˆã—ã¾ã—ãŸ", "info"); }, 1500);
  };
  const navMap = { "ğŸ“‹ ä¾‹å¤–ã‚­ãƒ¥ãƒ¼": "queue", "ğŸ” å–å¼•æ¤œç´¢": "orderSearch", "ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ": "report", "ğŸ‘¥ åŠ ç›Ÿåº—ä¸€è¦§": "merchants", "ğŸ¤– AIç›£è¦–": "ai" };
  const kpiDrillData = {
    "å–å¼•é‡": { value: "1,247ä»¶", details: [{ label: "VISA", value: "486ä»¶" }, { label: "Mastercard", value: "312ä»¶" }, { label: "JCB", value: "198ä»¶" }, { label: "AMEX", value: "89ä»¶" }, { label: "WEBãƒãƒãƒ¼", value: "162ä»¶" }] },
    "æ±ºæ¸ˆé«˜": { value: "Â¥16.2M", details: [{ label: "ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ", value: "Â¥14.8M" }, { label: "WEBãƒãƒãƒ¼", value: "Â¥1.4M" }] },
    "æ±ºæ¸ˆæˆåŠŸç‡": { value: "99.2%", details: [{ label: "VISA", value: "99.5%" }, { label: "Mastercard", value: "99.1%" }, { label: "JCB", value: "98.8%" }, { label: "AMEX", value: "99.7%" }] },
  };

  return (
  <div className="p-5 flex gap-4">
    {/* ===== å·¦ã‚«ãƒ©ãƒ : AIãƒãƒ£ãƒƒãƒˆï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ ===== */}
    <div className={`${chatOpen ? "w-80" : "w-10"} shrink-0 transition-all duration-300`}>
      {chatOpen ? (
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden flex flex-col" style={{ height: "calc(100vh - 80px)" }}>
        <div className="p-3 border-b bg-gradient-to-r from-blue-50 to-purple-50 flex items-center gap-2">
          <span className="text-sm">ğŸ’¬</span>
          <p className="text-xs font-bold text-blue-700">AIãƒãƒ£ãƒƒãƒˆã‚µãƒãƒ¼ãƒˆ</p>
          <Badge text="Claude 4 Opus" color="purple" />
          <button onClick={() => setChatOpen(false)} className="ml-auto text-slate-400 hover:text-slate-600 text-sm" title="ãƒãƒ£ãƒƒãƒˆã‚’é–‰ã˜ã‚‹">â—€</button>
        </div>
        {/* ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */}
        <div className="p-2 border-b bg-slate-50">
          <div className="flex flex-wrap gap-1">
            {["ä¸æ­£æ¤œçŸ¥ã®çŠ¶æ³", "ä»Šæ—¥ã®æ±ºæ¸ˆä»¶æ•°", "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã®ç¢ºèª", "ç²¾ç®—çŠ¶æ³", "ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œç´¢"].map(q => (
              <button key={q} onClick={() => sendChat(q)} className="text-xs bg-white border rounded px-2 py-1 text-slate-500 hover:bg-blue-50 hover:text-blue-600">{q}</button>
            ))}
          </div>
        </div>
        {/* ä¼šè©±ã‚¨ãƒªã‚¢ */}
        <div className="flex-1 p-3 space-y-2 overflow-y-auto bg-slate-50">
          {chatMessages.map((msg, i) => msg.role === "user" ? (
            <div key={i} className="flex gap-2 justify-end">
              <div className="bg-blue-600 rounded-lg p-2 max-w-[220px]"><p className="text-xs text-white whitespace-pre-wrap">{msg.text}</p></div>
            </div>
          ) : (
            <div key={i} className="flex gap-2">
              <div className="w-5 h-5 rounded-full bg-blue-100 flex items-center justify-center text-xs shrink-0">ğŸ¤–</div>
              <div className="bg-white rounded-lg p-2 border border-slate-200">
                <p className="text-xs text-slate-700 whitespace-pre-wrap">{msg.text}</p>
                <div className="flex gap-1 mt-1.5 border-t pt-1">
                  <button onClick={() => toast("ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "success")} className="text-xs text-slate-400 hover:text-emerald-600">ğŸ‘</button>
                  <button onClick={() => toast("ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "info")} className="text-xs text-slate-400 hover:text-red-600">ğŸ‘</button>
                  <button onClick={() => { navigator.clipboard?.writeText(msg.text); toast("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "info"); }} className="text-xs text-slate-400 hover:text-blue-600 ml-auto">ğŸ“‹</button>
                </div>
              </div>
            </div>
          ))}
        </div>
        {/* å…¥åŠ›ã‚¨ãƒªã‚¢ */}
        <div className="p-2 border-t bg-white flex gap-2">
          <input value={chatInput} onChange={e => setChatInput(e.target.value)} onKeyDown={e => e.key === "Enter" && sendChat(chatInput)} className="flex-1 text-xs border rounded-lg px-3 py-2" placeholder="AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«è³ªå•..." />
          <button onClick={() => sendChat(chatInput)} className="px-3 py-2 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700">é€ä¿¡</button>
        </div>
      </div>
      ) : (
      <button onClick={() => setChatOpen(true)} className="bg-white rounded-lg border border-slate-200 shadow-sm flex flex-col items-center justify-center gap-2 hover:bg-blue-50 transition-colors cursor-pointer" style={{ height: "calc(100vh - 80px)" }}>
        <span className="text-lg">ğŸ’¬</span>
        <span className="text-[10px] text-slate-400 font-bold" style={{ writingMode: "vertical-rl" }}>AIãƒãƒ£ãƒƒãƒˆ</span>
      </button>
      )}
    </div>

    {/* ===== å³ã‚«ãƒ©ãƒ : ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœ¬ä½“ ===== */}
    <div className="flex-1 space-y-4 min-w-0">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
      <div className="flex gap-2">
        <span className="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded">å…¨ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸</span>
        <span className="text-xs text-slate-400">æœ€çµ‚æ›´æ–°: 14:32</span>
      </div>
    </div>

    {/* AI Summary â€” â€» reviewer ãƒ­ãƒ¼ãƒ«ã«ã¯éè¡¨ç¤º / Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥30åˆ† */}
    <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200 p-3">
      <div className="flex items-center justify-between mb-1">
        <div className="flex items-center gap-2">
          <span>ğŸ¤–</span>
          <span className="text-xs font-bold text-blue-700">AI ã‚µãƒãƒªãƒ¼</span>
        </div>
        <button onClick={handleRegenerate} className="text-xs text-blue-500 hover:text-blue-700">{aiSummaryLoading ? "â³ ç”Ÿæˆä¸­..." : "ğŸ”„ å†ç”Ÿæˆ"}</button>
      </div>
      <p className={`text-xs text-slate-700 transition-opacity duration-300 ${aiSummaryLoading ? "opacity-30" : "opacity-100"}`}>{aiSummaryLoading ? "AIã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™..." : "æœ¬æ—¥ã®å–å¼•ã¯é †èª¿ã§ã™ã€‚å–å¼•é‡ã¯å‰æ—¥æ¯”+8%ã€æ±ºæ¸ˆæˆåŠŸç‡99.2%ã€‚ä¸æ­£æ¤œçŸ¥ã§2ä»¶ã‚’è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯æ¸ˆã¿ã€‚ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã«å¯©æŸ»ä¿ç•™3ä»¶ã‚ã‚Šï¼ˆã†ã¡1ä»¶ã¯2æ™‚é–“è¶…éï¼‰ã€‚å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"}</p>
    </div>

    {/* ãŠçŸ¥ã‚‰ã›æ¬„ */}
    {(() => {
      const allNotices = [
        { date: "02/17", title: "æ±ºæ¸ˆå‡¦ç†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›ï¼ˆ2/20 AM2:00-4:00ï¼‰", type: "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹", tColor: "yellow", icon: "ğŸ”§", target: "å…¨ä½“" },
        { date: "02/16", title: "Worldpayæ¥ç¶š ãƒ¬ãƒ¼ãƒˆæ”¹å®šã®ãŠçŸ¥ã‚‰ã›ï¼ˆ3æœˆé©ç”¨ï¼‰", type: "é‡è¦", tColor: "red", icon: "ğŸ’³", target: "ç®¡ç†è€…" },
        { date: "02/15", title: "æ–°æ©Ÿèƒ½: Apple Pay / Google Pay å¯¾å¿œé–‹å§‹", type: "ãƒªãƒªãƒ¼ã‚¹", tColor: "blue", icon: "ğŸš€", target: "å…¨ä½“" },
        { date: "02/14", title: "ã€å¾©æ—§æ¸ˆã€‘2/14 æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼å¢—åŠ ã«ã¤ã„ã¦", type: "éšœå®³", tColor: "red", icon: "âš ï¸", target: "å…¨ä½“" },
        { date: "02/12", title: "3Dã‚»ã‚­ãƒ¥ã‚¢2.0 å®Œå…¨ç§»è¡Œã®ãŠçŸ¥ã‚‰ã›", type: "ãŠçŸ¥ã‚‰ã›", tColor: "default", icon: "ğŸ“Œ", target: "å…¨ä½“" },
        { date: "02/10", title: "ä»£ç†åº—å‘ã‘å ±é…¬è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ã«ã¤ã„ã¦", type: "é‡è¦", tColor: "red", icon: "ğŸ¤", target: "ç®¡ç†è€…" },
      ];
      const renderNotice = (n, i) => (
        <div key={i} className={`flex items-center gap-2 p-2 rounded border text-xs cursor-pointer hover:bg-blue-50 ${i === 0 ? "border-amber-300 bg-amber-50" : i === 1 ? "border-rose-200 bg-rose-50/50" : "border-slate-200"}`}>
          <span>{n.icon}</span>
          <span className="w-12 text-slate-400 shrink-0">{n.date}</span>
          <Badge text={n.type} color={n.tColor} />
          <span className="px-1.5 py-0.5 bg-slate-100 rounded text-xs text-slate-500">{n.target}</span>
          <span className={`flex-1 ${i <= 1 ? "font-semibold" : ""} ${i === 0 ? "text-amber-800" : i === 1 ? "text-rose-700" : "text-slate-700"}`}>{n.title}</span>
        </div>
      );
      return (
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex items-center justify-between mb-2">
          <div className="flex items-center gap-2">
            <span>ğŸ“¢</span>
            <p className="text-xs font-bold text-slate-600">ãŠçŸ¥ã‚‰ã›</p>
            <Badge text="ç®¡ç†è€…å‘ã‘" color="purple" />
            {allNotices.length > 3 && <span className="text-xs text-slate-300">({allNotices.length}ä»¶)</span>}
          </div>
          {allNotices.length > 3 && (
            <button className="text-xs text-blue-600 cursor-pointer hover:underline" onClick={() => setShowAllNotices(!showAllNotices)}>
              {showAllNotices ? "é–‰ã˜ã‚‹ â–²" : `ã™ã¹ã¦è¦‹ã‚‹ (${allNotices.length - 3}ä»¶) â–¼`}
            </button>
          )}
        </div>
        <div className="space-y-1.5">
          {allNotices.slice(0, 3).map(renderNotice)}
          {showAllNotices && (
            <div className="space-y-1.5 pt-1 border-t border-dashed border-slate-200 mt-1">
              {allNotices.slice(3).map((n, i) => renderNotice(n, i + 3))}
            </div>
          )}
        </div>
      </div>
      );
    })()}

    {/* ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ€ä¸Šéƒ¨ï¼‰ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-2">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</p>
      <div className="flex gap-2">
        {[["ğŸ“‹ ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", "rose"], ["ğŸ” å–å¼•æ¤œç´¢", "blue"], ["ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ", "emerald"], ["ğŸ‘¥ åŠ ç›Ÿåº—ä¸€è¦§", "slate"], ["ğŸ¤– AIç›£è¦–", "purple"]].map(([label, color], i) => (
          <button key={i} onClick={() => nav.setMasterPage(navMap[label])} className={`flex-1 py-2 rounded-lg border text-xs font-bold bg-${color}-50 text-${color}-700 border-${color}-200 hover:bg-${color}-100`}>{label}</button>
        ))}
      </div>
    </div>

    {/* KPIs + Period Toggle */}
    <div className="space-y-2">
      <div className="flex justify-end">
        <div className="flex bg-slate-100 rounded-lg p-1">
          {[{k:"today",l:"æœ¬æ—¥"},{k:"week",l:"ä»Šé€±"},{k:"month",l:"ä»Šæœˆ"}].map(p => (
            <button key={p.k} className={`text-sm px-3 py-1.5 rounded ${kpiPeriod === p.k ? "bg-white shadow-sm text-blue-600 font-semibold" : "text-slate-500"}`}
              onClick={() => setKpiPeriod(p.k)}>{p.l}</button>
          ))}
        </div>
      </div>
      <div className="flex gap-3">
        {[{ label: "å–å¼•é‡", value: "1,247ä»¶", sub: "å‰æ—¥æ¯”", trend: 8 }, { label: "æ±ºæ¸ˆé«˜", value: "Â¥18.3M", sub: "å‰æ—¥æ¯”", trend: 12 }, { label: "æ±ºæ¸ˆæˆåŠŸç‡", value: "99.2%", sub: "ç›®æ¨™: 99.0%", color: "green" }, { label: "ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ç‡", value: "0.03%", sub: "åŸºæº–: 1.0%ä»¥ä¸‹", color: "green" }, { label: "è‡ªå‹•åŒ–ç‡", value: "94.2%", sub: "ç›®æ¨™: 95%", color: "purple" }].map((k, i) => (
          <div key={i} onClick={() => kpiDrillData[k.label] && setShowKpiDrill(k.label)} className={`flex-1 ${kpiDrillData[k.label] ? "cursor-pointer hover:ring-2 hover:ring-blue-200 rounded-lg transition-all" : ""}`}>
            <KPICard label={k.label} value={k.value} sub={k.sub} trend={k.trend} color={k.color} />
          </div>
        ))}
      </div>
    </div>

    {/* Charts + Exception Queue Preview */}
    <div className="flex gap-3">
      <div className="flex-1 bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex justify-between items-center mb-2">
          <div className="flex items-center gap-2">
            <p className="text-xs font-bold text-slate-600">å–å¼•æ¨ç§»</p>
            <div className="flex bg-slate-100 rounded-lg p-1">
              {[{k:"count",l:"ä»¶æ•°"},{k:"amount",l:"é‡‘é¡"}].map(t => (
                <button key={t.k} className={`text-sm px-3 py-1.5 rounded ${chartType === t.k ? "bg-white shadow-sm text-blue-600 font-semibold" : "text-slate-400"}`}
                  onClick={() => setChartType(t.k)}>{t.l}</button>
              ))}
            </div>
          </div>
          <div className="flex bg-slate-100 rounded-lg p-1">
            {[{k:"7d",l:"7æ—¥"},{k:"30d",l:"30æ—¥"},{k:"90d",l:"90æ—¥"}].map(p => (
              <button key={p.k} className={`text-sm px-3 py-1.5 rounded ${chartPeriod === p.k ? "bg-white shadow-sm text-blue-600 font-semibold" : "text-slate-400"}`}
                onClick={() => setChartPeriod(p.k)}>{p.l}</button>
            ))}
          </div>
        </div>
        {chartType === "count" ? (
          <div className="h-24 flex items-end gap-1">
            {[820, 950, 1100, 980, 1150, 1200, 1247].map((v, i) => (
              <div key={i} className="flex-1 flex flex-col items-center">
                <div className="w-full bg-blue-400 rounded-t" style={{ height: `${(v / 1300) * 80}px` }} />
                <span className="text-xs text-slate-400 mt-1">{["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"][i]}</span>
              </div>
            ))}
          </div>
        ) : (
          <div className="h-24 flex items-end gap-1">
            {[12.5, 14.2, 16.8, 15.1, 17.3, 18.0, 18.3].map((v, i) => (
              <div key={i} className="flex-1 flex flex-col items-center">
                <div className="w-full bg-emerald-400 rounded-t" style={{ height: `${(v / 20) * 80}px` }} />
                <span className="text-xs text-slate-400 mt-1">{["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"][i]}</span>
              </div>
            ))}
          </div>
        )}
      </div>
      <div className="w-72 bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex justify-between items-center mb-2">
          <p className="text-xs font-bold text-slate-600">ä¾‹å¤–ã‚­ãƒ¥ãƒ¼</p>
          <div className="flex items-center gap-2">
            <span className="bg-rose-500 text-white text-xs rounded-full px-1.5 py-0.5">3ä»¶</span>
            <button onClick={() => nav.setMasterPage("queue")} className="text-xs text-blue-500 hover:underline">å…¨ã¦è¦‹ã‚‹ â†’</button>
          </div>
        </div>
        <div className="space-y-2">
          <div className="bg-amber-50 rounded p-2 border border-amber-200">
            <div className="flex justify-between"><span className="text-xs font-semibold text-slate-700">å¯©æŸ»ä¿ç•™ #1024</span><Badge text="âš ï¸ 2hè¶…é" color="red" /></div>
            <p className="text-xs text-slate-500 mt-1">ä¸­ãƒªã‚¹ã‚¯åŠ ç›Ÿåº— / AIæ¨è–¦: æ‰¿èª</p>
          </div>
          <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
            <div className="flex justify-between"><span className="text-xs font-semibold text-slate-700">ä¸æ­£æ¤œçŸ¥ä¿ç•™ #5521</span><Badge text="30åˆ†å‰" color="yellow" /></div>
            <p className="text-xs text-slate-500 mt-1">Â¥89,000 / ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢: 72</p>
          </div>
          <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
            <div className="flex justify-between"><span className="text-xs font-semibold text-slate-700">å¯©æŸ»ä¿ç•™ #1025</span><Badge text="15åˆ†å‰" color="gray" /></div>
            <p className="text-xs text-slate-500 mt-1">ä¸­ãƒªã‚¹ã‚¯ / AIæ¨è–¦: æ‰¿èª</p>
          </div>
        </div>
      </div>
    </div>

    {/* Processor Health â€” ğŸŸ¢æ­£å¸¸ ğŸŸ¡æ³¨æ„ ğŸ”´ç•°å¸¸ ğŸ”µãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ğŸŸ ç·Šæ€¥ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-2">æ¥ç¶šå…ˆãƒ˜ãƒ«ã‚¹</p>
      <div className="flex gap-3">
        {[
          { name: "Univa Pay cast", status: "healthy", rate: "99.5%", ms: "120ms", tag: null },
          { name: "æ¥½å¤©éŠ€è¡Œ", status: "healthy", rate: "99.1%", ms: "95ms", tag: null },
          { name: "TCMS", status: "maintenance", rate: "-", ms: "-", tag: "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹" },
          { name: "Worldpay", status: "healthy", rate: "99.3%", ms: "110ms", tag: null },
          { name: "ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥", status: "healthy", rate: "99.8%", ms: "80ms", tag: null },
          { name: "ãƒšã‚¤ãƒ‡ã‚£", status: "healthy", rate: "99.9%", ms: "75ms", tag: null },
        ].map((p, i) => (
          <div key={i} className="flex-1 bg-slate-50 rounded p-2 flex items-center gap-2">
            <div className={`w-2 h-2 rounded-full ${
              p.status === "healthy" ? "bg-emerald-500" :
              p.status === "warning" ? "bg-amber-500" :
              p.status === "error" ? "bg-rose-500" :
              p.status === "maintenance" ? "bg-blue-500" :
              "bg-orange-500"
            }`} />
            <div>
              <div className="flex items-center gap-1">
                <p className="text-xs font-semibold text-slate-700">{p.name}</p>
                {p.tag && <span className={`text-xs px-1 py-0.5 rounded ${p.status === "maintenance" ? "bg-blue-100 text-blue-600" : "bg-orange-100 text-orange-600"}`}>{p.tag}</span>}
              </div>
              <p className="text-xs text-slate-400">{p.tag ? "è¨ˆç”»åœæ­¢ä¸­" : `æˆåŠŸç‡ ${p.rate} / ${p.ms}`}</p>
            </div>
          </div>
        ))}
      </div>
    </div>

    </div>{/* å³ã‚«ãƒ©ãƒ çµ‚äº† */}

    {/* KPIãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showKpiDrill && kpiDrillData[showKpiDrill] && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowKpiDrill(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[420px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">{showKpiDrill} - å†…è¨³</p>
            <button onClick={() => setShowKpiDrill(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            <div className="text-center py-2"><p className="text-2xl font-bold text-slate-800">{kpiDrillData[showKpiDrill].value}</p></div>
            <div className="space-y-2">
              {kpiDrillData[showKpiDrill].details.map((d, i) => (
                <div key={i} className="flex items-center text-xs border-b pb-1.5"><span className="flex-1 text-slate-600">{d.label}</span><span className="font-bold text-slate-800">{d.value}</span></div>
              ))}
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ M02: ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ â”€â”€â”€
const MasterExceptionQueue = () => {
  const toast = useToast();
  const [queueFilter, setQueueFilter] = useState("all");
  const [checkedItems, setCheckedItems] = useState([]);
  const [showBatchConfirm, setShowBatchConfirm] = useState(null);
  const [selectedQueueId, setSelectedQueueId] = useState("#1024");
  const [processedItems, setProcessedItems] = useState({});
  const [actionConfirm, setActionConfirm] = useState(null);

  const toggleCheck = (id) => setCheckedItems(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]);
  const toggleAll = (ids) => setCheckedItems(prev => prev.length === ids.length ? [] : ids);

  const markProcessed = (id, action) => {
    setProcessedItems(prev => ({ ...prev, [id]: action }));
    setSelectedQueueId(prev => {
      const remaining = queueItems.filter(q => q.id !== id && !processedItems[q.id]);
      return remaining.length > 0 ? remaining[0].id : prev;
    });
  };

  const queueItems = [
    { id: "#1024", type: "å¯©æŸ»ä¿ç•™", target: "æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«EC / ã‚¢ãƒ‘ãƒ¬ãƒ«EC", ai: "æ‰¿èªæ¨è–¦", aiColor: "green", time: "2æ™‚é–“12åˆ†", timeColor: "red", locked: false,
      detail: { badge: "å¯©æŸ»ä¿ç•™", company: "æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«EC", staleTime: "2æ™‚é–“12åˆ†", receivedAt: "2026-02-11 12:20",
        aiLabel: "æ‰¿èªã‚’æ¨è–¦", aiIcon: "âœ…", aiConf: "82%", aiColor: "text-emerald-700",
        risk: "ä¸­ãƒªã‚¹ã‚¯ (ã‚¹ã‚³ã‚¢: 58/100)", riskColor: "text-amber-600", riskSub: "æ¥­ç¨®: ã‚¢ãƒ‘ãƒ¬ãƒ«EC / æœˆå•†äºˆæ¸¬: Â¥3M",
        aiSummary: "æ³•äººè¨­ç«‹3å¹´ã€è²¡å‹™çŠ¶æ³ã¯å®‰å®šã€‚ã‚µã‚¤ãƒˆå†…å®¹ã«å•é¡Œãªã—ã€‚åç¤¾ãƒã‚§ãƒƒã‚¯ã‚¯ãƒªã‚¢ã€‚å”¯ä¸€ã®æ‡¸å¿µç‚¹ã¯å–æ‰±å•†å“ã‚«ãƒ†ã‚´ãƒªãŒã€Œé«˜é¡ã‚¢ãƒ‘ãƒ¬ãƒ«ã€ã§è¿”å“ç‡ãŒæ¥­ç•Œå¹³å‡ã‚ˆã‚Šé«˜ã„å¯èƒ½æ€§ã‚ã‚Šã€‚",
        data: [["æ³•äººå", "æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«EC"], ["è¨­ç«‹", "2023å¹´4æœˆ"], ["è³‡æœ¬é‡‘", "Â¥10M"], ["ä»£è¡¨", "å±±ç”° å¤ªéƒ"], ["æ¥­ç¨®", "ã‚¢ãƒ‘ãƒ¬ãƒ«EC"], ["URL", "sample-ec.jp âœ…"], ["åç¤¾ãƒã‚§ãƒƒã‚¯", "âœ… ã‚¯ãƒªã‚¢"], ["æ±ºç®—æ›¸", "âœ… è§£ææ¸ˆã¿"]],
      }},
    { id: "#5521", type: "ä¸æ­£æ¤œçŸ¥", target: "Â¥89,000 / ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ / å±±æœ¬å•†åº—", ai: "ãƒ–ãƒ­ãƒƒã‚¯æ¨è–¦", aiColor: "red", time: "30åˆ†", timeColor: "gray", locked: false,
      detail: { badge: "ä¸æ­£æ¤œçŸ¥", company: "å±±æœ¬å•†åº—", staleTime: "30åˆ†", receivedAt: "2026-02-11 14:02",
        aiLabel: "ãƒ–ãƒ­ãƒƒã‚¯ã‚’æ¨è–¦", aiIcon: "ğŸš«", aiConf: "94%", aiColor: "text-rose-700",
        risk: "é«˜ãƒªã‚¹ã‚¯ (ã‚¹ã‚³ã‚¢: 89/100)", riskColor: "text-rose-600", riskSub: "å–å¼•é‡‘é¡: Â¥89,000 / VISA / 3Dã‚»ã‚­ãƒ¥ã‚¢æœªé€šé",
        aiSummary: "éå»30æ—¥é–“ã§åŒä¸€ã‚«ãƒ¼ãƒ‰ç•ªå·ã‹ã‚‰ç•°ãªã‚‹åŠ ç›Ÿåº—ã§5ä»¶ã®å–å¼•ã‚ã‚Šã€‚IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæµ·å¤–VPNçµŒç”±ã€‚ã‚«ãƒ¼ãƒ‰ç™ºè¡Œå›½ã¨åˆ©ç”¨å›½ä¸ä¸€è‡´ã€‚çŸ­æ™‚é–“ã§ã®é€£ç¶šæ±ºæ¸ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«è©²å½“ã€‚",
        data: [["å–å¼•ID", "TXN-20260211-14502"], ["åŠ ç›Ÿåº—", "å±±æœ¬å•†åº—"], ["é‡‘é¡", "Â¥89,000"], ["ãƒ–ãƒ©ãƒ³ãƒ‰", "VISA"], ["ã‚«ãƒ¼ãƒ‰ç™ºè¡Œå›½", "US"], ["åˆ©ç”¨å›½", "JPï¼ˆVPNçµŒç”±ï¼‰"], ["ä¸æ­£ã‚¹ã‚³ã‚¢", "0.89"], ["3DS", "æœªé€šé"]],
      }},
    { id: "#1025", type: "å¯©æŸ»ä¿ç•™", target: "åˆåŒä¼šç¤¾ãƒ†ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒ— / é›‘è²¨EC", ai: "æ‰¿èªæ¨è–¦", aiColor: "green", time: "15åˆ†", timeColor: "gray", locked: true, lockedBy: "ç”°ä¸­",
      detail: { badge: "å¯©æŸ»ä¿ç•™", company: "åˆåŒä¼šç¤¾ãƒ†ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒ—", staleTime: "15åˆ†", receivedAt: "2026-02-11 14:17",
        aiLabel: "æ‰¿èªã‚’æ¨è–¦", aiIcon: "âœ…", aiConf: "91%", aiColor: "text-emerald-700",
        risk: "ä½ãƒªã‚¹ã‚¯ (ã‚¹ã‚³ã‚¢: 25/100)", riskColor: "text-emerald-600", riskSub: "æ¥­ç¨®: é›‘è²¨EC / æœˆå•†äºˆæ¸¬: Â¥1.5M",
        aiSummary: "æ³•äººè¨­ç«‹5å¹´ã€è²¡å‹™å¥å…¨ã€‚éå»ã®å–å¼•å®Ÿç¸¾ã‚ã‚Šï¼ˆåˆ¥PSPçµŒç”±ï¼‰ã€‚ã‚µã‚¤ãƒˆå†…å®¹ã¯é©æ­£ã€‚ä»£è¡¨è€…ã®ä¿¡ç”¨æƒ…å ±ã‚‚å•é¡Œãªã—ã€‚",
        data: [["æ³•äººå", "åˆåŒä¼šç¤¾ãƒ†ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒ—"], ["è¨­ç«‹", "2021å¹´8æœˆ"], ["è³‡æœ¬é‡‘", "Â¥5M"], ["ä»£è¡¨", "ä½è—¤ èŠ±å­"], ["æ¥­ç¨®", "é›‘è²¨EC"], ["URL", "test-shop.jp âœ…"], ["åç¤¾ãƒã‚§ãƒƒã‚¯", "âœ… ã‚¯ãƒªã‚¢"], ["æ±ºç®—æ›¸", "âœ… è§£ææ¸ˆã¿"]],
      }},
    { id: "#5518", type: "URLå·¡å›", target: "sample-shop.jp / å•†å“ãƒšãƒ¼ã‚¸å¤‰æ›´æ¤œçŸ¥", ai: "è¦ç¢ºèª", aiColor: "yellow", time: "1æ™‚é–“", timeColor: "yellow", locked: false,
      detail: { badge: "URLå·¡å›", company: "sample-shop.jp", staleTime: "1æ™‚é–“", receivedAt: "2026-02-11 13:32",
        aiLabel: "è¦ç¢ºèª", aiIcon: "âš ï¸", aiConf: "65%", aiColor: "text-amber-700",
        risk: "ä¸­ãƒªã‚¹ã‚¯ (ã‚¹ã‚³ã‚¢: 52/100)", riskColor: "text-amber-600", riskSub: "å•†å“ãƒšãƒ¼ã‚¸ã®å†…å®¹å¤‰æ›´æ¤œçŸ¥",
        aiSummary: "å®šæœŸå·¡å›ã§å•†å“ãƒšãƒ¼ã‚¸ã®å¤§å¹…å¤‰æ›´ã‚’æ¤œçŸ¥ã€‚æ–°ãŸã«ã€Œã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆã€ã‚«ãƒ†ã‚´ãƒªãŒè¿½åŠ ã•ã‚Œã¦ãŠã‚Šã€ç”³å‘Šæ¥­ç¨®ï¼ˆé›‘è²¨ï¼‰ã¨ã®ä¹–é›¢ã®å¯èƒ½æ€§ã‚ã‚Šã€‚è–¬æ©Ÿæ³•é–¢é€£ã®è¡¨è¨˜ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦ã€‚",
        data: [["ã‚µã‚¤ãƒˆURL", "sample-shop.jp"], ["å¤‰æ›´æ¤œçŸ¥æ—¥æ™‚", "2026-02-11 13:30"], ["å¤‰æ›´ç¨®åˆ¥", "å•†å“ã‚«ãƒ†ã‚´ãƒªè¿½åŠ "], ["æ–°ã‚«ãƒ†ã‚´ãƒª", "ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ"], ["ç”³å‘Šæ¥­ç¨®", "é›‘è²¨EC"], ["å‰å›å·¡å›", "2026-02-04"], ["å¤‰æ›´ç®‡æ‰€æ•°", "12ãƒšãƒ¼ã‚¸"], ["AIåˆ¤å®š", "æ¥­ç¨®ä¹–é›¢ã®å¯èƒ½æ€§"]],
      }},
    { id: "#5515", type: "ç²¾ç®—", target: "Univa Pay cast / ãƒãƒƒãƒ#B-0210 / ã‚¨ãƒ©ãƒ¼3ä»¶", ai: "å†å®Ÿè¡Œæ¨è–¦", aiColor: "blue", time: "2æ™‚é–“", timeColor: "red", locked: false,
      detail: { badge: "ç²¾ç®—", company: "Univa Pay cast ãƒãƒƒãƒ#B-0210", staleTime: "2æ™‚é–“", receivedAt: "2026-02-11 12:32",
        aiLabel: "å†å®Ÿè¡Œã‚’æ¨è–¦", aiIcon: "ğŸ”„", aiConf: "88%", aiColor: "text-blue-700",
        risk: "ä½ãƒªã‚¹ã‚¯ (ã‚¹ã‚³ã‚¢: 15/100)", riskColor: "text-emerald-600", riskSub: "ç²¾ç®—ãƒãƒƒãƒã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼",
        aiSummary: "ãƒãƒƒãƒ#B-0210ã®ç²¾ç®—å‡¦ç†ã§3ä»¶ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ã€‚åŸå› ã¯ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼å´ã®ä¸€æ™‚çš„ãªé…å»¶ã¨æ¨å®šã€‚åŒæ™‚é–“å¸¯ã®ä»–ã®ãƒãƒƒãƒã¯æ­£å¸¸å®Œäº†ã€‚å†å®Ÿè¡Œã§è§£æ±ºã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€‚",
        data: [["ãƒãƒƒãƒID", "B-0210"], ["æ¥ç¶šå…ˆ", "Univa Pay cast"], ["ã‚¨ãƒ©ãƒ¼ä»¶æ•°", "3ä»¶"], ["ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥", "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ"], ["æ­£å¸¸ä»¶æ•°", "147ä»¶"], ["ç·é¡", "Â¥8,520,000"], ["ã‚¨ãƒ©ãƒ¼é‡‘é¡", "Â¥312,000"], ["æ¨è–¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³", "å†å®Ÿè¡Œ"]],
      }},
  ];

  const selectedItem = queueItems.find(q => q.id === selectedQueueId) || queueItems[0];
  const d = selectedItem.detail;

  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">ä¾‹å¤–ã‚­ãƒ¥ãƒ¼</h2>
      <div className="flex gap-2">
        {[{ k: "all", label: "å…¨ã¦" }, { k: "review", label: "å¯©æŸ»ä¿ç•™" }, { k: "fraud", label: "ä¸æ­£æ¤œçŸ¥" }, { k: "url", label: "URLå·¡å›" }, { k: "settlement", label: "ç²¾ç®—" }, { k: "done", label: "å‡¦ç†æ¸ˆã¿" }].map(f => (
          <button key={f.k} onClick={() => setQueueFilter(f.k)} className={`text-xs px-2 py-1 rounded border ${queueFilter === f.k ? "bg-blue-50 text-blue-600 border-blue-200" : "bg-white text-slate-500"} ${f.k === "done" ? "border-dashed" : ""}`}>{f.label}</button>
        ))}
      </div>
    </div>

    {/* Statistics Bar */}
    <div className="flex gap-4 text-xs">
      <div className="flex items-center gap-1.5">
        <span className="text-slate-400">ä»Šæ—¥ã®å‡¦ç†:</span>
        <span className="font-bold text-slate-700">12ä»¶</span>
      </div>
      <div className="flex items-center gap-1.5">
        <span className="text-slate-400">AIä¸€è‡´ç‡:</span>
        <span className="font-bold text-emerald-600">87%</span>
      </div>
      {checkedItems.length > 0 && (
        <div className="flex items-center gap-2 ml-auto bg-blue-50 rounded px-3 py-1 border border-blue-200">
          <span className="font-bold text-blue-700">{checkedItems.length}ä»¶é¸æŠä¸­</span>
          <button onClick={() => setShowBatchConfirm("approve")} className="px-2 py-0.5 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700">ä¸€æ‹¬æ‰¿èª</button>
          <button onClick={() => setShowBatchConfirm("reject")} className="px-2 py-0.5 bg-rose-600 text-white rounded text-xs font-semibold hover:bg-rose-700">ä¸€æ‹¬æ‹’å¦</button>
          <button onClick={() => setCheckedItems([])} className="text-xs text-slate-400 hover:text-slate-600">âœ• è§£é™¤</button>
        </div>
      )}
    </div>

    {/* Detail card â€” é¸æŠä¸­ã®ã‚­ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ è©³ç´° */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm">
      <div className={`p-3 border-b ${d.badge === "ä¸æ­£æ¤œçŸ¥" ? "bg-rose-50" : d.badge === "ç²¾ç®—" ? "bg-blue-50" : d.badge === "URLå·¡å›" ? "bg-purple-50" : "bg-amber-50"}`}>
        <div className="flex justify-between items-center">
          <div className="flex items-center gap-2">
            <Badge text={d.badge} color={d.badge === "ä¸æ­£æ¤œçŸ¥" ? "red" : d.badge === "ç²¾ç®—" ? "blue" : d.badge === "URLå·¡å›" ? "purple" : "yellow"} />
            <span className="text-sm font-bold text-slate-800">{selectedItem.id} - {d.company}</span>
            {parseInt(d.staleTime) >= 60 || d.staleTime.includes("æ™‚é–“") ? <Badge text={`âš ï¸ æ»ç•™ ${d.staleTime}`} color="red" /> : <Badge text={`æ»ç•™ ${d.staleTime}`} color="gray" />}
          </div>
          <span className="text-xs text-slate-400">å—ä»˜: {d.receivedAt}</span>
        </div>
      </div>

      <div className="p-3">
        <div className="grid grid-cols-3 gap-4 mb-3">
          <div>
            <p className="text-xs text-slate-400 mb-1">AIæ¨è–¦åˆ¤å®š</p>
            <div className="flex items-center gap-2">
              <span className="text-lg">{d.aiIcon}</span>
              <div>
                <p className={`text-sm font-bold ${d.aiColor}`}>{d.aiLabel}</p>
                <p className="text-xs text-slate-500">ä¿¡é ¼åº¦: {d.aiConf}</p>
              </div>
            </div>
          </div>
          <div>
            <p className="text-xs text-slate-400 mb-1">ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«</p>
            <p className={`text-sm font-bold ${d.riskColor}`}>{d.risk}</p>
            <p className="text-xs text-slate-500">{d.riskSub}</p>
          </div>
          <div>
            <p className="text-xs text-slate-400 mb-1">AIåˆ†æã‚µãƒãƒªãƒ¼</p>
            <p className="text-xs text-slate-600">{d.aiSummary}</p>
          </div>
        </div>

        <div className="bg-slate-50 rounded p-2 mb-3">
          <p className="text-xs font-bold text-slate-600 mb-1">AIãŒåé›†ã—ãŸä¸»è¦ãƒ‡ãƒ¼ã‚¿</p>
          <div className="grid grid-cols-4 gap-2 text-xs">
            {d.data.map(([label, value], di) => (
              <div key={di}><span className="text-slate-400">{label}:</span> {value}</div>
            ))}
          </div>
        </div>

        <div className="flex gap-2 justify-end">
          {processedItems[selectedItem.id] ? (
            <span className="text-xs text-slate-400 italic">âœ” å‡¦ç†æ¸ˆã¿ï¼ˆ{processedItems[selectedItem.id]}ï¼‰</span>
          ) : d.badge === "ä¸æ­£æ¤œçŸ¥" ? (<>
            <button onClick={() => setActionConfirm({ title: "æ­£å¸¸ã¨åˆ¤å®š", description: `${selectedItem.id} ã‚’æ­£å¸¸ãªå–å¼•ã¨ã—ã¦å‡¦ç†ã—ã¾ã™ã€‚`, type: "approve", onConfirm: () => { markProcessed(selectedItem.id, "æ­£å¸¸åˆ¤å®š"); toast(`${selectedItem.id} ã‚’æ­£å¸¸ã¨åˆ¤å®šã—ã¾ã—ãŸ`, "success"); } })} className="px-4 py-2 bg-emerald-100 text-emerald-700 rounded text-xs font-semibold hover:bg-emerald-200">âœ“ æ­£å¸¸ã¨åˆ¤å®š</button>
            <button onClick={() => setActionConfirm({ title: "ãƒ–ãƒ­ãƒƒã‚¯ç¢ºå®š", description: `${selectedItem.id} ã®å–å¼•ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚`, warning: "ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸå–å¼•ã¯åŠ ç›Ÿåº—ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚", type: "danger", onConfirm: () => { markProcessed(selectedItem.id, "ãƒ–ãƒ­ãƒƒã‚¯"); toast(`${selectedItem.id} ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã—ãŸ`, "warning"); } })} className="px-4 py-2 bg-rose-600 text-white rounded text-xs font-semibold hover:bg-rose-700">ğŸš« ãƒ–ãƒ­ãƒƒã‚¯ç¢ºå®š</button>
          </>) : d.badge === "ç²¾ç®—" ? (<>
            <button onClick={() => { markProcessed(selectedItem.id, "ã‚¹ã‚­ãƒƒãƒ—"); toast(`${selectedItem.id} ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ`, "info"); }} className="px-4 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">ã‚¹ã‚­ãƒƒãƒ—</button>
            <button onClick={() => setActionConfirm({ title: "ç²¾ç®—å†å®Ÿè¡Œ", description: `${selectedItem.id} ã®ç²¾ç®—ãƒãƒƒãƒã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚`, type: "info", onConfirm: () => { markProcessed(selectedItem.id, "å†å®Ÿè¡Œ"); toast(`${selectedItem.id} ã®å†å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã—ãŸ`, "success"); } })} className="px-4 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">ğŸ”„ å†å®Ÿè¡Œ</button>
          </>) : d.badge === "URLå·¡å›" ? (<>
            <button onClick={() => setActionConfirm({ title: "å•é¡Œãªã—ã¨åˆ¤å®š", description: `${selectedItem.id} ã®URLå¤‰æ›´ã‚’å•é¡Œãªã—ã¨åˆ¤å®šã—ã¾ã™ã€‚`, type: "approve", onConfirm: () => { markProcessed(selectedItem.id, "å•é¡Œãªã—"); toast(`${selectedItem.id} ã‚’å•é¡Œãªã—ã¨åˆ¤å®šã—ã¾ã—ãŸ`, "success"); } })} className="px-4 py-2 bg-emerald-100 text-emerald-700 rounded text-xs font-semibold hover:bg-emerald-200">å•é¡Œãªã—</button>
            <button onClick={() => setActionConfirm({ title: "åŠ ç›Ÿåº—ã«ç¢ºèª", description: `${selectedItem.id} ã«ã¤ã„ã¦åŠ ç›Ÿåº—ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™ã€‚`, type: "warning", onConfirm: () => { markProcessed(selectedItem.id, "åŠ ç›Ÿåº—ç¢ºèªä¸­"); toast(`${selectedItem.id} ã®ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ`, "info"); } })} className="px-4 py-2 bg-amber-100 text-amber-700 rounded text-xs font-semibold hover:bg-amber-200">åŠ ç›Ÿåº—ã«ç¢ºèª</button>
            <button onClick={() => setActionConfirm({ title: "ã‚µã‚¤ãƒˆåœæ­¢", description: `${selectedItem.id} ã®ã‚µã‚¤ãƒˆã‚’åœæ­¢ã—ã¾ã™ã€‚`, warning: "åœæ­¢ã™ã‚‹ã¨è©²å½“ã‚µã‚¤ãƒˆã®æ±ºæ¸ˆå‡¦ç†ãŒåœæ­¢ã•ã‚Œã¾ã™ã€‚", type: "danger", onConfirm: () => { markProcessed(selectedItem.id, "åœæ­¢"); toast(`${selectedItem.id} ã®ã‚µã‚¤ãƒˆã‚’åœæ­¢ã—ã¾ã—ãŸ`, "warning"); } })} className="px-4 py-2 bg-rose-600 text-white rounded text-xs font-semibold hover:bg-rose-700">åœæ­¢</button>
          </>) : (<>
            <button onClick={() => setActionConfirm({ title: "å¯©æŸ»æ‹’å¦", description: `${selectedItem.id} ã®å¯©æŸ»ç”³è«‹ã‚’æ‹’å¦ã—ã¾ã™ã€‚`, warning: "æ‹’å¦ç†ç”±ãŒåŠ ç›Ÿåº—ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚", type: "reject", onConfirm: () => { markProcessed(selectedItem.id, "æ‹’å¦"); toast(`${selectedItem.id} ã‚’æ‹’å¦ã—ã¾ã—ãŸ`, "warning"); } })} className="px-4 py-2 bg-rose-100 text-rose-700 rounded text-xs font-semibold hover:bg-rose-200">æ‹’å¦</button>
            <button onClick={() => setActionConfirm({ title: "å·®æˆ»ã—", description: `${selectedItem.id} ã‚’å·®æˆ»ã—ã¾ã™ã€‚è¿½åŠ æ›¸é¡ã®æå‡ºã‚’ä¾é ¼ã—ã¾ã™ã€‚`, type: "warning", onConfirm: () => { markProcessed(selectedItem.id, "å·®æˆ»ã—"); toast(`${selectedItem.id} ã‚’å·®æˆ»ã—ã¾ã—ãŸ`, "info"); } })} className="px-4 py-2 bg-amber-100 text-amber-700 rounded text-xs font-semibold hover:bg-amber-200">å·®æˆ»ã—</button>
            <button onClick={() => setActionConfirm({ title: "å¯©æŸ»æ‰¿èª", description: `${selectedItem.id} ã®å¯©æŸ»ã‚’æ‰¿èªã—ã¾ã™ã€‚`, type: "approve", onConfirm: () => { markProcessed(selectedItem.id, "æ‰¿èª"); toast(`${selectedItem.id} ã‚’æ‰¿èªã—ã¾ã—ãŸ`, "success"); } })} className="px-4 py-2 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700">âœ“ æ‰¿èª</button>
          </>)}
        </div>
      </div>
    </div>

    {/* Queue list */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "", w: "w-8" }, { label: "ID", w: "w-16" }, { label: "ç¨®åˆ¥", w: "w-20" }, { label: "å¯¾è±¡", w: "flex-1" }, { label: "AIæ¨è–¦", w: "w-24" }, { label: "æ»ç•™æ™‚é–“", w: "w-24" }, { label: "æ“ä½œ", w: "w-32" }]}>
      <tr className="border-b bg-slate-50">
        <td className="px-4 py-1 w-8"><input type="checkbox" className="w-3.5 h-3.5" checked={checkedItems.length === queueItems.length} onChange={() => toggleAll(queueItems.map(q => q.id))} /></td>
        <td colSpan="6" className="px-4 py-1 text-xs text-slate-400">{checkedItems.length > 0 ? `${checkedItems.length}ä»¶é¸æŠä¸­` : "å…¨é¸æŠ"}</td>
      </tr>
      {queueItems.map((item, i) => (
        <tr key={i} onClick={() => setSelectedQueueId(item.id)} className={`border-b cursor-pointer transition-colors ${processedItems[item.id] ? "bg-slate-100 opacity-60" : selectedQueueId === item.id ? "bg-blue-100 border-l-2 border-l-blue-500" : item.locked ? "bg-orange-50 hover:bg-orange-100" : checkedItems.includes(item.id) ? "bg-blue-50 hover:bg-blue-100" : "hover:bg-slate-100"}`}>
          <td className="px-4 py-2 whitespace-nowrap w-8" onClick={(e) => e.stopPropagation()}><input type="checkbox" className="w-3.5 h-3.5" checked={checkedItems.includes(item.id)} onChange={() => toggleCheck(item.id)} disabled={!!processedItems[item.id]} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-16 font-mono text-slate-600"><div className="flex items-center gap-1">{item.locked && <span title={`${item.lockedBy}ã•ã‚“ãŒå¯¾å¿œä¸­`}>ğŸ”’</span>}{selectedQueueId === item.id ? <span className="font-bold text-blue-700">{item.id}</span> : item.id}</div></td>
          <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={item.type} color={item.type === "ä¸æ­£æ¤œçŸ¥" ? "red" : item.type === "ç²¾ç®—" ? "blue" : item.type === "URLå·¡å›" ? "purple" : "yellow"} /></td>
          <td className="px-4 py-2 whitespace-nowrap text-slate-700">{item.target}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24">{processedItems[item.id] ? <Badge text={`âœ” ${processedItems[item.id]}`} color="gray" /> : <Badge text={item.ai} color={item.aiColor} />}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24"><Badge text={item.time} color={item.timeColor} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-32"><div className="flex gap-1" onClick={(e) => e.stopPropagation()}>
            {processedItems[item.id] ? (
              <span className="text-xs text-slate-400 italic">å‡¦ç†æ¸ˆã¿</span>
            ) : item.type === "ä¸æ­£æ¤œçŸ¥" ? (<>
              <button onClick={() => setActionConfirm({ title: "æ­£å¸¸ã¨åˆ¤å®š", description: `${item.id} ã‚’æ­£å¸¸ãªå–å¼•ã¨ã—ã¦å‡¦ç†ã—ã¾ã™ã€‚`, type: "approve", onConfirm: () => { markProcessed(item.id, "æ­£å¸¸åˆ¤å®š"); toast(`${item.id} ã‚’æ­£å¸¸ã¨åˆ¤å®šã—ã¾ã—ãŸ`, "success"); } })} className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs hover:bg-emerald-200">æ­£å¸¸</button>
              <button onClick={() => setActionConfirm({ title: "ãƒ–ãƒ­ãƒƒã‚¯ç¢ºå®š", description: `${item.id} ã®å–å¼•ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚`, type: "danger", onConfirm: () => { markProcessed(item.id, "ãƒ–ãƒ­ãƒƒã‚¯"); toast(`${item.id} ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã—ãŸ`, "warning"); } })} className="px-2 py-1 bg-rose-100 text-rose-700 rounded text-xs hover:bg-rose-200">ãƒ–ãƒ­ãƒƒã‚¯</button>
            </>) : item.type === "ç²¾ç®—" ? (<>
              <button onClick={() => setActionConfirm({ title: "ç²¾ç®—å†å®Ÿè¡Œ", description: `${item.id} ã®ç²¾ç®—ãƒãƒƒãƒã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚`, type: "info", onConfirm: () => { markProcessed(item.id, "å†å®Ÿè¡Œ"); toast(`${item.id} ã®å†å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã—ãŸ`, "success"); } })} className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">å†å®Ÿè¡Œ</button>
              <button onClick={() => { markProcessed(item.id, "ã‚¹ã‚­ãƒƒãƒ—"); toast(`${item.id} ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ`, "info"); }} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs hover:bg-slate-200">ã‚¹ã‚­ãƒƒãƒ—</button>
            </>) : (<>
              <button onClick={() => setActionConfirm({ title: item.type === "URLå·¡å›" ? "å•é¡Œãªã—ã¨åˆ¤å®š" : "å¯©æŸ»æ‰¿èª", description: `${item.id} ã‚’${item.type === "URLå·¡å›" ? "å•é¡Œãªã—ã¨åˆ¤å®š" : "æ‰¿èª"}ã—ã¾ã™ã€‚`, type: "approve", onConfirm: () => { markProcessed(item.id, item.type === "URLå·¡å›" ? "å•é¡Œãªã—" : "æ‰¿èª"); toast(`${item.id} ã‚’${item.type === "URLå·¡å›" ? "å•é¡Œãªã—ã¨åˆ¤å®š" : "æ‰¿èª"}ã—ã¾ã—ãŸ`, "success"); } })} className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs hover:bg-emerald-200">{item.type === "URLå·¡å›" ? "å•é¡Œãªã—" : "æ‰¿èª"}</button>
              <button onClick={() => setActionConfirm({ title: item.type === "URLå·¡å›" ? "ã‚µã‚¤ãƒˆåœæ­¢" : "å¯©æŸ»æ‹’å¦", description: `${item.id} ã‚’${item.type === "URLå·¡å›" ? "åœæ­¢" : "æ‹’å¦"}ã—ã¾ã™ã€‚`, type: item.type === "URLå·¡å›" ? "danger" : "reject", onConfirm: () => { markProcessed(item.id, item.type === "URLå·¡å›" ? "åœæ­¢" : "æ‹’å¦"); toast(`${item.id} ã‚’${item.type === "URLå·¡å›" ? "åœæ­¢" : "æ‹’å¦"}ã—ã¾ã—ãŸ`, "warning"); } })} className="px-2 py-1 bg-rose-100 text-rose-700 rounded text-xs hover:bg-rose-200">{item.type === "URLå·¡å›" ? "åœæ­¢" : "æ‹’å¦"}</button>
            </>)}
          </div></td>
        </tr>
      ))}
      </TableHeader>
    </div>

    <ConfirmDialog config={actionConfirm} onClose={() => setActionConfirm(null)} />

    {/* â”€â”€ Modal: ãƒãƒƒãƒæ“ä½œç¢ºèª â”€â”€ */}
    {showBatchConfirm && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowBatchConfirm(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
          <div className={`p-4 border-b rounded-t-xl flex justify-between items-center ${showBatchConfirm === "approve" ? "bg-emerald-50" : "bg-rose-50"}`}>
            <h3 className="text-sm font-bold text-slate-800">{showBatchConfirm === "approve" ? "âœ… ä¸€æ‹¬æ‰¿èªã®ç¢ºèª" : "âŒ ä¸€æ‹¬æ‹’å¦ã®ç¢ºèª"}</h3>
            <button onClick={() => setShowBatchConfirm(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className={`rounded-lg border p-3 ${showBatchConfirm === "approve" ? "bg-emerald-50 border-emerald-200" : "bg-rose-50 border-rose-200"}`}>
              <p className="text-xs font-bold text-slate-700 mb-2">å¯¾è±¡: {checkedItems.length}ä»¶</p>
              <div className="space-y-1">
                {checkedItems.map((id, i) => {
                  const item = queueItems.find(q => q.id === id);
                  return item ? (
                    <div key={i} className="flex items-center gap-2 text-xs">
                      <span className="font-mono text-slate-500">{item.id}</span>
                      <Badge text={item.type} color="yellow" />
                      <span className="text-slate-600 truncate">{item.target}</span>
                    </div>
                  ) : null;
                })}
              </div>
            </div>
            {showBatchConfirm === "reject" && (
              <div>
                <label className="text-xs font-semibold text-slate-600">æ‹’å¦ç†ç”± <span className="text-rose-500">*</span></label>
                <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ãƒãƒªã‚·ãƒ¼é•å</option><option>ä¸æ­£åˆ©ç”¨ã®ç–‘ã„</option><option>æ›¸é¡ä¸å‚™</option><option>ãã®ä»–</option></select>
              </div>
            )}
            <div className="bg-yellow-50 rounded border border-yellow-200 p-2 text-xs text-yellow-700">
              âš ï¸ ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚{showBatchConfirm === "approve" ? "æ‰¿èª" : "æ‹’å¦"}å¾Œã€é–¢é€£ã™ã‚‹é€šçŸ¥ãŒè‡ªå‹•é€ä¿¡ã•ã‚Œã¾ã™ã€‚
            </div>
          </div>
          <div className="p-4 border-t flex gap-2 justify-end">
            <button onClick={() => setShowBatchConfirm(null)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={() => { const action = showBatchConfirm === "approve" ? "æ‰¿èª" : "æ‹’å¦"; const count = checkedItems.length; checkedItems.forEach(id => markProcessed(id, action)); setShowBatchConfirm(null); setCheckedItems([]); toast(`${count}ä»¶ã‚’ä¸€æ‹¬${action}ã—ã¾ã—ãŸ`, showBatchConfirm === "approve" ? "success" : "warning"); }} className={`px-4 py-2 text-xs text-white rounded font-semibold ${showBatchConfirm === "approve" ? "bg-emerald-600 hover:bg-emerald-700" : "bg-rose-600 hover:bg-rose-700"}`}>{checkedItems.length}ä»¶ã‚’{showBatchConfirm === "approve" ? "æ‰¿èª" : "æ‹’å¦"}ã™ã‚‹</button>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

const merchantData = [
  { id: "M-001", name: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", status: "æœ‰åŠ¹", sColor: "green", risk: "ä½", rColor: "green", salesNum: 12500000, sales: "Â¥12.5M", cbNum: 0.01, cb: "0.01%", successNum: 99.5, success: "99.5%", feeNum: 3.2, fee: "3.2%", riskOrder: 1,
    sites: [
      { siteId: "S-001-01", siteName: "æœ¬åº—ECã‚µã‚¤ãƒˆ", url: "https://abc-mart.example.com", agentId: "AG-001", agentName: "æ ªå¼ä¼šç¤¾ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º",
        processors: [
          { name: "Univa Pay cast", brands: "VISA/MC", status: "approved", since: "2025-04", txnCount: 8200, mid: "UPC-ABC-001",
            feeOverride: { visa: "3.85%", master: "3.85%" }, trFeesOverride: { success: "35å††", fail: "35å††", cb: "3,500å††", refund: "150å††", tds: "5å††/ä»¶" },
            depositOverride: { rate: "5%", period: "120æ—¥" }, limitOverride: { trMax: "Â¥300,000", monthly: "Â¥50,000,000", count: "3å›/æ—¥ã€7å›/æœˆ" }, settlementOverride: "15æ—¥ç· ã‚æœ«æ‰•ã„ / æœ«ç· ã‚ç¿Œ15æ—¥æ‰•ã„" },
          { name: "æ¥½å¤©éŠ€è¡Œ", brands: "VISA/MC", status: "approved", since: "2025-04", txnCount: 5600, mid: "RKT-ABC-001",
            feeOverride: { visa: "2.95%", master: "2.95%" }, trFeesOverride: { success: "15å††" },
            depositOverride: { rate: "5%", period: "120æ—¥" }, limitOverride: { trMax: "Â¥500,000" }, settlementOverride: null },
          { name: "TCMS", brands: "VISA/MC/JCB", status: "approved", since: "2025-08", txnCount: 2100, mid: "TCMS-ABC-001",
            feeOverride: { visa: "4.10%", master: "4.10%", jcb: "3.90%" }, trFeesOverride: { success: "25å††", tds: "2å††/ä»¶" },
            depositOverride: null, limitOverride: { trMax: "Â¥200,000" }, settlementOverride: null },
          { name: "ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥", brands: "WEBãƒãƒãƒ¼", status: "approved", since: "2025-11", txnCount: 900, mid: "BC-ABC-001",
            feeOverride: { webmoney: "5.8%" }, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
      { siteId: "S-001-02", siteName: "ä¼šå“¡é™å®šã‚·ãƒ§ãƒƒãƒ—", url: "https://members.abc-mart.example.com", agentId: "AG-001", agentName: "æ ªå¼ä¼šç¤¾ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º",
        processors: [
          { name: "Worldpay", brands: "VISA/MC/AMEX", status: "approved", since: "2025-10", txnCount: 2800, mid: "WP-ABC-002",
            feeOverride: { visa: "3.72%", master: "3.89%" }, trFeesOverride: { success: "15å††", fail: "15å††", cb: "1,500å††", refund: "600å††" },
            depositOverride: { rate: "10%", period: "180æ—¥" }, limitOverride: null, settlementOverride: null },
          { name: "ãƒšã‚¤ãƒ‡ã‚£", brands: "WEBãƒãƒãƒ¼", status: "approved", since: "2025-12", txnCount: 600, mid: "PD-ABC-002",
            feeOverride: { webmoney: "4.0%" }, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
    ],
    // å¾Œæ–¹äº’æ›: å…¨ã‚µã‚¤ãƒˆã®processorsã‚’çµ±åˆã—ãŸé…åˆ—
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
  { id: "M-002", name: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", status: "æœ‰åŠ¹", sColor: "green", risk: "ä½", rColor: "green", salesNum: 5800000, sales: "Â¥5.8M", cbNum: 0.02, cb: "0.02%", successNum: 99.1, success: "99.1%", feeNum: 3.5, fee: "3.5%", riskOrder: 1,
    sites: [
      { siteId: "S-002-01", siteName: "ãƒ¡ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ—", url: "https://xyz-shop.example.com", agentId: "AG-002", agentName: "åˆåŒä¼šç¤¾ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ",
        processors: [
          { name: "Simpletransact", brands: "VISA/MC", status: "approved", since: "2025-06", txnCount: 5400, mid: "ST-XYZ-001",
            feeOverride: { visa: "4.80%", master: "4.80%" }, trFeesOverride: { success: "0.45USD", fail: "0.45USD", cb: "55USD", refund: "3USD" },
            depositOverride: null, limitOverride: { trMax: "Â¥500,000" }, settlementOverride: null },
          { name: "Univa Pay cast", brands: "VISA/MC", status: "reviewing", since: null, txnCount: 0, mid: null,
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
          { name: "Gãƒãƒãƒ¼", brands: "WEBãƒãƒãƒ¼", status: "pending", since: null, txnCount: 0, mid: null,
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
    ],
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
  { id: "M-003", name: "æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«EC", status: "å¯©æŸ»ä¸­", sColor: "yellow", risk: "ä¸­", rColor: "yellow", salesNum: 0, sales: "-", cbNum: 0, cb: "-", successNum: 0, success: "-", feeNum: 3.6, fee: "3.6%", riskOrder: 2,
    sites: [
      { siteId: "S-003-01", siteName: "ã‚µãƒ³ãƒ—ãƒ«ECã‚·ãƒ§ãƒƒãƒ—", url: "https://sample-ec.example.com", agentId: null, agentName: null,
        processors: [
          { name: "TCMS", brands: "VISA/MC/JCB", status: "reviewing", since: null, txnCount: 0, mid: null,
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
    ],
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
  { id: "M-004", name: "æœ‰é™ä¼šç¤¾ãƒ†ã‚¹ãƒˆå•†äº‹", status: "æœ‰åŠ¹", sColor: "green", risk: "ä¸­", rColor: "yellow", salesNum: 2100000, sales: "Â¥2.1M", cbNum: 0.15, cb: "0.15%", successNum: 98.8, success: "98.8%", feeNum: 3.8, fee: "3.8%", riskOrder: 2,
    sites: [
      { siteId: "S-004-01", siteName: "ãƒ†ã‚¹ãƒˆå•†äº‹ã‚ªãƒ³ãƒ©ã‚¤ãƒ³", url: "https://test-shoji.example.com", agentId: "AG-001", agentName: "æ ªå¼ä¼šç¤¾ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º",
        processors: [
          { name: "æ¥½å¤©éŠ€è¡Œ", brands: "VISA/MC", status: "approved", since: "2025-09", txnCount: 2800, mid: "RKT-TST-001",
            feeOverride: { visa: "2.80%", master: "2.80%" }, trFeesOverride: { success: "12å††", cb: "1,500å††" },
            depositOverride: { rate: "10%", period: "180æ—¥" }, limitOverride: { trMax: "Â¥300,000", count: "3å›/æ—¥ã€7å›/æœˆ" }, settlementOverride: null },
          { name: "ãƒãƒƒãƒˆãƒ©ã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥", brands: "WEBãƒãƒãƒ¼", status: "approved", since: "2025-11", txnCount: 450, mid: "NRC-TST-001",
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
    ],
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
  { id: "M-005", name: "æ ªå¼ä¼šç¤¾ã‚°ãƒ¬ãƒ¼ç”£æ¥­", status: "åœæ­¢ä¸­", sColor: "red", risk: "é«˜", rColor: "red", salesNum: 0, sales: "Â¥0", cbNum: 1.2, cb: "1.2%", successNum: 95.2, success: "95.2%", feeNum: 4.5, fee: "4.5%", riskOrder: 3,
    sites: [
      { siteId: "S-005-01", siteName: "ã‚°ãƒ¬ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹", url: "https://grey-industry.example.com", agentId: null, agentName: null,
        processors: [
          { name: "Simpletransact", brands: "VISA/MC", status: "suspended", since: "2025-07", txnCount: 1500, mid: "ST-GRY-001",
            feeOverride: { visa: "5.20%", master: "5.20%" }, trFeesOverride: { success: "0.50USD", fail: "0.50USD", cb: "60USD" },
            depositOverride: { rate: "10%", period: "180æ—¥" }, limitOverride: { trMax: "Â¥100,000", count: "2å›/æ—¥ã€5å›/æœˆ" }, settlementOverride: null },
        ]},
    ],
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
  { id: "M-006", name: "æ ªå¼ä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", status: "æœ‰åŠ¹", sColor: "green", risk: "ä½", rColor: "green", salesNum: 8200000, sales: "Â¥8.2M", cbNum: 0.03, cb: "0.03%", successNum: 99.3, success: "99.3%", feeNum: 3.3, fee: "3.3%", riskOrder: 1,
    sites: [
      { siteId: "S-006-01", siteName: "å›½å†…æ—…è¡Œã‚µã‚¤ãƒˆ", url: "https://travel-plus.example.com", agentId: "AG-002", agentName: "åˆåŒä¼šç¤¾ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ",
        processors: [
          { name: "Univa Pay cast", brands: "VISA/MC", status: "approved", since: "2025-03", txnCount: 6500, mid: "UPC-TRV-001",
            feeOverride: { visa: "3.80%", master: "3.80%" }, trFeesOverride: { success: "35å††", fail: "35å††", cb: "3,500å††", refund: "120å††", tds: "5å††/ä»¶" },
            depositOverride: { rate: "10%", period: "180æ—¥" }, limitOverride: { trMax: "Â¥500,000", monthly: "Â¥100,000,000" }, settlementOverride: "15æ—¥ç· ã‚æœ«æ‰•ã„ / æœ«ç· ã‚ç¿Œ15æ—¥æ‰•ã„" },
          { name: "ONTHELINE", brands: "JCB", status: "approved", since: "2025-07", txnCount: 2100, mid: "OTL-TRV-001",
            feeOverride: { jcb: "3.80%" }, depositOverride: { rate: "5%", period: "180æ—¥" }, limitOverride: null, settlementOverride: null },
          { name: "ã‚¹ãƒãƒ¼ãƒˆãƒ”ãƒƒãƒˆ", brands: "WEBãƒãƒãƒ¼", status: "approved", since: "2025-09", txnCount: 800, mid: "SMP-TRV-001",
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
      { siteId: "S-006-02", siteName: "æµ·å¤–æ—…è¡Œã‚µã‚¤ãƒˆ", url: "https://overseas.travel-plus.example.com", agentId: "AG-002", agentName: "åˆåŒä¼šç¤¾ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ",
        processors: [
          { name: "Worldpay", brands: "VISA/MC/AMEX", status: "approved", since: "2025-03", txnCount: 6200, mid: "WP-TRV-002",
            feeOverride: { visa: "3.65%", master: "3.80%" }, trFeesOverride: { success: "14å††", fail: "14å††", cb: "1,400å††", tds: "2å††/ä»¶" },
            depositOverride: { rate: "10%", period: "180æ—¥" }, limitOverride: null, settlementOverride: null },
          { name: "Asiabill", brands: "AMEX/Diners", status: "reviewing", since: null, txnCount: 0, mid: null,
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
          { name: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒãƒ¼", brands: "WEBãƒãƒãƒ¼", status: "approved", since: "2025-10", txnCount: 450, mid: "SCM-TRV-002",
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
    ],
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
  { id: "M-007", name: "åˆåŒä¼šç¤¾ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ¯ãƒ¼ã‚¯ã‚¹", status: "æœ‰åŠ¹", sColor: "green", risk: "ä½", rColor: "green", salesNum: 3400000, sales: "Â¥3.4M", cbNum: 0.01, cb: "0.01%", successNum: 99.7, success: "99.7%", feeNum: 3.4, fee: "3.4%", riskOrder: 1,
    sites: [
      { siteId: "S-007-01", siteName: "ãƒ‡ã‚¸ã‚¿ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è²©å£²", url: "https://digi-works.example.com", agentId: "AG-003", agentName: "æœ‰é™ä¼šç¤¾ãƒ†ãƒƒã‚¯ãƒ–ãƒªãƒƒã‚¸",
        processors: [
          { name: "TCMS", brands: "VISA/MC/JCB", status: "approved", since: "2025-11", txnCount: 1800, mid: "TCMS-DW-001",
            feeOverride: { visa: "4.10%", master: "4.10%", jcb: "3.50%" }, trFeesOverride: { success: "25å††", tds: "2å††/ä»¶" },
            depositOverride: null, limitOverride: { trMax: "Â¥200,000" }, settlementOverride: null },
          { name: "æ¥½å¤©éŠ€è¡Œ", brands: "VISA/MC", status: "pending", since: null, txnCount: 0, mid: null,
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
          { name: "ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥", brands: "WEBãƒãƒãƒ¼", status: "approved", since: "2025-12", txnCount: 350, mid: "BC-DW-001",
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
    ],
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
  { id: "M-008", name: "æ ªå¼ä¼šç¤¾ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ•ãƒ¼ã‚º", status: "æœ‰åŠ¹", sColor: "green", risk: "ä¸­", rColor: "yellow", salesNum: 1500000, sales: "Â¥1.5M", cbNum: 0.08, cb: "0.08%", successNum: 99.0, success: "99.0%", feeNum: 3.7, fee: "3.7%", riskOrder: 2,
    sites: [
      { siteId: "S-008-01", siteName: "ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯é£Ÿå“EC", url: "https://fresh-foods.example.com", agentId: null, agentName: null,
        processors: [
          { name: "Simpletransact", brands: "VISA/MC", status: "approved", since: "2025-12", txnCount: 900, mid: "ST-FF-001",
            feeOverride: { visa: "4.30%", master: "4.30%" }, trFeesOverride: { success: "0.30USD", fail: "0.30USD", cb: "50USD" },
            depositOverride: null, limitOverride: { trMax: "Â¥200,000" }, settlementOverride: null },
          { name: "ãƒ‹ãƒ¼ãƒã‚ªãƒšã‚¤", brands: "WEBãƒãƒãƒ¼", status: "approved", since: "2026-01", txnCount: 120, mid: "NHP-FF-001",
            feeOverride: null, depositOverride: null, limitOverride: null, settlementOverride: null },
        ]},
    ],
    get processors() { return this.sites.flatMap(s => s.processors); },
  },
];

const PROC_STATUS = {
  approved: { label: "âœ… æ‰¿èªæ¸ˆ", color: "green", textClass: "text-emerald-600" },
  reviewing: { label: "ğŸ”„ å¯©æŸ»ä¸­", color: "blue", textClass: "text-blue-600" },
  pending: { label: "â³ ç”³è«‹æº–å‚™ä¸­", color: "gray", textClass: "text-slate-600" },
  suspended: { label: "â›” åœæ­¢", color: "red", textClass: "text-rose-600" },
  rejected: { label: "âŒ å´ä¸‹", color: "red", textClass: "text-rose-600" },
};

const SortableHeader = ({ cols, sortKey, sortDir, onSort, children }) => (
  <table className="w-full text-left text-xs">
    <thead>
      <tr className="bg-slate-50/80 border-b border-slate-200 font-semibold text-slate-500 uppercase tracking-wider">
        {cols.map((c, i) => (
          <th key={i} className={`px-4 py-3 whitespace-nowrap font-semibold ${c.w === "flex-1" ? "" : c.w} ${c.sortKey ? "cursor-pointer hover:text-blue-600 select-none" : ""}`}
            onClick={() => c.sortKey && onSort(c.sortKey)}
          >
            <span className="inline-flex items-center gap-1">
              {c.label}
              {c.sortKey && sortKey === c.sortKey && (
                <span className="text-blue-600 text-xs">{sortDir === "asc" ? "â–²" : "â–¼"}</span>
              )}
              {c.sortKey && sortKey !== c.sortKey && (
                <span className="text-slate-300 text-xs">â‡…</span>
              )}
            </span>
          </th>
        ))}
      </tr>
    </thead>
    <tbody>{children}</tbody>
  </table>
);

// â”€â”€â”€ M03: åŠ ç›Ÿåº—ç®¡ç† â”€â”€â”€
const MasterMerchants = () => {
  const toast = useToast();
  const [sortKey, setSortKey] = useState("id");
  const [sortDir, setSortDir] = useState("asc");
  const [searchText, setSearchText] = useState("");
  const [statusFilter, setStatusFilter] = useState("all");
  const [expandedId, setExpandedId] = useState(null);
  const [slidePanel, setSlidePanel] = useState(null);
  const [showAddModal, setShowAddModal] = useState(false);
  const [showConfirm, setShowConfirm] = useState(null);
  const [showProcApply, setShowProcApply] = useState(false);
  const [m03Tab, setM03Tab] = useState("merchants");
  const [actionConfirm, setActionConfirm] = useState(null);
  const [showSiteAddModal, setShowSiteAddModal] = useState(false);

  const handleSort = (key) => {
    if (sortKey === key) {
      setSortDir(d => d === "asc" ? "desc" : "asc");
    } else {
      setSortKey(key);
      setSortDir("asc");
    }
  };

  const filtered = merchantData
    .filter(m => {
      if (statusFilter !== "all" && m.status !== statusFilter) return false;
      if (searchText && !m.name.includes(searchText) && !m.id.includes(searchText)) return false;
      return true;
    })
    .sort((a, b) => {
      let va = a[sortKey], vb = b[sortKey];
      if (typeof va === "string") {
        const cmp = va.localeCompare(vb, "ja");
        return sortDir === "asc" ? cmp : -cmp;
      }
      return sortDir === "asc" ? va - vb : vb - va;
    });

  return (
    <div className="p-5 space-y-4">
      <div className="flex justify-between items-center">
        <div className="flex items-center gap-3">
          <h2 className="text-sm font-bold text-slate-800">åŠ ç›Ÿåº—ç®¡ç† <span className="text-slate-400 font-normal">({filtered.length}ä»¶)</span></h2>
          <button onClick={() => setShowAddModal(true)} className="text-xs bg-blue-600 text-white px-2.5 py-1 rounded hover:bg-blue-700">+ æ‰‹å‹•ç™»éŒ²</button>
          <button onClick={() => toast("åŠ ç›Ÿåº—ä¸€è¦§ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-white text-slate-600 px-2 py-1 rounded border hover:bg-slate-50">ğŸ“¥ CSV</button>
          <button onClick={() => toast("åŠ ç›Ÿåº—ä¸€è¦§ã‚’Excelå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-white text-slate-600 px-2 py-1 rounded border hover:bg-slate-50">ğŸ“¥ Excel</button>
        </div>
        <div className="flex gap-2">
          <input className="text-xs border rounded px-2 py-1 w-48" placeholder="åŠ ç›Ÿåº—å / IDã§æ¤œç´¢..." value={searchText} onChange={e => setSearchText(e.target.value)} />
          <select className="text-xs border rounded px-2 py-1" value={statusFilter} onChange={e => setStatusFilter(e.target.value)}>
            <option value="all">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
            <option value="æœ‰åŠ¹">æœ‰åŠ¹</option>
            <option value="å¯©æŸ»ä¸­">å¯©æŸ»ä¸­</option>
            <option value="åœæ­¢ä¸­">åœæ­¢ä¸­</option>
          </select>
        </div>
      </div>

      {/* Tabs: åŠ ç›Ÿåº—ä¸€è¦§ / ã‚µã‚¤ãƒˆç®¡ç† */}
      <div className="flex gap-1 border-b">
        {[{ id: "merchants", label: "åŠ ç›Ÿåº—ä¸€è¦§" }, { id: "sites", label: "ã‚µã‚¤ãƒˆç®¡ç†" }].map(t => (
          <button key={t.id} onClick={() => setM03Tab(t.id)} className={`text-xs px-3 py-2 border-b-2 ${m03Tab === t.id ? "border-blue-500 text-blue-600 font-semibold" : "border-transparent text-slate-400"}`}>{t.label}</button>
        ))}
      </div>

      {/* ===== ã‚µã‚¤ãƒˆç®¡ç†ã‚¿ãƒ– ===== */}
      {m03Tab === "sites" && (() => {
        // merchantDataã‹ã‚‰å…¨ã‚µã‚¤ãƒˆã‚’ãƒ•ãƒ©ãƒƒãƒˆã«å±•é–‹
        const allSites = merchantData.flatMap(m => m.sites.map(s => {
          const approvedProcs = s.processors.filter(p => p.status === "approved");
          const allBrands = [...new Set(s.processors.flatMap(p => p.brands.split("/")))];
          const totalTxn = s.processors.reduce((sum, p) => sum + p.txnCount, 0);
          // ã‚µã‚¤ãƒˆåˆ¥ã®è¨­å®šãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿé‹ç”¨ã§ã¯DBç®¡ç†ï¼‰
          const siteSettings = {
            "S-001-01": { tds: true, tdsMode: "å…¨ä»¶", rec: true, recMax: 12, ipRestrict: true, ipList: ["203.0.113.0/24", "198.51.100.0/24"], cvvRequired: true, tokenize: true, linkPay: true, apiPay: true, callbackUrl: "https://abc-mart.example.com/callback", webhookUrl: "https://abc-mart.example.com/webhook", testMode: false, created: "2025-03-15", lastTxn: "2026-02-17 14:23", monthlyVol: "Â¥8.2M", successRate: "99.6%", notifyEmail: "admin@abc-mart.example.com", authToken: "aip_tk_upc_abc001_xxxx" },
            "S-001-02": { tds: true, tdsMode: "æ¡ä»¶ä»˜ã", rec: false, recMax: 0, ipRestrict: false, ipList: [], cvvRequired: true, tokenize: true, linkPay: true, apiPay: false, callbackUrl: "https://members.abc-mart.example.com/callback", webhookUrl: "https://members.abc-mart.example.com/webhook", testMode: false, created: "2025-09-20", lastTxn: "2026-02-17 11:05", monthlyVol: "Â¥4.3M", successRate: "99.2%", notifyEmail: "admin@abc-mart.example.com", authToken: "aip_tk_wp_abc002_yyyy" },
            "S-002-01": { tds: true, tdsMode: "å…¨ä»¶", rec: true, recMax: 6, ipRestrict: false, ipList: [], cvvRequired: true, tokenize: true, linkPay: true, apiPay: true, callbackUrl: "https://xyz-shop.example.com/pay/callback", webhookUrl: "https://xyz-shop.example.com/pay/webhook", testMode: false, created: "2025-05-10", lastTxn: "2026-02-17 09:45", monthlyVol: "Â¥5.8M", successRate: "99.1%", notifyEmail: "tech@xyz-shop.example.com", authToken: "aip_tk_st_xyz001_zzzz" },
            "S-003-01": { tds: true, tdsMode: "å…¨ä»¶", rec: false, recMax: 0, ipRestrict: false, ipList: [], cvvRequired: true, tokenize: false, linkPay: true, apiPay: false, callbackUrl: "", webhookUrl: "", testMode: true, created: "2026-01-20", lastTxn: "â€”", monthlyVol: "â€”", successRate: "â€”", notifyEmail: "info@sample-ec.example.com", authToken: "aip_tk_test_smp001" },
            "S-004-01": { tds: true, tdsMode: "æ¡ä»¶ä»˜ã", rec: true, recMax: 3, ipRestrict: true, ipList: ["192.0.2.0/24"], cvvRequired: true, tokenize: true, linkPay: true, apiPay: true, callbackUrl: "https://test-shoji.example.com/api/callback", webhookUrl: "https://test-shoji.example.com/api/webhook", testMode: false, created: "2025-08-01", lastTxn: "2026-02-17 13:10", monthlyVol: "Â¥2.1M", successRate: "98.8%", notifyEmail: "system@test-shoji.example.com", authToken: "aip_tk_rkt_tst001_aaaa" },
            "S-005-01": { tds: false, tdsMode: "â€”", rec: false, recMax: 0, ipRestrict: false, ipList: [], cvvRequired: false, tokenize: false, linkPay: true, apiPay: false, callbackUrl: "", webhookUrl: "", testMode: false, created: "2025-06-15", lastTxn: "2025-12-01 18:30", monthlyVol: "Â¥0", successRate: "95.2%", notifyEmail: "info@grey.example.com", authToken: "aip_tk_suspended" },
            "S-006-01": { tds: true, tdsMode: "å…¨ä»¶", rec: false, recMax: 0, ipRestrict: true, ipList: ["203.0.113.50/32", "198.51.100.0/24"], cvvRequired: true, tokenize: true, linkPay: true, apiPay: true, callbackUrl: "https://travel-plus.example.com/payment/callback", webhookUrl: "https://travel-plus.example.com/payment/webhook", testMode: false, created: "2025-02-20", lastTxn: "2026-02-17 15:02", monthlyVol: "Â¥5.6M", successRate: "99.4%", notifyEmail: "pay@travel-plus.example.com", authToken: "aip_tk_upc_trv001_bbbb" },
            "S-006-02": { tds: true, tdsMode: "å…¨ä»¶", rec: false, recMax: 0, ipRestrict: true, ipList: ["203.0.113.60/32"], cvvRequired: true, tokenize: true, linkPay: false, apiPay: true, callbackUrl: "https://overseas.travel-plus.example.com/callback", webhookUrl: "https://overseas.travel-plus.example.com/webhook", testMode: false, created: "2025-02-20", lastTxn: "2026-02-17 12:38", monthlyVol: "Â¥2.6M", successRate: "99.1%", notifyEmail: "pay@travel-plus.example.com", authToken: "aip_tk_wp_trv002_cccc" },
            "S-007-01": { tds: true, tdsMode: "æ¡ä»¶ä»˜ã", rec: true, recMax: 12, ipRestrict: false, ipList: [], cvvRequired: true, tokenize: true, linkPay: true, apiPay: true, callbackUrl: "https://digi-works.example.com/hook", webhookUrl: "https://digi-works.example.com/webhook", testMode: false, created: "2025-10-05", lastTxn: "2026-02-17 10:15", monthlyVol: "Â¥3.4M", successRate: "99.7%", notifyEmail: "dev@digi-works.example.com", authToken: "aip_tk_tcms_dw001_dddd" },
            "S-008-01": { tds: true, tdsMode: "å…¨ä»¶", rec: false, recMax: 0, ipRestrict: false, ipList: [], cvvRequired: true, tokenize: false, linkPay: true, apiPay: false, callbackUrl: "https://fresh-foods.example.com/pay_result", webhookUrl: "", testMode: false, created: "2025-11-20", lastTxn: "2026-02-16 21:45", monthlyVol: "Â¥1.5M", successRate: "99.0%", notifyEmail: "shop@fresh-foods.example.com", authToken: "aip_tk_st_ff001_eeee" },
          };
          const ss = siteSettings[s.siteId] || {};
          const mStatus = m.status === "åœæ­¢ä¸­" ? "åœæ­¢" : m.status === "å¯©æŸ»ä¸­" ? "å¯©æŸ»ä¸­" : ss.testMode ? "ãƒ†ã‚¹ãƒˆ" : "æœ‰åŠ¹";
          const sColor = mStatus === "åœæ­¢" ? "red" : mStatus === "å¯©æŸ»ä¸­" ? "yellow" : mStatus === "ãƒ†ã‚¹ãƒˆ" ? "purple" : "green";
          return { ...s, merchantId: m.id, merchantName: m.name, merchantStatus: m.status, approvedProcs, allBrands, totalTxn, settings: ss, siteStatus: mStatus, siteStatusColor: sColor };
        }));

        const [expandedSiteId, setExpandedSiteId] = [expandedId, setExpandedId]; // reuse state

        return (
        <div className="space-y-3">
          {/* KPI */}
          <div className="grid grid-cols-5 gap-3">
            {[
              ["ğŸŒ", "ç·ã‚µã‚¤ãƒˆæ•°", allSites.length, "blue"],
              ["âœ…", "æœ‰åŠ¹", allSites.filter(s => s.siteStatus === "æœ‰åŠ¹").length, "emerald"],
              ["ğŸ”„", "å¯©æŸ»ä¸­", allSites.filter(s => s.siteStatus === "å¯©æŸ»ä¸­").length, "amber"],
              ["ğŸ§ª", "ãƒ†ã‚¹ãƒˆ", allSites.filter(s => s.siteStatus === "ãƒ†ã‚¹ãƒˆ").length, "purple"],
              ["â›”", "åœæ­¢", allSites.filter(s => s.siteStatus === "åœæ­¢").length, "rose"],
            ].map(([icon, label, val, color], i) => (
              <div key={i} className={`bg-${color}-50 rounded-lg border border-${color}-200 p-2 text-center`}>
                <p className="text-xs text-slate-400">{icon} {label}</p>
                <p className={`text-lg font-bold text-${color}-700`}>{val}</p>
              </div>
            ))}
          </div>

          {/* æ¤œç´¢ãƒ»æ“ä½œãƒãƒ¼ */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex justify-between items-center mb-3">
              <p className="text-xs font-bold text-slate-600">ã‚µã‚¤ãƒˆç®¡ç†</p>
              <div className="flex gap-2">
                <button onClick={() => setShowSiteAddModal(true)} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">+ ã‚µã‚¤ãƒˆè¿½åŠ </button>
                <button onClick={() => setActionConfirm({ title: "ã‚µã‚¤ãƒˆä¸€æ‹¬åœæ­¢", description: "è¡¨ç¤ºä¸­ã®å…¨ã‚µã‚¤ãƒˆã‚’ä¸€æ‹¬åœæ­¢ã—ã¾ã™ã€‚", warning: "åœæ­¢ã™ã‚‹ã¨è©²å½“ã‚µã‚¤ãƒˆã®æ±ºæ¸ˆå‡¦ç†ãŒåœæ­¢ã•ã‚Œã¾ã™ã€‚", type: "danger", onConfirm: () => toast("é¸æŠã—ãŸã‚µã‚¤ãƒˆã‚’ä¸€æ‹¬åœæ­¢ã—ã¾ã—ãŸ", "warning") })} className="text-xs bg-amber-100 text-amber-700 px-3 py-1 rounded border border-amber-200 font-semibold">â¸ ä¸€æ‹¬åœæ­¢</button>
                <button onClick={() => toast("ã‚µã‚¤ãƒˆä¸€è¦§ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-white text-slate-600 px-2 py-1 rounded border hover:bg-slate-50">ğŸ“¥ CSV</button>
              </div>
            </div>
            <div className="grid grid-cols-6 gap-2">
              <div><label className="text-xs text-slate-400">ã‚µã‚¤ãƒˆID</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="S-XXX-XX" /></div>
              <div><label className="text-xs text-slate-400">ã‚µã‚¤ãƒˆå</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="ã‚µã‚¤ãƒˆåã§æ¤œç´¢" /></div>
              <div><label className="text-xs text-slate-400">åŠ ç›Ÿåº—å</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="åŠ ç›Ÿåº—ã§çµè¾¼" /></div>
              <div><label className="text-xs text-slate-400">ä»£ç†åº—</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ã¦</option><option>AG-001</option><option>AG-002</option><option>AG-003</option><option>ãªã—</option></select></div>
              <div><label className="text-xs text-slate-400">åˆ©ç”¨çŠ¶æ…‹</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ã¦</option><option>æœ‰åŠ¹</option><option>å¯©æŸ»ä¸­</option><option>ãƒ†ã‚¹ãƒˆ</option><option>åœæ­¢</option></select></div>
              <div className="flex items-end"><button onClick={() => toast("æ¤œç´¢æ¡ä»¶ã‚’é©ç”¨ã—ã¾ã—ãŸ", "info")} className="text-xs bg-blue-600 text-white px-4 py-1.5 rounded font-semibold w-full">æ¤œç´¢</button></div>
            </div>
          </div>

          {/* ã‚µã‚¤ãƒˆä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <div className="px-3 py-2 border-b flex justify-between items-center">
              <span className="text-xs text-slate-400">å…¨ {allSites.length} ã‚µã‚¤ãƒˆ</span>
              <span className="text-xs text-slate-300">ğŸ’¡ è¡Œã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°å±•é–‹</span>
            </div>
            <table className="w-full text-xs">
              <thead><tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold"><input type="checkbox" className="w-3 h-3" onClick={e => e.stopPropagation()} /></th>
                <th className="text-left p-2 text-slate-500 font-semibold w-20">ã‚µã‚¤ãƒˆID</th>
                <th className="text-left p-2 text-slate-500 font-semibold">ã‚µã‚¤ãƒˆå</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-24">åŠ ç›Ÿåº—</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-20">ä»£ç†åº—</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-24">URL</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-10">3DS</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-10">ç¶™ç¶š</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-10">IP</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-16">æ¥ç¶šå…ˆ</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-20">æœˆé–“å‡¦ç†</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-14">çŠ¶æ…‹</th>
              </tr></thead>
              <tbody>
                {allSites.map((s, i) => (
                  <React.Fragment key={s.siteId}>
                  <tr onClick={() => setExpandedSiteId(expandedSiteId === s.siteId ? null : s.siteId)} className={`border-b cursor-pointer transition-colors ${expandedSiteId === s.siteId ? "bg-blue-100 border-l-2 border-l-blue-500" : i % 2 ? "bg-slate-50/50 hover:bg-blue-50" : "hover:bg-blue-50"}`}>
                    <td className="p-2" onClick={e => e.stopPropagation()}><input type="checkbox" className="w-3 h-3" /></td>
                    <td className="p-2 font-mono text-blue-600">{s.siteId}</td>
                    <td className="p-2 text-slate-700 font-semibold">{s.siteName}</td>
                    <td className="p-2 text-slate-500 w-24 truncate">{s.merchantName.replace(/æ ªå¼ä¼šç¤¾|åˆåŒä¼šç¤¾|æœ‰é™ä¼šç¤¾/g, "")}</td>
                    <td className="p-2 w-20">{s.agentId ? <span className="text-xs font-mono text-orange-600">{s.agentId}</span> : <span className="text-slate-300">â€”</span>}</td>
                    <td className="p-2 text-blue-500 font-mono truncate max-w-[6rem]" title={s.url}>{s.url.replace(/https?:\/\//, "").split("/")[0]}</td>
                    <td className="p-2 text-center">{s.settings.tds ? "âœ…" : "â€”"}</td>
                    <td className="p-2 text-center">{s.settings.rec ? "ğŸ”„" : "â€”"}</td>
                    <td className="p-2 text-center">{s.settings.ipRestrict ? "ğŸ”’" : "â€”"}</td>
                    <td className="p-2 w-16"><span className="text-emerald-600 font-bold">{s.approvedProcs.length}</span><span className="text-slate-300">/{s.processors.length}</span></td>
                    <td className="p-2 w-20 text-right font-semibold">{s.settings.monthlyVol || "â€”"}</td>
                    <td className="p-2 text-center"><Badge text={s.siteStatus} color={s.siteStatusColor} /></td>
                  </tr>
                  {expandedSiteId === s.siteId && (
                    <tr><td colSpan={12} className="p-0">
                      <div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                        {/* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */}
                        <div className="flex items-center justify-between mb-3">
                          <div className="flex items-center gap-2">
                            <span className="text-xs font-mono bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded">{s.siteId}</span>
                            <span className="text-xs font-bold text-slate-700">{s.siteName}</span>
                            <Badge text={s.siteStatus} color={s.siteStatusColor} />
                            {s.settings.testMode && <Badge text="ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰" color="purple" />}
                          </div>
                          <div className="flex gap-1">
                            <button onClick={() => setActionConfirm({ title: "ã‚µã‚¤ãƒˆè¨­å®šã®ä¿å­˜", description: `${s.siteId} ${s.siteName} ã®è¨­å®šå¤‰æ›´ã‚’ä¿å­˜ã—ã¾ã™ã€‚`, warning: "æ±ºæ¸ˆè¨­å®šãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®å¤‰æ›´ã¯å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã«å½±éŸ¿ã—ã¾ã™ã®ã§ã”ç¢ºèªãã ã•ã„ã€‚", type: "warning", onConfirm: () => toast(`${s.siteName} ã®è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ`, "success") })} className="px-3 py-1 bg-blue-600 text-white rounded text-xs font-semibold">ğŸ’¾ ä¿å­˜</button>
                            <button onClick={() => setActionConfirm({ title: "ã‚µã‚¤ãƒˆåœæ­¢", description: `${s.siteId} ${s.siteName} ã‚’åœæ­¢ã—ã¾ã™ã€‚`, warning: "åœæ­¢ã™ã‚‹ã¨è©²å½“ã‚µã‚¤ãƒˆã®æ±ºæ¸ˆå‡¦ç†ãŒåœæ­¢ã•ã‚Œã¾ã™ã€‚", type: "warning", onConfirm: () => toast(`${s.siteName} ã‚’åœæ­¢ã—ã¾ã—ãŸ`, "warning") })} className="px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs border border-amber-200">â¸ åœæ­¢</button>
                            <button onClick={() => setActionConfirm({ title: "ãƒˆãƒ¼ã‚¯ãƒ³å†ç™ºè¡Œ", description: `${s.siteId} ${s.siteName} ã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†ç™ºè¡Œã—ã¾ã™ã€‚`, warning: "å†ç™ºè¡Œã™ã‚‹ã¨ç¾åœ¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚", type: "warning", inputConfirm: "å†ç™ºè¡Œ", onConfirm: () => toast(`${s.siteName} ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†ç™ºè¡Œã—ã¾ã—ãŸ`, "success") })} className="px-2 py-1 bg-white text-slate-600 rounded text-xs border">ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³å†ç™ºè¡Œ</button>
                            <button onClick={() => setActionConfirm({ title: "ã‚µã‚¤ãƒˆå‰Šé™¤", description: `${s.siteId} ${s.siteName} ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚`, warning: "å‰Šé™¤ã—ãŸã‚µã‚¤ãƒˆã¯å¾©å…ƒã§ãã¾ã›ã‚“ã€‚é–¢é€£ã™ã‚‹å…¨ã¦ã®å–å¼•ãƒ‡ãƒ¼ã‚¿ã‚‚å¤±ã‚ã‚Œã¾ã™ã€‚", type: "danger", inputConfirm: "å‰Šé™¤", onConfirm: () => toast(`${s.siteName} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "error") })} className="px-2 py-1 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200">ğŸ—‘ å‰Šé™¤</button>
                          </div>
                        </div>

                        {/* â”€â”€ ä¸Šæ®µ3ã‚«ãƒ©ãƒ  + ä¸‹æ®µæ¥ç¶šå…ˆå…¨å¹… â”€â”€ */}
                        <div className="grid grid-cols-3 gap-3 text-xs">
                          {/* ã‚«ãƒ©ãƒ 1: ã‚µã‚¤ãƒˆåŸºæœ¬æƒ…å ±ï¼ˆç·¨é›†å¯èƒ½ï¼‰ */}
                          <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                            <p className="font-semibold text-slate-600 mb-1.5">ğŸŒ ã‚µã‚¤ãƒˆåŸºæœ¬æƒ…å ±</p>
                            <div className="space-y-1.5">
                              <div><label className="text-slate-400">åŠ ç›Ÿåº—</label><div className="font-semibold text-slate-700">{s.merchantName} <span className="text-slate-400 font-mono">({s.merchantId})</span></div></div>
                              <div><label className="text-slate-400">ã‚µã‚¤ãƒˆå</label><input type="text" defaultValue={s.siteName} className="w-full border rounded px-2 py-1 text-xs mt-0.5" /></div>
                              <div><label className="text-slate-400">ã‚µã‚¤ãƒˆURL</label><input type="text" defaultValue={s.url} className="w-full border rounded px-2 py-1 text-xs font-mono mt-0.5" /></div>
                              <div><label className="text-slate-400">ä»£ç†åº—</label>
                                <select defaultValue={s.agentId || ""} className="w-full border rounded px-2 py-1 text-xs mt-0.5">
                                  <option value="">ç´ä»˜ãªã—</option>
                                  <option value="AG-001">AG-001 ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</option>
                                  <option value="AG-002">AG-002 ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚µãƒ«åˆåŒä¼šç¤¾</option>
                                  <option value="AG-003">AG-003 ITã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º</option>
                                </select>
                              </div>
                              <div><label className="text-slate-400">é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«</label><input type="email" defaultValue={s.settings.notifyEmail || ""} className="w-full border rounded px-2 py-1 text-xs font-mono mt-0.5" placeholder="admin@example.com" /></div>
                              <div className="flex justify-between pt-1 text-slate-400">
                                <span>ä½œæˆæ—¥: {s.settings.created || "â€”"}</span>
                                <span>æœ€çµ‚å–å¼•: {s.settings.lastTxn || "â€”"}</span>
                              </div>
                            </div>
                          </div>

                          {/* ã‚«ãƒ©ãƒ 2: æ±ºæ¸ˆè¨­å®šï¼ˆç·¨é›†å¯èƒ½ï¼‰ */}
                          <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                            <p className="font-semibold text-slate-600 mb-1.5">ğŸ’³ æ±ºæ¸ˆè¨­å®š</p>
                            <div className="space-y-1.5">
                              <div className="flex items-center justify-between">
                                <span className="text-slate-400">3DSèªè¨¼</span>
                                <div className="flex items-center gap-1">
                                  <label className="relative inline-flex items-center cursor-pointer"><input type="checkbox" defaultChecked={s.settings.tds} className="sr-only peer" /><div className="w-7 h-4 bg-slate-200 peer-checked:bg-emerald-500 rounded-full after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:after:translate-x-3" /></label>
                                  <select defaultValue={s.settings.tdsMode || "å…¨ä»¶"} className="border rounded px-1 py-0.5 text-xs w-16">
                                    <option>å…¨ä»¶</option><option>æ¡ä»¶ä»˜ã</option>
                                  </select>
                                </div>
                              </div>
                              <div className="flex items-center justify-between">
                                <span className="text-slate-400">ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°</span>
                                <div className="flex items-center gap-1">
                                  <label className="relative inline-flex items-center cursor-pointer"><input type="checkbox" defaultChecked={s.settings.rec} className="sr-only peer" /><div className="w-7 h-4 bg-slate-200 peer-checked:bg-emerald-500 rounded-full after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:after:translate-x-3" /></label>
                                  <span className="text-slate-400">æœ€å¤§</span>
                                  <input type="number" defaultValue={s.settings.recMax} className="border rounded px-1 py-0.5 text-xs w-10 text-center" min="0" max="99" />
                                  <span className="text-slate-400">å›</span>
                                </div>
                              </div>
                              <div className="flex items-center justify-between">
                                <span className="text-slate-400">CVV</span>
                                <select defaultValue={s.settings.cvvRequired ? "required" : "optional"} className="border rounded px-1 py-0.5 text-xs">
                                  <option value="required">å¿…é ˆ</option><option value="optional">ä»»æ„</option>
                                </select>
                              </div>
                              <div className="border-t border-dashed pt-1.5 mt-1">
                                <p className="text-slate-400 mb-1">æ±ºæ¸ˆæ–¹å¼</p>
                                <div className="space-y-1">
                                  {[["ãƒˆãƒ¼ã‚¯ãƒ³æ±ºæ¸ˆ", s.settings.tokenize], ["LINKæ±ºæ¸ˆ", s.settings.linkPay], ["APIæ±ºæ¸ˆ", s.settings.apiPay]].map(([label, val], ci) => (
                                    <label key={ci} className="flex items-center gap-1.5 cursor-pointer"><input type="checkbox" defaultChecked={val} className="w-3 h-3 rounded" /><span className="text-slate-600">{label}</span></label>
                                  ))}
                                </div>
                              </div>
                              <div className="border-t border-dashed pt-1.5 mt-1">
                                <label className="flex items-center gap-1.5 cursor-pointer"><input type="checkbox" defaultChecked={s.settings.testMode} className="w-3 h-3 rounded" /><span className="text-purple-600 font-semibold">ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</span></label>
                              </div>
                            </div>
                          </div>

                          {/* ã‚«ãƒ©ãƒ 3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»APIï¼ˆç·¨é›†å¯èƒ½ï¼‰ */}
                          <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                            <p className="font-semibold text-slate-600 mb-1.5">ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»API</p>
                            <div className="space-y-1.5">
                              <div className="flex items-center justify-between">
                                <span className="text-slate-400">IPåˆ¶é™</span>
                                <label className="relative inline-flex items-center cursor-pointer"><input type="checkbox" defaultChecked={s.settings.ipRestrict} className="sr-only peer" /><div className="w-7 h-4 bg-slate-200 peer-checked:bg-emerald-500 rounded-full after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:after:translate-x-3" /></label>
                              </div>
                              <div>
                                <label className="text-slate-400">è¨±å¯IP (æ”¹è¡ŒåŒºåˆ‡ã‚Š)</label>
                                <textarea defaultValue={s.settings.ipList.join("\n")} rows={2} className="w-full border rounded px-2 py-1 text-xs font-mono mt-0.5 resize-none" placeholder="203.0.113.0/24" />
                              </div>
                              <div>
                                <label className="text-slate-400">ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URL</label>
                                <input type="url" defaultValue={s.settings.callbackUrl} className="w-full border rounded px-2 py-1 text-xs font-mono mt-0.5" placeholder="https://example.com/callback" />
                              </div>
                              <div>
                                <label className="text-slate-400">Webhook URL</label>
                                <input type="url" defaultValue={s.settings.webhookUrl} className="w-full border rounded px-2 py-1 text-xs font-mono mt-0.5" placeholder="https://example.com/webhook" />
                              </div>
                              <div>
                                <label className="text-slate-400">èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³</label>
                                <div className="flex gap-1 mt-0.5">
                                  <input type="text" value={s.settings.authToken ? s.settings.authToken.substring(0, 12) + "â€¢â€¢â€¢â€¢â€¢â€¢" : "â€”"} readOnly className="flex-1 border rounded px-2 py-1 text-xs font-mono bg-slate-50 text-slate-500" />
                                  <button onClick={() => toast("ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="px-1.5 py-1 bg-slate-100 text-slate-500 rounded text-xs border hover:bg-slate-200">ğŸ“‹</button>
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>

                        {/* â”€â”€ æ¥ç¶šå…ˆæ¡ä»¶ï¼ˆå…¨å¹…ãƒ»ç·¨é›†å¯èƒ½ï¼‰ â”€â”€ */}
                        <div className="mt-3 bg-white rounded-lg border border-slate-200 p-2.5 text-xs">
                          <div className="flex items-center justify-between mb-2">
                            <p className="font-semibold text-slate-600">ğŸ”Œ æ¥ç¶šå…ˆæ¡ä»¶ ({s.processors.length})</p>
                            <div className="flex items-center gap-2">
                              <div className="flex items-center gap-3 text-slate-400">
                                <span>æœˆé–“å‡¦ç†é¡: <span className="font-bold text-blue-700">{s.settings.monthlyVol || "â€”"}</span></span>
                                <span>æˆåŠŸç‡: <span className="font-bold text-emerald-700">{s.settings.successRate || "â€”"}</span></span>
                                <span>ç·å–å¼•: <span className="font-bold text-slate-700">{s.totalTxn.toLocaleString()}</span></span>
                              </div>
                              {/* ã‚µã‚¤ãƒˆå…¨ä½“ã®ç²—åˆ©ã‚µãƒãƒªãƒ¼ */}
                              {(() => {
                                const siteMargins = s.processors.filter(p => p.feeOverride).flatMap(p => {
                                  const pi2 = processorList.find(pp => pp.name === p.name) || {};
                                  const bKeys = pi2.type !== "WEBãƒãƒãƒ¼" ? ["visa","master","jcb","amex","diners"] : ["webmoney"];
                                  return bKeys.map(bk => {
                                    const c = parseFloat(pi2.fees?.[bk]);
                                    const sv = parseFloat(p.feeOverride?.[bk]);
                                    return (!isNaN(c) && !isNaN(sv)) ? sv - c : null;
                                  }).filter(v => v !== null);
                                });
                                const hasTrBelowCost = s.processors.some(p => {
                                  if (!p.trFeesOverride) return false;
                                  const pi2 = processorList.find(pp => pp.name === p.name) || {};
                                  return Object.entries(p.trFeesOverride).some(([k,v]) => {
                                    const costNum = parseFloat((pi2.trFees?.[k]||"").replace(/[^0-9.]/g,""));
                                    const ovrNum = parseFloat((v||"").replace(/[^0-9.]/g,""));
                                    return !isNaN(costNum) && !isNaN(ovrNum) && ovrNum < costNum;
                                  });
                                });
                                if (siteMargins.length === 0 && !hasTrBelowCost) return null;
                                const avg = siteMargins.length > 0 ? (siteMargins.reduce((a,b)=>a+b,0)/siteMargins.length).toFixed(2) : null;
                                const hasNeg = siteMargins.some(m => m < 0) || hasTrBelowCost;
                                return <span className={`ml-2 text-xs font-bold px-2 py-0.5 rounded ${hasNeg ? "bg-rose-100 text-rose-700" : "bg-emerald-100 text-emerald-700"}`}>
                                  {avg !== null ? <>ã‚µã‚¤ãƒˆå¹³å‡ç²—åˆ©: {avg >= 0 ? "+" : ""}{avg}%</> : null}{hasTrBelowCost ? " âš TRä»•å…¥ã‚Œå‰²ã‚Œæœ‰" : ""}
                                </span>;
                              })()}
                            </div>
                          </div>
                          <div className="flex items-center gap-2 mb-2">
                            <span className="text-amber-600 font-semibold" style={{fontSize:"9px"}}>â€» ç©ºæ¬„=ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®ä»•å…¥ã‚Œå€¤ãŒé©ç”¨ã€‚åˆ©ç›Šã‚’è¼‰ã›ãŸæ–™ç‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>
                          </div>
                          <div className="space-y-2">
                            {s.processors.map((proc, pi) => {
                              const ps = PROC_STATUS[proc.status] || PROC_STATUS.pending;
                              const pInfo = processorList.find(p => p.name === proc.name) || {};
                              const isCredit = pInfo.type !== "WEBãƒãƒãƒ¼";
                              const brandKeys = isCredit ? ["visa","master","jcb","amex","diners"] : ["webmoney"];
                              return (
                              <div key={pi} className={`rounded-lg border ${proc.status === "approved" ? "border-emerald-300 bg-emerald-50/30" : proc.status === "suspended" ? "border-rose-300 bg-rose-50/30" : "border-slate-300 bg-slate-50/30"} p-2.5`}>
                                {/* æ¥ç¶šå…ˆãƒ˜ãƒƒãƒ€ãƒ¼ */}
                                <div className="flex items-center justify-between mb-2">
                                  <div className="flex items-center gap-2">
                                    <span className="font-bold text-slate-700">{proc.name}</span>
                                    <span className={`text-xs px-1.5 py-0.5 rounded ${ps.bgClass || "bg-slate-100"} ${ps.textClass}`}>{ps.label}</span>
                                    <span className="text-slate-400">{proc.brands}</span>
                                    {proc.mid && <span className="font-mono text-slate-500 bg-slate-100 px-1 rounded">MID: {proc.mid}</span>}
                                  </div>
                                  <span className="text-slate-400">å–å¼•: {(proc.txnCount || 0).toLocaleString()}ä»¶</span>
                                </div>
                                {/* ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥æ‰‹æ•°æ–™ç‡ */}
                                <div className="grid grid-cols-2 gap-2">
                                  <div>
                                    <p className="text-slate-400 mb-1 font-semibold">åŠ ç›Ÿåº—æç¤ºæ–™ç‡ <span className="text-amber-500 font-normal">ï¼ˆåˆ©ç›Šè¾¼ã¿ï¼‰</span></p>
                                    <div className="grid gap-1" style={{gridTemplateColumns: `repeat(${brandKeys.length}, 1fr)`}}>
                                      {brandKeys.map(bk => {
                                        const costVal = pInfo.fees?.[bk] || "-";
                                        const overrideVal = proc.feeOverride?.[bk] || "";
                                        const costNum = parseFloat(costVal);
                                        const ovrNum = parseFloat(overrideVal);
                                        const margin = (!isNaN(costNum) && !isNaN(ovrNum) && costNum > 0) ? (ovrNum - costNum).toFixed(2) : null;
                                        const belowCost = (!isNaN(costNum) && !isNaN(ovrNum) && ovrNum < costNum);
                                        return (
                                        <div key={bk} className="text-center">
                                          <p className="text-slate-400 uppercase" style={{fontSize:"9px"}}>{bk === "webmoney" ? "WEBãƒãƒãƒ¼" : bk}</p>
                                          <input type="text" defaultValue={overrideVal} placeholder={costVal} className={`w-full border rounded px-1 py-0.5 text-center text-xs ${belowCost ? "border-rose-400 bg-rose-50 text-rose-700 font-semibold" : overrideVal ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                          <p className="text-slate-300" style={{fontSize:"8px"}}>ä»•å…¥: {costVal}</p>
                                          {margin !== null && !belowCost && <p className="text-emerald-500 font-semibold" style={{fontSize:"8px"}}>ç²—åˆ© +{margin}%</p>}
                                          {belowCost && <p className="text-rose-500 font-semibold" style={{fontSize:"8px"}}>âš  ä»•å…¥ã‚Œå‰²ã‚Œ</p>}
                                        </div>
                                        );
                                      })}
                                    </div>
                                  </div>
                                  {/* TRæ‰‹æ•°æ–™ */}
                                  {isCredit && (
                                  <div>
                                    <p className="text-slate-400 mb-1 font-semibold">TRæ‰‹æ•°æ–™ <span className="text-amber-500 font-normal">ï¼ˆåˆ©ç›Šè¾¼ã¿ï¼‰</span></p>
                                    <div className="grid grid-cols-3 gap-1">
                                      {[["TR(æˆåŠŸ)", pInfo.trFees?.success, proc.trFeesOverride?.success],
                                        ["TR(å¤±æ•—)", pInfo.trFees?.fail, proc.trFeesOverride?.fail],
                                        ["CBæ‰‹æ•°æ–™", pInfo.trFees?.cb, proc.trFeesOverride?.cb],
                                        ["è¿”é‡‘", pInfo.trFees?.refund, proc.trFeesOverride?.refund],
                                        ["3DS", pInfo.trFees?.tds, proc.trFeesOverride?.tds],
                                        ["CBå–æ¶ˆ", pInfo.trFees?.cbCancel, proc.trFeesOverride?.cbCancel]
                                      ].map(([label, def, ovr], ti) => {
                                        const costStr = def || "-";
                                        const costNum = parseFloat((costStr || "").replace(/[^0-9.]/g, ""));
                                        const ovrNum = parseFloat((ovr || "").replace(/[^0-9.]/g, ""));
                                        const hasBoth = !isNaN(costNum) && !isNaN(ovrNum) && costNum > 0;
                                        const trMargin = hasBoth ? (ovrNum - costNum) : null;
                                        const trBelowCost = hasBoth && ovrNum < costNum;
                                        return (
                                        <div key={ti}>
                                          <p className="text-slate-400" style={{fontSize:"9px"}}>{label}</p>
                                          <input type="text" defaultValue={ovr || ""} placeholder={costStr} className={`w-full border rounded px-1 py-0.5 text-xs ${trBelowCost ? "border-rose-400 bg-rose-50 text-rose-700 font-semibold" : ovr ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                          <p className="text-slate-300" style={{fontSize:"8px"}}>ä»•å…¥: {costStr}</p>
                                          {trMargin !== null && !trBelowCost && <p className="text-emerald-500 font-semibold" style={{fontSize:"8px"}}>ç²—åˆ© +{trMargin.toFixed(trMargin < 1 ? 2 : 0)}{costStr.includes("USD") ? "USD" : costStr.includes("%") ? "%" : "å††"}</p>}
                                          {trBelowCost && <p className="text-rose-500 font-semibold" style={{fontSize:"8px"}}>âš  ä»•å…¥ã‚Œå‰²ã‚Œ</p>}
                                        </div>
                                        );
                                      })}
                                    </div>
                                  </div>
                                  )}
                                </div>
                                {/* ãƒ‡ãƒã‚¸ãƒƒãƒˆãƒ»åˆ¶é™ãƒ»å…¥é‡‘ */}
                                <div className="grid grid-cols-3 gap-2 mt-2 pt-2 border-t border-dashed border-slate-200">
                                  <div>
                                    <p className="text-slate-400 mb-1 font-semibold">ãƒ‡ãƒã‚¸ãƒƒãƒˆ</p>
                                    <div className="grid grid-cols-2 gap-1">
                                      <div>
                                        <p className="text-slate-400" style={{fontSize:"9px"}}>ç•™ä¿ç‡</p>
                                        <input type="text" defaultValue={proc.depositOverride?.rate || ""} placeholder={pInfo.deposit?.rate || "-"} className={`w-full border rounded px-1 py-0.5 text-xs ${proc.depositOverride?.rate ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                      </div>
                                      <div>
                                        <p className="text-slate-400" style={{fontSize:"9px"}}>æœŸé–“</p>
                                        <input type="text" defaultValue={proc.depositOverride?.period || ""} placeholder={pInfo.deposit?.period || "-"} className={`w-full border rounded px-1 py-0.5 text-xs ${proc.depositOverride?.period ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                      </div>
                                    </div>
                                  </div>
                                  <div>
                                    <p className="text-slate-400 mb-1 font-semibold">å–å¼•åˆ¶é™</p>
                                    <div className="grid grid-cols-3 gap-1">
                                      <div>
                                        <p className="text-slate-400" style={{fontSize:"9px"}}>1ä»¶ä¸Šé™</p>
                                        <input type="text" defaultValue={proc.limitOverride?.trMax || ""} placeholder={pInfo.limits?.trMax || "-"} className={`w-full border rounded px-1 py-0.5 text-xs ${proc.limitOverride?.trMax ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                      </div>
                                      <div>
                                        <p className="text-slate-400" style={{fontSize:"9px"}}>æœˆé–“ä¸Šé™</p>
                                        <input type="text" defaultValue={proc.limitOverride?.monthly || ""} placeholder={pInfo.limits?.monthlyMax || "-"} className={`w-full border rounded px-1 py-0.5 text-xs ${proc.limitOverride?.monthly ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                      </div>
                                      <div>
                                        <p className="text-slate-400" style={{fontSize:"9px"}}>å›æ•°åˆ¶é™</p>
                                        <input type="text" defaultValue={proc.limitOverride?.count || ""} placeholder={pInfo.limits?.countLimit || "-"} className={`w-full border rounded px-1 py-0.5 text-xs ${proc.limitOverride?.count ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                      </div>
                                    </div>
                                  </div>
                                  <div>
                                    <p className="text-slate-400 mb-1 font-semibold">å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«</p>
                                    <input type="text" defaultValue={proc.settlementOverride || ""} placeholder={pInfo.settlement?.cycle || "-"} className={`w-full border rounded px-1 py-0.5 text-xs ${proc.settlementOverride ? "border-amber-400 bg-amber-50 text-amber-700 font-semibold" : "border-slate-200 text-slate-400"}`} />
                                    <p className="text-slate-300 mt-0.5" style={{fontSize:"8px"}}>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: {pInfo.settlement?.cycle || "-"}</p>
                                  </div>
                                </div>
                                {/* ç²—åˆ©ã‚µãƒãƒªãƒ¼ */}
                                {(proc.feeOverride || proc.trFeesOverride) && (() => {
                                  const margins = brandKeys.map(bk => {
                                    const cost = parseFloat(pInfo.fees?.[bk]);
                                    const sell = parseFloat(proc.feeOverride?.[bk]);
                                    if (!isNaN(cost) && !isNaN(sell)) return { brand: bk, cost, sell, margin: sell - cost, type: "rate" };
                                    return null;
                                  }).filter(Boolean);
                                  const trLabels = {success:"TR(æˆåŠŸ)",fail:"TR(å¤±æ•—)",cb:"CBæ‰‹æ•°æ–™",refund:"è¿”é‡‘",tds:"3DS",cbCancel:"CBå–æ¶ˆ"};
                                  const trMargins = proc.trFeesOverride ? Object.entries(proc.trFeesOverride).map(([k,v]) => {
                                    const costStr = pInfo.trFees?.[k] || "";
                                    const costNum = parseFloat((costStr).replace(/[^0-9.]/g, ""));
                                    const ovrNum = parseFloat((v || "").replace(/[^0-9.]/g, ""));
                                    if (!isNaN(costNum) && !isNaN(ovrNum) && costNum > 0) {
                                      const unit = costStr.includes("USD") ? "USD" : costStr.includes("%") ? "%" : "å††";
                                      return { brand: trLabels[k] || k, margin: ovrNum - costNum, type: "tr", unit };
                                    }
                                    return null;
                                  }).filter(Boolean) : [];
                                  if (margins.length === 0 && trMargins.length === 0) return null;
                                  const avgMargin = margins.length > 0 ? (margins.reduce((s, m) => s + m.margin, 0) / margins.length).toFixed(2) : null;
                                  const hasNegative = margins.some(m => m.margin < 0) || trMargins.some(m => m.margin < 0);
                                  return (
                                    <div className={`mt-2 pt-2 border-t border-dashed ${hasNegative ? "border-rose-300" : "border-emerald-300"}`}>
                                      <div className="flex items-center justify-between flex-wrap gap-1">
                                        <p className="text-xs font-semibold text-slate-500">ğŸ“Š ã“ã®æ¥ç¶šå…ˆã®ç²—åˆ©</p>
                                        <div className="flex items-center gap-2 flex-wrap">
                                          {margins.map(m => (
                                            <span key={m.brand} className={`text-xs ${m.margin < 0 ? "text-rose-600 font-bold" : "text-emerald-600"}`}>
                                              {m.brand.toUpperCase()}: {m.margin >= 0 ? "+" : ""}{m.margin.toFixed(2)}%
                                            </span>
                                          ))}
                                          {avgMargin !== null && (
                                            <span className={`text-xs font-bold px-2 py-0.5 rounded ${margins.some(m => m.margin < 0) ? "bg-rose-100 text-rose-700" : "bg-emerald-100 text-emerald-700"}`}>
                                              æ–™ç‡å¹³å‡ç²—åˆ©: {avgMargin >= 0 ? "+" : ""}{avgMargin}%
                                            </span>
                                          )}
                                        </div>
                                      </div>
                                      {trMargins.length > 0 && (
                                        <div className="flex items-center gap-2 flex-wrap mt-1">
                                          <p className="text-[10px] text-slate-400">TRæ‰‹æ•°æ–™ç²—åˆ©:</p>
                                          {trMargins.map(m => (
                                            <span key={m.brand} className={`text-[10px] ${m.margin < 0 ? "text-rose-600 font-bold" : "text-emerald-600"}`}>
                                              {m.brand}: {m.margin >= 0 ? "+" : ""}{m.margin < 1 && m.margin > -1 ? m.margin.toFixed(2) : Math.round(m.margin)}{m.unit}
                                            </span>
                                          ))}
                                        </div>
                                      )}
                                      {hasNegative && (
                                        <div className="mt-1 bg-rose-50 border border-rose-300 rounded p-1.5">
                                          <p className="text-[10px] text-rose-600 font-semibold">âš  ä»•å…¥ã‚ŒåŸä¾¡ã‚’ä¸‹å›ã‚‹æ‰‹æ•°æ–™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ã¾ã¾ç™»éŒ²ã™ã‚‹ã¨èµ¤å­—ã«ãªã‚Šã¾ã™ã€‚æ–™ç‡ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚</p>
                                        </div>
                                      )}
                                    </div>
                                  );
                                })()}
                              </div>
                              );
                            })}
                          </div>
                        </div>
                      </div>
                    </td></tr>
                  )}
                  </React.Fragment>
                ))}
              </tbody>
            </table>
          </div>
        </div>
        );
      })()}

      {/* ===== åŠ ç›Ÿåº—ä¸€è¦§ã‚¿ãƒ– ===== */}
      {m03Tab === "merchants" && (<>
      {/* Sort indicator */}
      <div className="flex items-center gap-2 text-xs text-slate-400">
        <span>ä¸¦ã³æ›¿ãˆ:</span>
        <span className="bg-blue-50 text-blue-600 px-2 py-0.5 rounded border border-blue-200">
          {{ id:"åŠ ç›Ÿåº—ID", name:"åŠ ç›Ÿåº—å", salesNum:"æœˆé–“æ±ºæ¸ˆé«˜", cbNum:"CBç‡", successNum:"æˆåŠŸç‡", feeNum:"æ‰‹æ•°æ–™", riskOrder:"ãƒªã‚¹ã‚¯" }[sortKey] || sortKey}
          {sortDir === "asc" ? " â†‘æ˜‡é †" : " â†“é™é †"}
        </span>
        {sortKey !== "id" && (
          <button className="text-slate-400 hover:text-slate-600" onClick={() => { setSortKey("id"); setSortDir("asc"); }}>âœ• ãƒªã‚»ãƒƒãƒˆ</button>
        )}
        <span className="ml-auto text-slate-300">ğŸ’¡ è¡Œã‚¯ãƒªãƒƒã‚¯ã§æ¥ç¶šå…ˆå¯©æŸ»çŠ¶æ³ã‚’è¡¨ç¤º</span>
      </div>

      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
        <SortableHeader
          sortKey={sortKey} sortDir={sortDir} onSort={handleSort}
          cols={[
            { label: "åŠ ç›Ÿåº—ID", w: "w-24", sortKey: "id" },
            { label: "åŠ ç›Ÿåº—å", w: "flex-1", sortKey: "name" },
            { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-20" },
            { label: "ãƒªã‚¹ã‚¯", w: "w-16", sortKey: "riskOrder" },
            { label: "ã‚µã‚¤ãƒˆ", w: "w-12" },
            { label: "æ¥ç¶šå…ˆ", w: "w-16" },
            { label: "æœˆé–“æ±ºæ¸ˆé«˜", w: "w-24", sortKey: "salesNum" },
            { label: "CBç‡", w: "w-16", sortKey: "cbNum" },
            { label: "æˆåŠŸç‡", w: "w-16", sortKey: "successNum" },
            { label: "æ‰‹æ•°æ–™", w: "w-16", sortKey: "feeNum" },
            { label: "æ“ä½œ", w: "w-14" },
          ]}
        >
        {filtered.map((m, i) => {
          const approvedCount = m.processors.filter(p => p.status === "approved").length;
          const totalCount = m.processors.length;
          const isExpanded = expandedId === m.id;
          return (
            <React.Fragment key={m.id}>
              <tr
                className={`border-b cursor-pointer transition-colors ${isExpanded ? "bg-blue-50 border-l-2 border-l-blue-500" : i % 2 ? "bg-slate-50 hover:bg-blue-50" : "hover:bg-blue-50"}`}
                onClick={() => setExpandedId(isExpanded ? null : m.id)}
              >
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-slate-500">{m.id}</td>
                <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{m.name}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={m.status} color={m.sColor} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={m.risk} color={m.rColor} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-12 text-center"><span className="text-xs font-semibold text-slate-600">{m.sites.length}</span></td>
                <td className="px-4 py-2 whitespace-nowrap w-16">
                  <span className={`text-xs font-semibold ${approvedCount === 0 ? "text-slate-400" : approvedCount >= 3 ? "text-emerald-600" : "text-blue-600"}`}>
                    {approvedCount}/{totalCount}
                  </span>
                </td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-slate-600">{m.sales}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-right text-slate-600">{m.cb}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-right text-slate-600">{m.success}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-right text-slate-600">{m.fee}</td>
                <td className="px-4 py-2 whitespace-nowrap w-14"><button onClick={(e) => { e.stopPropagation(); setSlidePanel(m); }} className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">è©³ç´°</button></td>
              </tr>

              {/* â”€â”€ Expanded: ã‚µã‚¤ãƒˆâ†’æ¥ç¶šå…ˆâ†’å„æ¡ä»¶ éšå±¤ãƒ‘ãƒãƒ« â”€â”€ */}
              {isExpanded && (
                <tr><td colSpan={11} className="p-0"><div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                  <div className="flex justify-between items-center mb-2">
                    <p className="text-xs font-bold text-slate-700">ğŸ¢ ã‚µã‚¤ãƒˆãƒ»æ¥ç¶šå…ˆä¸€è¦§ â€” {m.name}ï¼ˆ{m.sites.length}ã‚µã‚¤ãƒˆ / {m.processors.length}æ¥ç¶šå…ˆï¼‰</p>
                    <button onClick={() => setShowProcApply(true)} className="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">+ æ¥ç¶šå…ˆå¯©æŸ»ã‚’è¿½åŠ ç”³è«‹</button>
                  </div>

                  {/* â”€â”€ ã‚µã‚¤ãƒˆåˆ¥å±•é–‹ â”€â”€ */}
                  {m.sites.map((site, si) => {
                    const siteApproved = site.processors.filter(p => p.status === "approved").length;
                    return (
                      <div key={si} className="bg-white rounded-lg border border-slate-200 mb-2 last:mb-0 overflow-hidden">
                        {/* ã‚µã‚¤ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ */}
                        <div className="flex items-center gap-3 px-4 py-2 bg-slate-50 border-b">
                          <span className="text-sm">ğŸŒ</span>
                          <div className="flex-1">
                            <div className="flex items-center gap-2">
                              <span className="text-xs font-bold text-slate-700">{site.siteName}</span>
                              <span className="text-xs font-mono text-slate-400">{site.siteId}</span>
                              <Badge text={`${siteApproved}/${site.processors.length} æ¥ç¶š`} color={siteApproved === site.processors.length ? "green" : "blue"} />
                            </div>
                            <div className="flex items-center gap-3 mt-0.5">
                              <span className="text-xs text-blue-500 truncate max-w-[200px]">{site.url}</span>
                              {site.agentName && <span className="text-xs text-slate-400">ä»£ç†åº—: {site.agentName}</span>}
                            </div>
                          </div>
                          <button onClick={() => toast("æ¥ç¶šå…ˆè¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã¾ã—ãŸï¼ˆå®Ÿè£…äºˆå®šï¼‰", "info")} className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200">+ æ¥ç¶šå…ˆè¿½åŠ </button>
                        </div>

                        {/* ã‚µã‚¤ãƒˆå†…ã®æ¥ç¶šå…ˆä¸€è¦§ */}
                        {site.processors.map((proc, pi) => {
                          const st = PROC_STATUS[proc.status] || { label: proc.status, color: "gray" };
                          const pInfo = processorList.find(p => p.name === proc.name);
                          const isCard = pInfo && pInfo.type !== "WEBãƒãƒãƒ¼";
                          return (
                            <div key={pi} className={`border-b last:border-0 ${proc.status === "suspended" ? "bg-rose-50/30" : ""}`}>
                              {/* æ¥ç¶šå…ˆã‚µãƒãƒªãƒ¼è¡Œ */}
                              <div className="flex items-center px-4 py-2 text-xs">
                                <div className="w-8 text-center">
                                  {proc.status === "approved" ? "âœ…" : proc.status === "reviewing" ? "ğŸ”„" : proc.status === "suspended" ? "â›”" : "â³"}
                                </div>
                                <div className="w-36 font-semibold text-slate-700">{proc.name}</div>
                                <div className="w-24 text-slate-500">{proc.brands}</div>
                                <div className="w-24"><Badge text={st.label} color={st.color} /></div>
                                <div className="w-20 text-slate-400">{proc.since || "â€”"}</div>
                                <div className="w-20 text-slate-600">{proc.txnCount > 0 ? proc.txnCount.toLocaleString() + "ä»¶" : "â€”"}</div>
                                <div className="w-20 font-mono text-slate-400 text-xs">{proc.mid || "â€”"}</div>
                                <div className="flex-1 flex gap-1 justify-end">
                                  {proc.status === "approved" && <button className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs hover:bg-slate-200">è©³ç´°</button>}
                                  {proc.status === "reviewing" && <button className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs">å¯©æŸ»ç¢ºèª</button>}
                                  {proc.status === "pending" && <button className="px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-xs">å¯©æŸ»ç”³è«‹</button>}
                                </div>
                              </div>

                              {/* å„æ¡ä»¶ï¼ˆæ‰¿èªæ¸ˆã¿ã®å ´åˆã®ã¿è©³ç´°è¡¨ç¤ºï¼‰ */}
                              {proc.status === "approved" && pInfo && (
                                <div className="px-4 pb-3 ml-8 mr-4">
                                  <div className="bg-slate-50 rounded-lg border border-slate-200 p-3 space-y-2">
                                    {/* ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥æ‰‹æ•°æ–™ */}
                                    <div>
                                      <p className="text-xs text-slate-400 mb-1">ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥æ‰‹æ•°æ–™ç‡</p>
                                      <div className="flex gap-2 flex-wrap">
                                        {isCard ? (
                                          ["visa", "master", "jcb", "amex", "diners"].filter(b => pInfo.fees[b] && pInfo.fees[b] !== "-").map(brand => {
                                            const def = pInfo.fees[brand];
                                            const ovr = proc.feeOverride && proc.feeOverride[brand];
                                            return (
                                              <div key={brand} className={`px-2 py-1 rounded border text-xs ${ovr ? "bg-amber-50 border-amber-300" : "bg-white border-slate-200"}`}>
                                                <span className="text-slate-400 uppercase">{brand}: </span>
                                                <span className={`font-semibold ${ovr ? "text-amber-700" : "text-slate-700"}`}>{ovr || def}</span>
                                                {ovr && <span className="text-slate-400 ml-1 line-through">{def}</span>}
                                              </div>
                                            );
                                          })
                                        ) : (
                                          <div className={`px-2 py-1 rounded border text-xs ${proc.feeOverride?.webmoney ? "bg-amber-50 border-amber-300" : "bg-white border-slate-200"}`}>
                                            <span className="text-slate-400">WEBãƒãƒãƒ¼: </span>
                                            <span className={`font-semibold ${proc.feeOverride?.webmoney ? "text-amber-700" : "text-slate-700"}`}>{proc.feeOverride?.webmoney || pInfo.fees?.webmoney || pInfo.fees?.visa || "-"}</span>
                                            {proc.feeOverride?.webmoney && <span className="text-slate-400 ml-1 line-through">{pInfo.fees?.webmoney || pInfo.fees?.visa || "-"}</span>}
                                          </div>
                                        )}
                                      </div>
                                    </div>

                                    {/* TRæ‰‹æ•°æ–™ãƒ»ãƒ‡ãƒã‚¸ãƒƒãƒˆãƒ»åˆ¶é™ */}
                                    <div className="grid grid-cols-3 gap-3 text-xs">
                                      {/* TRæ‰‹æ•°æ–™ */}
                                      <div>
                                        <p className="text-slate-400 mb-1">TRæ‰‹æ•°æ–™</p>
                                        <div className="space-y-0.5">
                                          <div className="flex justify-between"><span className="text-slate-500">æˆåŠŸ:</span><span className="font-semibold">{pInfo.trFees.success}</span></div>
                                          <div className="flex justify-between"><span className="text-slate-500">å¤±æ•—:</span><span className="font-semibold">{pInfo.trFees.fail}</span></div>
                                          <div className="flex justify-between"><span className="text-slate-500">CB:</span><span className="font-semibold">{pInfo.trFees.cb}</span></div>
                                          <div className="flex justify-between"><span className="text-slate-500">è¿”é‡‘:</span><span className="font-semibold">{pInfo.trFees.refund}</span></div>
                                        </div>
                                      </div>

                                      {/* ãƒ‡ãƒã‚¸ãƒƒãƒˆ */}
                                      <div>
                                        <p className="text-slate-400 mb-1">ãƒ‡ãƒã‚¸ãƒƒãƒˆãƒ»ç•™ä¿</p>
                                        <div className="space-y-0.5">
                                          {(() => {
                                            const depRate = proc.depositOverride?.rate || pInfo.deposit.rate;
                                            const depPeriod = proc.depositOverride?.period || pInfo.deposit.period;
                                            const hasOvr = proc.depositOverride?.rate || proc.depositOverride?.period;
                                            return (<>
                                              <div className="flex justify-between"><span className="text-slate-500">ç•™ä¿ç‡:</span><span className={`font-semibold ${hasOvr ? "text-amber-700" : ""}`}>{depRate}</span></div>
                                              <div className="flex justify-between"><span className="text-slate-500">æœŸé–“:</span><span className={`font-semibold ${hasOvr ? "text-amber-700" : ""}`}>{depPeriod}</span></div>
                                              <div className="flex justify-between"><span className="text-slate-500">ç¨®åˆ¥:</span><span className="font-semibold">{pInfo.deposit.type}</span></div>
                                            </>);
                                          })()}
                                        </div>
                                      </div>

                                      {/* å–å¼•åˆ¶é™ */}
                                      <div>
                                        <p className="text-slate-400 mb-1">å–å¼•åˆ¶é™</p>
                                        <div className="space-y-0.5">
                                          {(() => {
                                            const trMax = proc.limitOverride?.trMax || pInfo.limits.trMax;
                                            const monthly = proc.limitOverride?.monthly || pInfo.limits.monthlyMax;
                                            const count = proc.limitOverride?.count || pInfo.limits.countLimit;
                                            const hasOvr = proc.limitOverride?.trMax || proc.limitOverride?.monthly || proc.limitOverride?.count;
                                            return (<>
                                              <div className="flex justify-between"><span className="text-slate-500">1ä»¶ä¸Šé™:</span><span className={`font-semibold ${proc.limitOverride?.trMax ? "text-amber-700" : ""}`}>{trMax}</span></div>
                                              <div className="flex justify-between"><span className="text-slate-500">æœˆé–“:</span><span className={`font-semibold ${proc.limitOverride?.monthly ? "text-amber-700" : ""}`}>{monthly}</span></div>
                                              <div className="flex justify-between"><span className="text-slate-500">å›æ•°:</span><span className={`font-semibold ${proc.limitOverride?.count ? "text-amber-700" : ""}`}>{count}</span></div>
                                            </>);
                                          })()}
                                        </div>
                                      </div>
                                    </div>

                                    {/* å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ« */}
                                    <div className="flex items-center gap-4 text-xs pt-1 border-t border-slate-200">
                                      <span className="text-slate-400">å…¥é‡‘:</span>
                                      <span className={`font-semibold ${proc.settlementOverride ? "text-amber-700" : "text-slate-700"}`}>{proc.settlementOverride || pInfo.settlement.cycle}</span>
                                      {proc.settlementOverride && <span className="text-slate-400 text-xs">ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: {pInfo.settlement.cycle}ï¼‰</span>}
                                    </div>

                                    {/* ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰æ³¨è¨˜ */}
                                    {(proc.feeOverride || proc.depositOverride || proc.limitOverride || proc.settlementOverride) && (
                                      <div className="text-xs text-amber-600 flex items-center gap-1 pt-1">
                                        <span>âš ï¸</span>
                                        <span>é»„è‰²ã®å€¤ã¯åŠ ç›Ÿåº—åˆ¥ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚ŒãŸå€‹åˆ¥æ¡ä»¶ã§ã™</span>
                                      </div>
                                    )}
                                  </div>
                                </div>
                              )}
                            </div>
                          );
                        })}
                      </div>
                    );
                  })}

                  {/* AI Suggestion */}
                  {m.processors.filter(p => p.status === "approved").length === 1 && m.salesNum > 1000000 && (
                    <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded border border-blue-200 p-2 mt-2">
                      <p className="text-xs text-blue-700">ğŸ¤– <span className="font-semibold">AIææ¡ˆ:</span> æœˆé–“æ±ºæ¸ˆé«˜{m.sales}ã®å®Ÿç¸¾ãŒã‚ã‚Šã¾ã™ã€‚æ¥ç¶šå…ˆã‚’è¿½åŠ ã™ã‚‹ã¨ã€ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã‚„ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚Worldpayæ¥ç¶šã®å¯©æŸ»ã‚’æ¨è–¦ã—ã¾ã™ã€‚</p>
                    </div>
                  )}
                  {m.processors.filter(p => p.status === "approved").length >= 3 && (
                    <div className="bg-gradient-to-r from-emerald-50 to-emerald-50 rounded border border-emerald-200 p-2 mt-2">
                      <p className="text-xs text-emerald-700">âœ… <span className="font-semibold">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æœ€é©åŒ–:</span> 3æ¥ç¶šå…ˆä»¥ä¸ŠãŒæœ‰åŠ¹ã§ã™ã€‚AIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆæœ€é©åŒ–ãƒ»ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãŒå®Œå…¨ã«æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚</p>
                    </div>
                  )}
                </div></td></tr>
              )}
            </React.Fragment>
          );
        })}
        {filtered.length === 0 && (
          <tr><td colSpan={11} className="p-6 text-center text-xs text-slate-400">è©²å½“ã™ã‚‹åŠ ç›Ÿåº—ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>
        )}
        </SortableHeader>
      </div>

      {/* â”€â”€ Slide Panel: åŠ ç›Ÿåº—è©³ç´° â”€â”€ */}
      {slidePanel && (
        <div className="fixed inset-0 z-50 flex">
          <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSlidePanel(null)} />
          <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">åŠ ç›Ÿåº—è©³ç´°</h3>
              <button onClick={() => setSlidePanel(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              {/* ä¼æ¥­æƒ…å ± */}
              <div>
                <p className="text-xs font-bold text-slate-600 mb-2">ä¼æ¥­æƒ…å ±</p>
                <div className="space-y-1.5 text-xs">
                  <div className="flex justify-between"><span className="text-slate-400">æ³•äººå</span><span className="font-semibold">{slidePanel.name}</span></div>
                  <div className="flex justify-between"><span className="text-slate-400">ID</span><span className="font-mono">{slidePanel.id}</span></div>
                  <div className="flex justify-between"><span className="text-slate-400">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span><Badge text={slidePanel.status} color={slidePanel.sColor} /></div>
                  <div className="flex justify-between"><span className="text-slate-400">URL</span><span className="text-blue-600">sample-ec.jp</span></div>
                </div>
              </div>
              {/* ãƒªã‚¹ã‚¯æƒ…å ± */}
              <div className="border-t pt-3">
                <p className="text-xs font-bold text-slate-600 mb-2">ãƒªã‚¹ã‚¯æƒ…å ±</p>
                <div className="flex items-center gap-2 mb-2">
                  <span className="text-xs text-slate-400">ç¾åœ¨:</span>
                  <Badge text={slidePanel.risk} color={slidePanel.rColor} />
                  <span className="text-xs text-slate-400 ml-2">AIåˆ¤å®šã‚¹ã‚³ã‚¢: 58/100</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="text-xs text-slate-400">å¤‰æ›´:</span>
                  <select className="text-xs border rounded px-2 py-1">
                    <option>ä½</option><option>ä¸­</option><option>é«˜</option>
                  </select>
                  <input className="text-xs border rounded px-2 py-1 flex-1" placeholder="å¤‰æ›´ç†ç”±ï¼ˆå¿…é ˆï¼‰" />
                </div>
              </div>
              {/* å–å¼•çµ±è¨ˆ */}
              <div className="border-t pt-3">
                <p className="text-xs font-bold text-slate-600 mb-2">å–å¼•çµ±è¨ˆ</p>
                <div className="grid grid-cols-2 gap-2 text-xs">
                  <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200"><span className="text-slate-400">æœˆé–“æ±ºæ¸ˆé«˜</span><p className="font-bold">{slidePanel.sales}</p></div>
                  <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200"><span className="text-slate-400">æˆåŠŸç‡</span><p className="font-bold">{slidePanel.success}</p></div>
                  <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200"><span className="text-slate-400">CBç‡</span><p className="font-bold">{slidePanel.cb}</p></div>
                  <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200"><span className="text-slate-400">æ‰‹æ•°æ–™</span><p className="font-bold">{slidePanel.fee}</p></div>
                </div>
              </div>
              {/* ã‚µã‚¤ãƒˆåˆ¥æ¥ç¶šå…ˆçŠ¶æ³ */}
              <div className="border-t pt-3">
                <p className="text-xs font-bold text-slate-600 mb-2">ğŸŒ ã‚µã‚¤ãƒˆåˆ¥ æ¥ç¶šå…ˆãƒ»æ‰‹æ•°æ–™ä¸€è¦§</p>
                {(slidePanel.sites || []).map((site, si) => (
                  <div key={si} className="mb-3 bg-slate-50 rounded-lg border border-slate-200 p-2">
                    <div className="flex items-center gap-2 mb-2">
                      <span className="font-mono text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded">{site.siteId}</span>
                      <span className="text-xs font-semibold text-slate-700">{site.siteName}</span>
                      {site.agentName && <span className="text-xs text-purple-600 bg-purple-50 px-1.5 py-0.5 rounded border border-purple-200">ä»£ç†åº—: {site.agentName}</span>}
                    </div>
                    <div className="overflow-x-auto">
                      <table className="w-full text-xs">
                        <thead><tr className="bg-slate-100 text-slate-500">
                          <th className="px-2 py-1 text-left font-semibold">æ¥ç¶šå…ˆ</th>
                          <th className="px-2 py-1 text-center font-semibold">çŠ¶æ…‹</th>
                          <th className="px-2 py-1 text-center font-semibold">MID</th>
                          <th className="px-2 py-1 text-center font-semibold">VISA</th>
                          <th className="px-2 py-1 text-center font-semibold">MC</th>
                          <th className="px-2 py-1 text-center font-semibold">JCB</th>
                          <th className="px-2 py-1 text-center font-semibold">ãƒ‡ãƒ</th>
                          <th className="px-2 py-1 text-center font-semibold">å…¥é‡‘</th>
                        </tr></thead>
                        <tbody>
                        {site.processors.map((mp, pi) => {
                          const st = PROC_STATUS[mp.status];
                          const procDef = processorList.find(x => x.name === mp.name);
                          const isWM = procDef?.type === "WEBãƒãƒãƒ¼";
                          return (
                            <tr key={pi} className="border-b last:border-0">
                              <td className="px-2 py-1 font-semibold text-slate-700">{mp.name}</td>
                              <td className="px-2 py-1 text-center"><Badge text={st.label} color={st.color} /></td>
                              <td className="px-2 py-1 text-center font-mono text-slate-500">{mp.mid || "â€”"}</td>
                              {isWM ? (
                                <td colSpan={3} className={`px-2 py-1 text-center font-semibold ${mp.feeOverride?.webmoney ? "text-amber-600" : "text-blue-700"}`}>{mp.feeOverride?.webmoney || procDef?.fees?.webmoney || "-"}</td>
                              ) : (<>
                                <td className={`px-2 py-1 text-center font-semibold ${mp.feeOverride?.visa ? "text-amber-600" : "text-slate-600"}`}>{mp.feeOverride?.visa || procDef?.fees?.visa || "-"}</td>
                                <td className={`px-2 py-1 text-center font-semibold ${mp.feeOverride?.master ? "text-amber-600" : "text-slate-600"}`}>{mp.feeOverride?.master || procDef?.fees?.master || "-"}</td>
                                <td className={`px-2 py-1 text-center font-semibold ${mp.feeOverride?.jcb ? "text-amber-600" : "text-slate-600"}`}>{mp.feeOverride?.jcb || procDef?.fees?.jcb || "-"}</td>
                              </>)}
                              <td className={`px-2 py-1 text-center ${mp.depositOverride?.rate ? "text-amber-600 font-semibold" : "text-slate-500"}`}>{mp.depositOverride?.rate || procDef?.deposit?.rate || "-"}</td>
                              <td className="px-2 py-1 text-center text-slate-500 truncate max-w-[120px]">{mp.settlementOverride || procDef?.settlement?.cycle || "-"}</td>
                            </tr>
                          );
                        })}
                        </tbody>
                      </table>
                    </div>
                  </div>
                ))}
                <p className="text-xs text-amber-600">â€» ã‚ªãƒ¬ãƒ³ã‚¸ = ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å€¤</p>
              </div>
              {/* ãƒªã‚¶ãƒ¼ãƒ–è¨­å®šï¼ˆã‚µã‚¤ãƒˆãƒ»æ¥ç¶šå…ˆåˆ¥è‡ªå‹•è¡¨ç¤ºï¼‰ */}
              <div className="border-t pt-3">
                <p className="text-xs font-bold text-purple-700 mb-2">ğŸ”’ ãƒªã‚¶ãƒ¼ãƒ–ï¼ˆãƒ‡ãƒã‚¸ãƒƒãƒˆï¼‰è¨­å®š</p>
                <div className="space-y-2">
                  {(slidePanel.sites || []).flatMap(site =>
                    site.processors.filter(mp => mp.status === "approved").map(mp => {
                      const procDef = processorList.find(x => x.name === mp.name);
                      const rate = mp.depositOverride?.rate || procDef?.deposit?.rate || "-";
                      const period = mp.depositOverride?.period || procDef?.deposit?.period || "-";
                      if (rate === "-") return null;
                      return { proc: mp.name, siteId: site.siteId, rate, period, balance: `Â¥${Math.floor(mp.txnCount * 150 * parseFloat(rate) / 100).toLocaleString()}` };
                    })
                  ).filter(Boolean).map((r, i) => (
                    <div key={i} className="bg-purple-50 rounded border border-purple-200 p-2 text-xs">
                      <div className="flex justify-between items-center mb-1">
                        <span className="font-semibold text-slate-700">{r.proc} <span className="text-slate-400 font-normal">({r.siteId})</span></span>
                        <Badge text={`${r.rate} / ${r.period}`} color="purple" />
                      </div>
                      <div className="flex gap-3">
                        <div><span className="text-slate-400">ãƒªã‚¶ãƒ¼ãƒ–ç‡:</span> <input className="w-14 border rounded px-1 py-0.5 text-center" defaultValue={r.rate} /></div>
                        <div><span className="text-slate-400">æœŸé–“:</span> <select className="border rounded px-1 py-0.5"><option>90æ—¥</option><option>120æ—¥</option><option selected={r.period==="180æ—¥"}>180æ—¥</option><option>365æ—¥</option></select></div>
                        <div className="flex-1 text-right"><span className="text-slate-400">æ¦‚ç®—æ®‹é«˜:</span> <span className="font-bold text-purple-700">{r.balance}</span></div>
                      </div>
                    </div>
                  ))}
                </div>
                <p className="text-xs text-slate-400 mt-1">â€» å¤‰æ›´ã¯æ¬¡å›ç²¾ç®—ã‹ã‚‰é©ç”¨ã•ã‚Œã¾ã™</p>
              </div>
              {/* ãƒ¡ãƒ¢ */}
              <div className="border-t pt-3">
                <p className="text-xs font-bold text-slate-600 mb-2">é‹å–¶ãƒ¡ãƒ¢</p>
                <textarea className="w-full text-xs border rounded p-2 h-16" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›..." />
              </div>
              {/* æ“ä½œãƒœã‚¿ãƒ³ */}
              <div className="border-t pt-3 space-y-2">
                <button className="w-full py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">ä¿å­˜</button>
                <div className="flex gap-2">
                  <button onClick={() => setShowConfirm("suspend")} className="flex-1 py-2 bg-amber-100 text-amber-700 rounded text-xs font-semibold hover:bg-amber-200">âš  ã‚µã‚¹ãƒšãƒ³ãƒ‰</button>
                  <button onClick={() => setShowConfirm("terminate")} className="flex-1 py-2 bg-rose-100 text-rose-700 rounded text-xs font-semibold hover:bg-rose-200">ğŸš¨ è§£ç´„</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Slide Panel: æ‰‹å‹•ç™»éŒ² â”€â”€ */}
      {showAddModal && (
        <div className="fixed inset-0 z-50 flex">
          <div className="flex-1 bg-black bg-opacity-30" onClick={() => setShowAddModal(false)} />
          <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
            <div className="p-4 border-b bg-blue-50 flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">åŠ ç›Ÿåº— æ‰‹å‹•ç™»éŒ²</h3>
              <button onClick={() => setShowAddModal(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div className="bg-amber-50 rounded border border-amber-200 p-2 text-xs text-amber-700">âš ï¸ æ‰‹å‹•ç™»éŒ²ã¯AIå¯©æŸ»ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚audit_logsã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚</div>
              {[
                { label: "æ³•äººå", placeholder: "æ ªå¼ä¼šç¤¾ã€‡ã€‡", required: true },
                { label: "æ³•äººç•ªå·", placeholder: "1234567890123ï¼ˆ13æ¡ï¼‰", required: true },
                { label: "ä»£è¡¨è€…å", placeholder: "å±±ç”° å¤ªéƒ", required: true },
                { label: "æ‰€åœ¨åœ°", placeholder: "æ±äº¬éƒ½æ¸‹è°·åŒº...", required: true },
                { label: "æ‹…å½“è€…ãƒ¡ãƒ¼ãƒ«", placeholder: "tanaka@example.com", required: true },
                { label: "æ‹…å½“è€…é›»è©±", placeholder: "03-1234-5678", required: true },
                { label: "URL", placeholder: "https://example.com", required: true },
              ].map((f, i) => (
                <div key={i}>
                  <label className="text-xs font-semibold text-slate-600">{f.label} {f.required && <span className="text-rose-500">*</span>}</label>
                  <input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder={f.placeholder} />
                </div>
              ))}
              <div>
                <label className="text-xs font-semibold text-slate-600">æ¥­ç¨® <span className="text-rose-500">*</span></label>
                <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                  <option>é¸æŠã—ã¦ãã ã•ã„</option>
                  <option>ECï¼ˆç‰©è²©ï¼‰</option><option>ECï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ï¼‰</option><option>æ—…è¡Œ</option>
                  <option>é£²é£Ÿ</option><option>ã‚µãƒ¼ãƒ“ã‚¹</option><option>æ•™è‚²</option><option>åŒ»ç™‚</option><option>ãã®ä»–</option>
                </select>
              </div>
              <div>
                <label className="text-xs font-semibold text-slate-600">æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜ <span className="text-rose-500">*</span></label>
                <input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="Â¥1,000,000" />
              </div>
              <div>
                <label className="text-xs font-semibold text-slate-600">åˆæœŸãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ« <span className="text-rose-500">*</span></label>
                <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                  <option>ä½</option><option>ä¸­</option><option>é«˜</option>
                </select>
              </div>
              <div>
                <label className="text-xs font-semibold text-slate-600">ç™»éŒ²ç†ç”± <span className="text-rose-500">*</span></label>
                <textarea className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 h-16" placeholder="æ‰‹å‹•ç™»éŒ²ã®ç†ç”±ã‚’å…¥åŠ›..." />
              </div>
            </div>
            <div className="p-4 border-t space-y-2">
              <button onClick={() => { setShowAddModal(false); toast("åŠ ç›Ÿåº—ã‚’æ‰‹å‹•ç™»éŒ²ã—ã¾ã—ãŸ", "success"); }} className="w-full py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">ç™»éŒ²ã™ã‚‹</button>
              <button onClick={() => setShowAddModal(false)} className="w-full py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Confirm Dialog: ã‚µã‚¹ãƒšãƒ³ãƒ‰/è§£ç´„ â”€â”€ */}
      {showConfirm && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowConfirm(null)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[420px] p-6">
            <h3 className={`text-sm font-bold mb-3 ${showConfirm === "suspend" ? "text-amber-700" : "text-rose-700"}`}>
              {showConfirm === "suspend" ? "âš  åŠ ç›Ÿåº—ã‚’ã‚µã‚¹ãƒšãƒ³ãƒ‰ã—ã¾ã™ã‹ï¼Ÿ" : "ğŸš¨ åŠ ç›Ÿåº—ã‚’è§£ç´„ã—ã¾ã™ã‹ï¼Ÿ"}
            </h3>
            <p className="text-xs text-slate-600 mb-3">
              {showConfirm === "suspend" ? "ã‚µã‚¹ãƒšãƒ³ãƒ‰ä¸­ã¯å…¨ã‚µã‚¤ãƒˆã®æ±ºæ¸ˆå‡¦ç†ãŒåœæ­¢ã•ã‚Œã¾ã™ã€‚å¾©å¸°ã¯ç®¡ç†è€…ãŒæ‰‹å‹•ã§è¡Œã„ã¾ã™ã€‚" : "è§£ç´„å¾Œã¯å…¨ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã¾ã™ãŒã€æ±ºæ¸ˆå‡¦ç†ã¯å®Œå…¨ã«åœæ­¢ã•ã‚Œã¾ã™ã€‚æœªç²¾ç®—åˆ†ã¯ç²¾ç®—å®Œäº†å¾Œã«å…¥é‡‘ã•ã‚Œã¾ã™ã€‚"}
            </p>
            <div className="mb-3">
              <label className="text-xs font-semibold text-slate-600">ç†ç”±ï¼ˆå¿…é ˆï¼‰ <span className="text-rose-500">*</span></label>
              <textarea className="w-full text-xs border rounded p-2 h-16 mt-0.5" placeholder="ç†ç”±ã‚’å…¥åŠ›..." />
            </div>
            <div className="flex gap-2 justify-end">
              <button onClick={() => setShowConfirm(null)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { const action = showConfirm === "suspend" ? "ã‚µã‚¹ãƒšãƒ³ãƒ‰" : "è§£ç´„"; setShowConfirm(null); toast(`åŠ ç›Ÿåº—ã‚’${action}ã—ã¾ã—ãŸ`, showConfirm === "suspend" ? "warning" : "error"); }} className={`px-4 py-2 text-xs text-white rounded font-semibold ${showConfirm === "suspend" ? "bg-amber-600 hover:bg-amber-700" : "bg-rose-600 hover:bg-rose-700"}`}>
                {showConfirm === "suspend" ? "ã‚µã‚¹ãƒšãƒ³ãƒ‰ã™ã‚‹" : "è§£ç´„ã™ã‚‹"}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: æ¥ç¶šå…ˆå¯©æŸ»ã‚’è¿½åŠ ç”³è«‹ â”€â”€ */}
      {showProcApply && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowProcApply(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[480px]">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">æ¥ç¶šå…ˆå¯©æŸ»ã‚’è¿½åŠ ç”³è«‹</h3>
              <button onClick={() => setShowProcApply(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div>
                <label className="text-xs font-semibold text-slate-600">æ¥ç¶šå…ˆ <span className="text-rose-500">*</span></label>
                <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>é¸æŠã—ã¦ãã ã•ã„</option><option>Univa Pay cast</option><option>æ¥½å¤©éŠ€è¡Œ</option><option>Worldpay</option><option>TCMS</option><option>Simpletransact</option><option>ONTHELINE</option><option>Asiabill</option><option>ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥</option><option>ã‚¹ãƒãƒ¼ãƒˆãƒ”ãƒƒãƒˆ</option><option>ãƒãƒƒãƒˆãƒ©ã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥</option><option>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒãƒ¼</option><option>Gãƒãƒãƒ¼</option><option>ãƒšã‚¤ãƒ‡ã‚£</option><option>ãƒ‹ãƒ¼ãƒã‚ªãƒšã‚¤</option></select>
              </div>
              <div>
                <label className="text-xs font-semibold text-slate-600">ç”³è«‹ç†ç”±</label>
                <textarea className="w-full text-xs border rounded p-2 h-16 mt-0.5" placeholder="è¿½åŠ ç”³è«‹ã®ç†ç”±ã‚’å…¥åŠ›..." />
              </div>
              <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700">ğŸ’¡ ç”³è«‹å¾Œã€å¯©æŸ»å®Œäº†ã¾ã§1ã€œ5å–¶æ¥­æ—¥ã‹ã‹ã‚Šã¾ã™</div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowProcApply(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowProcApply(false); toast("æ¥ç¶šå…ˆå¯©æŸ»ã‚’ç”³è«‹ã—ã¾ã—ãŸ", "success"); }} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">ç”³è«‹ã™ã‚‹</button>
            </div>
          </div>
        </div>
      )}
      </>)}

      {/* â”€â”€ Modal: ã‚µã‚¤ãƒˆè¿½åŠ  â”€â”€ */}
      {showSiteAddModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowSiteAddModal(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[600px] max-h-[85vh] overflow-y-auto">
            <div className="p-4 border-b bg-blue-50 rounded-t-xl flex justify-between items-center sticky top-0 z-10">
              <h3 className="text-sm font-bold text-slate-800">ğŸŒ æ–°è¦ã‚µã‚¤ãƒˆè¿½åŠ </h3>
              <button onClick={() => setShowSiteAddModal(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div className="bg-blue-50 border border-blue-200 rounded p-3 text-xs text-blue-700">
                <p className="font-bold mb-1">ğŸ“‹ ã‚µã‚¤ãƒˆè¿½åŠ ã®æµã‚Œ</p>
                <div className="flex items-center gap-2 text-slate-600">
                  <span className="bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">1</span><span>åŸºæœ¬æƒ…å ±å…¥åŠ›</span>
                  <span className="text-slate-300">â†’</span>
                  <span className="bg-slate-300 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">2</span><span>æ±ºæ¸ˆè¨­å®š</span>
                  <span className="text-slate-300">â†’</span>
                  <span className="bg-slate-300 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">3</span><span>å¯©æŸ»ç”³è«‹</span>
                </div>
              </div>

              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“Œ åŸºæœ¬æƒ…å ±</p>
                <div className="grid grid-cols-2 gap-3">
                  <div><label className="text-xs font-semibold text-slate-600">åŠ ç›Ÿåº— <span className="text-rose-500">*</span></label>
                    <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                      <option value="">åŠ ç›Ÿåº—ã‚’é¸æŠ...</option>
                      <option>M-001 æ ªå¼ä¼šç¤¾ABCå•†äº‹</option>
                      <option>M-002 åˆåŒä¼šç¤¾XYZç‰©ç”£</option>
                      <option>M-003 æ ªå¼ä¼šç¤¾DEFã‚µãƒ¼ãƒ“ã‚¹</option>
                    </select>
                  </div>
                  <div><label className="text-xs font-semibold text-slate-600">ã‚µã‚¤ãƒˆå <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: ECã‚µã‚¤ãƒˆB" /></div>
                </div>
                <div className="grid grid-cols-2 gap-3 mt-2">
                  <div><label className="text-xs font-semibold text-slate-600">ã‚µã‚¤ãƒˆURL <span className="text-rose-500">*</span></label><input type="url" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 font-mono" placeholder="https://example.com" /></div>
                  <div><label className="text-xs font-semibold text-slate-600">ã‚¸ãƒ£ãƒ³ãƒ« <span className="text-rose-500">*</span></label>
                    <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                      <option value="">é¸æŠ...</option>
                      <option>ECï¼ˆç‰©è²©ï¼‰</option><option>ECï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ï¼‰</option><option>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</option>
                      <option>æ•™è‚²ãƒ»ã‚¹ã‚¯ãƒ¼ãƒ«</option><option>ã‚µãƒ¼ãƒ“ã‚¹æ¥­</option><option>ãã®ä»–</option>
                    </select>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-3 mt-2">
                  <div><label className="text-xs font-semibold text-slate-600">æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: Â¥5,000,000" /></div>
                  <div><label className="text-xs font-semibold text-slate-600">é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ« <span className="text-rose-500">*</span></label><input type="email" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 font-mono" placeholder="admin@example.com" /></div>
                </div>
                <div className="mt-2"><label className="text-xs font-semibold text-slate-600">ä»£ç†åº—ï¼ˆä»»æ„ï¼‰</label>
                  <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                    <option value="">ç´ä»˜ãªã—</option>
                    <option>AG-001 ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</option>
                    <option>AG-002 ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚µãƒ«åˆåŒä¼šç¤¾</option>
                    <option>AG-003 ITã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º</option>
                  </select>
                </div>
              </div>

              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">ğŸ’³ æ±ºæ¸ˆè¨­å®š</p>
                <div className="grid grid-cols-2 gap-3">
                  <div className="space-y-2">
                    <label className="flex items-center gap-2 text-xs cursor-pointer"><input type="checkbox" defaultChecked className="w-3.5 h-3.5 rounded" /><span className="text-slate-700">3DSèªè¨¼ã‚’æœ‰åŠ¹åŒ–</span></label>
                    <label className="flex items-center gap-2 text-xs cursor-pointer"><input type="checkbox" className="w-3.5 h-3.5 rounded" /><span className="text-slate-700">ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°ï¼ˆç¶™ç¶šèª²é‡‘ï¼‰</span></label>
                    <label className="flex items-center gap-2 text-xs cursor-pointer"><input type="checkbox" defaultChecked className="w-3.5 h-3.5 rounded" /><span className="text-slate-700">CVVå¿…é ˆ</span></label>
                  </div>
                  <div className="space-y-2">
                    <p className="text-xs text-slate-500 font-semibold">æ±ºæ¸ˆæ–¹å¼</p>
                    <label className="flex items-center gap-2 text-xs cursor-pointer"><input type="checkbox" defaultChecked className="w-3.5 h-3.5 rounded" /><span className="text-slate-700">ãƒˆãƒ¼ã‚¯ãƒ³æ±ºæ¸ˆ</span></label>
                    <label className="flex items-center gap-2 text-xs cursor-pointer"><input type="checkbox" className="w-3.5 h-3.5 rounded" /><span className="text-slate-700">LINKæ±ºæ¸ˆ</span></label>
                    <label className="flex items-center gap-2 text-xs cursor-pointer"><input type="checkbox" className="w-3.5 h-3.5 rounded" /><span className="text-slate-700">APIæ±ºæ¸ˆ</span></label>
                  </div>
                </div>
                <div className="mt-2">
                  <label className="text-xs font-semibold text-slate-600">å¸Œæœ›ãƒ–ãƒ©ãƒ³ãƒ‰</label>
                  <div className="flex gap-3 mt-1">
                    {["VISA", "Mastercard", "JCB", "AMEX", "Diners"].map(b => (
                      <label key={b} className="flex items-center gap-1 text-xs cursor-pointer"><input type="checkbox" defaultChecked={b === "VISA" || b === "Mastercard"} className="w-3.5 h-3.5 rounded" />{b}</label>
                    ))}
                  </div>
                </div>
              </div>

              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</p>
                <div className="grid grid-cols-2 gap-3">
                  <div><label className="text-xs font-semibold text-slate-600">ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URL</label><input type="url" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 font-mono" placeholder="https://example.com/callback" /></div>
                  <div><label className="text-xs font-semibold text-slate-600">Webhook URL</label><input type="url" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 font-mono" placeholder="https://example.com/webhook" /></div>
                </div>
                <div className="mt-2"><label className="text-xs font-semibold text-slate-600">IPåˆ¶é™ï¼ˆæ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰</label>
                  <textarea rows={2} className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 font-mono resize-none" placeholder="203.0.113.0/24&#10;198.51.100.0/24" />
                </div>
              </div>

              <div className="bg-amber-50 border border-amber-200 rounded p-3 text-xs text-amber-700">
                <p className="font-bold">âš ï¸ ã‚µã‚¤ãƒˆè¿½åŠ å¾Œã®æµã‚Œ</p>
                <p className="mt-1">ã‚µã‚¤ãƒˆä½œæˆå¾Œã€M04ã€Œæ—¢å­˜åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ã€ã«å¯©æŸ»æ¡ˆä»¶ãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ã€‚AIã‚µã‚¤ãƒˆå¯©æŸ»â†’äººé–“åˆ¤å®šâ†’æ‰¿èªã®é †ã§å¯©æŸ»ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</p>
              </div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end sticky bottom-0 bg-white">
              <button onClick={() => setShowSiteAddModal(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowSiteAddModal(false); toast("ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ã«æ¡ˆä»¶ãŒä½œæˆã•ã‚Œã¾ã™", "success"); }} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã—ã¦å¯©æŸ»ç”³è«‹</button>
            </div>
          </div>
        </div>
      )}

      <ConfirmDialog config={actionConfirm} onClose={() => setActionConfirm(null)} />
    </div>
  );
};

// â”€â”€â”€ M05: AIç›£è¦– â”€â”€â”€
const MasterAIMonitor = () => {
  const toast = useToast();
  const [aiPeriod, setAiPeriod] = useState("month");
  const [selectedModule, setSelectedModule] = useState(null);
  const [showTrainModal, setShowTrainModal] = useState(null);

  const aiModules = [
    { name: "ä¸æ­£æ¤œçŸ¥AI", version: "v2.3", lastTrain: "2026-02-09", trainData: "124,500ä»¶", enabled: true, trend: "FPç‡", trendData: [0.4, 0.35, 0.38, 0.3, 0.28, 0.3, 0.3], metrics: [{ l: "æ—¥æ¬¡åˆ¤å®šä»¶æ•°", v: "1,247" }, { l: "è‡ªå‹•æ‰¿èª", v: "1,182 (94.8%)" }, { l: "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯", v: "12 (1.0%)" }, { l: "ä¿ç•™â†’äººçš„åˆ¤æ–­", v: "53 (4.2%)" }, { l: "å½é™½æ€§ç‡(FPç‡)", v: "0.3%" }],
      dailyMetrics: [{ date: "2/11", total: 1247, blocked: 12, fp: 3 }, { date: "2/12", total: 1198, blocked: 8, fp: 2 }, { date: "2/13", total: 1312, blocked: 15, fp: 4 }, { date: "2/14", total: 1156, blocked: 10, fp: 1 }, { date: "2/15", total: 1280, blocked: 11, fp: 3 }],
      confusion: { tp: 142, fp: 4, tn: 1089, fn: 12 },
      samples: [{ id: "FD-001", result: "ãƒ–ãƒ­ãƒƒã‚¯", confidence: "98.2%", reason: "ç•°å¸¸IP + é«˜é¡", correct: true }, { id: "FD-002", result: "é€šé", confidence: "15.3%", reason: "å¸¸é€£é¡§å®¢", correct: true }, { id: "FD-003", result: "ãƒ–ãƒ­ãƒƒã‚¯", confidence: "72.1%", reason: "æ–°è¦ã‚«ãƒ¼ãƒ‰ + é«˜é »åº¦", correct: false }]
    },
    { name: "å¯©æŸ»AI", version: "v1.8", lastTrain: "2026-02-05", trainData: "2,400ä»¶", enabled: true, trend: "äººé–“åŒæ„ç‡", trendData: [82, 85, 84, 87, 86, 88, 87], metrics: [{ l: "ä»Šæœˆã®å¯©æŸ»ä»¶æ•°", v: "24" }, { l: "è‡ªå‹•æ‰¿èªï¼ˆä½ãƒªã‚¹ã‚¯ï¼‰", v: "15 (62.5%)" }, { l: "AIæ¨è–¦â†’æ‰¿èª", v: "7 (29.2%)" }, { l: "äººçš„å¯©æŸ»", v: "2 (8.3%)" }, { l: "å¹³å‡å¯©æŸ»æ™‚é–“", v: "1.8æ™‚é–“" }],
      dailyMetrics: [{ date: "2/11", total: 5, auto: 3, manual: 2 }, { date: "2/12", total: 3, auto: 2, manual: 1 }, { date: "2/13", total: 4, auto: 3, manual: 1 }],
      confusion: { tp: 18, fp: 1, tn: 3, fn: 2 },
      samples: [{ id: "RV-001", result: "æ‰¿èª", confidence: "95.1%", reason: "ä½ãƒªã‚¹ã‚¯æ¥­ç¨® + å£²ä¸Šå®‰å®š", correct: true }, { id: "RV-002", result: "è¦ç¢ºèª", confidence: "55.3%", reason: "æ–°è¦æ¥­ç¨® + é«˜é¡", correct: true }]
    },
    { name: "AIãƒãƒ£ãƒƒãƒˆã‚µãƒãƒ¼ãƒˆ", version: "v1.5", lastTrain: "-", trainData: "-", enabled: true, trend: "AIå®Œçµç‡", trendData: [78, 80, 79, 82, 81, 83, 82], metrics: [{ l: "ä»Šæœˆã®å¯¾è©±æ•°", v: "342" }, { l: "AIå®Œçµ", v: "281 (82.2%)" }, { l: "ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³", v: "61 (17.8%)" }, { l: "å¹³å‡å¿œç­”æ™‚é–“", v: "2.1ç§’" }, { l: "CSAT", v: "4.2 / 5.0" }],
      dailyMetrics: [{ date: "2/11", total: 42, resolved: 35, escalated: 7 }, { date: "2/12", total: 38, resolved: 32, escalated: 6 }, { date: "2/13", total: 45, resolved: 37, escalated: 8 }],
      confusion: null,
      samples: [{ id: "CH-001", result: "å®Œçµ", confidence: "-", reason: "å£²ä¸Šç…§ä¼š", correct: true }, { id: "CH-002", result: "ã‚¨ã‚¹ã‚«ãƒ¬", confidence: "-", reason: "è¿”é‡‘å‡¦ç†ä¾é ¼", correct: true }]
    },
    { name: "ãƒ¬ãƒãƒ¼ãƒˆAI", version: "v1.2", lastTrain: "-", trainData: "-", enabled: true, trend: "ç”ŸæˆæˆåŠŸç‡", trendData: [98, 99, 99, 100, 98, 99, 99], metrics: [{ l: "ä»Šæœˆã®ç”Ÿæˆæ•°", v: "156" }, { l: "æ—¥æ¬¡ã‚µãƒãƒªãƒ¼", v: "82" }, { l: "æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ", v: "24" }, { l: "ã‚«ã‚¹ã‚¿ãƒ åˆ†æ", v: "50" }, { l: "å¹³å‡ç”Ÿæˆæ™‚é–“", v: "8.3ç§’" }],
      dailyMetrics: [{ date: "2/11", total: 12, success: 12, failed: 0 }, { date: "2/12", total: 15, success: 14, failed: 1 }, { date: "2/13", total: 11, success: 11, failed: 0 }],
      confusion: null,
      samples: [{ id: "RP-001", result: "æˆåŠŸ", confidence: "-", reason: "æœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ", correct: true }, { id: "RP-002", result: "æˆåŠŸ", confidence: "-", reason: "ä¸æ­£æ¤œçŸ¥åˆ†æ", correct: true }]
    },
  ];

  return (
  <div className="p-5 space-y-4">
    <h2 className="text-sm font-bold text-slate-800">AIç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
    <div className="flex gap-3">
      <KPICard label="å…¨ä½“è‡ªå‹•åŒ–ç‡" value="94.2%" sub="ç›®æ¨™: 95%" color="purple" />
      <KPICard label="ä¸æ­£æ¤œçŸ¥ç²¾åº¦" value="97.8%" sub="FPç‡: 0.3%" color="green" />
      <KPICard label="å¯©æŸ»è‡ªå‹•æ‰¿èªç‡" value="68%" sub="ç›®æ¨™: 80%" color="blue" />
      <KPICard label="AIãƒãƒ£ãƒƒãƒˆå®Œçµç‡" value="82%" sub="ç›®æ¨™: 90%" color="blue" />
    </div>

    {/* AI Modules with version info, toggle, trend */}
    <div className="grid grid-cols-2 gap-3">
      {aiModules.map((ai, i) => (
        <div key={i} className="bg-white rounded-lg border border-slate-200 shadow-sm p-3 cursor-pointer hover:ring-2 hover:ring-blue-200 transition-all" onClick={() => setSelectedModule(ai)}>
          <div className="flex justify-between items-center mb-2">
            <p className="text-xs font-bold text-slate-700">ğŸ¤– {ai.name}</p>
            <div className="flex items-center gap-2">
              <span className="text-xs text-slate-400">{ai.version}</span>
              <div className={`w-8 h-4 rounded-full flex items-center px-0.5 cursor-pointer ${ai.enabled ? "bg-emerald-500 justify-end" : "bg-slate-300 justify-start"}`} onClick={e => e.stopPropagation()}>
                <div className="w-3 h-3 bg-white rounded-full shadow" />
              </div>
            </div>
          </div>
          {/* Model info */}
          <div className="flex gap-3 text-xs text-slate-400 mb-2 pb-2 border-b border-dashed">
            <span>æœ€çµ‚å­¦ç¿’: {ai.lastTrain}</span>
            <span>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿: {ai.trainData}</span>
          </div>
          {ai.metrics.map((m, j) => (
            <div key={j} className="flex justify-between text-xs py-1 border-b border-slate-100 last:border-0">
              <span className="text-slate-500">{m.l}</span>
              <span className="font-semibold text-slate-700">{m.v}</span>
            </div>
          ))}
          {/* Mini trend chart */}
          <div className="mt-2 pt-2 border-t">
            <p className="text-xs text-slate-400 mb-1">{ai.trend}ï¼ˆç›´è¿‘7æ—¥ï¼‰</p>
            <div className="h-8 flex items-end gap-0.5">
              {ai.trendData.map((v, j) => (
                <div key={j} className="flex-1 bg-blue-200 rounded-t" style={{ height: `${(v / Math.max(...ai.trendData)) * 28}px` }} />
              ))}
            </div>
          </div>
        </div>
      ))}
    </div>

    {/* AI vs Human Consistency Analysis */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-slate-700">ğŸ“Š AIåˆ¤å®š vs äººé–“åˆ¤å®š ä¸€è‡´ç‡åˆ†æ</p>
        <div className="flex bg-slate-100 rounded-lg p-1">
          {[{k:"month",l:"ä»Šæœˆ"},{k:"prev",l:"å…ˆæœˆ"},{k:"3m",l:"3ãƒ¶æœˆ"}].map(p => (
            <button key={p.k} className={`text-sm px-3 py-1.5 rounded ${aiPeriod === p.k ? "bg-white shadow-sm text-blue-600 font-semibold" : "text-slate-400"}`}
              onClick={() => setAiPeriod(p.k)}>{p.l}</button>
          ))}
        </div>
      </div>
      <div className="grid grid-cols-3 gap-3">
        {[
          { cat: "å¯©æŸ»AI", rate: "87%", ok: true, agree: 45, aiYesHumanNo: 3, aiNoHumanYes: 5, disagree: 12 },
          { cat: "ä¸æ­£æ¤œçŸ¥AI", rate: "92%", ok: true, agree: 120, aiYesHumanNo: 2, aiNoHumanYes: 8, disagree: 15 },
          { cat: "URLå·¡å›AI", rate: "95%", ok: true, agree: 38, aiYesHumanNo: 1, aiNoHumanYes: 1, disagree: 2 },
        ].map((c, i) => (
          <div key={i} className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
            <div className="flex justify-between items-center mb-1">
              <span className="text-xs font-bold text-slate-700">{c.cat}</span>
              <span className={`text-xs font-bold ${c.ok ? "text-emerald-600" : "text-rose-600"}`}>{c.rate}</span>
            </div>
            <div className="space-y-0.5 text-xs">
              <div className="flex justify-between"><span className="text-emerald-600">âœ… AIæ‰¿èªâ†’äººé–“æ‰¿èª</span><span>{c.agree}ä»¶</span></div>
              <div className="flex justify-between"><span className="text-rose-500">âš ï¸ AIæ‰¿èªâ†’äººé–“æ‹’å¦(ç”˜ã„)</span><span>{c.aiYesHumanNo}ä»¶</span></div>
              <div className="flex justify-between"><span className="text-amber-600">âš ï¸ AIæ‹’å¦â†’äººé–“æ‰¿èª(å³ã—ã„)</span><span>{c.aiNoHumanYes}ä»¶</span></div>
              <div className="flex justify-between"><span className="text-emerald-600">âœ… AIæ‹’å¦â†’äººé–“æ‹’å¦</span><span>{c.disagree}ä»¶</span></div>
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* Claude API Usage & Cost */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-700 mb-2">ğŸ’° Claude API ä½¿ç”¨é‡ãƒ»ã‚³ã‚¹ãƒˆï¼ˆä»Šæœˆï¼‰</p>
      <div className="flex gap-3 mb-2">
        <div className="flex-1 bg-slate-50 rounded p-2 text-center">
          <p className="text-xs text-slate-400">æœˆé–“ãƒˆãƒ¼ã‚¯ãƒ³</p>
          <p className="text-sm font-bold text-slate-700">2.4M <span className="text-xs text-slate-400 font-normal">(å…¥åŠ› 1.8M / å‡ºåŠ› 0.6M)</span></p>
        </div>
        <div className="flex-1 bg-slate-50 rounded p-2 text-center">
          <p className="text-xs text-slate-400">APIå‘¼å‡ºå›æ•°</p>
          <p className="text-sm font-bold text-slate-700">3,842å›</p>
        </div>
        <div className="flex-1 bg-slate-50 rounded p-2 text-center">
          <p className="text-xs text-slate-400">æœˆé–“ã‚³ã‚¹ãƒˆ</p>
          <p className="text-sm font-bold text-blue-700">Â¥44,200</p>
        </div>
      </div>
      <div className="flex gap-2 text-xs">
        {[
          { name: "å¯©æŸ»AI", cost: "Â¥12,800", pct: 29 },
          { name: "ä¸æ­£æ¤œçŸ¥AI", cost: "Â¥8,200", pct: 19 },
          { name: "ãƒãƒ£ãƒƒãƒˆAI", cost: "Â¥14,500", pct: 33 },
          { name: "ãƒ¬ãƒãƒ¼ãƒˆAI", cost: "Â¥5,200", pct: 12 },
          { name: "URLå·¡å›AI", cost: "Â¥2,100", pct: 5 },
          { name: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°AI", cost: "Â¥1,400", pct: 2 },
        ].map((m, i) => (
          <div key={i} className="flex-1 text-center">
            <div className="bg-blue-100 rounded-full h-1.5 mb-1"><div className="bg-blue-500 rounded-full h-1.5" style={{ width: `${m.pct}%` }} /></div>
            <p className="text-slate-500">{m.name}</p>
            <p className="font-semibold">{m.cost}</p>
          </div>
        ))}
      </div>
    </div>

    {/* ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤è¨­å®š */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-700 mb-2">âš ï¸ ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤è¨­å®š</p>
      <div className="grid grid-cols-4 gap-3">
        {[{ label: "FPç‡ã‚¢ãƒ©ãƒ¼ãƒˆ", value: "0.5%", desc: "å½é™½æ€§ç‡ãŒã“ã®å€¤ã‚’è¶…ãˆãŸã‚‰é€šçŸ¥" },
          { label: "è‡ªå‹•åŒ–ç‡ä½ä¸‹", value: "90%", desc: "è‡ªå‹•å‡¦ç†ç‡ãŒã“ã®å€¤ã‚’ä¸‹å›ã£ãŸã‚‰é€šçŸ¥" },
          { label: "å¿œç­”æ™‚é–“ä¸Šé™", value: "5ç§’", desc: "AIå¿œç­”ãŒé…å»¶ã—ãŸå ´åˆã«é€šçŸ¥" },
          { label: "ã‚¨ã‚¹ã‚«ãƒ¬ç‡ä¸Šé™", value: "25%", desc: "ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç‡ã®ä¸Šé™" }
        ].map((a, i) => (
          <div key={i} className="bg-slate-50 rounded p-2 border">
            <p className="text-xs font-bold text-slate-700">{a.label}</p>
            <p className="text-sm font-bold text-blue-600 my-1">{a.value}</p>
            <p className="text-xs text-slate-400">{a.desc}</p>
          </div>
        ))}
      </div>
    </div>

    {/* AIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {selectedModule && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setSelectedModule(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[600px] max-h-[85vh] overflow-y-auto">
          <div className="p-4 border-b flex items-center justify-between sticky top-0 bg-white z-10">
            <div className="flex items-center gap-2">
              <p className="text-sm font-bold">ğŸ¤– {selectedModule.name}</p>
              <Badge text={selectedModule.version} color="blue" />
            </div>
            <div className="flex items-center gap-2">
              <button onClick={e => { e.stopPropagation(); setShowTrainModal(selectedModule); setSelectedModule(null); }} className="text-xs px-3 py-1 bg-purple-50 text-purple-600 rounded border border-purple-200 hover:bg-purple-100">ğŸ”„ å†å­¦ç¿’</button>
              <button onClick={() => setSelectedModule(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
            </div>
          </div>
          <div className="p-4 space-y-4">
            {/* æ—¥æ¬¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ */}
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">æ—¥æ¬¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆç›´è¿‘5æ—¥ï¼‰</p>
              <table className="w-full text-xs">
                <thead><tr className="bg-slate-50 border-b">{Object.keys(selectedModule.dailyMetrics[0]).map(k => <th key={k} className="text-left py-1.5 px-2 font-semibold text-slate-500">{k}</th>)}</tr></thead>
                <tbody>{selectedModule.dailyMetrics.map((row, i) => (
                  <tr key={i} className="border-b"><td className="py-1.5 px-2 text-slate-400">{row.date}</td>{Object.values(row).slice(1).map((v, j) => <td key={j} className="py-1.5 px-2 font-bold">{v}</td>)}</tr>
                ))}</tbody>
              </table>
            </div>

            {/* æ··åŒè¡Œåˆ— */}
            {selectedModule.confusion && (
              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">æ··åŒè¡Œåˆ—ï¼ˆä»Šæœˆï¼‰</p>
                <div className="grid grid-cols-2 gap-2 w-64">
                  <div className="bg-emerald-50 rounded p-2 text-center border border-emerald-200"><p className="text-xs text-slate-500">çœŸé™½æ€§(TP)</p><p className="text-lg font-bold text-emerald-600">{selectedModule.confusion.tp}</p></div>
                  <div className="bg-red-50 rounded p-2 text-center border border-red-200"><p className="text-xs text-slate-500">å½é™½æ€§(FP)</p><p className="text-lg font-bold text-red-600">{selectedModule.confusion.fp}</p></div>
                  <div className="bg-amber-50 rounded p-2 text-center border border-amber-200"><p className="text-xs text-slate-500">å½é™°æ€§(FN)</p><p className="text-lg font-bold text-amber-600">{selectedModule.confusion.fn}</p></div>
                  <div className="bg-emerald-50 rounded p-2 text-center border border-emerald-200"><p className="text-xs text-slate-500">çœŸé™°æ€§(TN)</p><p className="text-lg font-bold text-emerald-600">{selectedModule.confusion.tn}</p></div>
                </div>
              </div>
            )}

            {/* åˆ¤å®šã‚µãƒ³ãƒ—ãƒ« */}
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">æœ€æ–°åˆ¤å®šã‚µãƒ³ãƒ—ãƒ«</p>
              {selectedModule.samples.map((s, i) => (
                <div key={i} className="flex items-center gap-3 py-2 border-b text-xs last:border-0">
                  <span className="font-mono text-slate-400 w-16">{s.id}</span>
                  <Badge text={s.result} color={s.result === "ãƒ–ãƒ­ãƒƒã‚¯" || s.result === "ã‚¨ã‚¹ã‚«ãƒ¬" ? "red" : s.result === "è¦ç¢ºèª" ? "yellow" : "green"} />
                  {s.confidence !== "-" && <span className="text-slate-500">ä¿¡é ¼åº¦: {s.confidence}</span>}
                  <span className="flex-1 text-slate-400">{s.reason}</span>
                  <span>{s.correct ? "âœ…" : "âŒ"}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    )}

    {/* å†å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showTrainModal && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowTrainModal(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[420px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">ğŸ”„ å†å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</p>
            <button onClick={() => setShowTrainModal(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-3">
            <div className="flex items-center gap-2 text-xs"><span className="text-slate-400">å¯¾è±¡:</span><span className="font-bold">{showTrainModal.name}</span><Badge text={showTrainModal.version} color="blue" /></div>
            <div>
              <label className="text-xs text-slate-500">å­¦ç¿’ã‚¿ã‚¤ãƒ—</label>
              <select className="w-full border rounded px-2 py-1.5 text-xs mt-0.5"><option>å·®åˆ†å­¦ç¿’ï¼ˆæ¨å¥¨ï¼‰</option><option>ãƒ•ãƒ«å†å­¦ç¿’</option><option>ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°</option></select>
            </div>
            <div>
              <label className="text-xs text-slate-500">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</label>
              <select className="w-full border rounded px-2 py-1.5 text-xs mt-0.5"><option>å³æ™‚å®Ÿè¡Œ</option><option>ä»Šå¤œ 02:00</option><option>æ¯é€±æ—¥æ›œ 02:00</option><option>æ¯æœˆ1æ—¥ 02:00</option></select>
            </div>
            <div>
              <label className="text-xs text-slate-500">å­¦ç¿’ãƒ‡ãƒ¼ã‚¿æœŸé–“</label>
              <select className="w-full border rounded px-2 py-1.5 text-xs mt-0.5"><option>ç›´è¿‘1ãƒ¶æœˆ</option><option>ç›´è¿‘3ãƒ¶æœˆ</option><option>ç›´è¿‘6ãƒ¶æœˆ</option><option>å…¨æœŸé–“</option></select>
            </div>
            <div className="bg-amber-50 border border-amber-200 rounded p-2 text-xs text-amber-700">
              <p className="font-bold">âš ï¸ æ³¨æ„</p>
              <p>å†å­¦ç¿’ä¸­ã¯AIç²¾åº¦ãŒä¸€æ™‚çš„ã«ä½ä¸‹ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ·±å¤œå¸¯ã®å®Ÿè¡Œã‚’æ¨å¥¨ã—ã¾ã™ã€‚</p>
            </div>
            <div className="flex gap-2">
              <button onClick={() => setShowTrainModal(null)} className="flex-1 py-2 border rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { toast(`${showTrainModal.name} ã®å†å­¦ç¿’ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã—ã¾ã—ãŸ`, "success"); setShowTrainModal(null); }} className="flex-1 py-2 bg-purple-600 text-white rounded text-xs font-bold hover:bg-purple-700">å†å­¦ç¿’ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</button>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ S01: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â”€â”€â”€
const MerchantDashboard = () => {
  const toast = useToast();
  const [period, setPeriod] = useState("ä»Šæœˆ");
  const [showKpiDetail, setShowKpiDetail] = useState(null);
  const [showAllNotices, setShowAllNotices] = useState(false);
  const kpiData = {
    "ä»Šæœˆã®æ±ºæ¸ˆé«˜": { value: "Â¥12.5M", trend: 18, details: [
      { label: "ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ", value: "Â¥9.75M", pct: "89%" },
      { label: "WEBãƒãƒãƒ¼", value: "Â¥1.25M", pct: "11%" }
    ], chart: [8.2, 9.1, 10.5, 11.2, 10.8, 12.5] },
    "ä»Šæ—¥ã®æ±ºæ¸ˆé«˜": { value: "Â¥412K", trend: 15, details: [
      { label: "0-6æ™‚", value: "Â¥28K", pct: "7%" },
      { label: "6-12æ™‚", value: "Â¥95K", pct: "23%" },
      { label: "12-18æ™‚", value: "Â¥148K", pct: "36%" },
      { label: "18-24æ™‚", value: "Â¥141K", pct: "34%" }
    ], chart: [320, 355, 380, 412, 0, 0] },
    "æ±ºæ¸ˆæˆåŠŸç‡": { value: "99.5%", trend: 0.2, details: [
      { label: "VISA", value: "99.7%", pct: "" },
      { label: "Mastercard", value: "99.4%", pct: "" },
      { label: "JCB", value: "99.2%", pct: "" },
      { label: "AMEX", value: "99.8%", pct: "" }
    ], chart: [99.1, 99.3, 99.2, 99.5, 99.4, 99.5] },
    "å¹³å‡å˜ä¾¡": { value: "Â¥8,200", trend: 3, details: [
      { label: "ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ", value: "Â¥9,500", pct: "" },
      { label: "WEBãƒãƒãƒ¼", value: "Â¥4,500", pct: "" }
    ], chart: [7800, 7900, 8100, 8000, 8150, 8200] }
  };
  const recentTx = [
    { id: "pay_8f3a2b", time: "14:23", amount: "Â¥12,800", status: "æˆåŠŸ", sc: "green", method: "VISA" },
    { id: "pay_7e2c3d", time: "14:18", amount: "Â¥5,500", status: "æˆåŠŸ", sc: "green", method: "MC" },
    { id: "pay_6d1b2a", time: "14:05", amount: "Â¥3,200", status: "å¤±æ•—", sc: "red", method: "JCB" },
    { id: "pay_5c0a1b", time: "13:52", amount: "Â¥28,000", status: "æˆåŠŸ", sc: "green", method: "VISA" },
    { id: "pay_4b9z0a", time: "13:41", amount: "Â¥1,980", status: "æˆåŠŸ", sc: "green", method: "QR" },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
      <div className="flex items-center gap-2">
        <div className="flex bg-slate-100 rounded-lg p-1">
          {["ä»Šæ—¥", "ä»Šé€±", "ä»Šæœˆ"].map(p => (
            <button key={p} onClick={() => setPeriod(p)} className={`text-sm px-3 py-1.5 rounded ${period === p ? "bg-white shadow-sm text-blue-600 font-semibold" : "text-slate-500"}`}>{p}</button>
          ))}
        </div>
        <span className="text-xs text-slate-400">æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ</span>
      </div>
    </div>

    {/* Under Review State (shown when merchant is under review) */}
    {false && (
      <div className="bg-amber-50 rounded-lg border border-amber-300 p-6 text-center space-y-3">
        <div className="text-3xl">ğŸ“‹</div>
        <p className="text-sm font-bold text-amber-800">ç¾åœ¨å¯©æŸ»ä¸­ã§ã™</p>
        <p className="text-xs text-amber-700">å¯©æŸ»å®Œäº†å¾Œã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        <div className="flex items-center justify-center gap-2">
          <div className="h-2 w-48 bg-slate-200 rounded-full"><div className="h-2 bg-amber-500 rounded-full" style={{width:"60%"}} /></div>
          <span className="text-xs text-amber-600 font-semibold">60%</span>
        </div>
        <p className="text-xs text-slate-500">é€šå¸¸1ã€œ3æ™‚é–“ã§å®Œäº†ã—ã¾ã™ã€‚çµæœã¯ãƒ¡ãƒ¼ãƒ«ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚</p>
      </div>
    )}

    {/* ãŠçŸ¥ã‚‰ã›æ¬„ */}
    {(() => {
      const mNotices = [
        { date: "02/17", title: "æ±ºæ¸ˆå‡¦ç†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›ï¼ˆ2/20 AM2:00-4:00ï¼‰", type: "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹", tColor: "yellow", icon: "ğŸ”§" },
        { date: "02/15", title: "æ–°æ©Ÿèƒ½: Apple Pay / Google Pay å¯¾å¿œé–‹å§‹", type: "ãƒªãƒªãƒ¼ã‚¹", tColor: "blue", icon: "ğŸš€" },
        { date: "02/14", title: "ã€å¾©æ—§æ¸ˆã€‘2/14 æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼å¢—åŠ ã«ã¤ã„ã¦", type: "éšœå®³", tColor: "red", icon: "âš ï¸" },
        { date: "02/12", title: "3Dã‚»ã‚­ãƒ¥ã‚¢2.0 å®Œå…¨ç§»è¡Œã®ãŠçŸ¥ã‚‰ã›", type: "ãŠçŸ¥ã‚‰ã›", tColor: "default", icon: "ğŸ“Œ" },
      ];
      const renderMNotice = (n, i) => (
        <div key={i} className={`flex items-center gap-2 p-2 rounded border text-xs cursor-pointer hover:bg-blue-50 ${i === 0 ? "border-amber-300 bg-amber-50" : "border-slate-200"}`}>
          <span>{n.icon}</span>
          <span className="w-12 text-slate-400 shrink-0">{n.date}</span>
          <Badge text={n.type} color={n.tColor} />
          <span className={`flex-1 ${i === 0 ? "text-amber-800 font-semibold" : "text-slate-700"}`}>{n.title}</span>
        </div>
      );
      return (
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex items-center justify-between mb-2">
          <div className="flex items-center gap-2">
            <span>ğŸ“¢</span>
            <p className="text-xs font-bold text-slate-600">ãŠçŸ¥ã‚‰ã›</p>
            {mNotices.length > 3 && <span className="text-xs text-slate-300">({mNotices.length}ä»¶)</span>}
          </div>
          {mNotices.length > 3 && (
            <button className="text-xs text-blue-600 cursor-pointer hover:underline" onClick={() => setShowAllNotices(!showAllNotices)}>
              {showAllNotices ? "é–‰ã˜ã‚‹ â–²" : `ã™ã¹ã¦è¦‹ã‚‹ (${mNotices.length - 3}ä»¶) â–¼`}
            </button>
          )}
        </div>
        <div className="space-y-1.5">
          {mNotices.slice(0, 3).map(renderMNotice)}
          {showAllNotices && (
            <div className="space-y-1.5 pt-1 border-t border-dashed border-slate-200 mt-1">
              {mNotices.slice(3).map((n, i) => renderMNotice(n, i + 3))}
            </div>
          )}
        </div>
      </div>
      );
    })()}

    <div className="bg-gradient-to-r from-emerald-50 to-blue-50 rounded-lg border border-emerald-200 p-3">
      <div className="flex items-center gap-2 mb-1">
        <span>ğŸ¤–</span><span className="text-xs font-bold text-emerald-700">AI ã‚¤ãƒ³ã‚µã‚¤ãƒˆ</span><span className="text-xs text-slate-400">æ¯æ—¥æ›´æ–°</span>
      </div>
      <p className="text-xs text-slate-700">æ˜¨æ—¥ã®å£²ä¸Šã¯Â¥412,000ã§å‰é€±æ¯”+15%ã€‚ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆãŒ78%ã‚’å ã‚ã¦ã„ã¾ã™ã€‚æ±ºæ¸ˆæˆåŠŸç‡ã¯99.5%ã¨å®‰å®šã€‚ç‰¹ç•°ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚WEBãƒãƒãƒ¼ã®å°å…¥ã§ã€ã‚«ãƒ¼ãƒˆé›¢è„±ç‡ã‚’ç´„8%æ”¹å–„ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
    </div>

    <div className="flex gap-3">
      {Object.entries(kpiData).map(([label, d]) => (
        <div key={label} onClick={() => setShowKpiDetail(label)} className="flex-1 cursor-pointer hover:ring-2 hover:ring-blue-200 rounded-lg transition-all">
          <KPICard label={label} value={d.value} sub={label === "æ±ºæ¸ˆæˆåŠŸç‡" ? "" : "å‰æœˆæ¯”"} trend={d.trend} color={label === "æ±ºæ¸ˆæˆåŠŸç‡" ? "green" : undefined} />
        </div>
      ))}
    </div>

    <div className="flex gap-3">
      <div className="flex-1 bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-600 mb-2">æ±ºæ¸ˆé«˜æ¨ç§»ï¼ˆç›´è¿‘30æ—¥ï¼‰</p>
        <div className="flex items-center justify-center h-20">
          <MiniChart data={[280,310,295,340,380,350,420,390,410,380,420,450,412,440,470,430,460,480,450,490,510,480,520,540,510,550,530,560,580,550]} w={400} h={70} />
        </div>
      </div>
      <div className="w-56 bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-600 mb-2">æ±ºæ¸ˆæ‰‹æ®µåˆ†å¸ƒ</p>
        <div className="space-y-2">
          {[{ name: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰", pct: 89, color: "bg-blue-500" }, { name: "WEBãƒãƒãƒ¼", pct: 11, color: "bg-purple-500" }].map((m, i) => (
            <div key={i}>
              <div className="flex justify-between text-xs"><span className="text-slate-600">{m.name}</span><span className="font-semibold">{m.pct}%</span></div>
              <div className="w-full h-1.5 bg-slate-100 rounded-full mt-0.5"><div className={`h-full ${m.color} rounded-full`} style={{ width: `${m.pct}%` }} /></div>
            </div>
          ))}
        </div>
      </div>
    </div>

    <div className="grid grid-cols-2 gap-3">
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-600 mb-2">ğŸ’¡ AIã‹ã‚‰ã®æ”¹å–„ææ¡ˆ</p>
        <div className="space-y-2">
          <div className="bg-blue-50 rounded p-2 text-xs text-blue-700">ğŸ“Š 19-21æ™‚å°ã®å£²ä¸ŠãŒå…¨ä½“ã®35%ã‚’å ã‚ã¦ã„ã¾ã™ã€‚ã“ã®æ™‚é–“å¸¯ã®ã‚µãƒ¼ãƒãƒ¼å¿œç­”é€Ÿåº¦ã‚’æœ€é©åŒ–ã™ã‚‹ã¨æˆåŠŸç‡ãŒå‘ä¸Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</div>
          <div className="bg-emerald-50 rounded p-2 text-xs text-emerald-700">ğŸ’³ 3Dã‚»ã‚­ãƒ¥ã‚¢ã®ãƒ•ãƒªã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ã‚¹ç‡ãŒ92%ã§ã™ã€‚ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç‡ã‚’ã•ã‚‰ã«ä¸‹ã’ã‚‹ãŸã‚ã«ã€ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã®é€ä¿¡ã‚’å¼·åŒ–ã—ã¾ã—ã‚‡ã†ã€‚</div>
        </div>
      </div>
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex items-center justify-between mb-2">
          <p className="text-xs font-bold text-slate-600">ç›´è¿‘ã®å–å¼•</p>
          <span className="text-xs text-blue-600 cursor-pointer">ã™ã¹ã¦è¦‹ã‚‹ â†’</span>
        </div>
        {recentTx.map((tx, i) => (
          <div key={i} className="flex items-center py-1.5 text-xs border-b last:border-0">
            <span className="w-16 font-mono text-slate-400">{tx.time}</span>
            <span className="flex-1 font-bold">{tx.amount}</span>
            <span className="w-10 text-slate-400">{tx.method}</span>
            <Badge text={tx.status} color={tx.sc} />
          </div>
        ))}
      </div>
    </div>

    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-2">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</p>
      <div className="flex gap-2">
        {[["ğŸ“‹ æ³¨æ–‡ä¸€è¦§", "blue"], ["ğŸ“Š æ±ºæ¸ˆé«˜ãƒ¬ãƒãƒ¼ãƒˆ", "emerald"], ["âš™ï¸ APIè¨­å®š", "slate"], ["ğŸ’¬ AIã«ç›¸è«‡", "purple"]].map(([label, color], i) => (
          <button key={i} onClick={() => toast(`${label}ã‚’é–‹ãã¾ã™`, "info")} className={`flex-1 py-2 rounded-lg border text-xs font-bold bg-${color}-50 text-${color}-700 border-${color}-200 hover:bg-${color}-100`}>{label}</button>
        ))}
      </div>
    </div>

    {/* KPIãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showKpiDetail && kpiData[showKpiDetail] && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowKpiDetail(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[480px] max-h-[80vh] overflow-y-auto">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">{showKpiDetail} - è©³ç´°</p>
            <button onClick={() => setShowKpiDetail(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            <div className="text-center py-3">
              <p className="text-2xl font-bold text-slate-800">{kpiData[showKpiDetail].value}</p>
              <p className="text-xs text-emerald-600 mt-1">å‰æœˆæ¯” +{kpiData[showKpiDetail].trend}%</p>
            </div>
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">æœˆæ¬¡æ¨ç§»ï¼ˆç›´è¿‘6ãƒ¶æœˆï¼‰</p>
              <div className="flex items-end gap-2 h-20 px-2">
                {kpiData[showKpiDetail].chart.map((v, i) => {
                  const max = Math.max(...kpiData[showKpiDetail].chart);
                  const h = max > 0 ? (v / max) * 100 : 0;
                  return (
                    <div key={i} className="flex-1 flex flex-col items-center">
                      <p className="text-xs text-slate-500 mb-1">{typeof v === "number" && v > 1000 ? `${(v/1000).toFixed(0)}K` : v}</p>
                      <div className={`w-full rounded-t ${i === 5 ? "bg-blue-500" : "bg-blue-200"}`} style={{ height: `${h}%` }} />
                      <p className="text-xs text-slate-400 mt-1">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][i]}</p>
                    </div>
                  );
                })}
              </div>
            </div>
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">å†…è¨³</p>
              <div className="space-y-2">
                {kpiData[showKpiDetail].details.map((d, i) => (
                  <div key={i} className="flex items-center text-xs border-b pb-1.5">
                    <span className="flex-1 text-slate-600">{d.label}</span>
                    <span className="font-bold text-slate-800 w-20 text-right">{d.value}</span>
                    {d.pct && <span className="w-12 text-right text-slate-400">{d.pct}</span>}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ S02: æ³¨æ–‡ä¸€è¦§ â”€â”€â”€
const MerchantTransactions = () => {
  const toast = useToast();
  const [selectedTx, setSelectedTx] = useState(null);
  const [showRefundModal, setShowRefundModal] = useState(false);
  const txData = [
    { id: "pay_8f3a2b1c", time: "2026-02-11 14:23", amount: "Â¥12,800", rawAmt: 12800, status: "æˆåŠŸ", sColor: "green", method: "VISA", card: "****4242", order: "ORD-20260211-001", threeD: "èªè¨¼æ¸ˆ", fee: "Â¥384", net: "Â¥12,416", customer: "t***@example.com" },
    { id: "pay_7e2c3d4a", time: "2026-02-11 14:18", amount: "Â¥5,500", rawAmt: 5500, status: "æˆåŠŸ", sColor: "green", method: "Mastercard", card: "****8888", order: "ORD-20260211-002", threeD: "èªè¨¼æ¸ˆ", fee: "Â¥165", net: "Â¥5,335", customer: "s***@gmail.com" },
    { id: "pay_6d1b5e9f", time: "2026-02-11 14:12", amount: "Â¥89,000", rawAmt: 89000, status: "ãƒ–ãƒ­ãƒƒã‚¯", sColor: "red", method: "VISA", card: "****1234", order: "ORD-20260211-003", threeD: "æœªå®Ÿæ–½", fee: "â€”", net: "â€”", customer: "k***@company.jp" },
    { id: "pay_5c4a6f8e", time: "2026-02-11 13:55", amount: "Â¥3,200", rawAmt: 3200, status: "è¿”é‡‘æ¸ˆ", sColor: "yellow", method: "JCB", card: "****5678", order: "ORD-20260210-045", threeD: "èªè¨¼æ¸ˆ", fee: "Â¥96", net: "Â¥0", customer: "h***@yahoo.co.jp" },
    { id: "pay_4b3d7g2h", time: "2026-02-11 13:42", amount: "Â¥15,600", rawAmt: 15600, status: "æˆåŠŸ", sColor: "green", method: "ãƒšã‚¤ãƒ‡ã‚£", card: "-", order: "ORD-20260211-004", threeD: "â€”", fee: "Â¥546", net: "Â¥15,054", customer: "m***@icloud.com" },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">æ³¨æ–‡ä¸€è¦§</h2>
      <div className="flex gap-2">
        <input className="text-xs border rounded px-2 py-1 w-40" placeholder="æ³¨æ–‡ç•ªå· / é‡‘é¡ã§æ¤œç´¢" />
        <select className="text-xs border rounded px-2 py-1"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>æˆåŠŸ</option><option>å¤±æ•—</option><option>è¿”é‡‘æ¸ˆ</option><option>ãƒ–ãƒ­ãƒƒã‚¯</option></select>
        <input type="date" className="text-xs border rounded px-2 py-1" />
        <button onClick={() => toast("æ³¨æ–‡ä¸€è¦§ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 px-2 py-1 rounded border border-slate-200" title="å‡ºåŠ›é …ç›®: æ±ºæ¸ˆID/æ—¥æ™‚/é‡‘é¡/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹/æ±ºæ¸ˆæ‰‹æ®µ/æ³¨æ–‡ç•ªå·ï¼ˆã‚«ãƒ¼ãƒ‰ç•ªå·ç­‰ã®æ©Ÿå¯†æƒ…å ±ã¯å«ã¿ã¾ã›ã‚“ï¼‰">ğŸ“¥ CSVå‡ºåŠ›</button>
      </div>
    </div>
    <div className="grid grid-cols-4 gap-3">
      <KPICard label="ä»Šæœˆã®å–å¼•æ•°" value="342ä»¶" trend={8.2} color="blue" />
      <KPICard label="å–å¼•ç·é¡" value="Â¥4,280,000" trend={5.1} color="blue" />
      <KPICard label="æˆåŠŸç‡" value="97.4%" sub="" color="green" />
      <KPICard label="è¿”é‡‘ä»¶æ•°" value="3ä»¶" sub="Â¥9,200" color="yellow" />
    </div>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "æ±ºæ¸ˆID", w: "w-28" }, { label: "æ—¥æ™‚", w: "w-32" }, { label: "é‡‘é¡", w: "w-20" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-20" }, { label: "æ±ºæ¸ˆæ‰‹æ®µ", w: "w-24" }, { label: "ã‚«ãƒ¼ãƒ‰", w: "w-20" }, { label: "æ³¨æ–‡ç•ªå·", w: "flex-1" }, { label: "æ“ä½œ", w: "w-16" }]}>
      {txData.map((tx, i) => (
        <tr key={i} onClick={() => setSelectedTx(tx)} className={`border-b cursor-pointer hover:bg-blue-50 ${i % 2 ? "bg-slate-50" : ""}`}>
          <td className="px-4 py-2 whitespace-nowrap w-28 font-mono text-blue-600">{tx.id}</td>
          <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-500">{tx.time}</td>
          <td className="px-4 py-2 whitespace-nowrap w-20 font-semibold text-right">{tx.amount}</td>
          <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={tx.status} color={tx.sColor} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-600">{tx.method}</td>
          <td className="px-4 py-2 whitespace-nowrap w-20 font-mono text-slate-500">{tx.card}</td>
          <td className="px-4 py-2 whitespace-nowrap text-slate-500">{tx.order}</td>
          <td className="px-4 py-2 whitespace-nowrap w-16"><button onClick={(e) => { e.stopPropagation(); setSelectedTx(tx); }} className="text-xs text-blue-600 hover:underline">è©³ç´°</button></td>
        </tr>
      ))}
      </TableHeader>
    </div>
    <div className="text-xs text-slate-400 text-right">5ä»¶è¡¨ç¤º / å…¨342ä»¶</div>

    {/* å–å¼•è©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedTx && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedTx(null)} />
        <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b bg-blue-50 flex justify-between items-center">
            <h3 className="text-sm font-bold text-slate-800">å–å¼•è©³ç´°</h3>
            <button onClick={() => setSelectedTx(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div>
              <p className="text-xs text-slate-400 mb-1">å–å¼•ã‚µãƒãƒªãƒ¼</p>
              <div className="space-y-1.5">
                {[["æ±ºæ¸ˆID", selectedTx.id], ["æ—¥æ™‚", selectedTx.time], ["é‡‘é¡", selectedTx.amount], ["æ³¨æ–‡ç•ªå·", selectedTx.order]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-20 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
                <div className="flex text-xs"><span className="w-20 text-slate-400">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span><Badge text={selectedTx.status} color={selectedTx.sColor} /></div>
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-1">æ±ºæ¸ˆæƒ…å ±</p>
              <div className="space-y-1.5">
                {[["æ±ºæ¸ˆæ‰‹æ®µ", selectedTx.method], ["ã‚«ãƒ¼ãƒ‰ç•ªå·", selectedTx.card], ["3Dã‚»ã‚­ãƒ¥ã‚¢", selectedTx.threeD], ["é¡§å®¢ãƒ¡ãƒ¼ãƒ«", selectedTx.customer]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-20 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-1">æ‰‹æ•°æ–™ãƒ»ç²¾ç®—</p>
              <div className="space-y-1.5">
                {[["æ±ºæ¸ˆæ‰‹æ•°æ–™", selectedTx.fee], ["å…¥é‡‘é¡", selectedTx.net]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-20 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-2">ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</p>
              <div className="space-y-2">
                {[
                  { time: "14:23:01", event: "æ±ºæ¸ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡", icon: "ğŸ“¥" },
                  { time: "14:23:02", event: selectedTx.threeD === "èªè¨¼æ¸ˆ" ? "3Dã‚»ã‚­ãƒ¥ã‚¢èªè¨¼å®Œäº†" : "3Dã‚»ã‚­ãƒ¥ã‚¢æœªå®Ÿæ–½", icon: selectedTx.threeD === "èªè¨¼æ¸ˆ" ? "ğŸ”" : "âš ï¸" },
                  { time: "14:23:03", event: "ã‚ªãƒ¼ã‚½ãƒªæ‰¿èª", icon: "âœ…" },
                  { time: "14:23:03", event: selectedTx.status === "æˆåŠŸ" ? "å£²ä¸Šç¢ºå®š" : selectedTx.status === "è¿”é‡‘æ¸ˆ" ? "è¿”é‡‘å‡¦ç†å®Œäº†" : "ãƒ–ãƒ­ãƒƒã‚¯åˆ¤å®š", icon: selectedTx.status === "æˆåŠŸ" ? "ğŸ’°" : selectedTx.status === "è¿”é‡‘æ¸ˆ" ? "â†©ï¸" : "ğŸš«" },
                ].map((e, i) => (
                  <div key={i} className="flex items-start gap-2 text-xs">
                    <span>{e.icon}</span>
                    <div><p className="font-bold">{e.event}</p><p className="text-slate-400">{e.time}</p></div>
                  </div>
                ))}
              </div>
            </div>
            {selectedTx.status === "æˆåŠŸ" && (
              <div className="border-t pt-3 flex gap-2">
                <button onClick={() => setShowRefundModal(true)} className="flex-1 py-1.5 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200 font-bold">â†©ï¸ è¿”é‡‘ã™ã‚‹</button>
              </div>
            )}
          </div>
        </div>
      </div>
    )}

    {/* è¿”é‡‘ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showRefundModal && selectedTx && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowRefundModal(false)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[420px]">
          <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
            <h3 className="text-sm font-bold text-slate-800">â†©ï¸ è¿”é‡‘å‡¦ç†</h3>
            <button onClick={() => setShowRefundModal(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className="bg-blue-50 rounded p-3 text-xs">
              <div className="flex justify-between"><span className="text-slate-500">å¯¾è±¡å–å¼•</span><span className="font-mono font-bold">{selectedTx.id}</span></div>
              <div className="flex justify-between mt-1"><span className="text-slate-500">æ±ºæ¸ˆé‡‘é¡</span><span className="font-bold">{selectedTx.amount}</span></div>
            </div>
            <div><label className="text-xs font-semibold text-slate-600">è¿”é‡‘é‡‘é¡ <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue={selectedTx.rawAmt} /><p className="text-xs text-slate-400 mt-0.5">ä¸€éƒ¨è¿”é‡‘ã®å ´åˆã¯é‡‘é¡ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„</p></div>
            <div><label className="text-xs font-semibold text-slate-600">è¿”é‡‘ç†ç”± <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ãŠå®¢æ§˜éƒ½åˆ</option><option>å•†å“ä¸è‰¯ãƒ»æ¬ å“</option><option>é‡è¤‡æ±ºæ¸ˆ</option><option>ä¸æ­£åˆ©ç”¨</option><option>ãã®ä»–</option></select></div>
            <div><label className="text-xs font-semibold text-slate-600">å‚™è€ƒ</label><textarea className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 h-16" placeholder="ä»»æ„ãƒ¡ãƒ¢" /></div>
          </div>
          <div className="p-4 border-t flex gap-2 justify-end">
            <button onClick={() => setShowRefundModal(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={() => setShowRefundModal(false)} className="px-4 py-2 text-xs bg-rose-600 text-white rounded font-semibold hover:bg-rose-700">è¿”é‡‘ã‚’å®Ÿè¡Œ</button>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ S05: APIè¨­å®š â”€â”€â”€
const MerchantAPISettings = () => {
  const toast = useToast();
  const [showKey, setShowKey] = useState({ live: false, test: false });
  const [showRegenerateModal, setShowRegenerateModal] = useState(null);
  const [webhookTab, setWebhookTab] = useState("settings");
  const [confirmText, setConfirmText] = useState("");
  const webhookLogs = [
    { id: "wh_01", event: "payment.succeeded", url: "https://api.abc-mart.co.jp/webhooks/payment", status: 200, sc: "green", time: "2026-02-11 14:23:05", duration: "120ms" },
    { id: "wh_02", event: "payment.failed", url: "https://api.abc-mart.co.jp/webhooks/payment", status: 200, sc: "green", time: "2026-02-11 14:18:12", duration: "95ms" },
    { id: "wh_03", event: "payment.succeeded", url: "https://api.abc-mart.co.jp/webhooks/payment", status: 500, sc: "red", time: "2026-02-11 13:55:30", duration: "3012ms" },
    { id: "wh_04", event: "chargeback.received", url: "https://api.abc-mart.co.jp/webhooks/payment", status: 200, sc: "green", time: "2026-02-11 12:40:18", duration: "88ms" },
    { id: "wh_05", event: "payment.refunded", url: "https://api.abc-mart.co.jp/webhooks/payment", status: 200, sc: "green", time: "2026-02-11 11:22:45", duration: "105ms" },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex items-center justify-between">
      <h2 className="text-sm font-bold text-slate-800">APIè¨­å®š</h2>
      <a href="#" className="text-xs text-blue-600 hover:underline">ğŸ“– APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â†’</a>
    </div>
    <div className="grid grid-cols-2 gap-4">
      {[{ env: "æœ¬ç•ªç’°å¢ƒ", badge: "green", pk: "aip_pk_live_xxxxxxxxxxxx...", sk: "aip_sk_live_xxxxxxxxxxxxxxxxxxxxxxxx", key: "live" },
        { env: "ãƒ†ã‚¹ãƒˆç’°å¢ƒ", badge: "yellow", pk: "aip_pk_test_xxxxxxxxxxxx...", sk: "aip_sk_test_xxxxxxxxxxxxxxxxxxxxxxxx", key: "test" }
      ].map(e => (
        <div key={e.key} className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
          <div className="flex items-center justify-between mb-2">
            <Badge text={e.env} color={e.badge} />
            <button onClick={() => setShowRegenerateModal(e.key)} className="text-xs text-red-500 hover:text-red-700">ğŸ”„ ã‚­ãƒ¼ã‚’å†ç™ºè¡Œ</button>
          </div>
          <div className="space-y-2">
            <div>
              <p className="text-xs text-slate-400">APIå…¬é–‹ã‚­ãƒ¼</p>
              <div className="flex items-center gap-1">
                <p className="text-xs font-mono bg-slate-50 rounded p-1.5 flex-1">{e.pk}</p>
                <button onClick={() => toast("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="text-xs text-blue-600 px-1">ğŸ“‹</button>
              </div>
            </div>
            <div>
              <p className="text-xs text-slate-400">APIã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼</p>
              <div className="flex items-center gap-1">
                <p className="text-xs font-mono bg-slate-50 rounded p-1.5 flex-1">{showKey[e.key] ? e.sk : "sk_" + e.key + "_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}</p>
                <button onClick={() => setShowKey(prev => ({ ...prev, [e.key]: !prev[e.key] }))} className="text-xs text-blue-600 px-1">{showKey[e.key] ? "ğŸ™ˆ éš ã™" : "ğŸ‘ è¡¨ç¤º"}</button>
                <button onClick={() => toast("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="text-xs text-blue-600 px-1">ğŸ“‹</button>
              </div>
            </div>
            <p className="text-xs text-slate-400">æœ€çµ‚ä½¿ç”¨: 2026-02-11 14:23</p>
          </div>
        </div>
      ))}
    </div>

    {/* Webhook ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex items-center justify-between mb-3">
        <p className="text-xs font-bold text-slate-700">Webhookè¨­å®š</p>
        <div className="flex bg-slate-100 rounded p-0.5">
          {["settings", "logs"].map(t => (
            <button key={t} onClick={() => setWebhookTab(t)} className={`text-xs px-3 py-1 rounded ${webhookTab === t ? "bg-white shadow-sm font-bold" : "text-slate-500"}`}>{t === "settings" ? "è¨­å®š" : "é…ä¿¡ãƒ­ã‚°"}</button>
          ))}
        </div>
      </div>

      {webhookTab === "settings" && (
        <div className="space-y-3">
          <div className="flex items-center gap-2 bg-slate-50 rounded-lg p-2.5 border border-slate-200">
            <Badge text="æœ¬ç•ª" color="green" />
            <span className="text-xs font-mono flex-1">https://api.abc-mart.co.jp/webhooks/payment</span>
            <Badge text="ç¨¼åƒä¸­" color="green" />
            <button onClick={() => toast("Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç·¨é›†ä¸­", "info")} className="text-xs text-blue-600">ç·¨é›†</button>
          </div>
          <div>
            <p className="text-xs text-slate-400 mb-1">å—ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ:</p>
            <div className="flex flex-wrap gap-1">
              {["payment.succeeded", "payment.failed", "payment.refunded", "chargeback.received", "subscription.created", "subscription.cancelled"].map(e => (
                <span key={e} className="text-xs bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded">{e}</span>
              ))}
            </div>
          </div>
          <div className="flex gap-2 pt-1">
            <button onClick={() => { toast("Webhookãƒ†ã‚¹ãƒˆé€ä¿¡ä¸­...", "info"); setTimeout(() => toast("Webhookãƒ†ã‚¹ãƒˆé€ä¿¡æˆåŠŸ", "success"), 1500); }} className="text-xs px-3 py-1.5 bg-blue-50 text-blue-600 rounded border border-blue-200 hover:bg-blue-100">ğŸ§ª ãƒ†ã‚¹ãƒˆé€ä¿¡</button>
            <button onClick={() => toast("ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="text-xs px-3 py-1.5 bg-slate-50 text-slate-600 rounded border border-slate-200 hover:bg-slate-100">+ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ </button>
          </div>
          <div className="mt-3 pt-3 border-t">
            <p className="text-xs font-bold text-slate-700 mb-2">Webhookç½²åæ¤œè¨¼</p>
            <div className="flex items-center gap-2">
              <p className="text-xs text-slate-400">ç½²åã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ:</p>
              <p className="text-xs font-mono bg-slate-50 rounded p-1.5">whsec_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</p>
              <button onClick={() => toast("Webhookç½²åã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ", "warning")} className="text-xs text-blue-600">è¡¨ç¤º</button>
            </div>
          </div>
        </div>
      )}

      {webhookTab === "logs" && (
        <div>
          <div className="flex items-center gap-2 mb-2">
            <span className="text-xs text-slate-400">é…ä¿¡æˆåŠŸç‡:</span>
            <span className="text-xs font-bold text-emerald-600">96.8%</span>
            <span className="text-xs text-slate-400 ml-2">ç›´è¿‘24æ™‚é–“: 245ä»¶</span>
          </div>
          <table className="w-full text-xs">
            <thead><tr className="border-b bg-slate-50"><th className="text-left py-1.5 px-2 font-semibold text-slate-500">ã‚¤ãƒ™ãƒ³ãƒˆ</th><th className="text-left py-1.5 px-2 font-semibold text-slate-500">æ—¥æ™‚</th><th className="text-left py-1.5 px-2 font-semibold text-slate-500">Status</th><th className="text-left py-1.5 px-2 font-semibold text-slate-500">å¿œç­”æ™‚é–“</th><th className="py-1.5 px-2"></th></tr></thead>
            <tbody>
              {webhookLogs.map(log => (
                <tr key={log.id} className="border-b hover:bg-slate-50">
                  <td className="py-1.5 px-2 font-mono">{log.event}</td>
                  <td className="py-1.5 px-2 text-slate-400">{log.time}</td>
                  <td className="py-1.5 px-2"><Badge text={String(log.status)} color={log.sc} /></td>
                  <td className="py-1.5 px-2 text-slate-500">{log.duration}</td>
                  <td className="py-1.5 px-2"><button onClick={() => toast(`${log.event}ã‚’å†é€ã—ã¾ã—ãŸ`, "success")} className="text-blue-600">å†é€</button></td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>

    {/* IPåˆ¶é™ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-700 mb-2">IPåˆ¶é™ï¼ˆAPIã‚¢ã‚¯ã‚»ã‚¹å…ƒï¼‰</p>
      <div className="space-y-1.5">
        {[["203.0.113.0/24", "æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼", "green"], ["198.51.100.10", "é–‹ç™ºç’°å¢ƒ", "yellow"]].map(([ip, label, color], i) => (
          <div key={i} className="flex items-center gap-2 text-xs bg-slate-50 rounded p-2 border">
            <span className="font-mono flex-1">{ip}</span>
            <span className="text-slate-400">{label}</span>
            <Badge text="è¨±å¯" color={color} />
            <button onClick={() => toast(`${ip}ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "warning")} className="text-red-400 hover:text-red-600">âœ•</button>
          </div>
        ))}
        <button onClick={() => toast("IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="text-xs text-blue-600 mt-1">+ IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ </button>
      </div>
    </div>

    {/* ã‚­ãƒ¼å†ç™ºè¡Œç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showRegenerateModal && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => { setShowRegenerateModal(null); setConfirmText(""); }} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[420px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold text-red-600">âš ï¸ APIã‚­ãƒ¼ã®å†ç™ºè¡Œ</p>
            <button onClick={() => { setShowRegenerateModal(null); setConfirmText(""); }} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-3">
            <div className="bg-red-50 border border-red-200 rounded p-3 text-xs text-red-700">
              <p className="font-bold">ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“</p>
              <p className="mt-1">ç¾åœ¨ã®{showRegenerateModal === "live" ? "æœ¬ç•ª" : "ãƒ†ã‚¹ãƒˆ"}ç’°å¢ƒã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã€æ–°ã—ã„ã‚­ãƒ¼ãŒç™ºè¡Œã•ã‚Œã¾ã™ã€‚æ—¢å­˜ã®APIé€£æºãŒåœæ­¢ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
            </div>
            <div>
              <label className="text-xs text-slate-500">ç¢ºèªã®ãŸã‚ã€Œå†ç™ºè¡Œã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„</label>
              <input value={confirmText} onChange={e => setConfirmText(e.target.value)} className="w-full border rounded px-2 py-1.5 text-xs mt-0.5" placeholder="å†ç™ºè¡Œ" />
            </div>
            <div className="flex gap-2">
              <button onClick={() => { setShowRegenerateModal(null); setConfirmText(""); }} className="flex-1 py-2 border rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button disabled={confirmText !== "å†ç™ºè¡Œ"} onClick={() => { setShowRegenerateModal(null); setConfirmText(""); toast("APIã‚­ãƒ¼ã‚’å†ç™ºè¡Œã—ã¾ã—ãŸã€‚æ–°ã—ã„ã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„", "warning"); }} className={`flex-1 py-2 rounded text-xs font-bold text-white ${confirmText === "å†ç™ºè¡Œ" ? "bg-red-500 hover:bg-red-600" : "bg-slate-300 cursor-not-allowed"}`}>ã‚­ãƒ¼ã‚’å†ç™ºè¡Œã™ã‚‹</button>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ S06: AIã‚µãƒãƒ¼ãƒˆ â”€â”€â”€
const MerchantAIChat = () => {
  const toast = useToast();
  const [inputText, setInputText] = useState("");
  const [showHistory, setShowHistory] = useState(false);
  return (
  <div className="p-4 flex gap-4 h-full">
    <div className="flex-1 bg-white rounded-lg border flex flex-col">
      <div className="p-3 border-b flex justify-between items-center">
        <p className="text-xs font-bold text-slate-700">ğŸ¤– AIã‚µãƒãƒ¼ãƒˆãƒãƒ£ãƒƒãƒˆ</p>
        <div className="flex items-center gap-2">
          <button onClick={() => setShowHistory(!showHistory)} className={`text-xs px-2 py-1 rounded border ${showHistory ? "bg-blue-50 text-blue-600 border-blue-200" : "text-slate-400 border-slate-200"}`}>ğŸ“‹ å±¥æ­´</button>
          <button onClick={() => toast("æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã—ãŸ", "info")} className="text-xs px-2 py-1 rounded border text-slate-400 border-slate-200">ğŸ”„ æ–°è¦</button>
        </div>
      </div>
      <div className="flex flex-1 overflow-hidden">
        {showHistory && (
          <div className="w-44 border-r bg-slate-50 overflow-y-auto p-2 space-y-1">
            <p className="text-xs font-bold text-slate-500 px-1 mb-2">ä¼šè©±å±¥æ­´</p>
            {[["å£²ä¸Šç…§ä¼š", "ä»Šæ—¥ 14:23"], ["è¿”é‡‘å‡¦ç†ã®ä¾é ¼", "æ˜¨æ—¥ 16:30"], ["APIè¨­å®šã®è³ªå•", "2/15 09:00"]].map(([title, time], i) => (
              <div key={i} className={`p-2 rounded text-xs cursor-pointer ${i === 0 ? "bg-white border border-blue-200" : "hover:bg-white"}`}>
                <p className="font-bold text-slate-700 truncate">{title}</p>
                <p className="text-slate-400">{time}</p>
              </div>
            ))}
          </div>
        )}
        <div className="flex-1 p-3 space-y-3 overflow-y-auto">
          <div className="flex gap-2">
            <div className="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-xs">ğŸ¤–</div>
            <div className="bg-slate-100 rounded-lg p-2 max-w-xs">
              <p className="text-xs text-slate-700">ã“ã‚“ã«ã¡ã¯ï¼ABCãƒãƒ¼ãƒˆã®ã‚µãƒãƒ¼ãƒˆAIã§ã™ã€‚å–å¼•ã®ç…§ä¼šã€APIè¨­å®šã®å¤‰æ›´ã€è¿”é‡‘å‡¦ç†ãªã©ã€ä½•ã§ã‚‚ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚</p>
            </div>
          </div>
          <div className="flex gap-2 justify-end">
            <div className="bg-blue-600 rounded-lg p-2 max-w-xs"><p className="text-xs text-white">æ˜¨æ—¥ã®å£²ä¸Šã‚’æ•™ãˆã¦</p></div>
          </div>
          <div className="flex gap-2">
            <div className="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-xs">ğŸ¤–</div>
            <div className="bg-slate-100 rounded-lg p-2 max-w-sm">
              <p className="text-xs text-slate-700 mb-2">æ˜¨æ—¥ï¼ˆ2/10ï¼‰ã®å£²ä¸Šã‚µãƒãƒªãƒ¼ã§ã™ï¼š</p>
              <div className="bg-white rounded p-2 text-xs space-y-1">
                <div className="flex justify-between"><span className="text-slate-500">ç·å£²ä¸Š:</span><span className="font-bold">Â¥412,000</span></div>
                <div className="flex justify-between"><span className="text-slate-500">å–å¼•ä»¶æ•°:</span><span>48ä»¶</span></div>
                <div className="flex justify-between"><span className="text-slate-500">æˆåŠŸç‡:</span><span className="text-emerald-600">99.5%</span></div>
                <div className="flex justify-between"><span className="text-slate-500">å‰é€±æ¯”:</span><span className="text-emerald-600">+15%</span></div>
              </div>
              <p className="text-xs text-slate-500 mt-2">è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆãŒå¿…è¦ã§ã—ãŸã‚‰ã€Œæœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºã—ã¦ã€ã¨è¨€ã£ã¦ãã ã•ã„ã€‚</p>
              <div className="flex gap-1 mt-2 border-t pt-1.5">
                <button onClick={() => toast("ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", "success")} className="text-xs text-slate-400 hover:text-emerald-600">ğŸ‘</button>
                <button onClick={() => toast("ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ", "info")} className="text-xs text-slate-400 hover:text-red-600">ğŸ‘</button>
                <button onClick={() => toast("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="text-xs text-slate-400 hover:text-blue-600 ml-auto">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
              </div>
            </div>
          </div>
          <div className="flex gap-2 justify-end">
            <div className="bg-blue-600 rounded-lg p-2 max-w-xs"><p className="text-xs text-white">æ³¨æ–‡ç•ªå· ORD-20260210-045 ã‚’è¿”é‡‘ã—ã¦</p></div>
          </div>
          <div className="flex gap-2">
            <div className="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-xs">ğŸ¤–</div>
            <div className="bg-slate-100 rounded-lg p-2 max-w-sm">
              <p className="text-xs text-slate-700 mb-2">ç¢ºèªã—ã¾ã™ã€‚ä»¥ä¸‹ã®å–å¼•ã‚’è¿”é‡‘ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
              <div className="bg-amber-50 border border-amber-200 rounded p-2 text-xs space-y-1">
                <div className="flex justify-between"><span className="text-slate-500">æ³¨æ–‡ç•ªå·:</span><span>ORD-20260210-045</span></div>
                <div className="flex justify-between"><span className="text-slate-500">é‡‘é¡:</span><span className="font-bold">Â¥3,200</span></div>
                <div className="flex justify-between"><span className="text-slate-500">ã‚«ãƒ¼ãƒ‰:</span><span>JCB ****5678</span></div>
              </div>
              <div className="flex gap-2 mt-2">
                <button onClick={() => toast("ORD-20260210-045 ã®è¿”é‡‘å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ", "success")} className="px-3 py-1 bg-rose-100 text-rose-700 rounded text-xs font-semibold">è¿”é‡‘å®Ÿè¡Œ</button>
                <button onClick={() => toast("è¿”é‡‘ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ", "info")} className="px-3 py-1 bg-slate-100 text-slate-600 rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              </div>
              <div className="flex gap-1 mt-2 border-t pt-1.5">
                <button onClick={() => toast("ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", "success")} className="text-xs text-slate-400 hover:text-emerald-600">ğŸ‘</button>
                <button onClick={() => toast("ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ", "info")} className="text-xs text-slate-400 hover:text-red-600">ğŸ‘</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div className="p-3 border-t flex gap-2">
        <button onClick={() => toast("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„", "info")} className="px-2 py-2 text-slate-400 border rounded-lg text-xs hover:bg-slate-50" title="ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜">ğŸ“</button>
        <input value={inputText} onChange={e => setInputText(e.target.value)} className="flex-1 text-xs border rounded-lg px-3 py-2" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." />
        <button onClick={() => { if (inputText) { toast("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "success"); setInputText(""); } }} className={`px-3 py-2 rounded-lg text-xs font-semibold ${inputText ? "bg-blue-600 text-white" : "bg-slate-200 text-slate-400"}`}>é€ä¿¡</button>
      </div>
      <div className="px-3 py-1.5 bg-slate-50 border-t text-xs text-slate-400 text-center">
        ğŸ¤– å–¶æ¥­æ™‚é–“å¤–ã¯AIãŒä¸€æ¬¡å¯¾å¿œã—ã¾ã™ã€‚ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªå ´åˆã¯å–¶æ¥­æ™‚é–“å†…ã«æ‹…å½“è€…ã‹ã‚‰å›ç­”ã—ã¾ã™ã€‚
      </div>
    </div>
    <div className="w-48">
      <p className="text-xs font-bold text-slate-600 mb-2">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</p>
      <div className="space-y-1">
        {["æ˜¨æ—¥ã®å£²ä¸Šã¯ï¼Ÿ", "ä»Šæœˆã®ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºã—ã¦", "æ±ºæ¸ˆæˆåŠŸç‡ã¯ï¼Ÿ", "Webhook URLã‚’å¤‰æ›´ã—ãŸã„", "ãƒ†ã‚¹ãƒˆæ±ºæ¸ˆã‚’ã—ãŸã„", "APIã‚­ãƒ¼ã‚’å†ç™ºè¡Œã—ãŸã„"].map(q => (
          <button key={q} onClick={() => setInputText(q)} className="w-full text-left text-xs bg-white border rounded p-2 text-slate-600 hover:bg-blue-50 hover:text-blue-600 transition-all">{q}</button>
        ))}
      </div>
    </div>
  </div>
  );
};

// â”€â”€â”€ M12: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† â”€â”€â”€
const MASTER_MENU_ITEMS = [
  { id: "M01", label: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰", icon: "ğŸ“Š", group: "æ¦‚æ³" },
  { id: "M02", label: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", icon: "âš¡", group: "æ¦‚æ³" },
  { id: "M03", label: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–", icon: "ğŸ“¡", group: "ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°" },
  { id: "M03b", label: "æ³¨æ–‡æ¤œç´¢", icon: "ğŸ”", group: "å–å¼•" },
  { id: "M16", label: "é¡§å®¢ç®¡ç†", icon: "ğŸ‘¥", group: "å–å¼•" },
  { id: "M14", label: "ç¶™ç¶šèª²é‡‘ç®¡ç†", icon: "ğŸ”„", group: "å–å¼•" },
  { id: "M04", label: "åŠ ç›Ÿåº—ç®¡ç†", icon: "ğŸª", group: "åŠ ç›Ÿåº—" },
  { id: "M06", label: "å¯©æŸ»ãƒ»ç”³è¾¼", icon: "ğŸ“", group: "åŠ ç›Ÿåº—" },
  { id: "M09b", label: "æ¥ç¶šå…ˆå¯©æŸ»", icon: "ğŸ”—", group: "åŠ ç›Ÿåº—" },
  { id: "M15", label: "ä»£ç†åº—ç®¡ç†", icon: "ğŸ¤", group: "åŠ ç›Ÿåº—" },
  { id: "M08", label: "ç²¾ç®—ãƒ»å…¥é‡‘ç®¡ç†", icon: "ğŸ’°", group: "ç²¾ç®—" },
  { id: "M11", label: "ãƒ¬ãƒãƒ¼ãƒˆ", icon: "ğŸ“„", group: "ç²¾ç®—" },
  { id: "M09", label: "æ¥ç¶šå…ˆç®¡ç†", icon: "ğŸ–¥ï¸", group: "æ±ºæ¸ˆã‚¤ãƒ³ãƒ•ãƒ©" },
  { id: "M10", label: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°", icon: "ğŸ”€", group: "æ±ºæ¸ˆã‚¤ãƒ³ãƒ•ãƒ©" },
  { id: "M07", label: "ä¸æ­£æ¤œçŸ¥", icon: "ğŸ›¡ï¸", group: "æ±ºæ¸ˆã‚¤ãƒ³ãƒ•ãƒ©" },
  { id: "M05", label: "AIç›£è¦–", icon: "ğŸ¤–", group: "é‹ç”¨" },
  { id: "M12", label: "ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†", icon: "ğŸ‘¤", group: "é‹ç”¨" },
  { id: "M13", label: "ã‚·ã‚¹ãƒ†ãƒ è¨­å®š", icon: "âš™ï¸", group: "é‹ç”¨" },
];

const MENU_GROUPS = ["æ¦‚æ³", "ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°", "å–å¼•", "åŠ ç›Ÿåº—", "ç²¾ç®—", "æ±ºæ¸ˆã‚¤ãƒ³ãƒ•ãƒ©", "é‹ç”¨"];

// ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç¢ºèªç”¨: ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡æ›¿ãƒªã‚¹ãƒˆ
const SWITCHABLE_USERS = [
  { id: "U001", name: "ç”°ä¸­ å¤ªéƒ", initials: "ç”°", roleLabel: "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…", rColor: "#EF4444",
    permissions: Object.fromEntries(MASTER_MENU_ITEMS.map(m => [m.id, "full"])) },
  { id: "U002", name: "ä½è—¤ èŠ±å­", initials: "ä½", roleLabel: "ç®¡ç†è€…", rColor: "#3B82F6",
    permissions: Object.fromEntries(MASTER_MENU_ITEMS.map(m => [m.id, m.id === "M12" || m.id === "M13" ? "readonly" : "full"])) },
  { id: "U003", name: "å±±ç”° ä¸€éƒ", initials: "å±±", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼ˆå¯©æŸ»ï¼‰", rColor: "#8B5CF6",
    permissions: { M01: "readonly", M02: "full", M03: "readonly", M03b: "readonly", M16: "none", M14: "none", M04: "full", M06: "full", M09b: "full", M15: "none", M08: "none", M11: "none", M09: "none", M10: "none", M07: "full", M05: "none", M12: "none", M13: "none" } },
  { id: "U004", name: "éˆ´æœ¨ ç¾å’²", initials: "éˆ´", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼ˆä¸æ­£æ¤œçŸ¥ï¼‰", rColor: "#8B5CF6",
    permissions: { M01: "readonly", M02: "full", M03: "readonly", M03b: "readonly", M16: "none", M14: "none", M04: "none", M06: "none", M09b: "none", M15: "none", M08: "none", M11: "none", M09: "none", M10: "none", M07: "full", M05: "readonly", M12: "none", M13: "none" } },
  { id: "U005", name: "é«˜æ©‹ å¥å¤ª", initials: "é«˜", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼ˆé–²è¦§ä¸­å¿ƒï¼‰", rColor: "#8B5CF6",
    permissions: { M01: "readonly", M02: "none", M03: "none", M03b: "readonly", M16: "none", M14: "none", M04: "readonly", M06: "readonly", M09b: "none", M15: "none", M08: "none", M11: "none", M09: "none", M10: "none", M07: "none", M05: "none", M12: "none", M13: "none" } },
  { id: "U006", name: "ä¼Šè—¤ ç¿”", initials: "ä¼Š", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼ˆç²¾ç®—ï¼‰", rColor: "#8B5CF6",
    permissions: { M01: "readonly", M02: "full", M03: "readonly", M03b: "readonly", M16: "none", M14: "none", M04: "full", M06: "full", M09b: "none", M15: "none", M08: "full", M11: "readonly", M09: "none", M10: "none", M07: "none", M05: "none", M12: "none", M13: "none" } },
];

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼IDã¨ã‚µã‚¤ãƒ‰ãƒãƒ¼IDé–“ã®ãƒãƒƒãƒ”ãƒ³ã‚°
const MENU_TO_SIDEBAR = {
  M01: "dashboard", M02: "queue", M03: "txn", "M03b": "orderSearch", M16: "customers",
  M14: "recurring", M04: "merchants", M06: "applications", "M09b": "processors",
  M15: "agents", M08: "settlement", M11: "report", M09: null, M10: "routing",
  M07: "fraud", M05: "ai", M12: "users", M13: "settings",
};

const MasterUserManagement = () => {
  const toast = useToast();
  const [showInviteM04, setShowInviteM04] = useState(false);
  const [expandedStaff, setExpandedStaff] = useState(null);
  const [expandedSection, setExpandedSection] = useState("permissions");
  const [actionConfirm, setActionConfirm] = useState(null);

  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™: { ãƒ¡ãƒ‹ãƒ¥ãƒ¼ID: "full" | "readonly" | "none" }
  const defaultPermissions = {
    super_admin: Object.fromEntries(MASTER_MENU_ITEMS.map(m => [m.id, "full"])),
    admin: Object.fromEntries(MASTER_MENU_ITEMS.map(m => [m.id, "full"])),
  };

  const staffData = [
    { id: "U001", name: "ç”°ä¸­ å¤ªéƒ", email: "tanaka@company.jp", roleLabel: "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…", mfa: true, lastLogin: "2026-02-11 14:30", rColor: "red", joinDate: "2024-01-15", status: "æœ‰åŠ¹",
      permissions: Object.fromEntries(MASTER_MENU_ITEMS.map(m => [m.id, "full"])),
      sessions: [
        { date: "02/11 14:30", ip: "203.0.113.10", device: "Chrome / macOS", duration: "2h 15m" },
        { date: "02/11 09:00", ip: "203.0.113.10", device: "Chrome / macOS", duration: "4h 30m" },
        { date: "02/10 13:20", ip: "203.0.113.10", device: "Chrome / macOS", duration: "3h 10m" },
      ], activity: [
        { date: "02/11 14:35", action: "åŠ ç›Ÿåº—æ‰¿èª", target: "ABCãƒãƒ¼ãƒˆ", page: "M04" },
        { date: "02/11 10:20", action: "ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´", target: "é€šçŸ¥è¨­å®š", page: "M13" },
        { date: "02/10 16:00", action: "ã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾…", target: "æ–°è¦ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼", page: "M12" },
        { date: "02/10 11:30", action: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¤‰æ›´", target: "VISAæ¥ç¶šå…ˆ", page: "M10" },
      ]},
    { id: "U002", name: "ä½è—¤ èŠ±å­", email: "sato@company.jp", roleLabel: "ç®¡ç†è€…", mfa: true, lastLogin: "2026-02-11 13:45", rColor: "blue", joinDate: "2024-03-01", status: "æœ‰åŠ¹",
      permissions: Object.fromEntries(MASTER_MENU_ITEMS.map(m => [m.id, m.id === "M12" || m.id === "M13" ? "readonly" : "full"])),
      sessions: [
        { date: "02/11 13:45", ip: "198.51.100.5", device: "Firefox / Windows", duration: "3h 20m" },
        { date: "02/10 09:15", ip: "198.51.100.5", device: "Firefox / Windows", duration: "6h 45m" },
      ], activity: [
        { date: "02/11 14:00", action: "ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ", target: "æœˆæ¬¡ã‚µãƒãƒªãƒ¼", page: "M11" },
        { date: "02/11 10:30", action: "ç²¾ç®—ãƒãƒƒãƒå®Ÿè¡Œ", target: "2026-02-10åˆ†", page: "M08" },
      ]},
    { id: "U003", name: "å±±ç”° ä¸€éƒ", email: "yamada@company.jp", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼", mfa: true, lastLogin: "2026-02-11 14:20", rColor: "purple", joinDate: "2024-06-15", status: "æœ‰åŠ¹",
      permissions: { M01: "readonly", M02: "full", M03: "readonly", M03b: "readonly", M16: "none", M14: "none", M04: "full", M06: "full", M09b: "full", M15: "none", M08: "none", M11: "none", M09: "none", M10: "none", M07: "full", M05: "none", M12: "none", M13: "none" },
      sessions: [
        { date: "02/11 14:20", ip: "192.0.2.100", device: "Chrome / Windows", duration: "5h 10m" },
      ], activity: [
        { date: "02/11 14:25", action: "å¯©æŸ»æ‰¿èª", target: "DEFã‚·ãƒ§ãƒƒãƒ—", page: "M04" },
        { date: "02/11 11:00", action: "ä¸æ­£æ¤œçŸ¥ç¢ºèª", target: "TX-89012", page: "M07" },
      ]},
    { id: "U004", name: "éˆ´æœ¨ ç¾å’²", email: "suzuki@company.jp", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼", mfa: true, lastLogin: "2026-02-11 12:10", rColor: "purple", joinDate: "2024-08-01", status: "æœ‰åŠ¹",
      permissions: { M01: "readonly", M02: "full", M03: "readonly", M03b: "readonly", M16: "none", M14: "none", M04: "none", M06: "none", M09b: "none", M15: "none", M08: "none", M11: "none", M09: "none", M10: "none", M07: "full", M05: "readonly", M12: "none", M13: "none" },
      sessions: [
        { date: "02/11 12:10", ip: "10.0.0.50", device: "Safari / macOS", duration: "3h 00m" },
      ], activity: [
        { date: "02/11 12:15", action: "ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤", target: "IP: 45.xxx.xxx.1", page: "M07" },
      ]},
    { id: "U005", name: "é«˜æ©‹ å¥å¤ª", email: "takahashi@company.jp", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼", mfa: false, lastLogin: "2026-02-10 18:00", rColor: "purple", joinDate: "2025-01-10", status: "æœ‰åŠ¹",
      permissions: { M01: "readonly", M02: "none", M03: "none", M03b: "readonly", M16: "none", M14: "none", M04: "readonly", M06: "readonly", M09b: "none", M15: "none", M08: "none", M11: "none", M09: "none", M10: "none", M07: "none", M05: "none", M12: "none", M13: "none" },
      sessions: [
        { date: "02/10 18:00", ip: "172.16.0.20", device: "Chrome / Windows", duration: "1h 30m" },
      ], activity: [
        { date: "02/10 18:10", action: "URLå·¡å›ç¢ºèª", target: "ã‚µã‚¤ãƒˆ#S-042", page: "M06" },
      ]},
    { id: "U006", name: "ä¼Šè—¤ ç¿”", email: "ito@company.jp", roleLabel: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼", mfa: true, lastLogin: "2026-02-11 09:30", rColor: "purple", joinDate: "2025-03-20", status: "æœ‰åŠ¹",
      permissions: { M01: "readonly", M02: "full", M03: "readonly", M03b: "readonly", M16: "none", M14: "none", M04: "full", M06: "full", M09b: "none", M15: "none", M08: "full", M11: "readonly", M09: "none", M10: "none", M07: "none", M05: "none", M12: "none", M13: "none" },
      sessions: [
        { date: "02/11 09:30", ip: "10.0.0.80", device: "Edge / Windows", duration: "4h 20m" },
      ], activity: [
        { date: "02/11 09:45", action: "ç²¾ç®—ç¢ºèª", target: "ãƒãƒƒãƒ#B-0211", page: "M08" },
        { date: "02/11 09:35", action: "å¯©æŸ»ãƒ¬ãƒ“ãƒ¥ãƒ¼", target: "GHIãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°", page: "M04" },
      ]},
  ];

  const permLabel = (v) => v === "full" ? "ç·¨é›†å¯" : v === "readonly" ? "é–²è¦§ã®ã¿" : "éè¡¨ç¤º";
  const permColor = (v) => v === "full" ? "green" : v === "readonly" ? "yellow" : "gray";
  const permCount = (perms, type) => Object.values(perms).filter(v => v === type).length;

  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆé‹å–¶ã‚¹ã‚¿ãƒƒãƒ•ï¼‰</h2>
      <button onClick={() => setShowInviteM04(true)} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold hover:bg-blue-700">ğŸ“§ ã‚¹ã‚¿ãƒƒãƒ•ã‚’æ‹›å¾…</button>
    </div>

    {/* Role Summary */}
    <div className="flex gap-3">
      {[
        { role: "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…", count: staffData.filter(s => s.roleLabel === "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…").length, textClass: "text-rose-600", icon: "ğŸ‘‘", desc: "å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†å¯" },
        { role: "ç®¡ç†è€…", count: staffData.filter(s => s.roleLabel === "ç®¡ç†è€…").length, textClass: "text-blue-600", icon: "ğŸ”‘", desc: "å€‹åˆ¥ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™è¨­å®šå¯" },
        { role: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼", count: staffData.filter(s => s.roleLabel === "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼").length, textClass: "text-purple-600", icon: "ğŸ“‹", desc: "å€‹åˆ¥ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™è¨­å®šå¯" },
      ].map((r, i) => (
        <div key={i} className="flex-1 bg-white rounded-lg border border-slate-200 shadow-sm p-3">
          <div className="flex items-center gap-2 mb-1">
            <span>{r.icon}</span>
            <span className="text-xs font-bold text-slate-600">{r.role}</span>
          </div>
          <span className={`text-lg font-bold ${r.textClass}`}>{r.count}å</span>
          <p className="text-xs text-slate-400 mt-0.5">{r.desc}</p>
        </div>
      ))}
    </div>

    {/* Staff Accordion List */}
    <div className="space-y-2">
      {staffData.map((u, i) => {
        const isExpanded = expandedStaff === u.id;
        return (
        <div key={u.id} className={`bg-white rounded-lg border shadow-sm ${isExpanded ? "border-blue-300 ring-1 ring-blue-100" : "border-slate-200"}`}>
          {/* Accordion Header */}
          <div className={`flex items-center gap-3 px-4 py-3 cursor-pointer hover:bg-blue-50/50 transition-colors ${isExpanded ? "bg-blue-50/30" : ""}`} onClick={() => { setExpandedStaff(isExpanded ? null : u.id); setExpandedSection("permissions"); }}>
            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center text-sm shrink-0">ğŸ‘¤</div>
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2">
                <span className="text-xs font-bold text-slate-800">{u.name}</span>
                <Badge text={u.roleLabel} color={u.rColor} />
                {u.mfa ? <span className="text-xs text-emerald-500">ğŸ”’</span> : <span className="text-xs text-rose-400">âš ï¸MFAç„¡åŠ¹</span>}
              </div>
              <p className="text-xs text-slate-400">{u.email}</p>
            </div>
            <div className="flex items-center gap-4 shrink-0">
              <div className="flex gap-1.5 text-xs">
                <span className="px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-600 font-semibold">{permCount(u.permissions, "full")}ç·¨é›†</span>
                <span className="px-1.5 py-0.5 rounded bg-amber-50 text-amber-600 font-semibold">{permCount(u.permissions, "readonly")}é–²è¦§</span>
                <span className="px-1.5 py-0.5 rounded bg-slate-100 text-slate-400 font-semibold">{permCount(u.permissions, "none")}éè¡¨ç¤º</span>
              </div>
              <span className="text-xs text-slate-400">{u.lastLogin}</span>
              <span className={`text-slate-400 transition-transform ${isExpanded ? "rotate-180" : ""}`}>â–¼</span>
            </div>
          </div>

          {/* Accordion Body */}
          {isExpanded && (
          <div className="border-t">
            {/* Inner Tabs */}
            <div className="flex border-b bg-slate-50 px-4">
              {[
                { key: "permissions", label: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™", icon: "ğŸ”" },
                { key: "activity", label: "æ“ä½œãƒ­ã‚°", icon: "ğŸ“" },
                { key: "sessions", label: "ã‚»ãƒƒã‚·ãƒ§ãƒ³", icon: "ğŸ’»" },
                { key: "info", label: "åŸºæœ¬æƒ…å ±", icon: "â„¹ï¸" },
              ].map(tab => (
                <button key={tab.key} onClick={() => setExpandedSection(tab.key)} className={`px-3 py-2 text-xs font-semibold border-b-2 transition-colors ${expandedSection === tab.key ? "border-blue-500 text-blue-700 bg-white" : "border-transparent text-slate-500 hover:text-slate-700"}`}>
                  {tab.icon} {tab.label}
                </button>
              ))}
              <div className="flex-1" />
              <div className="flex items-center gap-1 py-1" onClick={e => e.stopPropagation()}>
                <button onClick={() => setActionConfirm({ title: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ", description: `${u.name} ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™ã€‚`, type: "warning", onConfirm: () => toast(`${u.name} ã«ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ`, "success") })} className="px-2 py-1 bg-yellow-50 text-yellow-700 border border-yellow-200 rounded text-xs hover:bg-yellow-100">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ</button>
                <button onClick={() => setActionConfirm({ title: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç„¡åŠ¹åŒ–", description: `${u.name}ï¼ˆ${u.email}ï¼‰ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚`, warning: "ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³ã§ããªããªã‚Šã¾ã™ã€‚", type: "danger", onConfirm: () => toast(`${u.name} ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ`, "warning") })} className="px-2 py-1 bg-rose-50 text-rose-600 border border-rose-200 rounded text-xs hover:bg-rose-100">ç„¡åŠ¹åŒ–</button>
              </div>
            </div>

            <div className="p-4">
              {/* â”€â”€ ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™ã‚¿ãƒ– â”€â”€ */}
              {expandedSection === "permissions" && (
              <div className="space-y-3">
                <div className="flex items-center justify-between">
                  <p className="text-xs text-slate-500">å„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’å€‹åˆ¥ã«è¨­å®šã§ãã¾ã™ã€‚</p>
                  {u.roleLabel === "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…" && (
                    <Badge text="å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†å¯ï¼ˆå¤‰æ›´ä¸å¯ï¼‰" color="red" />
                  )}
                </div>
                {MENU_GROUPS.map(group => {
                  const items = MASTER_MENU_ITEMS.filter(m => m.group === group);
                  return (
                  <div key={group}>
                    <p className="text-xs font-bold text-slate-600 mb-1.5 flex items-center gap-1">
                      <span className="w-1.5 h-1.5 rounded-full bg-blue-400 inline-block" />
                      {group}
                    </p>
                    <div className="grid grid-cols-2 gap-1.5">
                      {items.map(menu => {
                        const perm = u.permissions[menu.id] || "none";
                        return (
                        <div key={menu.id} className={`flex items-center gap-2 px-3 py-2 rounded border text-xs ${perm === "full" ? "bg-emerald-50 border-emerald-200" : perm === "readonly" ? "bg-amber-50 border-amber-200" : "bg-slate-50 border-slate-200 opacity-60"}`}>
                          <span>{menu.icon}</span>
                          <span className={`flex-1 font-semibold ${perm === "none" ? "text-slate-400 line-through" : "text-slate-700"}`}>{menu.id} {menu.label}</span>
                          <select
                            defaultValue={perm}
                            disabled={u.roleLabel === "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…"}
                            className={`text-xs border rounded px-1.5 py-0.5 ${u.roleLabel === "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…" ? "bg-slate-100 text-slate-400 cursor-not-allowed" : "bg-white cursor-pointer"}`}
                          >
                            <option value="full">ç·¨é›†å¯</option>
                            <option value="readonly">é–²è¦§ã®ã¿</option>
                            <option value="none">éè¡¨ç¤º</option>
                          </select>
                        </div>
                        );
                      })}
                    </div>
                  </div>
                  );
                })}
                {u.roleLabel !== "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…" && (
                <div className="flex gap-2 pt-2 border-t">
                  <button onClick={() => toast(`${u.name} ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™ã‚’ä¿å­˜ã—ã¾ã—ãŸ`, "success")} className="px-4 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">æ¨©é™ã‚’ä¿å­˜</button>
                  <button className="px-3 py-1.5 bg-slate-100 text-slate-500 rounded text-xs hover:bg-slate-200">å…¨ã¦ç·¨é›†å¯ã«ã™ã‚‹</button>
                  <button className="px-3 py-1.5 bg-slate-100 text-slate-500 rounded text-xs hover:bg-slate-200">å…¨ã¦é–²è¦§ã®ã¿ã«ã™ã‚‹</button>
                </div>
                )}
              </div>
              )}

              {/* â”€â”€ æ“ä½œãƒ­ã‚°ã‚¿ãƒ– â”€â”€ */}
              {expandedSection === "activity" && (
              <div className="space-y-2">
                {u.activity.map((a, ai) => (
                  <div key={ai} className="flex items-start gap-3">
                    <div className="flex flex-col items-center">
                      <div className="w-2 h-2 rounded-full bg-blue-400 mt-1.5" />
                      {ai < u.activity.length - 1 && <div className="w-px h-6 bg-slate-200" />}
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2">
                        <span className="text-xs font-semibold text-slate-700">{a.action}</span>
                        <Badge text={a.page} color="blue" />
                      </div>
                      <p className="text-xs text-slate-400">{a.target} â€” {a.date}</p>
                    </div>
                  </div>
                ))}
                {u.activity.length === 0 && <p className="text-xs text-slate-400 py-4 text-center">æ“ä½œãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“</p>}
              </div>
              )}

              {/* â”€â”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ãƒ– â”€â”€ */}
              {expandedSection === "sessions" && (
              <div className="space-y-1">
                {u.sessions.map((s, si) => (
                  <div key={si} className="flex items-center gap-3 text-xs p-2 bg-slate-50 rounded border">
                    <span className="w-24 text-slate-400">{s.date}</span>
                    <span className="w-28 text-slate-500 font-mono">{s.ip}</span>
                    <span className="flex-1 text-slate-600">{s.device}</span>
                    <span className="text-slate-400">{s.duration}</span>
                  </div>
                ))}
              </div>
              )}

              {/* â”€â”€ åŸºæœ¬æƒ…å ±ã‚¿ãƒ– â”€â”€ */}
              {expandedSection === "info" && (
              <div className="space-y-3">
                <div className="grid grid-cols-4 gap-3">
                  {[
                    { label: "ãƒ­ãƒ¼ãƒ«", value: u.roleLabel },
                    { label: "å‚åŠ æ—¥", value: u.joinDate },
                    { label: "MFA", value: u.mfa ? "æœ‰åŠ¹" : "ç„¡åŠ¹" },
                    { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", value: u.status },
                  ].map((item, ii) => (
                    <div key={ii} className="bg-slate-50 rounded p-2">
                      <p className="text-xs text-slate-400">{item.label}</p>
                      <p className="text-xs font-bold text-slate-700">{item.value}</p>
                    </div>
                  ))}
                </div>
                <div>
                  <label className="text-xs font-semibold text-slate-600">ãƒ­ãƒ¼ãƒ«å¤‰æ›´</label>
                  <div className="flex items-center gap-2 mt-1">
                    <select defaultValue={u.roleLabel} disabled={u.roleLabel === "ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…"} className="text-xs border rounded px-2 py-1.5">
                      <option>ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€…</option>
                      <option>ç®¡ç†è€…</option>
                      <option>ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼</option>
                    </select>
                    <input className="flex-1 text-xs border rounded px-2 py-1.5" placeholder="å¤‰æ›´ç†ç”±ï¼ˆç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ï¼‰" />
                    <button onClick={() => toast(`${u.name} ã®ãƒ­ãƒ¼ãƒ«ã‚’å¤‰æ›´ã—ã¾ã—ãŸ`, "success")} className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700 whitespace-nowrap">å¤‰æ›´</button>
                  </div>
                  <p className="text-xs text-amber-600 mt-1">âš ï¸ ãƒ­ãƒ¼ãƒ«å¤‰æ›´æ™‚ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™è¨­å®šã‚‚åˆã‚ã›ã¦è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
              </div>
              )}
            </div>
          </div>
          )}
        </div>
        );
      })}
    </div>

    {/* â”€â”€ Modal: æ‹›å¾… â”€â”€ */}
    {showInviteM04 && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowInviteM04(false)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[520px] max-h-[85vh] overflow-y-auto">
          <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center sticky top-0 z-10">
            <h3 className="text-sm font-bold text-slate-800">ğŸ“§ ã‚¹ã‚¿ãƒƒãƒ•ã‚’æ‹›å¾…</h3>
            <button onClick={() => setShowInviteM04(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs font-semibold text-slate-600">æ°å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: å±±ç”° å¤ªéƒ" /></div>
              <div><label className="text-xs font-semibold text-slate-600">ãƒ¡ãƒ¼ãƒ« <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: yamada@company.jp" /></div>
              <div><label className="text-xs font-semibold text-slate-600">ãƒ­ãƒ¼ãƒ« <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ç®¡ç†è€…ï¼ˆadminï¼‰</option><option>ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼ˆreviewerï¼‰</option></select></div>
              <div><label className="text-xs font-semibold text-slate-600">MFA <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å¿…é ˆï¼ˆæ¨å¥¨ï¼‰</option><option>ä»»æ„</option></select></div>
            </div>
            <div>
              <label className="text-xs font-semibold text-slate-600">ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¨©é™ï¼ˆæ‹›å¾…å¾Œã«è©³ç´°è¨­å®šå¯ï¼‰</label>
              <div className="mt-2 space-y-2 max-h-48 overflow-y-auto border rounded p-2">
                {MENU_GROUPS.map(group => (
                  <div key={group}>
                    <p className="text-xs font-bold text-slate-500 mb-1">{group}</p>
                    <div className="grid grid-cols-2 gap-1">
                      {MASTER_MENU_ITEMS.filter(m => m.group === group).map(menu => (
                        <div key={menu.id} className="flex items-center gap-1.5 text-xs">
                          <span>{menu.icon}</span>
                          <span className="flex-1 text-slate-600">{menu.label}</span>
                          <select className="text-xs border rounded px-1 py-0.5 bg-white" defaultValue="none">
                            <option value="full">ç·¨é›†å¯</option>
                            <option value="readonly">é–²è¦§ã®ã¿</option>
                            <option value="none">éè¡¨ç¤º</option>
                          </select>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
          <div className="p-4 border-t flex gap-2 justify-end sticky bottom-0 bg-white">
            <button onClick={() => setShowInviteM04(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={() => { setShowInviteM04(false); toast("æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "success"); }} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
          </div>
        </div>
      </div>
    )}

    <ConfirmDialog config={actionConfirm} onClose={() => setActionConfirm(null)} />
    </div>
  );
};

// â”€â”€â”€ M04: ç”³è¾¼ãƒ»ç™»éŒ²ç®¡ç† â”€â”€â”€
const MasterMerchantApplications = () => {
  const toast = useToast();
  const nav = useNav();
  const [appConfirmDialog, setAppConfirmDialog] = useState(null);
  const [selectedApp, setSelectedApp] = useState("APP-0211-003");
  const [appStatusFilter, setAppStatusFilter] = useState("all");
  const [appTab, setAppTab] = useState("new_merchant");
  const [selectedSiteApp, setSelectedSiteApp] = useState("SADD-0212-001");
  const [siteAppStatusFilter, setSiteAppStatusFilter] = useState("all");

  const appList = [
    { id: "APP-0211-003", name: "æ ªå¼ä¼šç¤¾ãƒ†ãƒƒã‚¯ã‚·ãƒ§ãƒƒãƒ—", biz: "å®¶é›»EC", status: "AIå¯©æŸ»ä¸­", sColor: "blue", ai: "å‡¦ç†ä¸­", aColor: "blue", date: "02/11 10:15", step: 3, procStatus: null },
    { id: "APP-0211-002", name: "åˆåŒä¼šç¤¾ãƒ•ãƒ¼ãƒ‰ãƒ‡ãƒª", biz: "é£²é£Ÿãƒ‡ãƒªãƒãƒªãƒ¼", status: "äººé–“åˆ¤å®šå¾…ã¡", sColor: "yellow", ai: "æ‰¿èªæ¨è–¦", aColor: "green", date: "02/11 09:00", step: 4, procStatus: null },
    { id: "APP-0210-008", name: "æ ªå¼ä¼šç¤¾ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢Pro", biz: "å¥åº·é£Ÿå“EC", status: "äººé–“åˆ¤å®šå¾…ã¡", sColor: "yellow", ai: "è¦ç¢ºèª", aColor: "yellow", date: "02/10 16:30", step: 4, procStatus: null },
    { id: "APP-0210-007", name: "æ ªå¼ä¼šç¤¾ã‚¹ãƒãƒ¼ãƒˆã‚¦ã‚§ã‚¢", biz: "ã‚¢ãƒ‘ãƒ¬ãƒ«EC", status: "è‡ªç¤¾æ‰¿èªæ¸ˆã¿", sColor: "green", ai: "è‡ªå‹•æ‰¿èª", aColor: "green", date: "02/10 11:20", step: 5, procStatus: "æ¥ç¶šå…ˆå¯©æŸ»å¾…ã¡" },
    { id: "APP-0210-006", name: "æ ªå¼ä¼šç¤¾ãƒã‚¯ã‚¹ãƒˆã‚®ã‚¢", biz: "ã‚¹ãƒãƒ¼ãƒ„EC", status: "è‡ªç¤¾æ‰¿èªæ¸ˆã¿", sColor: "green", ai: "æ‰¿èªæ¨è–¦", aColor: "green", date: "02/10 09:45", step: 5, procStatus: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" },
    { id: "APP-0209-005", name: "æœ‰é™ä¼šç¤¾ã‚°ãƒ¬ãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆ", biz: "é›‘è²¨è²©å£²", status: "å´ä¸‹", sColor: "red", ai: "å´ä¸‹æ¨è–¦", aColor: "red", date: "02/09 14:00", step: -1, procStatus: null },
  ];

  // æ—¢å­˜åŠ ç›Ÿåº—ã‹ã‚‰ã®æ–°è¦ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ç”³è«‹
  const siteAddAppList = [
    { id: "SADD-0212-001", merchantId: "M-1001", merchantName: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", siteName: "ä¼šå“¡é™å®šã‚·ãƒ§ãƒƒãƒ—", siteUrl: "https://members.abcmart-ec.jp", genre: "ç‰©è²©EC", monthlyVol: "Â¥3M", status: "AIå¯©æŸ»ä¸­", sColor: "blue", ai: "å‡¦ç†ä¸­", aColor: "blue", date: "02/12 09:30", existingSites: 2, brands: "VISA/MC/JCB" },
    { id: "SADD-0211-003", merchantId: "M-1003", merchantName: "æ ªå¼ä¼šç¤¾ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ—ãƒ©ã‚¹", siteName: "æ–°è¦ã‚µãƒ–ã‚¹ã‚¯ã‚µã‚¤ãƒˆ", siteUrl: "https://sub.digitalplus.jp", genre: "ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³", monthlyVol: "Â¥8M", status: "äººé–“åˆ¤å®šå¾…ã¡", sColor: "yellow", ai: "è¦ç¢ºèª", aColor: "yellow", date: "02/11 14:20", existingSites: 1, brands: "VISA/MC" },
    { id: "SADD-0211-002", merchantId: "M-1005", merchantName: "åˆåŒä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒã‚¯ã‚¹ãƒˆ", siteName: "æµ·å¤–ãƒ„ã‚¢ãƒ¼äºˆç´„ã‚µã‚¤ãƒˆ", siteUrl: "https://overseas.travelnext.co.jp", genre: "æ—…è¡Œãƒ»å®¿æ³Š", monthlyVol: "Â¥15M", status: "äººé–“åˆ¤å®šå¾…ã¡", sColor: "yellow", ai: "æ‰¿èªæ¨è–¦", aColor: "green", date: "02/11 11:00", existingSites: 3, brands: "VISA/MC/JCB/AMEX" },
    { id: "SADD-0210-005", merchantId: "M-1002", merchantName: "æ ªå¼ä¼šç¤¾ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ«", siteName: "ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆEC", siteUrl: "https://outlet.fashion-mall.jp", genre: "ç‰©è²©ECï¼ˆè¡£æ–™ï¼‰", monthlyVol: "Â¥5M", status: "æ‰¿èªæ¸ˆã¿", sColor: "green", ai: "è‡ªå‹•æ‰¿èª", aColor: "green", date: "02/10 16:45", existingSites: 2, brands: "VISA/MC/JCB", procStatus: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" },
    { id: "SADD-0210-004", merchantId: "M-1008", merchantName: "æ ªå¼ä¼šç¤¾ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢Pro", siteName: "ã‚µãƒ—ãƒªå®šæœŸè³¼å…¥ã‚µã‚¤ãƒˆ", siteUrl: "", genre: "ç¾å®¹ãƒ»å¥åº·", monthlyVol: "Â¥2M", status: "æ‰¿èªæ¸ˆã¿", sColor: "green", ai: "æ‰¿èªæ¨è–¦", aColor: "green", date: "02/10 10:30", existingSites: 1, brands: "VISA/MC", procStatus: "æ¥ç¶šå…ˆå¯©æŸ»å¾…ã¡" },
    { id: "SADD-0209-003", merchantId: "M-1004", merchantName: "æœ‰é™ä¼šç¤¾ã‚°ãƒ¬ãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆ", siteName: "æ–°è¦é›‘è²¨ã‚µã‚¤ãƒˆ", siteUrl: "https://new.greymarket.jp", genre: "é›‘è²¨è²©å£²", monthlyVol: "Â¥1M", status: "å´ä¸‹", sColor: "red", ai: "å´ä¸‹æ¨è–¦", aColor: "red", date: "02/09 15:20", existingSites: 1, brands: "VISA/MC" },
  ];

  const selectedSiteAppData = siteAddAppList.find(a => a.id === selectedSiteApp);

  const selectedAppData = appList.find(a => a.id === selectedApp);

  const steps = [
    { label: "ç”³è¾¼å—ä»˜", done: true },
    { label: "æ›¸é¡ç¢ºèª", done: true },
    { label: "AIå¯©æŸ»", done: selectedApp === "APP-0211-003" ? false : true, active: selectedApp === "APP-0211-003" },
    { label: "äººé–“åˆ¤å®š", done: selectedApp === "APP-0210-007" || selectedApp === "APP-0210-006", active: selectedApp === "APP-0211-002" || selectedApp === "APP-0210-008" },
    { label: "è‡ªç¤¾æ‰¿èª", done: selectedApp === "APP-0210-007" || selectedApp === "APP-0210-006" },
  ];

  return (
    <div className="p-5 space-y-4">
      {/* ã‚¿ãƒ–åˆ‡æ›¿: æ–°è¦åŠ ç›Ÿåº—ç”³è¾¼ / æ—¢å­˜åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆè¿½åŠ  */}
      <div className="flex gap-1 border-b border-slate-200">
        {[
          { id: "new_merchant", label: "ğŸ“‹ æ–°è¦åŠ ç›Ÿåº—ç”³è¾¼", count: 6 },
          { id: "site_add", label: "ğŸŒ æ—¢å­˜åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆè¿½åŠ ", count: siteAddAppList.length },
        ].map(tab => (
          <button key={tab.id} onClick={() => setAppTab(tab.id)}
            className={`px-4 py-2 text-xs font-semibold border-b-2 transition-colors ${appTab === tab.id ? "border-blue-500 text-blue-600 bg-blue-50/50" : "border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50"}`}>
            {tab.label} <span className="ml-1 text-slate-400">({tab.count})</span>
          </button>
        ))}
      </div>

      {appTab === "new_merchant" && (<>
      <div className="flex justify-between items-center">
        <h2 className="text-sm font-bold text-slate-800">åŠ ç›Ÿåº— ç”³è¾¼ãƒ»ç™»éŒ²ç®¡ç† <span className="text-xs text-slate-400 font-normal ml-2">â€»è‡ªç¤¾å¯©æŸ»ã®ã¿ç®¡ç†ã€‚æ¥ç¶šå…ˆå¯©æŸ»ã¯ã€ŒğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã€ã§ç®¡ç†</span></h2>
        <div className="flex gap-2">
          {[{ k: "all", label: "å…¨ã¦ (12)" }, { k: "ai", label: "AIå¯©æŸ»ä¸­ (3)" }, { k: "human", label: "äººé–“åˆ¤å®šå¾…ã¡ (2)" }, { k: "approved", label: "è‡ªç¤¾æ‰¿èªæ¸ˆã¿ (5)" }, { k: "rejected", label: "å´ä¸‹ (2)" }].map(f => (
            <button key={f.k} onClick={() => setAppStatusFilter(f.k)} className={`text-xs px-2 py-1 rounded border ${appStatusFilter === f.k ? "bg-blue-50 text-blue-600 border-blue-200" : "bg-white text-slate-500"}`}>{f.label}</button>
          ))}
        </div>
      </div>

      {/* Scope Diagram */}
      <div className="bg-gradient-to-r from-blue-50 via-white to-gray-50 rounded-lg border p-3">
        <p className="text-xs font-bold text-slate-600 mb-2">ğŸ“‹ å¯©æŸ»ãƒ•ãƒ­ãƒ¼å…¨ä½“åƒï¼ˆã“ã®ç”»é¢ã®ç®¡è½„ç¯„å›²ï¼‰</p>
        <div className="flex items-center gap-1 text-xs">
          <div className="bg-blue-100 border-2 border-blue-400 rounded-lg px-3 py-2 text-center">
            <p className="font-bold text-blue-700">ã“ã®ç”»é¢ã§ç®¡ç†</p>
            <p className="text-blue-500 mt-1">ç”³è¾¼å—ä»˜ â†’ æ›¸é¡ç¢ºèª â†’ AIå¯©æŸ» â†’ äººé–“åˆ¤å®š â†’ <span className="font-bold">è‡ªç¤¾æ‰¿èª</span></p>
          </div>
          <span className="text-2xl text-slate-300 mx-1">â†’</span>
          <div className="bg-slate-100 border border-slate-300 rounded-lg px-3 py-2 text-center">
            <p className="font-semibold text-slate-500">ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã§ç®¡ç†</p>
            <p className="text-slate-400 mt-1">å¯©æŸ»ç”³è«‹ â†’ æ›¸é¡é€ä»˜ â†’ å¯©æŸ» â†’ <span className="font-semibold text-slate-500">æ¡ä»¶ç¢ºå®š â†’ å¥‘ç´„ â†’ æ±ºæ¸ˆé–‹å§‹</span></p>
          </div>
        </div>
      </div>

      {/* Pipeline KPIs */}
      <div className="flex gap-3">
        <KPICard label="ä»Šæœˆã®ç”³è¾¼æ•°" value="12ä»¶" sub="å‰æœˆæ¯”" trend={20} />
        <KPICard label="AIè‡ªå‹•æ‰¿èªç‡" value="58.3%" sub="ç›®æ¨™: 70%" color="blue" />
        <KPICard label="å¹³å‡å¯©æŸ»æ™‚é–“" value="2.4æ™‚é–“" sub="AIè¾¼ã¿" color="green" />
        <KPICard label="å´ä¸‹ç‡" value="16.7%" sub="æ¥­ç•Œå¹³å‡: 25%" color="green" />
      </div>

      {/* Confirmation Dialog */}
      {appConfirmDialog && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setAppConfirmDialog(null)}>
          <div className="bg-white rounded-xl shadow-2xl w-[520px] max-w-[90vw]" onClick={e => e.stopPropagation()}>
            <div className={`p-4 rounded-t-xl border-b ${
              appConfirmDialog.type === "approve" ? "bg-emerald-50" :
              appConfirmDialog.type === "reject" ? "bg-rose-50" :
              appConfirmDialog.type === "start_proc_review" ? "bg-purple-50" :
              "bg-blue-50"
            }`}>
              <div className="flex items-center gap-2">
                <span className="text-lg">{appConfirmDialog.icon}</span>
                <h3 className="text-sm font-bold text-slate-800">{appConfirmDialog.title}</h3>
              </div>
            </div>
            <div className="p-5 space-y-4">
              <p className="text-xs text-slate-600">{appConfirmDialog.description}</p>
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-3 space-y-1">
                <div className="flex text-xs"><span className="w-24 text-slate-400">ç”³è¾¼ID:</span><span className="font-mono text-slate-700">{appConfirmDialog.appId}</span></div>
                <div className="flex text-xs"><span className="w-24 text-slate-400">æ³•äººå:</span><span className="font-semibold text-slate-700">{appConfirmDialog.merchantName}</span></div>
                {appConfirmDialog.processorName && (
                  <div className="flex text-xs"><span className="w-24 text-slate-400">åˆæœŸæ¥ç¶šå…ˆ:</span><span className="font-semibold text-blue-600">{appConfirmDialog.processorName}</span></div>
                )}
              </div>
              {appConfirmDialog.impacts && (
                <div className={`rounded border p-2 ${appConfirmDialog.type === "reject" ? "bg-rose-50 border-rose-200" : "bg-blue-50 border-blue-200"}`}>
                  <p className="text-xs font-semibold mb-1" style={{color: appConfirmDialog.type === "reject" ? "#b91c1c" : "#1d4ed8"}}>ã“ã®æ“ä½œã®å½±éŸ¿:</p>
                  <ul className="space-y-0.5">
                    {appConfirmDialog.impacts.map((imp, i) => (
                      <li key={i} className="text-xs flex items-center gap-1" style={{color: appConfirmDialog.type === "reject" ? "#dc2626" : "#2563eb"}}>
                        <span>â†’</span> {imp}
                      </li>
                    ))}
                  </ul>
                </div>
              )}
              {appConfirmDialog.type === "reject" && (
                <div>
                  <p className="text-xs font-semibold text-slate-600 mb-1">å´ä¸‹ç†ç”±ï¼ˆå¿…é ˆï¼‰:</p>
                  <textarea className="w-full border rounded p-2 text-xs h-16" placeholder="å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." />
                </div>
              )}
              {appConfirmDialog.type === "start_proc_review" && (
                <div>
                  <p className="text-xs font-semibold text-slate-600 mb-1">åˆæœŸæ¥ç¶šå…ˆã®é¸æŠ:</p>
                  <select className="w-full border rounded p-2 text-xs">
                    <option>Simpletransactï¼ˆæ¨å¥¨ â€” å¯©æŸ»æœ€é€Ÿ å¹³å‡7æ—¥ï¼‰</option>
                    <option>Univa Pay castï¼ˆå¯©æŸ» å¹³å‡10æ—¥ï¼‰</option>
                    <option>æ¥½å¤©éŠ€è¡Œï¼ˆå¯©æŸ» å¹³å‡12æ—¥ï¼‰</option>
                    <option>TCMSï¼ˆå¯©æŸ» å¹³å‡21æ—¥ï¼‰</option>
                  </select>
                  <p className="text-xs text-slate-400 mt-1">ğŸ’¡ AIã®æ¨è–¦: Simpletransactã‚’åˆæœŸæ¥ç¶šå…ˆã¨ã—ã¦é–‹å§‹ã—ã€å–å¼•å®Ÿç¸¾ã‚’ç©ã‚“ã å¾Œã«ç›´æ¥æ¥ç¶šã‚’è¿½åŠ ã™ã‚‹ã®ãŒæœ€é€Ÿã§ã™ã€‚</p>
                </div>
              )}
              {appConfirmDialog.type !== "reject" && appConfirmDialog.type !== "start_proc_review" && (
                <div>
                  <p className="text-xs font-semibold text-slate-600 mb-1">å‚™è€ƒï¼ˆä»»æ„ï¼‰:</p>
                  <input className="w-full border rounded p-2 text-xs" placeholder="æ“ä½œã«é–¢ã™ã‚‹ãƒ¡ãƒ¢ã‚’å…¥åŠ›..." />
                </div>
              )}
            </div>
            <div className="flex justify-end gap-2 p-4 border-t bg-slate-50 rounded-b-xl">
              <button onClick={() => setAppConfirmDialog(null)} className="px-4 py-2 bg-white text-slate-600 rounded border text-xs font-semibold hover:bg-slate-100">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { const d = appConfirmDialog; setAppConfirmDialog(null); const msgs = { approve: ["æ‰¿èªã—ã¾ã—ãŸ", "success"], reject: ["å´ä¸‹ã—ã¾ã—ãŸ", "warning"], start_proc_review: ["æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹å§‹ã—ã¾ã—ãŸ", "success"], reapply: ["å†ç”³è¾¼ã‚’è¨±å¯ã—ã¾ã—ãŸ", "info"] }; const [msg, type] = msgs[d.type] || ["å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ", "success"]; toast(`${d.appId} ã‚’${msg}`, type); }} className={`px-4 py-2 rounded text-white text-xs font-semibold ${
                appConfirmDialog.type === "approve" ? "bg-emerald-600 hover:bg-emerald-700" :
                appConfirmDialog.type === "reject" ? "bg-rose-600 hover:bg-rose-700" :
                appConfirmDialog.type === "start_proc_review" ? "bg-purple-600 hover:bg-purple-700" :
                "bg-blue-600 hover:bg-blue-700"
              }`}>{appConfirmDialog.confirmLabel}</button>
            </div>
          </div>
        </div>
      )}

      {/* Application Detail */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm">
        <div className={`p-3 border-b ${
          selectedAppData?.status === "è‡ªç¤¾æ‰¿èªæ¸ˆã¿" ? "bg-emerald-50" :
          selectedAppData?.status === "äººé–“åˆ¤å®šå¾…ã¡" ? "bg-amber-50" :
          selectedAppData?.status === "å´ä¸‹" ? "bg-rose-50" :
          "bg-blue-50"
        }`}>
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-2">
              <Badge text={selectedAppData?.status || ""} color={selectedAppData?.sColor || "gray"} />
              <span className="text-sm font-bold text-slate-800">{selectedApp} - {selectedAppData?.name}</span>
            </div>
            <span className="text-xs text-slate-400">ç”³è¾¼æ—¥: {selectedAppData?.date}</span>
          </div>
        </div>
        <div className="p-3">
          {/* Progress Steps */}
          <div className="flex items-center gap-1 mb-3">
            {steps.map((s, i) => (
              <div key={i} className="flex items-center gap-1 flex-1">
                <div className={`w-5 h-5 rounded-full flex items-center justify-center text-xs ${s.done ? "bg-emerald-500 text-white" : s.active ? "bg-blue-500 text-white animate-pulse" : "bg-slate-200 text-slate-400"}`}>
                  {s.done ? "âœ“" : s.active ? "âŸ³" : i + 1}
                </div>
                <span className={`text-xs ${s.done ? "text-emerald-700" : s.active ? "text-blue-700 font-semibold" : "text-slate-400"} ${i === 4 ? "font-bold" : ""}`}>{s.label}</span>
                {i < 4 && <div className={`flex-1 h-0.5 ${s.done ? "bg-emerald-300" : "bg-slate-200"}`} />}
              </div>
            ))}
          </div>

          {/* Step Action Buttons (Human-in-the-Loop) */}
          <div className="flex items-center gap-2 mb-3 p-2 bg-slate-50 rounded-lg border">
            <span className="text-xs text-slate-500">æ“ä½œ:</span>
            {/* äººé–“åˆ¤å®šå¾…ã¡ã®å ´åˆ */}
            {selectedAppData?.status === "äººé–“åˆ¤å®šå¾…ã¡" && (
              <>
                <button onClick={() => setAppConfirmDialog({
                  type: "approve", icon: "âœ…", title: "è‡ªç¤¾æ‰¿èª â€” åŠ ç›Ÿåº—ã‚’æ‰¿èª", appId: selectedApp, merchantName: selectedAppData.name,
                  description: "AIå¯©æŸ»çµæœã‚’ç¢ºèªã®ä¸Šã€ã“ã®åŠ ç›Ÿåº—ã‚’è‡ªç¤¾æ‰¿èªã—ã¾ã™ã€‚æ‰¿èªå¾Œã€æ¥ç¶šå…ˆå¯©æŸ»ã®é–‹å§‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚",
                  impacts: ["åŠ ç›Ÿåº—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œè‡ªç¤¾æ‰¿èªæ¸ˆã¿ã€ã«å¤‰æ›´", "åŠ ç›Ÿåº—ãƒã‚¹ã‚¿ãƒ¼ã«ç™»éŒ²ã•ã‚Œã‚‹", "æ¥ç¶šå…ˆå¯©æŸ»ã®é–‹å§‹ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã‚‹", "ğŸ“§ åŠ ç›Ÿåº—æ‹…å½“è€…ã«æ‰¿èªé€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: approval_notificationï¼‰", "ğŸ“§ æ‹…å½“ä»£ç†åº—ã«ã‚‚æ‰¿èªé€šçŸ¥ã‚’é€ä¿¡ï¼ˆä»£ç†åº—ç´ä»˜ãŒã‚ã‚‹å ´åˆï¼‰", "â€»å¥‘ç´„æ›¸ã¯æ¥ç¶šå…ˆå¯©æŸ»å®Œäº†ãƒ»æ¡ä»¶ç¢ºå®šå¾Œã«ç”Ÿæˆã•ã‚Œã¾ã™"],
                  confirmLabel: "âœ… è‡ªç¤¾æ‰¿èªã™ã‚‹"
                })} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700 shadow-sm">âœ… æ‰¿èª</button>
                <button onClick={() => setAppConfirmDialog({
                  type: "reject", icon: "âŒ", title: "ç”³è¾¼å´ä¸‹", appId: selectedApp, merchantName: selectedAppData.name,
                  description: "ã“ã®åŠ ç›Ÿåº—ã®ç”³è¾¼ã‚’å´ä¸‹ã—ã¾ã™ã€‚å´ä¸‹ç†ç”±ã¯åŠ ç›Ÿåº—ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚",
                  impacts: ["åŠ ç›Ÿåº—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œå´ä¸‹ã€ã«å¤‰æ›´", "ğŸ“§ åŠ ç›Ÿåº—æ‹…å½“è€…ã«å´ä¸‹é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: rejection_notificationï¼‰", "ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã«å´ä¸‹ç†ç”±ãŒè¨˜è¼‰ã•ã‚Œã‚‹ï¼ˆä¸‹è¨˜ã§å…¥åŠ›ï¼‰", "å†ç”³è«‹ã«ã¯æ–°è¦ã®ç”³è¾¼ãŒå¿…è¦"],
                  confirmLabel: "âŒ å´ä¸‹ã™ã‚‹"
                })} className="px-3 py-1.5 bg-white text-rose-600 border border-rose-300 rounded text-xs font-semibold hover:bg-rose-50">âŒ å´ä¸‹</button>
                <button onClick={() => toast(`${selectedApp} ã®AIå†å¯©æŸ»ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã—ãŸ`, "info")} className="px-3 py-1.5 bg-white text-slate-600 border rounded text-xs hover:bg-slate-100">â†© AIå†å¯©æŸ»ã‚’ä¾é ¼</button>
              </>
            )}
            {/* AIå¯©æŸ»ä¸­ã®å ´åˆ â€” ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆ5æ®µéšï¼‰ */}
            {selectedAppData?.status === "AIå¯©æŸ»ä¸­" && (
              <div className="bg-blue-50 rounded-lg border border-blue-200 p-3 w-full">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-xs font-bold text-blue-700">ğŸ¤– AIå¯©æŸ»ã‚’å®Ÿè¡Œä¸­...</span>
                  <span className="text-xs text-blue-500">3/5 ã‚¹ãƒ†ãƒƒãƒ—å®Œäº† â€” 60%</span>
                </div>
                <div className="w-full bg-blue-200 rounded-full h-2 mb-2">
                  <div className="bg-blue-600 h-2 rounded-full transition-all" style={{ width: "60%" }} />
                </div>
                <div className="space-y-1.5 text-xs">
                  <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> åç¤¾ãƒã‚§ãƒƒã‚¯... å®Œäº† <span className="text-slate-400 ml-auto">5ç§’</span></div>
                  <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> è²¡å‹™åˆ†æ... å®Œäº† <span className="text-slate-400 ml-auto">8ç§’</span></div>
                  <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> ã‚µã‚¤ãƒˆåˆ†æ... å®Œäº† <span className="text-slate-400 ml-auto">25ç§’</span></div>
                  <div className="flex items-center gap-2"><span className="text-blue-500 animate-pulse">ğŸ”„</span> ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ç®—å‡º... å®Ÿè¡Œä¸­</div>
                  <div className="flex items-center gap-2"><span className="text-slate-300">â³</span> ç·åˆåˆ¤å®š... å¾…æ©Ÿä¸­</div>
                </div>
                <p className="text-xs text-slate-400 mt-2">â€» é€šå¸¸30ç§’ã€œ2åˆ†ã§å®Œäº†ã€‚3åˆ†è¶…éã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ</p>
              </div>
            )}
            {/* è‡ªç¤¾æ‰¿èªæ¸ˆã¿ã®å ´åˆ â†’ æ¥ç¶šå…ˆå¯©æŸ»é–‹å§‹ãƒœã‚¿ãƒ³ */}
            {selectedAppData?.status === "è‡ªç¤¾æ‰¿èªæ¸ˆã¿" && selectedAppData?.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»å¾…ã¡" && (
              <>
                <button onClick={() => setAppConfirmDialog({
                  type: "start_proc_review", icon: "ğŸ”Œ", title: "æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹å§‹", appId: selectedApp, merchantName: selectedAppData.name,
                  description: "è‡ªç¤¾æ‰¿èªãŒå®Œäº†ã—ã¾ã—ãŸã€‚åˆæœŸæ¥ç¶šå…ˆã‚’é¸æŠã—ã¦å¯©æŸ»ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚å¯©æŸ»ã«å¿…è¦ãªæ›¸é¡ã¯ç”³è¾¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚",
                  impacts: [
                    "é¸æŠã—ãŸæ¥ç¶šå…ˆã«å¯©æŸ»ç”³è«‹ãŒé€ä¿¡ã•ã‚Œã‚‹",
                    "ç”³è¾¼æ™‚ã®æ›¸é¡ï¼ˆç™»è¨˜ç°¿ãƒ»æœ¬äººç¢ºèªãƒ»æ±ºç®—æ›¸ç­‰ï¼‰ãŒå¯©æŸ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦è»¢é€ã•ã‚Œã‚‹",
                    "æ¥ç¶šå…ˆå¯©æŸ»ç”»é¢ã®ã€Œå¯©æŸ»ãƒ•ãƒ­ãƒ¼ç®¡ç†ã€ã‚¿ãƒ–ã«æ¡ˆä»¶ãŒè¿½åŠ ã•ã‚Œã‚‹",
                    "ä»¥é™ã®å¯©æŸ»é€²æ—ã¯ã€ŒğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã€ç”»é¢ã§ç®¡ç†"
                  ],
                  processorName: "Simpletransactï¼ˆAIæ¨è–¦ï¼‰",
                  confirmLabel: "ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹å§‹"
                })} className="px-3 py-1.5 bg-purple-600 text-white rounded text-xs font-bold hover:bg-purple-700 shadow-sm ring-2 ring-purple-300 ring-offset-1">ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹å§‹</button>
                <span className="text-xs text-slate-400 ml-1">â†’ æ¥ç¶šå…ˆå¯©æŸ»ç”»é¢ã«å¯©æŸ»æ¡ˆä»¶ãŒä½œæˆã•ã‚Œã¾ã™</span>
              </>
            )}
            {selectedAppData?.status === "è‡ªç¤¾æ‰¿èªæ¸ˆã¿" && selectedAppData?.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" && (
              <div className="flex items-center gap-2">
                <Badge text="æ¥ç¶šå…ˆå¯©æŸ»ä¸­" color="blue" />
                <span className="text-xs text-slate-500">æ¥ç¶šå…ˆå¯©æŸ»ã¯ã€ŒğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã€ç”»é¢ã§é€²è¡Œä¸­ã§ã™ â†’</span>
                <button onClick={() => { if (nav.setMasterPage) nav.setMasterPage("processorReview"); toast("æ¥ç¶šå…ˆå¯©æŸ»ç”»é¢ã«ç§»å‹•ã—ã¾ã™", "info"); }} className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs border border-blue-200 font-semibold hover:bg-blue-200">ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹ã</button>
              </div>
            )}
            {selectedAppData?.status === "å´ä¸‹" && (
              <div className="flex items-center gap-3">
                <span className="text-xs text-rose-500">ã“ã®ç”³è¾¼ã¯å´ä¸‹ã•ã‚Œã¦ã„ã¾ã™</span>
                <button onClick={() => setAppConfirmDialog({
                  type: "reapply", icon: "ğŸ”„", title: "å†ç”³è¾¼ã‚’è¨±å¯",
                  appId: selectedApp, merchantName: selectedAppData.name,
                  description: "ã“ã®ç”³è¾¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ã„ã§å†ç”³è¾¼ã‚’è¨±å¯ã—ã¾ã™ã‹ï¼ŸåŠ ç›Ÿåº—ã«å†ç”³è¾¼ãƒªãƒ³ã‚¯ãŒãƒ¡ãƒ¼ãƒ«é€ä¿¡ã•ã‚Œã¾ã™ã€‚",
                  impacts: ["ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆP01ï¼‰ã«æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒãƒ—ãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸçŠ¶æ…‹ã§å†ç”³è¾¼ãƒªãƒ³ã‚¯ãŒç”Ÿæˆ", "åŠ ç›Ÿåº—æ‹…å½“è€…ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥"],
                  confirmLabel: "ğŸ”„ å†ç”³è¾¼ã‚’è¨±å¯ã™ã‚‹"
                })} className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold hover:bg-blue-200 border border-blue-200">ğŸ”„ å†ç”³è¾¼ã‚’è¨±å¯</button>
              </div>
            )}
          </div>

          {/* Info Grid */}
          <div className="grid grid-cols-3 gap-4 mb-3">
            <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
              <p className="text-xs font-bold text-slate-600 mb-1">ç”³è¾¼ä¼æ¥­æƒ…å ±</p>
              <div className="text-xs space-y-1 text-slate-600">
                <div>æ³•äººå: æ ªå¼ä¼šç¤¾ãƒ†ãƒƒã‚¯ã‚·ãƒ§ãƒƒãƒ—</div>
                <div>ä»£è¡¨è€…: ä½ã€…æœ¨ å¥ä¸€</div>
                <div>è¨­ç«‹: 2022å¹´8æœˆ</div>
                <div>è³‡æœ¬é‡‘: Â¥5,000,000</div>
                <div>æ¥­ç¨®: å®¶é›»ãƒ»ã‚¬ã‚¸ã‚§ãƒƒãƒˆEC</div>
              </div>
            </div>
            <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
              <p className="text-xs font-bold text-slate-600 mb-1">ç”³è¾¼å†…å®¹</p>
              <div className="text-xs space-y-1 text-slate-600">
                <div>å¸Œæœ›æ±ºæ¸ˆ: VISA / MC / JCB</div>
                <div>æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜: Â¥5M</div>
                <div>å¹³å‡å˜ä¾¡: Â¥15,000</div>
                <div>ã‚µã‚¤ãƒˆURL: techshop.jp</div>
                <div>æå‡ºæ›¸é¡: 5/5 å®Œäº† âœ…</div>
              </div>
            </div>
            <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
              <p className="text-xs font-bold text-slate-600 mb-1">AIå¯©æŸ»é€²æ—ï¼ˆè‡ªç¤¾å¯©æŸ»ï¼‰</p>
              <div className="text-xs space-y-1.5">
                <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> åç¤¾ãƒã‚§ãƒƒã‚¯: ã‚¯ãƒªã‚¢</div>
                <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> ã‚µã‚¤ãƒˆå†…å®¹ç¢ºèª: å•é¡Œãªã—</div>
                <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> æ±ºç®—æ›¸è§£æ: è²¡å‹™å¥å…¨</div>
                <div className="flex items-center gap-2"><span className="text-blue-500 animate-pulse">âŸ³</span> æ¥­ç•Œãƒªã‚¹ã‚¯è©•ä¾¡: å‡¦ç†ä¸­...</div>
                <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> ç·åˆåˆ¤å®š: å¾…æ©Ÿä¸­</div>
              </div>
            </div>
          </div>

          {/* Post-approval: æ¥ç¶šå…ˆå¯©æŸ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚µãƒãƒªãƒ¼ */}
          {selectedAppData?.status === "è‡ªç¤¾æ‰¿èªæ¸ˆã¿" && (
            <div className="bg-gradient-to-r from-emerald-50 to-blue-50 rounded-lg border border-emerald-200 p-3">
              <div className="flex items-center justify-between mb-1">
                <p className="text-xs font-bold text-emerald-700">âœ… è‡ªç¤¾å¯©æŸ»å®Œäº† â†’ æ¥ç¶šå…ˆå¯©æŸ»ãƒ•ã‚§ãƒ¼ã‚º</p>
                {selectedAppData.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" && <Badge text="æ¥ç¶šå…ˆå¯©æŸ»ä¸­" color="blue" />}
                {selectedAppData.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»å¾…ã¡" && <Badge text="æ¥ç¶šå…ˆå¯©æŸ»æœªé–‹å§‹" color="yellow" />}
              </div>
              <div className="flex gap-4 text-xs text-slate-600">
                <div><span className="text-slate-400">è‡ªç¤¾æ‰¿èªæ—¥:</span> 2026-02-10</div>
                <div><span className="text-slate-400">æ‰¿èªè€…:</span> admin@aipaymentsys.com</div>
                <div><span className="text-slate-400">AIåˆ¤å®š:</span> <span className="text-emerald-600 font-semibold">æ‰¿èªæ¨è–¦ï¼ˆä¿¡é ¼åº¦92%ï¼‰</span></div>
                {selectedAppData.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" && (
                  <div><span className="text-slate-400">åˆæœŸæ¥ç¶šå…ˆ:</span> <span className="text-blue-600 font-semibold">Simpletransactï¼ˆå¯©æŸ»ä¸­ â€” 3æ—¥çµŒéï¼‰</span></div>
                )}
              </div>
            </div>
          )}

          {/* ãƒ¡ãƒ¼ãƒ«é€šçŸ¥å±¥æ­´ */}
          <div className="bg-white rounded-lg border border-slate-200 p-3 mt-3">
            <div className="flex items-center justify-between mb-2">
              <p className="text-xs font-bold text-slate-600">ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€šçŸ¥å±¥æ­´</p>
              <button onClick={() => toast("é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã‚’æ‰‹å‹•å†é€ã—ã¾ã—ãŸ", "success")} className="text-xs text-blue-600 hover:underline">æ‰‹å‹•å†é€</button>
            </div>
            <div className="space-y-1.5 text-xs">
              {[
                { date: "02/14 10:30", template: "ç”³è¾¼å—ä»˜ç¢ºèª", to: `${selectedAppData?.name || ""} æ‹…å½“è€…`, status: "é€ä¿¡æ¸ˆã¿", stc: "green" },
                ...(selectedAppData?.status !== "AIå¯©æŸ»ä¸­" ? [{ date: "02/14 10:31", template: "AIå¯©æŸ»å®Œäº†é€šçŸ¥ï¼ˆç¤¾å†…ï¼‰", to: "admin@aipaymentsys.com", status: "é€ä¿¡æ¸ˆã¿", stc: "green" }] : []),
                ...(selectedAppData?.status === "è‡ªç¤¾æ‰¿èªæ¸ˆã¿" ? [
                  { date: "02/14 14:20", template: "è‡ªç¤¾æ‰¿èªé€šçŸ¥", to: `${selectedAppData?.name || ""} æ‹…å½“è€…`, status: "é€ä¿¡æ¸ˆã¿", stc: "green" },
                  { date: "02/14 14:20", template: "æ‰¿èªé€šçŸ¥ï¼ˆä»£ç†åº—ï¼‰", to: "ä»£ç†åº—æ‹…å½“è€…", status: "é€ä¿¡æ¸ˆã¿", stc: "green" },
                ] : []),
                ...(selectedAppData?.status === "å´ä¸‹" ? [
                  { date: "02/14 14:20", template: "ç”³è¾¼å´ä¸‹é€šçŸ¥", to: `${selectedAppData?.name || ""} æ‹…å½“è€…`, status: "é€ä¿¡æ¸ˆã¿", stc: "green" },
                ] : []),
              ].map((n, i) => (
                <div key={i} className="flex items-center py-1 border-b last:border-0">
                  <div className="w-28 text-slate-400">{n.date}</div>
                  <div className="w-40 font-semibold text-slate-700">{n.template}</div>
                  <div className="flex-1 text-slate-500">{n.to}</div>
                  <div><Badge text={n.status} color={n.stc} /></div>
                </div>
              ))}
            </div>
            <div className="mt-2 bg-slate-50 rounded p-2 text-xs text-slate-500">
              <p className="font-semibold text-slate-600 mb-1">ğŸ“‹ ãƒ¡ãƒ¼ãƒ«é…ä¿¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§</p>
              <div className="grid grid-cols-2 gap-1">
                {[
                  ["ç”³è¾¼å—ä»˜ç¢ºèª", "ç”³è¾¼æ™‚ã«è‡ªå‹•é€ä¿¡"],
                  ["AIå¯©æŸ»å®Œäº†ï¼ˆç¤¾å†…ï¼‰", "å¯©æŸ»å®Œäº†æ™‚ã«ç®¡ç†è€…ã¸"],
                  ["è‡ªç¤¾æ‰¿èªé€šçŸ¥", "æ‰¿èªæ“ä½œå¾Œã«åŠ ç›Ÿåº—ã¸"],
                  ["å´ä¸‹é€šçŸ¥", "å´ä¸‹æ“ä½œå¾Œã«åŠ ç›Ÿåº—ã¸ï¼ˆç†ç”±ä»˜ãï¼‰"],
                  ["æ¥ç¶šå…ˆå¯©æŸ»é–‹å§‹é€šçŸ¥", "æ¥ç¶šå…ˆå¯©æŸ»é–‹å§‹æ™‚"],
                  ["å¥‘ç´„æ›¸é€ä»˜", "å…¨å¯©æŸ»å®Œäº†ãƒ»æ¡ä»¶ç¢ºå®šå¾Œ"],
                  ["å†ç”³è¾¼è¨±å¯é€šçŸ¥", "å†ç”³è¾¼è¨±å¯æ™‚ã«åŠ ç›Ÿåº—ã¸"],
                  ["ä»£ç†åº—é€šçŸ¥", "å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´æ™‚ã«ä»£ç†åº—ã¸"],
                ].map(([name, desc], i) => (
                  <div key={i} className="flex gap-1"><span className="text-blue-600">â€¢</span><span className="font-semibold">{name}</span><span className="text-slate-400">â€” {desc}</span></div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Applications List */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
        <TableHeader cols={[{ label: "ç”³è¾¼ID", w: "w-36" }, { label: "æ³•äººå", w: "flex-1" }, { label: "æ¥­ç¨®", w: "w-24" }, { label: "è‡ªç¤¾å¯©æŸ»", w: "w-24" }, { label: "AIåˆ¤å®š", w: "w-24" }, { label: "æ¥ç¶šå…ˆå¯©æŸ»", w: "w-28" }, { label: "ç”³è¾¼æ—¥", w: "w-24" }, { label: "æ“ä½œ", w: "w-20" }]}>
        {appList.map((a, i) => (
          <tr key={i} className={`border-b cursor-pointer transition-colors ${selectedApp === a.id ? "bg-blue-50 border-l-2 border-l-blue-500" : i % 2 ? "bg-slate-50 hover:bg-blue-50" : "hover:bg-blue-50"}`}
               onClick={() => setSelectedApp(a.id)}>
            <td className="px-4 py-2 whitespace-nowrap w-36 font-mono text-slate-500">{a.id}</td>
            <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{a.name}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-500">{a.biz}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24"><Badge text={a.status} color={a.sColor} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-24"><Badge text={a.ai} color={a.aColor} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-28">
              {a.procStatus ? <Badge text={a.procStatus} color={a.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" ? "blue" : "yellow"} /> : <span className="text-slate-300">â€”</span>}
            </td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400">{a.date}</td>
            <td className="px-4 py-2 whitespace-nowrap w-20"><button onClick={(e) => { e.stopPropagation(); setSelectedApp(a.id); }} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">è©³ç´°</button></td>
          </tr>
        ))}
        </TableHeader>
      </div>
      </>)}

      {/* ====== æ—¢å­˜åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ã‚¿ãƒ– ====== */}
      {appTab === "site_add" && (<>
      <div className="flex justify-between items-center">
        <h2 className="text-sm font-bold text-slate-800">æ—¢å­˜åŠ ç›Ÿåº— ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ» <span className="text-xs text-slate-400 font-normal ml-2">â€»æ—¢å­˜åŠ ç›Ÿåº—ãŒæ–°ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã™ã‚‹éš›ã®å¯©æŸ»ã‚’ç®¡ç†</span></h2>
        <div className="flex gap-2">
          {[{ k: "all", label: `å…¨ã¦ (${siteAddAppList.length})` }, { k: "ai", label: "AIå¯©æŸ»ä¸­" }, { k: "human", label: "äººé–“åˆ¤å®šå¾…ã¡" }, { k: "approved", label: "æ‰¿èªæ¸ˆã¿" }, { k: "rejected", label: "å´ä¸‹" }].map(f => (
            <button key={f.k} onClick={() => setSiteAppStatusFilter(f.k)} className={`text-xs px-2 py-1 rounded border ${siteAppStatusFilter === f.k ? "bg-teal-50 text-teal-600 border-teal-200" : "bg-white text-slate-500"}`}>{f.label}</button>
          ))}
        </div>
      </div>

      {/* ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ãƒ•ãƒ­ãƒ¼å›³ */}
      <div className="bg-gradient-to-r from-teal-50 via-white to-gray-50 rounded-lg border p-3">
        <p className="text-xs font-bold text-slate-600 mb-2">ğŸŒ æ—¢å­˜åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ãƒ•ãƒ­ãƒ¼ï¼ˆæ–°è¦åŠ ç›Ÿåº—å¯©æŸ»ã¨ã®é•ã„ï¼‰</p>
        <div className="flex items-center gap-1 text-xs">
          <div className="bg-slate-100 border border-slate-300 rounded-lg px-3 py-2 text-center">
            <p className="text-slate-500">ã‚¹ã‚­ãƒƒãƒ—</p>
            <p className="text-slate-400 mt-1 line-through">åç¤¾ãƒã‚§ãƒƒã‚¯ãƒ»è²¡å‹™åˆ†æ</p>
            <p className="text-[10px] text-slate-400">ï¼ˆåŠ ç›Ÿåº—ç™»éŒ²æ™‚ã«å®Ÿæ–½æ¸ˆã¿ï¼‰</p>
          </div>
          <span className="text-2xl text-slate-300 mx-1">â†’</span>
          <div className="bg-teal-100 border-2 border-teal-400 rounded-lg px-3 py-2 text-center">
            <p className="font-bold text-teal-700">ã“ã®ç”»é¢ã§ç®¡ç†</p>
            <p className="text-teal-600 mt-1">ã‚µã‚¤ãƒˆç”³è«‹å—ä»˜ â†’ AI<span className="font-semibold">ã‚µã‚¤ãƒˆå¯©æŸ»</span> â†’ äººé–“åˆ¤å®š â†’ <span className="font-bold">æ‰¿èª</span></p>
          </div>
          <span className="text-2xl text-slate-300 mx-1">â†’</span>
          <div className="bg-slate-100 border border-slate-300 rounded-lg px-3 py-2 text-center">
            <p className="font-semibold text-slate-500">ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã§ç®¡ç†</p>
            <p className="text-slate-400 mt-1">æ¥ç¶šå…ˆé¸å®š â†’ æ¡ä»¶ç¢ºå®š â†’ æ±ºæ¸ˆé–‹å§‹</p>
          </div>
        </div>
      </div>

      {/* ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ» KPI */}
      <div className="flex gap-3">
        <KPICard label="ä»Šæœˆã®ã‚µã‚¤ãƒˆè¿½åŠ ç”³è«‹" value={`${siteAddAppList.length}ä»¶`} sub="å‰æœˆæ¯”" trend={15} />
        <KPICard label="AIè‡ªå‹•æ‰¿èªç‡" value="50.0%" sub="ã‚µã‚¤ãƒˆå¯©æŸ»ç‰¹åŒ–" color="blue" />
        <KPICard label="å¹³å‡å¯©æŸ»æ™‚é–“" value="1.2æ™‚é–“" sub="åç¤¾ãƒ»è²¡å‹™ã‚¹ã‚­ãƒƒãƒ—" color="green" />
        <KPICard label="å´ä¸‹ç‡" value="16.7%" sub="ã‚µã‚¤ãƒˆå†…å®¹ä¸é©åˆ" color="yellow" />
      </div>

      {/* ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ» è©³ç´°ãƒ‘ãƒãƒ« */}
      {selectedSiteAppData && (
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm">
        <div className={`p-3 border-b ${
          selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿" ? "bg-emerald-50" :
          selectedSiteAppData.status === "äººé–“åˆ¤å®šå¾…ã¡" ? "bg-amber-50" :
          selectedSiteAppData.status === "å´ä¸‹" ? "bg-rose-50" :
          "bg-teal-50"
        }`}>
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-2">
              <Badge text="ã‚µã‚¤ãƒˆè¿½åŠ " color="teal" />
              <Badge text={selectedSiteAppData.status} color={selectedSiteAppData.sColor} />
              <span className="text-sm font-bold text-slate-800">{selectedSiteAppData.id} â€” {selectedSiteAppData.siteName}</span>
            </div>
            <span className="text-xs text-slate-400">ç”³è«‹æ—¥: {selectedSiteAppData.date}</span>
          </div>
        </div>
        <div className="p-3">
          {/* å¯©æŸ»ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆã‚µã‚¤ãƒˆè¿½åŠ ç”¨ï¼šç°¡ç•¥ç‰ˆï¼‰ */}
          <div className="flex items-center gap-1 mb-3">
            {[
              { label: "ç”³è«‹å—ä»˜", done: true },
              { label: "AIã‚µã‚¤ãƒˆå¯©æŸ»", done: selectedSiteAppData.status !== "AIå¯©æŸ»ä¸­", active: selectedSiteAppData.status === "AIå¯©æŸ»ä¸­" },
              { label: "äººé–“åˆ¤å®š", done: selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿", active: selectedSiteAppData.status === "äººé–“åˆ¤å®šå¾…ã¡" },
              { label: "æ‰¿èª", done: selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿" },
            ].map((s, i) => (
              <div key={i} className="flex items-center gap-1 flex-1">
                <div className={`w-5 h-5 rounded-full flex items-center justify-center text-xs ${s.done ? "bg-emerald-500 text-white" : s.active ? "bg-teal-500 text-white animate-pulse" : "bg-slate-200 text-slate-400"}`}>
                  {s.done ? "âœ“" : s.active ? "âŸ³" : i + 1}
                </div>
                <span className={`text-xs ${s.done ? "text-emerald-700" : s.active ? "text-teal-700 font-semibold" : "text-slate-400"}`}>{s.label}</span>
                {i < 3 && <div className={`flex-1 h-0.5 ${s.done ? "bg-emerald-300" : "bg-slate-200"}`} />}
              </div>
            ))}
          </div>

          {/* æ“ä½œãƒœã‚¿ãƒ³ */}
          <div className="flex items-center gap-2 mb-3 p-2 bg-slate-50 rounded-lg border">
            <span className="text-xs text-slate-500">æ“ä½œ:</span>
            {selectedSiteAppData.status === "äººé–“åˆ¤å®šå¾…ã¡" && (
              <>
                <button onClick={() => setAppConfirmDialog({
                  type: "approve", icon: "âœ…", title: "ã‚µã‚¤ãƒˆè¿½åŠ æ‰¿èª", appId: selectedSiteAppData.id, merchantName: `${selectedSiteAppData.merchantName} â€” ${selectedSiteAppData.siteName}`,
                  description: "AIã‚µã‚¤ãƒˆå¯©æŸ»çµæœã‚’ç¢ºèªã®ä¸Šã€ã“ã®æ–°è¦ã‚µã‚¤ãƒˆã®è¿½åŠ ã‚’æ‰¿èªã—ã¾ã™ã€‚æ‰¿èªå¾Œã€æ¥ç¶šå…ˆã®å¯©æŸ»ãƒ»è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚",
                  impacts: ["ã‚µã‚¤ãƒˆãŒåŠ ç›Ÿåº—ãƒã‚¹ã‚¿ãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹", "æ¥ç¶šå…ˆå¯©æŸ»ã®é–‹å§‹ãŒå¯èƒ½ã«ãªã‚‹", "æ—¢å­˜ã®åŠ ç›Ÿåº—å¥‘ç´„æƒ…å ±ãŒå¼•ãç¶™ãŒã‚Œã‚‹", "ğŸ“§ åŠ ç›Ÿåº—æ‹…å½“è€…ã«ã‚µã‚¤ãƒˆè¿½åŠ æ‰¿èªé€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡"],
                  confirmLabel: "âœ… ã‚µã‚¤ãƒˆè¿½åŠ ã‚’æ‰¿èª"
                })} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700 shadow-sm">âœ… æ‰¿èª</button>
                <button onClick={() => setAppConfirmDialog({
                  type: "reject", icon: "âŒ", title: "ã‚µã‚¤ãƒˆè¿½åŠ å´ä¸‹", appId: selectedSiteAppData.id, merchantName: `${selectedSiteAppData.merchantName} â€” ${selectedSiteAppData.siteName}`,
                  description: "ã“ã®ã‚µã‚¤ãƒˆè¿½åŠ ç”³è«‹ã‚’å´ä¸‹ã—ã¾ã™ã€‚ç†ç”±ã¯åŠ ç›Ÿåº—ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚",
                  impacts: ["ã‚µã‚¤ãƒˆè¿½åŠ ãŒå´ä¸‹ã•ã‚Œã‚‹", "ğŸ“§ åŠ ç›Ÿåº—æ‹…å½“è€…ã«ã‚µã‚¤ãƒˆè¿½åŠ å´ä¸‹é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆå´ä¸‹ç†ç”±ä»˜ãï¼‰", "æ—¢å­˜ã‚µã‚¤ãƒˆã®é‹ç”¨ã«ã¯å½±éŸ¿ãªã—"],
                  confirmLabel: "âŒ å´ä¸‹ã™ã‚‹"
                })} className="px-3 py-1.5 bg-white text-rose-600 border border-rose-300 rounded text-xs font-semibold hover:bg-rose-50">âŒ å´ä¸‹</button>
                <button onClick={() => toast(`${selectedSiteAppData.id} ã®AIå†å¯©æŸ»ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã—ãŸ`, "info")} className="px-3 py-1.5 bg-white text-slate-600 border rounded text-xs hover:bg-slate-100">â†© AIå†å¯©æŸ»ã‚’ä¾é ¼</button>
              </>
            )}
            {selectedSiteAppData.status === "AIå¯©æŸ»ä¸­" && (
              <div className="bg-teal-50 rounded-lg border border-teal-200 p-3 w-full">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-xs font-bold text-teal-700">ğŸ¤– AIã‚µã‚¤ãƒˆå¯©æŸ»ã‚’å®Ÿè¡Œä¸­...</span>
                  <span className="text-xs text-teal-500">1/3 ã‚¹ãƒ†ãƒƒãƒ—å®Œäº† â€” 33%</span>
                </div>
                <div className="w-full bg-teal-200 rounded-full h-2 mb-2">
                  <div className="bg-teal-600 h-2 rounded-full transition-all" style={{ width: "33%" }} />
                </div>
                <div className="space-y-1.5 text-xs">
                  <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> ã‚µã‚¤ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„è§£æ... å®Œäº† <span className="text-slate-400 ml-auto">15ç§’</span></div>
                  <div className="flex items-center gap-2"><span className="text-teal-500 animate-pulse">ğŸ”„</span> ã‚¸ãƒ£ãƒ³ãƒ«é©åˆæ€§ãƒã‚§ãƒƒã‚¯... å®Ÿè¡Œä¸­</div>
                  <div className="flex items-center gap-2"><span className="text-slate-300">â³</span> ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ç®—å‡º... å¾…æ©Ÿä¸­</div>
                </div>
                <p className="text-xs text-slate-400 mt-2">â€» ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ã¯åç¤¾ãƒ»è²¡å‹™ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚é€šå¸¸15ç§’ã€œ1åˆ†ã§å®Œäº†</p>
              </div>
            )}
            {selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿" && selectedSiteAppData.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»å¾…ã¡" && (
              <>
                <button onClick={() => setAppConfirmDialog({
                  type: "start_proc_review", icon: "ğŸ”Œ", title: "æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹å§‹ï¼ˆã‚µã‚¤ãƒˆè¿½åŠ ï¼‰", appId: selectedSiteAppData.id, merchantName: `${selectedSiteAppData.merchantName} â€” ${selectedSiteAppData.siteName}`,
                  description: "ã‚µã‚¤ãƒˆè¿½åŠ ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸã€‚ã“ã®ã‚µã‚¤ãƒˆç”¨ã®æ¥ç¶šå…ˆã‚’é¸æŠã—ã¦å¯©æŸ»ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚æ—¢å­˜æ¥ç¶šå…ˆã®æµç”¨ã‚‚å¯èƒ½ã§ã™ã€‚",
                  impacts: ["é¸æŠã—ãŸæ¥ç¶šå…ˆã«å¯©æŸ»ç”³è«‹ãŒé€ä¿¡ã•ã‚Œã‚‹", "æ—¢å­˜åŠ ç›Ÿåº—ã®æ›¸é¡æƒ…å ±ãŒè‡ªå‹•è»¢é€ã•ã‚Œã‚‹", "æ¥ç¶šå…ˆå¯©æŸ»ç”»é¢ã«æ¡ˆä»¶ãŒè¿½åŠ ã•ã‚Œã‚‹"],
                  processorName: "æ—¢å­˜æ¥ç¶šå…ˆæµç”¨ or æ–°è¦é¸å®š",
                  confirmLabel: "ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹å§‹"
                })} className="px-3 py-1.5 bg-purple-600 text-white rounded text-xs font-bold hover:bg-purple-700 shadow-sm ring-2 ring-purple-300 ring-offset-1">ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹å§‹</button>
                <span className="text-xs text-slate-400 ml-1">â†’ æ—¢å­˜æ¥ç¶šå…ˆã®æµç”¨ or æ–°è¦æ¥ç¶šå…ˆã®å¯©æŸ»</span>
              </>
            )}
            {selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿" && selectedSiteAppData.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" && (
              <div className="flex items-center gap-2">
                <Badge text="æ¥ç¶šå…ˆå¯©æŸ»ä¸­" color="blue" />
                <span className="text-xs text-slate-500">æ¥ç¶šå…ˆå¯©æŸ»ã¯ã€ŒğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã€ç”»é¢ã§é€²è¡Œä¸­ã§ã™ â†’</span>
                <button onClick={() => { if (nav.setMasterPage) nav.setMasterPage("processorReview"); toast("æ¥ç¶šå…ˆå¯©æŸ»ç”»é¢ã«ç§»å‹•ã—ã¾ã™", "info"); }} className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs border border-blue-200 font-semibold hover:bg-blue-200">ğŸ”Œ æ¥ç¶šå…ˆå¯©æŸ»ã‚’é–‹ã</button>
              </div>
            )}
            {selectedSiteAppData.status === "å´ä¸‹" && (
              <div className="flex items-center gap-3">
                <span className="text-xs text-rose-500">ã“ã®ã‚µã‚¤ãƒˆè¿½åŠ ç”³è«‹ã¯å´ä¸‹ã•ã‚Œã¦ã„ã¾ã™</span>
                <button onClick={() => setAppConfirmDialog({
                  type: "reapply", icon: "ğŸ”„", title: "å†ç”³è«‹ã‚’è¨±å¯",
                  appId: selectedSiteAppData.id, merchantName: `${selectedSiteAppData.merchantName} â€” ${selectedSiteAppData.siteName}`,
                  description: "ã‚µã‚¤ãƒˆè¿½åŠ ã®å†ç”³è«‹ã‚’è¨±å¯ã—ã¾ã™ã‹ï¼ŸåŠ ç›Ÿåº—ç®¡ç†ç”»é¢ã‹ã‚‰å†ç”³è«‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚",
                  impacts: ["åŠ ç›Ÿåº—ã®ã€Œæ–°è¦ã‚µã‚¤ãƒˆç”³è«‹ã€ã‹ã‚‰å†ç”³è«‹ãŒå¯èƒ½ã«ãªã‚‹", "åŠ ç›Ÿåº—æ‹…å½“è€…ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥"],
                  confirmLabel: "ğŸ”„ å†ç”³è«‹ã‚’è¨±å¯ã™ã‚‹"
                })} className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold hover:bg-blue-200 border border-blue-200">ğŸ”„ å†ç”³è«‹ã‚’è¨±å¯</button>
              </div>
            )}
          </div>

          {/* å¯©æŸ»ãƒ¡ãƒ¢ */}
          {(selectedSiteAppData.status === "äººé–“åˆ¤å®šå¾…ã¡" || selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿") && (
            <div className="bg-white rounded p-2 border border-slate-200 mb-3">
              <div className="flex items-center justify-between mb-1">
                <p className="text-xs font-bold text-slate-600">ğŸ“ å¯©æŸ»ãƒ¡ãƒ¢ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆ</p>
                <span className="text-xs text-slate-400">å¯©æŸ»æ™‚ã®åˆ¤æ–­æ ¹æ‹ ã‚’è¨˜éŒ²</span>
              </div>
              <div className="flex gap-1">
                <input className="flex-1 border rounded px-2 py-1 text-xs" placeholder="å¯©æŸ»ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ..." />
                <button onClick={() => toast("å¯©æŸ»ãƒ¡ãƒ¢ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="px-3 py-1 bg-teal-600 text-white rounded text-xs">è¿½åŠ </button>
              </div>
              {selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿" && (
                <div className="mt-1.5 bg-slate-50 rounded p-1.5 text-xs text-slate-500">
                  <span className="text-slate-400">02/10 14:18 admin:</span> æ—¢å­˜åŠ ç›Ÿåº—ã®å–å¼•å®Ÿç¸¾è‰¯å¥½ã€‚ã‚µã‚¤ãƒˆå†…å®¹å•é¡Œãªã—ã€‚æ‰¿èªã€‚
                </div>
              )}
            </div>
          )}

          {/* ç”³è«‹æƒ…å ±ã‚°ãƒªãƒƒãƒ‰ */}
          <div className="grid grid-cols-3 gap-4 mb-3">
            <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
              <p className="text-xs font-bold text-slate-600 mb-1">ç”³è«‹å…ƒåŠ ç›Ÿåº—</p>
              <div className="text-xs space-y-1 text-slate-600">
                <div>åŠ ç›Ÿåº—ID: <span className="font-mono text-blue-600">{selectedSiteAppData.merchantId}</span></div>
                <div>æ³•äººå: {selectedSiteAppData.merchantName}</div>
                <div>æ—¢å­˜ã‚µã‚¤ãƒˆæ•°: {selectedSiteAppData.existingSites}ã‚µã‚¤ãƒˆ</div>
                <div>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span className="text-emerald-600 font-semibold">ç¨¼åƒä¸­</span></div>
                <div className="pt-1 border-t mt-1">
                  <span className="text-[10px] text-emerald-500">âœ… åç¤¾ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ âœ… è²¡å‹™å¯©æŸ»æ¸ˆã¿</span>
                </div>
              </div>
            </div>
            <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
              <p className="text-xs font-bold text-slate-600 mb-1">æ–°è¦ã‚µã‚¤ãƒˆæƒ…å ±</p>
              <div className="text-xs space-y-1 text-slate-600">
                <div>ã‚µã‚¤ãƒˆå: <span className="font-semibold">{selectedSiteAppData.siteName}</span></div>
                <div>URL: {selectedSiteAppData.siteUrl || <span className="text-slate-400">ï¼ˆæº–å‚™ä¸­ï¼‰</span>}</div>
                <div>ã‚¸ãƒ£ãƒ³ãƒ«: {selectedSiteAppData.genre}</div>
                <div>æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜: {selectedSiteAppData.monthlyVol}</div>
                <div>å¸Œæœ›ãƒ–ãƒ©ãƒ³ãƒ‰: {selectedSiteAppData.brands}</div>
              </div>
            </div>
            <div className="bg-slate-50 rounded-lg p-2.5 border border-slate-200">
              <p className="text-xs font-bold text-slate-600 mb-1">AIã‚µã‚¤ãƒˆå¯©æŸ»ï¼ˆç°¡æ˜“ç‰ˆï¼‰</p>
              <div className="text-xs space-y-1.5">
                <div className="flex items-center gap-2"><span className="text-slate-300 line-through">åç¤¾ãƒã‚§ãƒƒã‚¯</span> <span className="text-[10px] text-emerald-500 bg-emerald-50 px-1 rounded">ç™»éŒ²æ™‚æ¸ˆã¿</span></div>
                <div className="flex items-center gap-2"><span className="text-slate-300 line-through">è²¡å‹™åˆ†æ</span> <span className="text-[10px] text-emerald-500 bg-emerald-50 px-1 rounded">ç™»éŒ²æ™‚æ¸ˆã¿</span></div>
                {selectedSiteAppData.status === "AIå¯©æŸ»ä¸­" ? (
                  <>
                    <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> ã‚µã‚¤ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¢ºèª: å®Œäº†</div>
                    <div className="flex items-center gap-2"><span className="text-teal-500 animate-pulse">âŸ³</span> ã‚¸ãƒ£ãƒ³ãƒ«é©åˆæ€§: å‡¦ç†ä¸­...</div>
                    <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> ç·åˆåˆ¤å®š: å¾…æ©Ÿä¸­</div>
                  </>
                ) : (
                  <>
                    <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> ã‚µã‚¤ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¢ºèª: å•é¡Œãªã—</div>
                    <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> ã‚¸ãƒ£ãƒ³ãƒ«é©åˆæ€§: é©åˆ</div>
                    <div className="flex items-center gap-2">
                      {selectedSiteAppData.ai === "å´ä¸‹æ¨è–¦" ? <span className="text-rose-500">âŒ</span> : <span className="text-emerald-500">âœ…</span>}
                      ç·åˆåˆ¤å®š: <span className={selectedSiteAppData.ai === "å´ä¸‹æ¨è–¦" ? "text-rose-600 font-semibold" : "text-emerald-600 font-semibold"}>{selectedSiteAppData.ai}</span>
                    </div>
                  </>
                )}
              </div>
            </div>
          </div>

          {/* æ‰¿èªæ¸ˆã¿ã®å ´åˆã®ã‚µãƒãƒªãƒ¼ */}
          {selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿" && (
            <div className="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-lg border border-emerald-200 p-3">
              <div className="flex items-center justify-between mb-1">
                <p className="text-xs font-bold text-emerald-700">âœ… ã‚µã‚¤ãƒˆè¿½åŠ æ‰¿èªæ¸ˆã¿ â†’ æ¥ç¶šå…ˆè¨­å®šãƒ•ã‚§ãƒ¼ã‚º</p>
                {selectedSiteAppData.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»ä¸­" && <Badge text="æ¥ç¶šå…ˆå¯©æŸ»ä¸­" color="blue" />}
                {selectedSiteAppData.procStatus === "æ¥ç¶šå…ˆå¯©æŸ»å¾…ã¡" && <Badge text="æ¥ç¶šå…ˆå¯©æŸ»æœªé–‹å§‹" color="yellow" />}
              </div>
              <div className="flex gap-4 text-xs text-slate-600">
                <div><span className="text-slate-400">æ‰¿èªæ—¥:</span> 2026-02-10</div>
                <div><span className="text-slate-400">æ‰¿èªè€…:</span> admin@aipaymentsys.com</div>
                <div><span className="text-slate-400">AIåˆ¤å®š:</span> <span className="text-emerald-600 font-semibold">{selectedSiteAppData.ai}</span></div>
                <div><span className="text-slate-400">æ—¢å­˜æ¥ç¶šå…ˆæµç”¨:</span> <span className="text-blue-600 font-semibold">å¯èƒ½</span></div>
              </div>
            </div>
          )}

          {/* ãƒ¡ãƒ¼ãƒ«é€šçŸ¥å±¥æ­´ï¼ˆã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ï¼‰ */}
          <div className="bg-white rounded-lg border border-slate-200 p-3 mt-3">
            <div className="flex items-center justify-between mb-2">
              <p className="text-xs font-bold text-slate-600">ğŸ“§ é€šçŸ¥ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´</p>
              <button onClick={() => toast("æ‰‹å‹•ã§é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã‚’å†é€ã—ã¾ã—ãŸ", "success")} className="text-xs text-blue-600 hover:underline">æ‰‹å‹•å†é€</button>
            </div>
            <div className="space-y-1 text-xs">
              <div className="flex items-center py-1 border-b"><div className="w-28 text-slate-400">{selectedSiteAppData.date}</div><div className="w-36 font-semibold text-slate-700">ã‚µã‚¤ãƒˆè¿½åŠ ç”³è«‹å—ä»˜</div><div className="flex-1 text-slate-500">åŠ ç›Ÿåº—æ‹…å½“è€…ã«å—ä»˜ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡</div><Badge text="é€ä¿¡æ¸ˆã¿" color="green" /></div>
              {selectedSiteAppData.status !== "AIå¯©æŸ»ä¸­" && <div className="flex items-center py-1 border-b"><div className="w-28 text-slate-400">{selectedSiteAppData.date.split(" ")[0]} 10:31</div><div className="w-36 font-semibold text-slate-700">AIã‚µã‚¤ãƒˆå¯©æŸ»å®Œäº†</div><div className="flex-1 text-slate-500">ç¤¾å†…ç®¡ç†è€…ã«å¯©æŸ»å®Œäº†é€šçŸ¥</div><Badge text="é€ä¿¡æ¸ˆã¿" color="green" /></div>}
              {selectedSiteAppData.status === "æ‰¿èªæ¸ˆã¿" && <div className="flex items-center py-1 border-b"><div className="w-28 text-slate-400">02/10 14:20</div><div className="w-36 font-semibold text-slate-700">ã‚µã‚¤ãƒˆè¿½åŠ æ‰¿èªé€šçŸ¥</div><div className="flex-1 text-slate-500">åŠ ç›Ÿåº—æ‹…å½“è€…ã«æ‰¿èªå®Œäº†ãƒ¡ãƒ¼ãƒ«é€ä¿¡</div><Badge text="é€ä¿¡æ¸ˆã¿" color="green" /></div>}
              {selectedSiteAppData.status === "å´ä¸‹" && <div className="flex items-center py-1 border-b"><div className="w-28 text-slate-400">02/09 16:00</div><div className="w-36 font-semibold text-slate-700">ã‚µã‚¤ãƒˆè¿½åŠ å´ä¸‹é€šçŸ¥</div><div className="flex-1 text-slate-500">åŠ ç›Ÿåº—æ‹…å½“è€…ã«å´ä¸‹ç†ç”±ä»˜ããƒ¡ãƒ¼ãƒ«é€ä¿¡</div><Badge text="é€ä¿¡æ¸ˆã¿" color="green" /></div>}
            </div>
          </div>
        </div>
      </div>
      )}

      {/* ã‚µã‚¤ãƒˆè¿½åŠ ç”³è«‹ ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
        <TableHeader cols={[{ label: "ç”³è«‹ID", w: "w-36" }, { label: "åŠ ç›Ÿåº—", w: "w-44" }, { label: "æ–°è¦ã‚µã‚¤ãƒˆå", w: "flex-1" }, { label: "ã‚¸ãƒ£ãƒ³ãƒ«", w: "w-28" }, { label: "äºˆå®šæ±ºæ¸ˆé«˜", w: "w-24" }, { label: "å¯©æŸ»çŠ¶æ³", w: "w-24" }, { label: "AIåˆ¤å®š", w: "w-24" }, { label: "ç”³è«‹æ—¥", w: "w-24" }, { label: "æ“ä½œ", w: "w-20" }]}>
        {siteAddAppList.map((a, i) => (
          <tr key={i} className={`border-b cursor-pointer transition-colors ${selectedSiteApp === a.id ? "bg-teal-50 border-l-2 border-l-teal-500" : i % 2 ? "bg-slate-50 hover:bg-teal-50" : "hover:bg-teal-50"}`}
               onClick={() => setSelectedSiteApp(a.id)}>
            <td className="px-4 py-2 whitespace-nowrap w-36 font-mono text-slate-500">{a.id}</td>
            <td className="px-4 py-2 whitespace-nowrap w-44">
              <div className="font-semibold text-slate-700">{a.merchantName}</div>
              <div className="text-[10px] text-slate-400">{a.merchantId} Â· {a.existingSites}ã‚µã‚¤ãƒˆç¨¼åƒä¸­</div>
            </td>
            <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{a.siteName}</td>
            <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-500">{a.genre}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-500">{a.monthlyVol}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24"><Badge text={a.status} color={a.sColor} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-24"><Badge text={a.ai} color={a.aColor} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400">{a.date}</td>
            <td className="px-4 py-2 whitespace-nowrap w-20"><button onClick={(e) => { e.stopPropagation(); setSelectedSiteApp(a.id); }} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">è©³ç´°</button></td>
          </tr>
        ))}
        </TableHeader>
      </div>
      </>)}
    </div>
  );
};

// â”€â”€â”€ M08: ç²¾ç®—ãƒ»å…¥é‡‘ â”€â”€â”€
const MasterSettlement = () => {
  const toast = useToast();
  const [settleTab, setSettleTab] = useState("settlement");
  const [selectedBatch, setSelectedBatch] = useState(null);
  const [selectedPayout, setSelectedPayout] = useState(null);
  const [showBatchConfirm, setShowBatchConfirm] = useState(false);
  const [actionConfirm, setActionConfirm] = useState(null);
  const batchData = [
    { date: "2026-02-11", status: "å®Œäº†", count: "248ä»¶", amount: "Â¥8.2M", errors: 0, color: "green", logs: [{ time: "02:00:00", msg: "ãƒãƒƒãƒé–‹å§‹", st: "ok" }, { time: "02:01:15", msg: "å£²ä¸Šé›†è¨ˆå®Œäº† (248ä»¶)", st: "ok" }, { time: "02:02:30", msg: "æ‰‹æ•°æ–™è¨ˆç®—å®Œäº†", st: "ok" }, { time: "02:03:45", msg: "å…¥é‡‘ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ", st: "ok" }, { time: "02:04:12", msg: "ãƒãƒƒãƒå®Œäº†", st: "ok" }] },
    { date: "2026-02-10", status: "å®Œäº†", count: "312ä»¶", amount: "Â¥10.5M", errors: 1, color: "green", logs: [{ time: "02:00:00", msg: "ãƒãƒƒãƒé–‹å§‹", st: "ok" }, { time: "02:01:30", msg: "å£²ä¸Šé›†è¨ˆå®Œäº† (312ä»¶)", st: "ok" }, { time: "02:02:45", msg: "æ‰‹æ•°æ–™è¨ˆç®—å®Œäº†", st: "ok" }, { time: "02:03:10", msg: "M-019: å£åº§æƒ…å ±ã‚¨ãƒ©ãƒ¼", st: "error" }, { time: "02:04:00", msg: "ãƒãƒƒãƒå®Œäº†ï¼ˆã‚¨ãƒ©ãƒ¼1ä»¶ï¼‰", st: "warn" }] },
    { date: "2026-02-09", status: "å®Œäº†", count: "189ä»¶", amount: "Â¥6.3M", errors: 0, color: "green", logs: [] },
    { date: "2026-02-08", status: "å®Œäº†ï¼ˆã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼‰", count: "276ä»¶", amount: "Â¥9.1M", errors: 2, color: "yellow", logs: [] },
    { date: "2026-02-07", status: "å®Œäº†", count: "234ä»¶", amount: "Â¥7.8M", errors: 0, color: "green", logs: [] },
  ];
  const payoutData = [
    { id: "PAY-0211-001", merchant: "M-001 ABCãƒãƒ¼ãƒˆ", period: "02/04 ã€œ 02/10", amount: "Â¥3,825,000", fee: "Â¥127,500", status: "å…¥é‡‘å®Œäº†", sColor: "green", date: "02/12", sales: "Â¥4,200,000", brands: [{ name: "VISA", amt: "Â¥2,100,000", fee: "Â¥63,000" }, { name: "MC", amt: "Â¥1,050,000", fee: "Â¥31,500" }, { name: "JCB", amt: "Â¥840,000", fee: "Â¥27,720" }], cb: "Â¥0", reserve: "Â¥420,000", bank: "ä¸‰è±UFJéŠ€è¡Œ æ–°å®¿æ”¯åº— æ™®é€š 1234567" },
    { id: "PAY-0211-002", merchant: "M-002 XYZã‚·ãƒ§ãƒƒãƒ—", period: "02/04 ã€œ 02/10", amount: "Â¥1,682,000", fee: "Â¥58,870", status: "å…¥é‡‘å®Œäº†", sColor: "green", date: "02/12", sales: "Â¥1,850,000", brands: [{ name: "VISA", amt: "Â¥1,110,000", fee: "Â¥33,300" }, { name: "JCB", amt: "Â¥740,000", fee: "Â¥25,570" }], cb: "Â¥12,000", reserve: "Â¥185,000", bank: "ã¿ãšã»éŠ€è¡Œ æ¸‹è°·æ”¯åº— æ™®é€š 7654321" },
    { id: "PAY-0211-003", merchant: "M-004 ãƒ†ã‚¹ãƒˆå•†äº‹", period: "02/04 ã€œ 02/10", amount: "Â¥612,000", fee: "Â¥23,256", status: "ä¿ç•™", sColor: "yellow", date: "-", sales: "Â¥680,000", brands: [{ name: "VISA", amt: "Â¥680,000", fee: "Â¥23,256" }], cb: "Â¥0", reserve: "Â¥68,000", bank: "ä¸‰äº•ä½å‹éŠ€è¡Œ å“å·æ”¯åº— æ™®é€š 9876543" },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">ç²¾ç®—ãƒ»å…¥é‡‘ç®¡ç†</h2>
      <div className="flex gap-2">
        <select className="text-xs border rounded px-2 py-1"><option>2026å¹´2æœˆ</option><option>2026å¹´1æœˆ</option></select>
        <button onClick={() => setShowBatchConfirm(true)} className="text-xs bg-emerald-600 text-white px-3 py-1 rounded font-semibold">ç²¾ç®—ãƒãƒƒãƒå®Ÿè¡Œ</button>
      </div>
    </div>

    {/* Tabs */}
    <div className="flex gap-1 border-b">
      {[{ id: "settlement", label: "ç²¾ç®—ãƒ»å…¥é‡‘" }, { id: "deposit", label: "ãƒ‡ãƒã‚¸ãƒƒãƒˆç®¡ç†" }, { id: "chargeback", label: "ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯" }].map(tab => (
        <button key={tab.id} onClick={() => setSettleTab(tab.id)} className={`text-xs px-3 py-2 border-b-2 ${settleTab === tab.id ? "border-blue-500 text-blue-600 font-semibold" : "border-transparent text-slate-400"}`}>{tab.label}</button>
      ))}
    </div>

    {/* Tab: ç²¾ç®—ãƒ»å…¥é‡‘ */}
    {settleTab === "settlement" && (<>
    {/* KPIs */}
    <div className="flex gap-3">
      <KPICard label="ä»Šæœˆç²¾ç®—ç·é¡" value="Â¥45.2M" sub="å‰æœˆæ¯”" trend={5} />
      <KPICard label="å…¥é‡‘å®Œäº†" value="38ä»¶" sub="å…¨42ä»¶ä¸­" color="green" />
      <KPICard label="å…¥é‡‘ã‚¨ãƒ©ãƒ¼" value="2ä»¶" sub="è¦å¯¾å¿œ" color="red" />
      <KPICard label="ä¿ç•™ä¸­" value="2ä»¶" sub="CBèª¿æŸ»ä¸­" color="yellow" />
    </div>

    {/* Settlement Batch Status */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-2">ç²¾ç®—ãƒãƒƒãƒçŠ¶æ³ï¼ˆç›´è¿‘5å›ï¼‰</p>
      <div className="space-y-2">
        {batchData.map((b, i) => (
          <div key={i} onClick={() => setSelectedBatch(b)} className="flex items-center gap-3 text-xs cursor-pointer hover:bg-slate-50 rounded p-1 -m-1">
            <span className="w-24 text-slate-500">{b.date}</span>
            <Badge text={b.status} color={b.color} />
            <span className="text-slate-600">{b.count}</span>
            <span className="font-semibold text-slate-700">{b.amount}</span>
            {b.errors > 0 && <Badge text={`ã‚¨ãƒ©ãƒ¼ ${b.errors}ä»¶`} color="red" />}
            <span className="ml-auto text-slate-300">â€º</span>
          </div>
        ))}
      </div>
    </div>

    {/* Payout Error Details */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex items-center gap-2 mb-2">
        <p className="text-xs font-bold text-rose-600">âš  å…¥é‡‘ã‚¨ãƒ©ãƒ¼ï¼ˆè¦å¯¾å¿œï¼‰</p>
        <Badge text="2ä»¶" color="red" />
      </div>
      {[
        { id: "PAY-0211-019", merchant: "M-019 é£²é£Ÿãƒã‚§ãƒ¼ãƒ³åº—", amount: "Â¥1,240,000", error: "å£åº§æƒ…å ±ä¸ä¸€è‡´ï¼ˆæ”¯åº—ã‚³ãƒ¼ãƒ‰èª¤ã‚Šï¼‰", date: "02/11" },
        { id: "PAY-0210-033", merchant: "M-033 ã‚µãƒ–ã‚¹ã‚¯ã‚µãƒ¼ãƒ“ã‚¹", amount: "Â¥580,000", error: "å…¥é‡‘é™åº¦é¡è¶…é", date: "02/10" },
      ].map((e, i) => (
        <div key={i} className="bg-rose-50 border border-rose-200 rounded p-2 mb-2">
          <div className="flex justify-between items-center mb-1">
            <span className="text-xs font-semibold text-slate-700">{e.id} - {e.merchant}</span>
            <span className="text-xs font-bold text-rose-600">{e.amount}</span>
          </div>
          <p className="text-xs text-rose-600 mb-2">ã‚¨ãƒ©ãƒ¼: {e.error}</p>
          <div className="flex gap-2">
            <button onClick={() => toast(`${e.merchant} ã«é€£çµ¡ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ`, "info")} className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">åŠ ç›Ÿåº—ã«é€£çµ¡</button>
            <button onClick={() => setActionConfirm({ title: "æ‰‹å‹•å†å®Ÿè¡Œ", description: `${e.id} ã®ç²¾ç®—ã‚’æ‰‹å‹•ã§å†å®Ÿè¡Œã—ã¾ã™ã€‚`, type: "info", onConfirm: () => toast(`${e.id} ã®å†å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã—ãŸ`, "success") })} className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs">æ‰‹å‹•ã§å†å®Ÿè¡Œ</button>
            <button onClick={() => toast(`${e.id} ã‚’ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã«é€ã‚Šã¾ã—ãŸ`, "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã«é€ã‚‹</button>
          </div>
        </div>
      ))}
    </div>

    {/* Rolling Reserve */}
    <div className="bg-purple-50 rounded-lg border border-purple-200 p-3">
      <p className="text-xs font-bold text-purple-700 mb-2">ğŸ”’ ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–ï¼ˆãƒ‡ãƒã‚¸ãƒƒãƒˆï¼‰</p>
      <div className="grid grid-cols-4 gap-3">
        {[
          { label: "ãƒªã‚¶ãƒ¼ãƒ–ç·é¡", value: "Â¥4,520,000", color: "text-purple-700" },
          { label: "ä»Šæœˆè§£æ”¾äºˆå®š", value: "Â¥1,280,000", color: "text-emerald-600" },
          { label: "æ¥æœˆè§£æ”¾äºˆå®š", value: "Â¥1,640,000", color: "text-blue-600" },
          { label: "æ–°è¦ç•™ä¿ï¼ˆä»Šæœˆï¼‰", value: "Â¥2,130,000", color: "text-slate-700" },
        ].map((r, i) => (
          <div key={i} className="bg-white rounded-lg border border-slate-200 p-2.5 text-center">
            <p className="text-xs text-slate-400">{r.label}</p>
            <p className={`text-sm font-bold ${r.color}`}>{r.value}</p>
          </div>
        ))}
      </div>
      {/* Reserve Search */}
      <div className="flex gap-2 mt-3">
        <div className="flex items-center border rounded bg-white">
          <span className="text-xs text-slate-400 pl-2">ğŸ”</span>
          <input className="text-xs px-2 py-1 w-48 outline-none" placeholder="åŠ ç›Ÿåº—IDãƒ»åå‰ã§æ¤œç´¢" />
        </div>
        <select className="text-xs border rounded px-2 py-1 bg-white"><option>å…¨æ¥ç¶šå…ˆ</option><option>Univa Pay cast</option><option>æ¥½å¤©éŠ€è¡Œ</option><option>Worldpay</option><option>TCMS</option><option>Simpletransact</option><option>ONTHELINE</option><option>Asiabill</option></select>
        <select className="text-xs border rounded px-2 py-1 bg-white"><option>å…¨ç¨®åˆ¥</option><option>ç•™ä¿</option><option>è§£æ”¾</option></select>
        <button onClick={() => toast("æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ", "info")} className="text-xs bg-purple-600 text-white px-3 py-1 rounded">æ¤œç´¢</button>
      </div>
      {/* Reserve per Merchant */}
      <div className="bg-white rounded border mt-2">
        <TableHeader cols={[{ label: "åŠ ç›Ÿåº—", w: "flex-1" }, { label: "æ¥ç¶šå…ˆ", w: "w-28" }, { label: "ãƒªã‚¶ãƒ¼ãƒ–ç‡", w: "w-20" }, { label: "æœŸé–“", w: "w-16" }, { label: "æ®‹é«˜", w: "w-24" }, { label: "æ¬¡å›è§£æ”¾", w: "w-24" }, { label: "è§£æ”¾äºˆå®šæ—¥", w: "w-24" }]}>
        {[
          { m: "ABCãƒãƒ¼ãƒˆ", proc: "Univa Pay cast", rate: "10%", period: "180æ—¥", bal: "Â¥420,000", next: "Â¥120,000", date: "2026-03-07" },
          { m: "ABCãƒãƒ¼ãƒˆ", proc: "æ¥½å¤©éŠ€è¡Œ", rate: "5%", period: "90æ—¥", bal: "Â¥200,000", next: "Â¥60,000", date: "2026-03-07" },
          { m: "XYZã‚·ãƒ§ãƒƒãƒ—", proc: "Simpletransact", rate: "10%", period: "180æ—¥", bal: "Â¥185,000", next: "Â¥92,000", date: "2026-03-14" },
          { m: "ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", proc: "Worldpay", rate: "15%", period: "180æ—¥", bal: "Â¥510,000", next: "Â¥340,000", date: "2026-03-07" },
        ].map((r, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-4 py-1.5 whitespace-nowrap font-semibold text-slate-700">{r.m}</td>
            <td className="px-4 py-1.5 whitespace-nowrap w-28 text-slate-600">{r.proc}</td>
            <td className="px-4 py-1.5 whitespace-nowrap w-20 text-center"><Badge text={r.rate} color="purple" /></td>
            <td className="px-4 py-1.5 whitespace-nowrap w-16 text-center text-slate-500">{r.period}</td>
            <td className="px-4 py-1.5 whitespace-nowrap w-24 text-right font-bold text-purple-700">{r.bal}</td>
            <td className="px-4 py-1.5 whitespace-nowrap w-24 text-right text-emerald-600">{r.next}</td>
            <td className="px-4 py-1.5 whitespace-nowrap w-24 text-right text-slate-400">{r.date}</td>
          </tr>
        ))}
        </TableHeader>
      </div>
    </div>

    {/* Merchant Breakdown */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-slate-600">åŠ ç›Ÿåº—åˆ¥ ç²¾ç®—å†…è¨³</p>
        <button onClick={() => toast("å…¨åŠ ç›Ÿåº—ã®ç²¾ç®—å†…è¨³ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ", "info")} className="text-xs text-blue-600 hover:underline">å…¨åŠ ç›Ÿåº—ã‚’è¡¨ç¤º â†’</button>
      </div>
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
        <TableHeader cols={[{ label: "åŠ ç›Ÿåº—", w: "flex-1" }, { label: "æ±ºæ¸ˆé«˜", w: "w-28" }, { label: "æ‰‹æ•°æ–™", w: "w-24" }, { label: "CBå·®å¼•", w: "w-20" }, { label: "ãƒªã‚¶ãƒ¼ãƒ–ç•™ä¿", w: "w-24" }, { label: "ãƒªã‚¶ãƒ¼ãƒ–è§£æ”¾", w: "w-24" }, { label: "å…¥é‡‘é¡", w: "w-28" }]}>
        {[
          { merchant: "M-001 ABCãƒãƒ¼ãƒˆ", sales: "Â¥4,200,000", fee: "Â¥127,500", cb: "Â¥0", hold: "Â¥420,000", release: "Â¥280,000", payout: "Â¥3,932,500" },
          { merchant: "M-002 XYZã‚·ãƒ§ãƒƒãƒ—", sales: "Â¥1,850,000", fee: "Â¥58,870", cb: "Â¥12,000", hold: "Â¥185,000", release: "Â¥92,000", payout: "Â¥1,686,130" },
          { merchant: "M-003 ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", sales: "Â¥5,100,000", fee: "Â¥183,600", cb: "Â¥245,000", hold: "Â¥510,000", release: "Â¥340,000", payout: "Â¥4,501,400" },
        ].map((m, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{m.merchant}</td>
            <td className="px-4 py-2 whitespace-nowrap w-28 text-right text-slate-600">{m.sales}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-rose-500">-{m.fee}</td>
            <td className="px-4 py-2 whitespace-nowrap w-20 text-right text-rose-500">{m.cb !== "Â¥0" ? `-${m.cb}` : "â€”"}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-purple-500">-{m.hold}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-emerald-500">+{m.release}</td>
            <td className="px-4 py-2 whitespace-nowrap w-28 text-right font-bold text-slate-800">{m.payout}</td>
          </tr>
        ))}
        </TableHeader>
      </div>
    </div>

    {/* Payout List */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "å…¥é‡‘ID", w: "w-28" }, { label: "åŠ ç›Ÿåº—", w: "flex-1" }, { label: "ç²¾ç®—æœŸé–“", w: "w-36" }, { label: "å…¥é‡‘é¡", w: "w-28" }, { label: "æ‰‹æ•°æ–™", w: "w-24" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-24" }, { label: "å…¥é‡‘æ—¥", w: "w-24" }]}>
      {payoutData.map((p, i) => (
        <tr key={i} onClick={() => setSelectedPayout(p)} className={`border-b cursor-pointer hover:bg-blue-50 ${i % 2 ? "bg-slate-50" : ""}`}>
          <td className="px-4 py-2 whitespace-nowrap w-28 font-mono text-slate-500">{p.id}</td>
          <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{p.merchant}</td>
          <td className="px-4 py-2 whitespace-nowrap w-36 text-slate-500">{p.period}</td>
          <td className="px-4 py-2 whitespace-nowrap w-28 text-right font-semibold text-slate-700">{p.amount}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-slate-500">{p.fee}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24"><Badge text={p.status} color={p.sColor} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400">{p.date}</td>
        </tr>
      ))}
      </TableHeader>
    </div>

    {/* Agent Settlement Section */}
    <div className="bg-orange-50 rounded-lg border border-orange-200 p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-orange-700">ğŸ¤ ä»£ç†åº—ç²¾ç®—ï¼ˆæ±ºæ¸ˆæ‰‹æ•°æ–™ã‹ã‚‰ã®å·®å¼•ï¼‰</p>
        <div className="flex gap-2">
          <select className="text-xs border rounded px-2 py-1 bg-white"><option>2026å¹´2æœˆ</option><option>2026å¹´1æœˆ</option></select>
          <button onClick={() => setActionConfirm({ title: "ä»£ç†åº—ç²¾ç®—å®Ÿè¡Œ", description: "å…¨ä»£ç†åº—ã®ç²¾ç®—å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚", warning: "å®Ÿè¡Œå¾Œã¯å–æ¶ˆã§ãã¾ã›ã‚“ã€‚", type: "warning", onConfirm: () => toast("ä»£ç†åº—ç²¾ç®—ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ", "success") })} className="text-xs bg-orange-600 text-white px-3 py-1 rounded font-semibold">ä»£ç†åº—ç²¾ç®—ã‚’å®Ÿè¡Œ</button>
        </div>
      </div>
      <div className="grid grid-cols-3 gap-3 mb-3">
        {[
          { label: "ä»Šæœˆã®ä»£ç†åº—ãƒ•ã‚£ãƒ¼åˆè¨ˆ", value: "Â¥3,507,500", color: "text-orange-700" },
          { label: "æ”¯æ‰•å®Œäº†", value: "Â¥415,000", color: "text-emerald-600" },
          { label: "æœªæ‰•ã„", value: "Â¥3,092,500", color: "text-rose-600" },
        ].map((r, i) => (
          <div key={i} className="bg-white rounded-lg border border-slate-200 p-2.5 text-center">
            <p className="text-xs text-slate-400">{r.label}</p>
            <p className={`text-sm font-bold ${r.color}`}>{r.value}</p>
          </div>
        ))}
      </div>
      <div className="bg-white rounded border overflow-x-auto">
        <TableHeader cols={[{ label: "ä»£ç†åº—", w: "flex-1" }, { label: "å¯¾è±¡åŠ ç›Ÿåº—", w: "w-16" }, { label: "æ±ºæ¸ˆç¨®åˆ¥å†…è¨³", w: "w-56" }, { label: "ãƒ•ã‚£ãƒ¼åˆè¨ˆ", w: "w-24" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "æ“ä½œ", w: "w-16" }]}>
        {[
          { agent: "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º", merchants: "23", breakdown: "VISA: Â¥980K / MC: Â¥520K / JCB: Â¥410K / AMEX: Â¥230K / QR: Â¥120K", total: "Â¥2,260,000", status: "pending" },
          { agent: "ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚µãƒ«åˆåŒä¼šç¤¾", merchants: "12", breakdown: "VISA: Â¥380K / MC: Â¥210K / JCB: Â¥142K / AMEX: Â¥60K / QR: Â¥40K", total: "Â¥832,500", status: "pending" },
          { agent: "ITã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º", merchants: "8", breakdown: "VISA: Â¥190K / MC: Â¥105K / JCB: Â¥72K / AMEX: Â¥28K / QR: Â¥20K", total: "Â¥415,000", status: "paid" },
        ].map((r, i) => (
          <tr key={i} className="border-b">
            <td className="px-4 py-2 whitespace-nowrap font-bold">{r.agent}</td>
            <td className="px-4 py-2 whitespace-nowrap w-16 text-center">{r.merchants}ç¤¾</td>
            <td className="px-4 py-2 w-56 text-xs text-slate-500">{r.breakdown}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 font-bold text-orange-700">{r.total}</td>
            <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.status === "pending" ? "æœªæ‰•ã„" : "æ”¯æ‰•æ¸ˆ"} color={r.status === "pending" ? "yellow" : "green"} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-16">{r.status === "pending" && <button onClick={() => setActionConfirm({ title: "ä»£ç†åº—æ”¯æ‰•å®Ÿè¡Œ", description: `${r.agent} ã« ${r.total} ã‚’æ”¯æ‰•ã„ã¾ã™ã€‚`, type: "approve", onConfirm: () => toast(`${r.agent} ã¸ã®æ”¯æ‰•ã„ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ`, "success") })} className="text-emerald-600 text-xs font-semibold">æ”¯æ‰•å®Ÿè¡Œ</button>}</td>
          </tr>
        ))}
        </TableHeader>
      </div>
      <p className="text-xs text-orange-600 mt-2">â€» ä»£ç†åº—ãƒ•ã‚£ãƒ¼ã¯å„åŠ ç›Ÿåº—ã®æ±ºæ¸ˆæ‰‹æ•°æ–™ã‹ã‚‰è‡ªå‹•å·®å¼•ã•ã‚Œã¾ã™ã€‚æ±ºæ¸ˆç¨®åˆ¥ã”ã¨ã®æ–™ç‡ã¯ãƒ•ã‚£ãƒ¼è¨­å®šç”»é¢ã§ç®¡ç†ã—ã¾ã™ã€‚</p>
    </div>
    </>)}

    {/* Tab: ãƒ‡ãƒã‚¸ãƒƒãƒˆç®¡ç† */}
    {settleTab === "deposit" && (
      <div className="space-y-3">
        <div className="flex gap-3">
          <KPICard label="ãƒªã‚¶ãƒ¼ãƒ–ç·æ®‹é«˜" value="Â¥12.8M" sub="å…¨åŠ ç›Ÿåº—åˆè¨ˆ" color="blue" />
          <KPICard label="ä»Šæœˆç•™ä¿é¡" value="Â¥4.5M" sub="ç²¾ç®—æ™‚è‡ªå‹•ç•™ä¿" color="yellow" />
          <KPICard label="ä»Šæœˆè§£æ”¾é¡" value="Â¥3.2M" sub="ä¿æŒæœŸé–“æº€äº†" color="green" />
          <KPICard label="CBå……å½“é¡" value="Â¥380K" sub="ä»Šæœˆ" color="red" />
        </div>
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
          <div className="flex items-center justify-between mb-3">
            <p className="text-xs font-bold text-slate-600">åŠ ç›Ÿåº—åˆ¥ãƒªã‚¶ãƒ¼ãƒ–è¨­å®šãƒ»æ®‹é«˜</p>
            <div className="flex gap-2">
              <input className="text-xs border rounded px-2 py-1 w-48" placeholder="åŠ ç›Ÿåº—IDãƒ»åå‰ã§æ¤œç´¢" />
              <select className="text-xs border rounded px-2 py-1"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>æ®‹é«˜ã‚ã‚Š</option><option>è§£æ”¾å¾…ã¡</option></select>
            </div>
          </div>
          <table className="w-full text-xs">
            <thead>
              <tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold">åŠ ç›Ÿåº—</th>
                <th className="text-center p-2 text-slate-500 font-semibold">ãƒªã‚¶ãƒ¼ãƒ–ç‡</th>
                <th className="text-center p-2 text-slate-500 font-semibold">ä¿æŒæœŸé–“</th>
                <th className="text-right p-2 text-slate-500 font-semibold">ãƒªã‚¶ãƒ¼ãƒ–æ®‹é«˜</th>
                <th className="text-right p-2 text-slate-500 font-semibold">ä»Šæœˆç•™ä¿</th>
                <th className="text-right p-2 text-slate-500 font-semibold">æ¬¡å›è§£æ”¾äºˆå®š</th>
                <th className="text-center p-2 text-slate-500 font-semibold">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              {[
                { merchant: "M-001 ABCãƒãƒ¼ãƒˆ", rate: "10%", period: "180æ—¥", balance: "Â¥4,200,000", held: "Â¥420,000", nextRelease: "2026-03-15 Â¥380K", risk: "low" },
                { merchant: "M-002 XYZã‚·ãƒ§ãƒƒãƒ—", rate: "15%", period: "180æ—¥", balance: "Â¥2,775,000", held: "Â¥277,500", nextRelease: "2026-03-15 Â¥250K", risk: "mid" },
                { merchant: "M-004 ãƒ†ã‚¹ãƒˆå•†äº‹", rate: "20%", period: "180æ—¥", balance: "Â¥1,360,000", held: "Â¥136,000", nextRelease: "2026-03-15 Â¥120K", risk: "mid" },
                { merchant: "M-007 ãƒãƒƒãƒˆãƒ—ãƒ©ã‚¹", rate: "30%", period: "180æ—¥", balance: "Â¥3,900,000", held: "Â¥520,000", nextRelease: "2026-04-01 Â¥310K", risk: "high" },
                { merchant: "M-011 ãƒ‡ã‚¸ã‚¿ãƒ«EC", rate: "10%", period: "180æ—¥", balance: "Â¥580,000", held: "Â¥58,000", nextRelease: "2026-03-20 Â¥45K", risk: "low" },
              ].map((r, i) => (
                <tr key={i} className="border-b">
                  <td className="p-2 font-semibold text-slate-700">{r.merchant}</td>
                  <td className="p-2 text-center"><span className={`px-2 py-0.5 rounded text-xs font-bold ${r.risk === "high" ? "bg-rose-100 text-rose-700" : r.risk === "mid" ? "bg-amber-100 text-amber-700" : "bg-blue-100 text-blue-700"}`}>{r.rate}</span></td>
                  <td className="p-2 text-center text-slate-500">{r.period}</td>
                  <td className="p-2 text-right font-bold text-slate-800">{r.balance}</td>
                  <td className="p-2 text-right text-slate-600">{r.held}</td>
                  <td className="p-2 text-right text-emerald-600">{r.nextRelease}</td>
                  <td className="p-2 text-center">
                    <button onClick={() => toast(`${r.merchant} ã®ãƒªã‚¶ãƒ¼ãƒ–è¨­å®šã‚’ç·¨é›†ä¸­`, "info")} className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">è¨­å®š</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
          <p className="text-xs font-bold text-slate-600 mb-2">ãƒªã‚¶ãƒ¼ãƒ–å…¥å‡ºé‡‘å±¥æ­´ï¼ˆç›´è¿‘ï¼‰</p>
          <table className="w-full text-xs">
            <thead>
              <tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold">æ—¥æ™‚</th>
                <th className="text-left p-2 text-slate-500 font-semibold">åŠ ç›Ÿåº—</th>
                <th className="text-center p-2 text-slate-500 font-semibold">ç¨®åˆ¥</th>
                <th className="text-right p-2 text-slate-500 font-semibold">é‡‘é¡</th>
                <th className="text-right p-2 text-slate-500 font-semibold">æ®‹é«˜</th>
                <th className="text-left p-2 text-slate-500 font-semibold">å‚™è€ƒ</th>
              </tr>
            </thead>
            <tbody>
              {[
                { date: "02/21 02:04", merchant: "M-001 ABCãƒãƒ¼ãƒˆ", type: "ç•™ä¿", amount: "+Â¥420,000", balance: "Â¥4,200,000", note: "ç²¾ç®—ãƒãƒƒãƒ #B-0221" },
                { date: "02/21 02:04", merchant: "M-002 XYZã‚·ãƒ§ãƒƒãƒ—", type: "ç•™ä¿", amount: "+Â¥277,500", balance: "Â¥2,775,000", note: "ç²¾ç®—ãƒãƒƒãƒ #B-0221" },
                { date: "02/20 14:30", merchant: "M-007 ãƒãƒƒãƒˆãƒ—ãƒ©ã‚¹", type: "CBå……å½“", amount: "-Â¥85,000", balance: "Â¥3,900,000", note: "CB-2026-0089 VISA" },
                { date: "02/15 02:05", merchant: "M-011 ãƒ‡ã‚¸ã‚¿ãƒ«EC", type: "è§£æ”¾", amount: "-Â¥45,000", balance: "Â¥580,000", note: "ä¿æŒæœŸé–“æº€äº†ï¼ˆ2025-08åˆ†ï¼‰" },
                { date: "02/15 02:05", merchant: "M-001 ABCãƒãƒ¼ãƒˆ", type: "è§£æ”¾", amount: "-Â¥380,000", balance: "Â¥4,160,000", note: "ä¿æŒæœŸé–“æº€äº†ï¼ˆ2025-08åˆ†ï¼‰" },
              ].map((r, i) => (
                <tr key={i} className="border-b">
                  <td className="p-2 text-slate-500">{r.date}</td>
                  <td className="p-2 text-slate-700">{r.merchant}</td>
                  <td className="p-2 text-center"><Badge text={r.type} color={r.type === "ç•™ä¿" ? "blue" : r.type === "è§£æ”¾" ? "green" : "red"} /></td>
                  <td className={`p-2 text-right font-bold ${r.amount.startsWith("+") ? "text-blue-600" : "text-rose-600"}`}>{r.amount}</td>
                  <td className="p-2 text-right text-slate-600">{r.balance}</td>
                  <td className="p-2 text-slate-500">{r.note}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700">
          ğŸ’¡ ãƒªã‚¶ãƒ¼ãƒ–ç‡ã¯åŠ ç›Ÿåº—ã®ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦5-30%ã§è¨­å®šã€‚ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ç™ºç”Ÿæ™‚ã¯ãƒªã‚¶ãƒ¼ãƒ–ã‹ã‚‰è‡ªå‹•å……å½“ã•ã‚Œã¾ã™ã€‚ä¿æŒæœŸé–“æº€äº†å¾Œã«è‡ªå‹•è§£æ”¾ã€‚
        </div>
      </div>
    )}

    {/* Tab: ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ */}
    {settleTab === "chargeback" && (
      <div className="space-y-3">
        <div className="flex gap-3">
          <KPICard label="ä»ŠæœˆCBä»¶æ•°" value="8ä»¶" sub="å‰æœˆæ¯”" trend={-12} />
          <KPICard label="CBé‡‘é¡åˆè¨ˆ" value="Â¥892K" sub="ä»Šæœˆ" color="red" />
          <KPICard label="åè«–ä¸­" value="3ä»¶" sub="æœŸé™å†…" color="yellow" />
          <KPICard label="æœªåãƒªã‚¹ã‚¯" value="1ä»¶" sub="è¦å¯¾å¿œ" color="red" />
          <KPICard label="å‹è¨´ç‡" value="42%" sub="éå»6ãƒ¶æœˆ" color="green" />
        </div>
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
          <div className="flex items-center justify-between mb-3">
            <p className="text-xs font-bold text-slate-600">ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯æ¡ˆä»¶ä¸€è¦§</p>
            <div className="flex gap-2">
              <div className="flex gap-1">
                {["å…¨ã¦","å—é ˜","èª¿æŸ»ä¸­","åè«–æ¸ˆ","ç¢ºå®š"].map((s, i) => (
                  <button key={s} className={`text-xs px-2.5 py-1 rounded ${i === 0 ? "bg-blue-600 text-white font-semibold" : "bg-slate-100 text-slate-500"}`}>{s}</button>
                ))}
              </div>
              <input className="text-xs border rounded px-2 py-1 w-40" placeholder="ã‚±ãƒ¼ã‚¹ç•ªå·ã§æ¤œç´¢" />
            </div>
          </div>
          <table className="w-full text-xs">
            <thead>
              <tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold">ã‚±ãƒ¼ã‚¹ç•ªå·</th>
                <th className="text-left p-2 text-slate-500 font-semibold">åŠ ç›Ÿåº—</th>
                <th className="text-left p-2 text-slate-500 font-semibold">ç†ç”±</th>
                <th className="text-right p-2 text-slate-500 font-semibold">é‡‘é¡</th>
                <th className="text-center p-2 text-slate-500 font-semibold">ãƒ–ãƒ©ãƒ³ãƒ‰</th>
                <th className="text-center p-2 text-slate-500 font-semibold">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th className="text-left p-2 text-slate-500 font-semibold">åè«–æœŸé™</th>
                <th className="text-center p-2 text-slate-500 font-semibold">æœªåãƒªã‚¹ã‚¯</th>
                <th className="text-center p-2 text-slate-500 font-semibold">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              {[
                { case: "CB-2026-0095", merchant: "M-002 XYZã‚·ãƒ§ãƒƒãƒ—", reason: "13.1 å•†å“æœªå—é ˜", amount: "Â¥185,000", brand: "VISA", status: "å—é ˜", deadline: "2026-03-18", risk: true, riskNote: "å–æ‰±é«˜ä¸è¶³" },
                { case: "CB-2026-0094", merchant: "M-007 ãƒãƒƒãƒˆãƒ—ãƒ©ã‚¹", reason: "10.4 ä¸æ­£åˆ©ç”¨", amount: "Â¥320,000", brand: "MC", status: "èª¿æŸ»ä¸­", deadline: "2026-03-15", risk: false, riskNote: "" },
                { case: "CB-2026-0093", merchant: "M-001 ABCãƒãƒ¼ãƒˆ", reason: "13.3 å•†å“ç›¸é•", amount: "Â¥42,000", brand: "VISA", status: "åè«–æå‡ºæ¸ˆ", deadline: "2026-03-10", risk: false, riskNote: "" },
                { case: "CB-2026-0092", merchant: "M-004 ãƒ†ã‚¹ãƒˆå•†äº‹", reason: "10.4 ä¸æ­£åˆ©ç”¨", amount: "Â¥98,000", brand: "JCB", status: "åè«–æå‡ºæ¸ˆ", deadline: "2026-03-08", risk: false, riskNote: "" },
                { case: "CB-2026-0091", merchant: "M-007 ãƒãƒƒãƒˆãƒ—ãƒ©ã‚¹", reason: "13.1 å•†å“æœªå—é ˜", amount: "Â¥85,000", brand: "VISA", status: "æ•—è¨´", deadline: "-", risk: false, riskNote: "" },
                { case: "CB-2026-0090", merchant: "M-001 ABCãƒãƒ¼ãƒˆ", reason: "10.4 ä¸æ­£åˆ©ç”¨", amount: "Â¥67,000", brand: "MC", status: "å‹è¨´", deadline: "-", risk: false, riskNote: "" },
                { case: "CB-2026-0089", merchant: "M-007 ãƒãƒƒãƒˆãƒ—ãƒ©ã‚¹", reason: "10.4 ä¸æ­£åˆ©ç”¨", amount: "Â¥85,000", brand: "VISA", status: "æ•—è¨´", deadline: "-", risk: false, riskNote: "" },
                { case: "CB-2026-0088", merchant: "M-011 ãƒ‡ã‚¸ã‚¿ãƒ«EC", reason: "13.7 ã‚­ãƒ£ãƒ³ã‚»ãƒ«å“", amount: "Â¥10,000", brand: "VISA", status: "å–ä¸‹ã’", deadline: "-", risk: false, riskNote: "" },
              ].map((c, i) => (
                <tr key={i} className={`border-b ${c.risk ? "bg-rose-50" : ""}`}>
                  <td className="p-2 font-mono font-semibold text-blue-700">{c.case}</td>
                  <td className="p-2 text-slate-700">{c.merchant}</td>
                  <td className="p-2 text-slate-600">{c.reason}</td>
                  <td className="p-2 text-right font-bold text-slate-800">{c.amount}</td>
                  <td className="p-2 text-center"><Badge text={c.brand} color={c.brand === "VISA" ? "blue" : c.brand === "MC" ? "red" : "green"} /></td>
                  <td className="p-2 text-center"><Badge text={c.status} color={c.status === "å—é ˜" ? "yellow" : c.status === "èª¿æŸ»ä¸­" ? "blue" : c.status === "åè«–æå‡ºæ¸ˆ" ? "cyan" : c.status === "å‹è¨´" ? "green" : c.status === "æ•—è¨´" ? "red" : "slate"} /></td>
                  <td className="p-2 text-slate-500">{c.deadline !== "-" ? c.deadline : <span className="text-slate-300">â€”</span>}</td>
                  <td className="p-2 text-center">{c.risk ? <span className="px-2 py-0.5 rounded bg-rose-600 text-white text-xs font-bold">âš  {c.riskNote}</span> : <span className="text-slate-300">â€”</span>}</td>
                  <td className="p-2 text-center">
                    {(c.status === "å—é ˜" || c.status === "èª¿æŸ»ä¸­") && (
                      <button onClick={() => toast(`${c.case} ã®è©³ç´°ã‚’è¡¨ç¤º`, "info")} className="px-2 py-0.5 bg-blue-100 text-blue-600 rounded text-xs font-semibold">å¯¾å¿œ</button>
                    )}
                    {c.status === "åè«–æå‡ºæ¸ˆ" && (
                      <button onClick={() => toast(`${c.case} ã®åè«–çŠ¶æ³ã‚’ç¢ºèª`, "info")} className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">ç¢ºèª</button>
                    )}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        {/* æœªåãƒªã‚¹ã‚¯ã‚¢ãƒ©ãƒ¼ãƒˆ */}
        <div className="bg-rose-50 rounded-lg border border-rose-300 p-3">
          <div className="flex items-center gap-2 mb-2">
            <span className="text-sm">ğŸš¨</span>
            <p className="text-xs font-bold text-rose-700">æœªåãƒªã‚¹ã‚¯ã‚¢ãƒ©ãƒ¼ãƒˆ</p>
          </div>
          <div className="bg-white rounded border border-rose-200 p-2 text-xs">
            <div className="flex items-center justify-between">
              <div>
                <p className="font-bold text-slate-800">CB-2026-0095: M-002 XYZã‚·ãƒ§ãƒƒãƒ— â€” Â¥185,000</p>
                <p className="text-rose-600 mt-0.5">ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ç™ºç”Ÿæ™‚ç‚¹ã®å–æ‰±é«˜: Â¥23,000ï¼ˆãƒªã‚¶ãƒ¼ãƒ–æ®‹é«˜: Â¥2,775,000 â†’ å……å½“å¯èƒ½ã ãŒã‚µã‚¤ãƒˆå–æ‰±é«˜ãŒæ¥µç«¯ã«ä½ä¸‹ï¼‰</p>
                <p className="text-slate-500 mt-0.5">æ¤œçŸ¥ç†ç”±: å½“è©²ã‚µã‚¤ãƒˆã®ç›´è¿‘30æ—¥å–æ‰±é«˜ãŒå‰æœˆæ¯”95%æ¸›ã€‚è§£ç´„/ä¼‘æ­¢ã®å¯èƒ½æ€§ã€‚</p>
              </div>
              <div className="flex gap-1">
                <button onClick={() => toast("ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ï¼ˆM02ï¼‰ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã—ãŸ", "warning")} className="px-3 py-1.5 bg-rose-600 text-white rounded text-xs font-semibold whitespace-nowrap">M02ã¸é€ã‚‹</button>
              </div>
            </div>
          </div>
        </div>
        <div className="bg-amber-50 rounded border border-amber-200 p-2 text-xs text-amber-800">
          âš ï¸ ç®¡ç†è€…æ¨©é™ã§ãƒªãƒ•ã‚¡ãƒ³ãƒ‰ãƒ»ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ã®é‡‘é¡ã‚’æ‰‹å‹•ç·¨é›†ã§ãã¾ã™ã€‚ç·¨é›†æ™‚ã¯å¤‰æ›´å‰/å¾Œé‡‘é¡ã¨ç†ç”±ãŒæ“ä½œãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚
        </div>
      </div>
    )}

    {/* ãƒãƒƒãƒè©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedBatch && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedBatch(null)} />
        <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b flex items-center justify-between sticky top-0 bg-white z-10">
            <p className="text-sm font-bold">ç²¾ç®—ãƒãƒƒãƒè©³ç´°</p>
            <button onClick={() => setSelectedBatch(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            <div className="grid grid-cols-2 gap-2">
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">å®Ÿè¡Œæ—¥</p><p className="text-xs font-bold">{selectedBatch.date}</p></div>
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</p><Badge text={selectedBatch.status} color={selectedBatch.color} /></div>
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">å‡¦ç†ä»¶æ•°</p><p className="text-xs font-bold">{selectedBatch.count}</p></div>
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">ç²¾ç®—ç·é¡</p><p className="text-xs font-bold">{selectedBatch.amount}</p></div>
            </div>
            {selectedBatch.logs.length > 0 && (
              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">å®Ÿè¡Œãƒ­ã‚°</p>
                {selectedBatch.logs.map((log, i) => (
                  <div key={i} className="flex items-center gap-2 py-1.5 border-b text-xs last:border-0">
                    <span className="font-mono text-slate-400 w-16">{log.time}</span>
                    <span className={log.st === "error" ? "text-red-600" : log.st === "warn" ? "text-amber-600" : "text-slate-600"}>{log.st === "error" ? "âŒ" : log.st === "warn" ? "âš ï¸" : "âœ…"}</span>
                    <span className={`flex-1 ${log.st === "error" ? "text-red-600 font-bold" : ""}`}>{log.msg}</span>
                  </div>
                ))}
              </div>
            )}
            {selectedBatch.errors > 0 && (
              <button onClick={() => { toast(`ã‚¨ãƒ©ãƒ¼${selectedBatch.errors}ä»¶ã®å†å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã—ãŸ`, "success"); }} className="w-full py-2 bg-emerald-50 text-emerald-600 rounded text-xs font-bold border border-emerald-200 hover:bg-emerald-100">ğŸ”„ ã‚¨ãƒ©ãƒ¼åˆ†ã‚’å†å®Ÿè¡Œ</button>
            )}
          </div>
        </div>
      </div>
    )}

    {/* å…¥é‡‘è©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedPayout && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedPayout(null)} />
        <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b flex items-center justify-between sticky top-0 bg-white z-10">
            <p className="text-sm font-bold">{selectedPayout.id}</p>
            <button onClick={() => setSelectedPayout(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            <div className="flex items-center gap-2"><Badge text={selectedPayout.status} color={selectedPayout.sColor} /><span className="text-xs text-slate-400">{selectedPayout.period}</span></div>
            <div><p className="text-xs font-bold text-slate-700 mb-2">ç²¾ç®—ã‚µãƒãƒªãƒ¼</p>
              {[["æ±ºæ¸ˆé«˜", selectedPayout.sales], ["æ‰‹æ•°æ–™åˆè¨ˆ", `-${selectedPayout.fee}`], ["CBå·®å¼•", selectedPayout.cb !== "Â¥0" ? `-${selectedPayout.cb}` : "â€”"], ["ãƒªã‚¶ãƒ¼ãƒ–ç•™ä¿", `-${selectedPayout.reserve}`], ["å…¥é‡‘é¡", selectedPayout.amount]].map(([l, v], i) => (
                <div key={i} className={`flex text-xs py-1 border-b ${i === 4 ? "font-bold text-slate-800" : ""}`}><span className="flex-1 text-slate-500">{l}</span><span className={i === 1 || i === 2 || i === 3 ? "text-rose-500" : ""}>{v}</span></div>
              ))}
            </div>
            <div><p className="text-xs font-bold text-slate-700 mb-2">ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥å†…è¨³</p>
              {selectedPayout.brands.map((b, i) => (
                <div key={i} className="flex text-xs py-1 border-b"><span className="w-14">{b.name}</span><span className="flex-1 text-slate-500">{b.amt}</span><span className="text-rose-500">-{b.fee}</span></div>
              ))}
            </div>
            {/* æ¥ç¶šå…ˆåˆ¥æ‰‹æ•°æ–™ãƒ–ãƒ¬ã‚¤ã‚¯ãƒ€ã‚¦ãƒ³ */}
            <div><p className="text-xs font-bold text-slate-700 mb-2">ğŸ“Š æ¥ç¶šå…ˆåˆ¥ TR/CBæ‰‹æ•°æ–™</p>
              <div className="bg-slate-50 rounded border border-slate-200 p-2 space-y-1 text-xs">
                {[
                  { proc: "Univa Pay cast", trCount: 85, trFee: "30å††", cbCount: 0, cbFee: "3,000å††" },
                  { proc: "æ¥½å¤©éŠ€è¡Œ", trCount: 62, trFee: "10å††", cbCount: 0, cbFee: "1,300å††" },
                  { proc: "TCMS", trCount: 28, trFee: "20å††", cbCount: 0, cbFee: "-" },
                ].map((t, i) => (
                  <div key={i} className="flex items-center py-1 border-b last:border-0">
                    <span className="w-28 font-semibold text-slate-700">{t.proc}</span>
                    <span className="flex-1 text-slate-500">TR: {t.trCount}ä»¶ Ã— {t.trFee} = Â¥{(t.trCount * parseInt(t.trFee)).toLocaleString()}</span>
                    <span className="text-slate-400">CB: {t.cbCount}ä»¶</span>
                  </div>
                ))}
              </div>
            </div>
            <div><p className="text-xs font-bold text-slate-700 mb-1">æŒ¯è¾¼å…ˆå£åº§</p><p className="text-xs text-slate-600 bg-slate-50 rounded p-2">{selectedPayout.bank}</p></div>
            <button onClick={() => toast("å…¥é‡‘æ˜ç´°ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="w-full py-2 bg-blue-50 text-blue-600 rounded text-xs font-bold border border-blue-200">ğŸ“¥ æ˜ç´°ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
          </div>
        </div>
      </div>
    )}

    <ConfirmDialog config={actionConfirm} onClose={() => setActionConfirm(null)} />

    {/* ãƒãƒƒãƒå®Ÿè¡Œç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showBatchConfirm && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowBatchConfirm(false)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[450px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">ç²¾ç®—ãƒãƒƒãƒã®å®Ÿè¡Œç¢ºèª</p>
            <button onClick={() => setShowBatchConfirm(false)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-3">
            <div className="bg-blue-50 border border-blue-200 rounded p-3 text-xs text-blue-700">
              <p className="font-bold">å®Ÿè¡Œæ¦‚è¦</p>
              <div className="mt-2 space-y-1">
                <div className="flex justify-between"><span>å¯¾è±¡æœŸé–“:</span><span className="font-bold">2026/02/04 ã€œ 2026/02/10</span></div>
                <div className="flex justify-between"><span>å¯¾è±¡åŠ ç›Ÿåº—:</span><span className="font-bold">42ç¤¾</span></div>
                <div className="flex justify-between"><span>æ¨å®šç²¾ç®—é¡:</span><span className="font-bold">Â¥45,200,000</span></div>
                <div className="flex justify-between"><span>æ¨å®šæ‰‹æ•°æ–™:</span><span className="font-bold">Â¥1,560,000</span></div>
              </div>
            </div>
            <div>
              <label className="text-xs text-slate-500">å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰</label>
              <select className="w-full border rounded px-2 py-1.5 text-xs mt-0.5"><option>æœ¬ç•ªå®Ÿè¡Œ</option><option>ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼‰</option></select>
            </div>
            <div className="flex gap-2">
              <button onClick={() => setShowBatchConfirm(false)} className="flex-1 py-2 border rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowBatchConfirm(false); toast("ç²¾ç®—ãƒãƒƒãƒã®å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã—ãŸ", "success"); }} className="flex-1 py-2 bg-emerald-600 text-white rounded text-xs font-bold hover:bg-emerald-700">ãƒãƒƒãƒã‚’å®Ÿè¡Œ</button>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ M13: ã‚·ã‚¹ãƒ†ãƒ è¨­å®š â”€â”€â”€
const MasterSystemSettings = () => {
  const toast = useToast();
  const [sysTab, setSysTab] = useState(0);
  const [showAddProcessor, setShowAddProcessor] = useState(false);
  const [selectedSysProc, setSelectedSysProc] = useState(null);
  const [editingSysProc, setEditingSysProc] = useState(null);
  return (
  <div className="p-5 space-y-4">
    <h2 className="text-sm font-bold text-slate-800">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>

    {/* Tab navigation */}
    <div className="flex gap-1 border-b">
      {["æ±ºæ¸ˆæ‰‹æ®µ", "æ¥ç¶šå…ˆç®¡ç†", "é€šçŸ¥è¨­å®š", "APIè¨­å®š", "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£", "ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰", "ãŠçŸ¥ã‚‰ã›ç®¡ç†", "æ“ä½œãƒ­ã‚°"].map((tab, i) => (
        <button key={i} onClick={() => setSysTab(i)} className={`text-xs px-3 py-2 border-b-2 ${sysTab === i ? "border-blue-500 text-blue-600 font-semibold" : "border-transparent text-slate-400 hover:text-slate-600"}`}>{tab}</button>
      ))}
    </div>

    {/* â”€â”€â”€ Tab 0: æ±ºæ¸ˆæ‰‹æ®µ â”€â”€â”€ */}
    {sysTab === 0 && (<>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">æœ‰åŠ¹ãªæ±ºæ¸ˆæ‰‹æ®µ</p>
      <div className="space-y-2">
        {[
          { name: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆVISA / MC / JCB / AMEXï¼‰", status: true, processor: "Univa Pay cast / æ¥½å¤©éŠ€è¡Œ / Worldpay ä»–", fee: "3.0% ã€œ 3.6%" },
          { name: "WEBãƒãƒãƒ¼ï¼ˆãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ / ãƒšã‚¤ãƒ‡ã‚£ ä»–7ç¨®ï¼‰", status: true, processor: "å„ã‚µãƒ¼ãƒ“ã‚¹ç›´æ¥", fee: "3.5% ã€œ 5.0%" },
          { name: "Apple Pay / Google Pay", status: false, processor: "æœªè¨­å®š", fee: "-" },
        ].map((m, i) => (
          <div key={i} className="flex items-center gap-3 p-2 rounded border text-xs">
            <div className={`w-8 h-5 rounded-full relative cursor-pointer ${m.status ? "bg-emerald-500" : "bg-slate-300"}`}>
              <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all ${m.status ? "right-0.5" : "left-0.5"}`} />
            </div>
            <div className="flex-1">
              <p className="font-semibold text-slate-700">{m.name}</p>
              <p className="text-slate-400">æ¥ç¶šå…ˆ: {m.processor} / æ‰‹æ•°æ–™: {m.fee}</p>
            </div>
            <button onClick={() => toast(`${m.name} ã®è¨­å®šç”»é¢ã‚’é–‹ãã¾ã—ãŸ`, "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">è¨­å®š</button>
          </div>
        ))}
      </div>
    </div>

    {/* Payment Type Settings Table */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">æ±ºæ¸ˆç¨®åˆ¥ã”ã¨ã®è©³ç´°è¨­å®š</p>
      <div className="overflow-x-auto">
        <table className="w-full text-xs">
          <thead><tr className="bg-slate-50 text-slate-500">
            <th className="px-2 py-2 text-left font-semibold">æ±ºæ¸ˆç¨®åˆ¥</th>
            <th className="px-2 py-2 text-left font-semibold">ãƒ–ãƒ©ãƒ³ãƒ‰</th>
            <th className="px-2 py-2 text-center font-semibold">åŸºæœ¬æ‰‹æ•°æ–™ç‡</th>
            <th className="px-2 py-2 text-center font-semibold">TR(æˆåŠŸ)</th>
            <th className="px-2 py-2 text-center font-semibold">CBæ‰‹æ•°æ–™</th>
            <th className="px-2 py-2 text-center font-semibold">ãƒ‡ãƒã‚¸ãƒƒãƒˆ</th>
            <th className="px-2 py-2 text-center font-semibold">3DS</th>
            <th className="px-2 py-2 text-center font-semibold">é€šè²¨</th>
            <th className="px-2 py-2 text-center font-semibold">æœ€å°</th>
            <th className="px-2 py-2 text-center font-semibold">æœ€å¤§</th>
            <th className="px-2 py-2 text-center font-semibold">æœ‰åŠ¹</th>
          </tr></thead>
          <tbody>
          {[
            { type: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", brand: "VISA", fee: "3.0%", tr: "11ã€œ30å††", cb: "1,200ã€œ3,000å††", depo: "5ã€œ10%", tds: "å¿…é ˆ", currency: "JPY", min: "Â¥100", max: "Â¥999,999", active: true },
            { type: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", brand: "Mastercard", fee: "3.0%", tr: "11ã€œ30å††", cb: "1,200ã€œ3,000å††", depo: "5ã€œ10%", tds: "å¿…é ˆ", currency: "JPY", min: "Â¥100", max: "Â¥999,999", active: true },
            { type: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", brand: "JCB", fee: "3.25%", tr: "20å††", cb: "-", depo: "-", tds: "å¿…é ˆ", currency: "JPY", min: "Â¥100", max: "Â¥500,000", active: true },
            { type: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", brand: "AMEX", fee: "2.95%", tr: "-", cb: "-", depo: "10%", tds: "æ¨å¥¨", currency: "JPY", min: "Â¥100", max: "Â¥999,999", active: true },
            { type: "WEBãƒãƒãƒ¼", brand: "ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥", fee: "5.0%", tr: "-", cb: "-", depo: "-", tds: "-", currency: "JPY", min: "Â¥500", max: "Â¥200,000", active: true },
            { type: "WEBãƒãƒãƒ¼", brand: "ã‚¹ãƒãƒ¼ãƒˆãƒ”ãƒƒãƒˆ", fee: "Â¥300/ä»¶", tr: "-", cb: "-", depo: "-", tds: "-", currency: "JPY", min: "Â¥1,000", max: "Â¥300,000", active: true },
            { type: "WEBãƒãƒãƒ¼", brand: "ãƒãƒƒãƒˆãƒ©ã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥", fee: "5.0%", tr: "-", cb: "-", depo: "-", tds: "-", currency: "JPY", min: "Â¥500", max: "Â¥100,000", active: true },
            { type: "WEBãƒãƒãƒ¼", brand: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒãƒ¼", fee: "5.0%", tr: "-", cb: "-", depo: "-", tds: "-", currency: "JPY", min: "Â¥500", max: "Â¥100,000", active: true },
            { type: "WEBãƒãƒãƒ¼", brand: "Gãƒãƒãƒ¼", fee: "4.5%", tr: "-", cb: "-", depo: "-", tds: "-", currency: "JPY", min: "Â¥500", max: "Â¥150,000", active: true },
            { type: "WEBãƒãƒãƒ¼", brand: "ãƒšã‚¤ãƒ‡ã‚£", fee: "3.5%", tr: "-", cb: "-", depo: "-", tds: "-", currency: "JPY", min: "Â¥100", max: "Â¥500,000", active: true },
            { type: "WEBãƒãƒãƒ¼", brand: "ãƒ‹ãƒ¼ãƒã‚ªãƒšã‚¤", fee: "4.0%", tr: "-", cb: "-", depo: "-", tds: "-", currency: "JPY", min: "Â¥1,000", max: "Â¥200,000", active: true },
          ].map((r, i) => (
            <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
              <td className="px-2 py-2 text-slate-600">{r.type}</td>
              <td className="px-2 py-2 font-semibold text-slate-700">{r.brand}</td>
              <td className="px-2 py-2 text-center font-semibold text-blue-700">{r.fee}</td>
              <td className="px-2 py-2 text-center text-slate-500">{r.tr}</td>
              <td className="px-2 py-2 text-center text-slate-500">{r.cb}</td>
              <td className="px-2 py-2 text-center text-slate-500">{r.depo}</td>
              <td className="px-2 py-2 text-center"><Badge text={r.tds} color={r.tds === "å¿…é ˆ" ? "blue" : r.tds === "æ¨å¥¨" ? "green" : "gray"} /></td>
              <td className="px-2 py-2 text-center text-slate-500">{r.currency}</td>
              <td className="px-2 py-2 text-center text-slate-500">{r.min}</td>
              <td className="px-2 py-2 text-center text-slate-500">{r.max}</td>
              <td className="px-2 py-2 text-center">{r.active ? <span className="text-emerald-500">â—</span> : <span className="text-slate-300">â—</span>}</td>
            </tr>
          ))}
          </tbody>
        </table>
      </div>
    </div>
    </>)}

    {/* â”€â”€â”€ Tab 1: æ¥ç¶šå…ˆç®¡ç† â”€â”€â”€ */}
    {sysTab === 1 && (<>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼æ¥ç¶šä¸€è¦§</p>
        <button onClick={() => setShowAddProcessor(!showAddProcessor)} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold">+ æ¥ç¶šå…ˆè¿½åŠ </button>
      </div>

      {showAddProcessor && (
        <div className="bg-blue-50 rounded-lg border border-blue-200 p-3 mb-3 space-y-3">
          <div className="flex justify-between items-center"><p className="text-xs font-bold text-blue-700">ğŸ”— æ–°è¦æ¥ç¶šå…ˆè¿½åŠ </p><button onClick={() => setShowAddProcessor(false)} className="text-slate-400 text-sm">âœ•</button></div>
          <div className="grid grid-cols-2 gap-2">
            <div><label className="text-xs text-slate-500">ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼å *</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>Univa Pay cast</option><option>æ¥½å¤©éŠ€è¡Œ</option><option>Worldpay</option><option>TCMS</option><option>Simpletransact</option><option>ONTHELINE</option><option>Asiabill</option><option>ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥</option><option>ã‚¹ãƒãƒ¼ãƒˆãƒ”ãƒƒãƒˆ</option><option>ãƒãƒƒãƒˆãƒ©ã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥</option><option>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒãƒ¼</option><option>Gãƒãƒãƒ¼</option><option>ãƒšã‚¤ãƒ‡ã‚£</option><option>ãƒ‹ãƒ¼ãƒã‚ªãƒšã‚¤</option></select></div>
            <div><label className="text-xs text-slate-500">æ¥ç¶šã‚¿ã‚¤ãƒ— *</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>API</option><option>ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</option><option>SDK</option></select></div>
            <div><label className="text-xs text-slate-500">API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ *</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="https://api.example.com/v1" /></div>
            <div><label className="text-xs text-slate-500">ç’°å¢ƒ *</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>æœ¬ç•ª</option><option>ãƒ†ã‚¹ãƒˆ</option></select></div>
            <div><label className="text-xs text-slate-500">ãƒãƒ¼ãƒãƒ£ãƒ³ãƒˆID</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="mid_xxxx" /></div>
            <div><label className="text-xs text-slate-500">APIã‚­ãƒ¼</label><input type="password" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="sk_xxxx..." /></div>
          </div>
          <div className="flex gap-2 justify-end">
            <button onClick={() => setShowAddProcessor(false)} className="px-3 py-1.5 text-xs text-slate-500 border rounded">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={() => { setShowAddProcessor(false); toast("æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...", "info"); setTimeout(() => toast("æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼æ¥ç¶šå…ˆã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success"), 1500); }} className="px-3 py-1.5 text-xs bg-blue-600 text-white rounded font-semibold">æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
          </div>
        </div>
      )}

      <div className="overflow-x-auto">
        <table className="w-full text-xs">
          <thead><tr className="bg-slate-50 text-slate-500">
            <th className="px-3 py-2 text-left font-semibold">ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼</th>
            <th className="px-3 py-2 text-left font-semibold">ç¨®åˆ¥</th>
            <th className="px-3 py-2 text-center font-semibold">å¯¾å¿œãƒ–ãƒ©ãƒ³ãƒ‰</th>
            <th className="px-3 py-2 text-center font-semibold">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
            <th className="px-3 py-2 text-center font-semibold">ç¨¼åƒç‡</th>
            <th className="px-3 py-2 text-center font-semibold">æ‰¿èªæ¸ˆåŠ ç›Ÿåº—</th>
            <th className="px-3 py-2 text-center font-semibold">æ“ä½œ</th>
          </tr></thead>
          <tbody>
          {processorList.map((p, i) => (
            <React.Fragment key={p.id}>
            <tr className={`border-b ${selectedSysProc === p.id ? "bg-blue-50" : i % 2 ? "bg-slate-50" : ""} hover:bg-blue-50 cursor-pointer`} onClick={() => setSelectedSysProc(selectedSysProc === p.id ? null : p.id)}>
              <td className="px-3 py-2 font-semibold text-slate-700">
                <div className="flex items-center gap-1">
                  <span className={`text-xs ${selectedSysProc === p.id ? "text-blue-500" : "text-slate-400"}`}>{selectedSysProc === p.id ? "â–¼" : "â–¶"}</span>
                  {p.name}
                </div>
              </td>
              <td className="px-3 py-2 text-slate-500">{p.type}</td>
              <td className="px-3 py-2 text-center"><div className="flex gap-1 flex-wrap justify-center">{p.brands.map(b => <Badge key={b} text={b} color="blue" />)}</div></td>
              <td className="px-3 py-2 text-center"><Badge text={p.status} color={p.sColor} /></td>
              <td className="px-3 py-2 text-center text-emerald-600 font-semibold">{p.uptime}</td>
              <td className="px-3 py-2 text-center text-slate-700 font-semibold">{p.merchants}ç¤¾</td>
              <td className="px-3 py-2 text-center"><div className="flex gap-1 justify-center">
                <button className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs" onClick={(e) => e.stopPropagation()}>è¨­å®š</button>
                <button className="px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs" onClick={(e) => e.stopPropagation()}>ãƒ†ã‚¹ãƒˆ</button>
              </div></td>
            </tr>
            {/* æ¥ç¶šå…ˆæ¡ä»¶è©³ç´°ãƒ‘ãƒãƒ«ï¼ˆã‚¯ãƒªãƒƒã‚¯å±•é–‹ãƒ»adminä»¥ä¸Šç·¨é›†å¯ï¼‰ */}
            {selectedSysProc === p.id && (() => {
              const isCard = p.type !== "WEBãƒãƒãƒ¼";
              const isEditing = editingSysProc === p.id;
              const editInput = (val, w = "w-20") => isEditing
                ? <input defaultValue={val} className={`${w} text-xs border border-blue-300 rounded px-1.5 py-0.5 bg-white focus:outline-none focus:ring-1 focus:ring-blue-400`} onClick={(e) => e.stopPropagation()} />
                : <span className="font-semibold">{val}</span>;
              const editInputCenter = (val, w = "w-16") => isEditing
                ? <input defaultValue={val} className={`${w} text-xs border border-blue-300 rounded px-1.5 py-0.5 bg-white text-center focus:outline-none focus:ring-1 focus:ring-blue-400`} onClick={(e) => e.stopPropagation()} />
                : <p className={`text-xs font-bold ${val !== "-" ? "text-blue-700" : "text-slate-300"}`}>{val}</p>;
              return (
              <tr><td colSpan={7} className="p-0">
                <div className={`${isEditing ? "bg-amber-50 border-x border-b border-amber-300" : "bg-blue-50 border-x border-b border-blue-200"} p-3 space-y-3`}>
                  <div className="flex justify-between items-center">
                    <div className="flex items-center gap-2">
                      <p className="text-xs font-bold text-slate-700">ğŸ”Œ {p.name} â€” æ¡ä»¶è©³ç´°</p>
                      {isEditing && <Badge text="ç·¨é›†ä¸­" color="amber" />}
                    </div>
                    <div className="flex items-center gap-2">
                      {isEditing ? (
                        <>
                          <button onClick={(e) => { e.stopPropagation(); setEditingSysProc(null); }} className="px-2.5 py-1 text-xs text-slate-500 border border-slate-300 rounded hover:bg-slate-100">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                          <button onClick={(e) => { e.stopPropagation(); setEditingSysProc(null); toast("æ¥ç¶šå…ˆè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ", "success"); }} className="px-2.5 py-1 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">ğŸ’¾ ä¿å­˜</button>
                        </>
                      ) : (
                        <button onClick={(e) => { e.stopPropagation(); setEditingSysProc(p.id); }} className="px-2.5 py-1 text-xs bg-amber-500 text-white rounded font-semibold hover:bg-amber-600">âœï¸ ç·¨é›†ï¼ˆadminï¼‰</button>
                      )}
                      <button onClick={(e) => { e.stopPropagation(); setSelectedSysProc(null); setEditingSysProc(null); }} className="text-xs text-slate-400 hover:text-slate-600">âœ• é–‰ã˜ã‚‹</button>
                    </div>
                  </div>
                  {isEditing && (
                    <div className="bg-amber-100 border border-amber-300 rounded p-2 text-xs text-amber-800">
                      âš ï¸ adminä»¥ä¸Šã®æ¨©é™ã§ç·¨é›†ä¸­ã§ã™ã€‚å¤‰æ›´ã¯ä¿å­˜å¾Œã«å…¨åŠ ç›Ÿåº—ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
                    </div>
                  )}
                  <div className="grid grid-cols-2 gap-3">
                    {/* å·¦åˆ—: æ‰‹æ•°æ–™ */}
                    <div className="space-y-2">
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="text-xs font-bold text-slate-600 mb-2">ğŸ’° ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥æ‰‹æ•°æ–™ç‡ <span className="text-rose-500 font-normal">ï¼ˆä»•å…¥ã‚ŒåŸä¾¡ï¼‰</span></p>
                        <p className="text-[10px] text-slate-400 -mt-1 mb-2">â€» æ¥ç¶šå…ˆã‹ã‚‰æç¤ºã•ã‚ŒãŸåŸä¾¡æ‰‹æ•°æ–™ç‡ã€‚åŠ ç›Ÿåº—ã¸ã®æç¤ºæ–™ç‡ã¯ã€ŒåŠ ç›Ÿåº—ç®¡ç† â†’ ã‚µã‚¤ãƒˆç®¡ç†ã€ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰è¨­å®š</p>
                        {isCard ? (
                          <div className="grid grid-cols-5 gap-1.5">
                            {[{b:"VISA",k:"visa"},{b:"MC",k:"master"},{b:"JCB",k:"jcb"},{b:"AMEX",k:"amex"},{b:"Diners",k:"diners"}].map(({b,k}) => (
                              <div key={k} className={`rounded border p-1.5 text-center ${p.fees[k] !== "-" ? "bg-blue-50 border-blue-200" : "bg-slate-50 border-slate-200"}`}>
                                <p className="text-xs text-slate-400">{b}</p>
                                {editInputCenter(p.fees[k])}
                              </div>
                            ))}
                          </div>
                        ) : (
                          <div className="bg-blue-50 rounded border border-blue-200 p-2 text-center">
                            <p className="text-xs text-slate-400">WEBãƒãƒãƒ¼æ‰‹æ•°æ–™ <span className="text-rose-400">ï¼ˆä»•å…¥ã‚Œï¼‰</span></p>
                            {isEditing ? <input defaultValue={p.fees.webmoney} className="w-20 text-sm border border-blue-300 rounded px-1.5 py-0.5 bg-white text-center font-bold focus:outline-none focus:ring-1 focus:ring-blue-400 mx-auto block" onClick={(e) => e.stopPropagation()} /> : <p className="text-sm font-bold text-blue-700">{p.fees.webmoney}</p>}
                          </div>
                        )}
                      </div>
                      {isCard && (
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="text-xs font-bold text-slate-600 mb-2">ğŸ“Š TRæ‰‹æ•°æ–™</p>
                        <div className="grid grid-cols-3 gap-1.5">
                          {[{l:"TR(æˆåŠŸ)",v:p.trFees.success},{l:"TR(å¤±æ•—)",v:p.trFees.fail},{l:"CBæ‰‹æ•°æ–™",v:p.trFees.cb},{l:"è¿”é‡‘",v:p.trFees.refund},{l:"3DS",v:p.trFees.tds},{l:"CBå–æ¶ˆ",v:p.trFees.cbCancel}].map(({l,v}) => (
                            <div key={l} className="bg-slate-50 rounded border border-slate-200 p-1.5">
                              <p className="text-xs text-slate-400">{l}</p>
                              {isEditing ? <input defaultValue={v} className="w-full text-xs border border-blue-300 rounded px-1.5 py-0.5 bg-white focus:outline-none focus:ring-1 focus:ring-blue-400 mt-0.5" onClick={(e) => e.stopPropagation()} /> : <p className={`text-xs font-bold ${v !== "-" ? "text-slate-700" : "text-slate-300"}`}>{v}</p>}
                            </div>
                          ))}
                        </div>
                      </div>
                      )}
                    </div>
                    {/* å³åˆ—: æ¡ä»¶ãƒ»åˆ¶é™ */}
                    <div className="space-y-2">
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="text-xs font-bold text-slate-600 mb-2">ğŸ”’ ãƒ‡ãƒã‚¸ãƒƒãƒˆãƒ»åˆ¶é™</p>
                        <div className="grid grid-cols-2 gap-2">
                          <div className="bg-purple-50 rounded border border-purple-200 p-2 space-y-1 text-xs">
                            <p className="font-semibold text-purple-700 mb-0.5">ç•™ä¿æ¡ä»¶</p>
                            <div className="flex justify-between items-center"><span className="text-slate-400">ç•™ä¿ç‡</span>{editInput(p.deposit.rate)}</div>
                            <div className="flex justify-between items-center"><span className="text-slate-400">æœŸé–“</span>{editInput(p.deposit.period)}</div>
                            <div className="flex justify-between items-center"><span className="text-slate-400">ã‚¿ã‚¤ãƒ—</span>{isEditing ? <select defaultValue={p.deposit.type} className="w-28 text-xs border border-blue-300 rounded px-1 py-0.5 bg-white" onClick={(e) => e.stopPropagation()}><option>ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–</option><option>å›ºå®šãƒªã‚¶ãƒ¼ãƒ–</option><option>ãªã—</option></select> : <span className="font-semibold">{p.deposit.type}</span>}</div>
                          </div>
                          <div className="bg-amber-50 rounded border border-amber-200 p-2 space-y-1 text-xs">
                            <p className="font-semibold text-amber-700 mb-0.5">å–å¼•åˆ¶é™</p>
                            <div className="flex justify-between items-center"><span className="text-slate-400">TRä¸Šé™</span>{editInput(p.limits.trMax)}</div>
                            <div className="flex justify-between items-center"><span className="text-slate-400">æœˆé–“ä¸Šé™</span>{editInput(p.limits.monthlyMax)}</div>
                            <div className="flex justify-between items-center"><span className="text-slate-400">å›æ•°</span>{editInput(p.limits.countLimit)}</div>
                          </div>
                        </div>
                      </div>
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="text-xs font-bold text-slate-600 mb-2">ğŸ’µ å›ºå®šè²»ãƒ»å…¥é‡‘</p>
                        <div className="grid grid-cols-2 gap-2">
                          <div className="bg-emerald-50 rounded border border-emerald-200 p-2 space-y-1 text-xs">
                            <p className="font-semibold text-emerald-700 mb-0.5">å›ºå®šè²»</p>
                            <div className="flex justify-between items-center"><span className="text-slate-400">åˆæœŸ</span>{editInput(p.fixedCost.initial)}</div>
                            <div className="flex justify-between items-center"><span className="text-slate-400">æœˆé¡</span>{editInput(p.fixedCost.monthly)}</div>
                          </div>
                          <div className="bg-blue-50 rounded border border-blue-200 p-2 space-y-1 text-xs">
                            <p className="font-semibold text-blue-700 mb-0.5">å…¥é‡‘æƒ…å ±</p>
                            <div className="flex justify-between items-center"><span className="text-slate-400">å£åº§</span>{isEditing ? <select defaultValue={p.settlement.account} className="w-28 text-xs border border-blue-300 rounded px-1 py-0.5 bg-white" onClick={(e) => e.stopPropagation()}><option>æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰</option><option>æµ·å¤–å£åº§ï¼ˆUSDï¼‰</option><option>æµ·å¤–å£åº§ï¼ˆEURï¼‰</option></select> : <span className="font-semibold">{p.settlement.account}</span>}</div>
                          </div>
                        </div>
                        <div className="mt-1.5 bg-slate-50 rounded border border-slate-200 p-1.5 text-xs">
                          <span className="text-slate-400">å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«: </span>{isEditing ? <input defaultValue={p.settlement.cycle} className="w-full text-xs border border-blue-300 rounded px-1.5 py-0.5 bg-white mt-0.5 focus:outline-none focus:ring-1 focus:ring-blue-400" onClick={(e) => e.stopPropagation()} /> : <span className="font-semibold text-slate-700">{p.settlement.cycle}</span>}
                        </div>
                      </div>
                      {isCard && (
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="text-xs font-bold text-slate-600 mb-1">ğŸš« åˆ¶é™äº‹é …</p>
                        <div className="space-y-1 text-xs">
                          <div className="flex items-center gap-1"><span className="text-slate-400 w-10">CVV:</span>{isEditing ? <input defaultValue={p.restrictions.cvv} className="flex-1 text-xs border border-blue-300 rounded px-1.5 py-0.5 bg-white focus:outline-none focus:ring-1 focus:ring-blue-400" onClick={(e) => e.stopPropagation()} /> : <span className="font-semibold">{p.restrictions.cvv}</span>}</div>
                          <div className="flex items-center gap-1"><span className="text-slate-400 w-10">NG:</span>{isEditing ? <input defaultValue={p.restrictions.ngGenre} className="flex-1 text-xs border border-blue-300 rounded px-1.5 py-0.5 bg-white focus:outline-none focus:ring-1 focus:ring-blue-400" onClick={(e) => e.stopPropagation()} /> : <span className="font-semibold">{p.restrictions.ngGenre}</span>}</div>
                          <div className="flex items-center gap-1"><span className="text-slate-400 w-10">USD:</span>{isEditing ? <select defaultValue={p.restrictions.usd ? "å¯¾å¿œ" : "éå¯¾å¿œ"} className="text-xs border border-blue-300 rounded px-1 py-0.5 bg-white" onClick={(e) => e.stopPropagation()}><option>å¯¾å¿œ</option><option>éå¯¾å¿œ</option></select> : <span className="font-semibold">{p.restrictions.usd ? "å¯¾å¿œ" : "éå¯¾å¿œ"}</span>}</div>
                        </div>
                      </div>
                      )}
                    </div>
                  </div>
                </div>
              </td></tr>
              );
            })()}
            </React.Fragment>
          ))}
          </tbody>
        </table>
      </div>
    </div>

    {/* Routing Rules */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«</p>
        <button onClick={() => toast("ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 text-slate-600 px-3 py-1.5 rounded font-semibold">+ ãƒ«ãƒ¼ãƒ«è¿½åŠ </button>
      </div>
      <div className="space-y-2">
        {[
          { rule: "VISA â†’ Univa Pay castï¼ˆå„ªå…ˆï¼‰â†’ Worldpayï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰", priority: 1, active: true },
          { rule: "MC â†’ æ¥½å¤©éŠ€è¡Œï¼ˆå„ªå…ˆï¼‰â†’ Simpletransactï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰", priority: 2, active: true },
          { rule: "JCB â†’ TCMSï¼ˆå„ªå…ˆï¼‰â†’ ONTHELINEï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰", priority: 3, active: true },
          { rule: "AMEX â†’ Asiabillï¼ˆå˜ç‹¬ï¼‰", priority: 4, active: true },
          { rule: "WEBãƒãƒãƒ¼ â†’ å„ã‚µãƒ¼ãƒ“ã‚¹ç›´æ¥ï¼ˆå›ºå®šãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰", priority: 5, active: true },
        ].map((r, i) => (
          <div key={i} className="flex items-center gap-3 p-2 rounded border text-xs">
            <span className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold">{r.priority}</span>
            <span className="flex-1 text-slate-700">{r.rule}</span>
            <div className={`w-8 h-5 rounded-full relative cursor-pointer ${r.active ? "bg-emerald-500" : "bg-slate-300"}`}>
              <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all ${r.active ? "right-0.5" : "left-0.5"}`} />
            </div>
            <button onClick={() => toast(`ãƒ«ãƒ¼ãƒ«${r.priority}ã‚’ç·¨é›†ä¸­`, "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded">ç·¨é›†</button>
          </div>
        ))}
      </div>
    </div>

    {/* Health Monitor */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">æ¥ç¶šå…ˆãƒ˜ãƒ«ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒ¼ï¼ˆç›´è¿‘24æ™‚é–“ï¼‰</p>
      <div className="grid grid-cols-3 gap-3">
        {[
          { name: "Univa Pay cast", uptime: "99.97%", incidents: 0, avgLatency: "120ms" },
          { name: "æ¥½å¤©éŠ€è¡Œ", uptime: "99.99%", incidents: 0, avgLatency: "85ms" },
          { name: "Worldpay", uptime: "99.93%", incidents: 1, avgLatency: "110ms" },
        ].map((h, i) => (
          <div key={i} className="bg-slate-50 rounded-lg p-3 border">
            <div className="flex justify-between items-center mb-2">
              <span className="text-xs font-bold text-slate-700">{h.name}</span>
              <span className="text-xs font-bold text-emerald-600">{h.uptime}</span>
            </div>
            <div className="flex gap-0.5 mb-2">
              {Array.from({ length: 24 }, (_, j) => (
                <div key={j} className={`flex-1 h-4 rounded-sm ${j === 14 && h.incidents > 0 ? "bg-amber-400" : "bg-emerald-400"}`} title={`${j}:00`} />
              ))}
            </div>
            <div className="flex justify-between text-xs text-slate-400">
              <span>ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ: {h.incidents}ä»¶</span>
              <span>å¹³å‡ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·: {h.avgLatency}</span>
            </div>
          </div>
        ))}
      </div>
    </div>
    </>)}

    {/* â”€â”€â”€ Tab 2: é€šçŸ¥è¨­å®š â”€â”€â”€ */}
    {sysTab === 2 && (<>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«è¨­å®š</p>
        <button onClick={() => toast("é€šçŸ¥è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ", "success")} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold">ä¿å­˜</button>
      </div>

      {/* Channel configuration */}
      <div className="grid grid-cols-3 gap-3 mb-4">
        {[
          { ch: "Slack", icon: "ğŸ’¬", config: "Webhook URL", value: "https://hooks.slack.com/...xxxx", channel: "#payment-alerts", status: true },
          { ch: "Email", icon: "ğŸ“§", config: "é€ä¿¡å…ˆ", value: "alert@company.jp, admin@company.jp", channel: "", status: true },
          { ch: "SMS", icon: "ğŸ“±", config: "é€ä¿¡å…ˆç•ªå·", value: "090-xxxx-xxxx, 080-xxxx-xxxx", channel: "", status: true },
        ].map((c, i) => (
          <div key={i} className="bg-slate-50 rounded-lg p-3 border">
            <div className="flex justify-between items-center mb-2">
              <span className="text-xs font-bold text-slate-700">{c.icon} {c.ch}</span>
              <div className={`w-8 h-5 rounded-full relative cursor-pointer ${c.status ? "bg-emerald-500" : "bg-slate-300"}`}>
                <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all ${c.status ? "right-0.5" : "left-0.5"}`} />
              </div>
            </div>
            <div className="space-y-1">
              <label className="text-xs text-slate-400">{c.config}</label>
              <input className="w-full text-xs border rounded px-2 py-1.5" defaultValue={c.value} />
              {c.channel && <><label className="text-xs text-slate-400">ãƒãƒ£ãƒ³ãƒãƒ«</label><input className="w-full text-xs border rounded px-2 py-1.5" defaultValue={c.channel} /></>}
            </div>
            <button onClick={() => { toast(`${c.ch}ã«ãƒ†ã‚¹ãƒˆé€ä¿¡ä¸­...`, "info"); setTimeout(() => toast(`${c.ch}ã®ãƒ†ã‚¹ãƒˆé€ä¿¡ãŒå®Œäº†ã—ã¾ã—ãŸ`, "success"), 1500); }} className="text-xs text-blue-600 mt-2 hover:underline">ãƒ†ã‚¹ãƒˆé€ä¿¡</button>
          </div>
        ))}
      </div>
    </div>

    {/* Notification Rules */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">ã‚¤ãƒ™ãƒ³ãƒˆåˆ¥é€šçŸ¥è¨­å®š</p>
      <table className="w-full text-xs">
        <thead><tr className="bg-slate-50 text-slate-500">
          <th className="px-3 py-2 text-left font-semibold">ã‚«ãƒ†ã‚´ãƒª</th>
          <th className="px-3 py-2 text-left font-semibold">ã‚¤ãƒ™ãƒ³ãƒˆ</th>
          <th className="px-3 py-2 text-center font-semibold">Slack</th>
          <th className="px-3 py-2 text-center font-semibold">Email</th>
          <th className="px-3 py-2 text-center font-semibold">SMS</th>
          <th className="px-3 py-2 text-center font-semibold">é‡è¦åº¦</th>
        </tr></thead>
        <tbody>
        {[
          { cat: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", event: "æ–°è¦è¿½åŠ ", slack: true, email: true, sms: false, level: "ä¸­" },
          { cat: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", event: "æ»ç•™1æ™‚é–“è¶…", slack: true, email: true, sms: true, level: "é«˜" },
          { cat: "ä¸æ­£æ¤œçŸ¥", event: "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯", slack: true, email: false, sms: false, level: "ä¸­" },
          { cat: "ä¸æ­£æ¤œçŸ¥", event: "é«˜ãƒªã‚¹ã‚¯æ¤œçŸ¥", slack: true, email: true, sms: true, level: "ç·Šæ€¥" },
          { cat: "æ±ºæ¸ˆ", event: "å…¥é‡‘ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ", slack: true, email: true, sms: true, level: "é«˜" },
          { cat: "æ±ºæ¸ˆ", event: "æ±ºæ¸ˆæˆåŠŸç‡ä½ä¸‹ï¼ˆ<95%ï¼‰", slack: true, email: true, sms: true, level: "ç·Šæ€¥" },
          { cat: "ã‚·ã‚¹ãƒ†ãƒ ", event: "ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼éšœå®³", slack: true, email: true, sms: true, level: "ç·Šæ€¥" },
          { cat: "ã‚·ã‚¹ãƒ†ãƒ ", event: "CPU/ãƒ¡ãƒ¢ãƒªé–¾å€¤è¶…é", slack: true, email: true, sms: false, level: "é«˜" },
          { cat: "å·¡å›", event: "URLå·¡å› â€” ç•°å¸¸æ¤œçŸ¥", slack: true, email: true, sms: false, level: "ä¸­" },
          { cat: "æ¥­å‹™", event: "æ—¥æ¬¡ç²¾ç®—å®Œäº†", slack: true, email: false, sms: false, level: "ä½" },
          { cat: "æ¥­å‹™", event: "æ–°è¦åŠ ç›Ÿåº—ç”³è¾¼", slack: true, email: false, sms: false, level: "ä½" },
          { cat: "æ¥­å‹™", event: "æ–°è¦ä»£ç†åº—ç”³è¾¼", slack: true, email: false, sms: false, level: "ä½" },
        ].map((n, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-3 py-2 text-slate-500">{n.cat}</td>
            <td className="px-3 py-2 text-slate-700 font-semibold">{n.event}</td>
            <td className="px-3 py-2 text-center"><input type="checkbox" defaultChecked={n.slack} className="w-3.5 h-3.5" /></td>
            <td className="px-3 py-2 text-center"><input type="checkbox" defaultChecked={n.email} className="w-3.5 h-3.5" /></td>
            <td className="px-3 py-2 text-center"><input type="checkbox" defaultChecked={n.sms} className="w-3.5 h-3.5" /></td>
            <td className="px-3 py-2 text-center"><Badge text={n.level} color={n.level === "ç·Šæ€¥" ? "red" : n.level === "é«˜" ? "yellow" : n.level === "ä¸­" ? "blue" : "gray"} /></td>
          </tr>
        ))}
        </tbody>
      </table>
    </div>

    {/* Notification Schedule */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</p>
      <div className="grid grid-cols-2 gap-3">
        <div className="bg-slate-50 rounded-lg p-3 border">
          <p className="text-xs font-bold text-slate-700 mb-2">ğŸ”• ã‚µã‚¤ãƒ¬ãƒ³ãƒˆæ™‚é–“å¸¯</p>
          <div className="flex items-center gap-2">
            <input type="time" className="text-xs border rounded px-2 py-1.5" defaultValue="00:00" />
            <span className="text-xs text-slate-400">ã€œ</span>
            <input type="time" className="text-xs border rounded px-2 py-1.5" defaultValue="07:00" />
          </div>
          <p className="text-xs text-slate-400 mt-1">â€» ç·Šæ€¥ãƒ¬ãƒ™ãƒ«ã¯ã‚µã‚¤ãƒ¬ãƒ³ãƒˆæ™‚é–“ä¸­ã‚‚é€šçŸ¥ã•ã‚Œã¾ã™</p>
        </div>
        <div className="bg-slate-50 rounded-lg p-3 border">
          <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“Š å®šæœŸãƒ¬ãƒãƒ¼ãƒˆ</p>
          <div className="space-y-1.5">
            <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ï¼ˆæ¯æœ9:00ï¼‰</span></label>
            <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæœˆæ›œ10:00ï¼‰</span></label>
            <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ1æ—¥10:00ï¼‰</span></label>
          </div>
        </div>
      </div>
    </div>
    </>)}

    {/* â”€â”€â”€ Tab 3: APIè¨­å®šï¼ˆAI APIã‚­ãƒ¼ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šå«ã‚€ï¼‰ â”€â”€â”€ */}
    {sysTab === 3 && (<>
    {/* AI API Keys */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ğŸ¤– AI API ã‚­ãƒ¼è¨­å®š</p>
        <Badge text="Claude API" color="purple" />
      </div>
      <div className="space-y-3">
        <div className="bg-purple-50 rounded-lg p-3 border border-purple-200">
          <div className="flex justify-between items-center mb-2">
            <span className="text-xs font-bold text-purple-700">Anthropic Claude API</span>
            <Badge text="æ¥ç¶šæ¸ˆ" color="green" />
          </div>
          <div className="grid grid-cols-2 gap-2">
            <div><label className="text-xs text-slate-500">API Key *</label><div className="flex gap-1 mt-0.5"><input type="password" className="flex-1 text-xs border rounded px-2 py-1.5" defaultValue="sk-ant-api03-xxxxxxxxxxxx" /><button onClick={() => toast("APIã‚­ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã—ãŸï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„ï¼‰", "warning")} className="text-xs px-2 py-1.5 bg-slate-100 rounded">è¡¨ç¤º</button></div></div>
            <div><label className="text-xs text-slate-500">ãƒ¢ãƒ‡ãƒ« *</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>claude-sonnet-4-20250514</option><option>claude-opus-4-20250514</option><option>claude-haiku-35-20241022</option></select></div>
            <div><label className="text-xs text-slate-500">æœˆé–“äºˆç®—ä¸Šé™</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="Â¥100,000" /></div>
            <div><label className="text-xs text-slate-500">ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆreq/minï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="60" /></div>
          </div>
          <div className="flex gap-3 mt-2 text-xs text-slate-400">
            <span>ä»Šæœˆä½¿ç”¨: Â¥44,200 / Â¥100,000</span>
            <span>APIå‘¼å‡º: 3,842å›</span>
            <span>ãƒˆãƒ¼ã‚¯ãƒ³: 2.4M</span>
          </div>
        </div>

        <div className="bg-slate-50 rounded-lg p-3 border border-slate-200">
          <div className="flex justify-between items-center mb-2">
            <span className="text-xs font-bold text-slate-700">OpenAI APIï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼‰</span>
            <Badge text="æœªè¨­å®š" color="gray" />
          </div>
          <div className="grid grid-cols-2 gap-2">
            <div><label className="text-xs text-slate-500">API Key</label><input type="password" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="sk-xxxx..." /></div>
            <div><label className="text-xs text-slate-500">ãƒ¢ãƒ‡ãƒ«</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>gpt-4o</option><option>gpt-4-turbo</option><option>gpt-3.5-turbo</option></select></div>
          </div>
        </div>
      </div>
    </div>

    {/* AI Prompt Configuration */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ğŸ“ AIæ©Ÿèƒ½åˆ¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</p>
        <div className="flex gap-2">
          <button onClick={() => toast("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æˆ»ã—ã¾ã—ãŸ", "info")} className="text-xs bg-slate-100 text-slate-600 px-3 py-1.5 rounded font-semibold">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æˆ»ã™</button>
          <button onClick={() => toast("å…¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ", "success")} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold">å…¨ã¦ä¿å­˜</button>
        </div>
      </div>
      <div className="space-y-3">
        {[
          { name: "ä¸æ­£æ¤œçŸ¥AI", desc: "ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸æ­£ãƒªã‚¹ã‚¯ã‚’åˆ¤å®šã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ", model: "claude-sonnet-4-20250514", maxTokens: 2000, temp: 0.1, prompt: "ã‚ãªãŸã¯æ±ºæ¸ˆä¸æ­£æ¤œçŸ¥ã®å°‚é–€AIã§ã™ã€‚ä»¥ä¸‹ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’åˆ†æã—ã€ä¸æ­£ãƒªã‚¹ã‚¯ã‚’0-100ã®ã‚¹ã‚³ã‚¢ã§åˆ¤å®šã—ã¦ãã ã•ã„ã€‚\n\nåˆ¤å®šåŸºæº–:\n- å–å¼•é‡‘é¡ã®ç•°å¸¸æ€§\n- éå»ã®å–å¼•ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®ä¹–é›¢\n- ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ãƒ»IPæƒ…å ±ã®æ•´åˆæ€§\n- åœ°ç†çš„ãªä¸è‡ªç„¶ã•\n- çŸ­æ™‚é–“ã§ã®é€£ç¶šå–å¼•\n\nå‡ºåŠ›å½¢å¼: JSON { risk_score, risk_level, reasons[], recommendation }" },
          { name: "å¯©æŸ»AI", desc: "åŠ ç›Ÿåº—ã®å¯©æŸ»åˆ¤å®šã‚’æ”¯æ´ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ", model: "claude-sonnet-4-20250514", maxTokens: 4000, temp: 0.2, prompt: "ã‚ãªãŸã¯æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹ã®åŠ ç›Ÿåº—å¯©æŸ»AIã§ã™ã€‚æå‡ºã•ã‚ŒãŸç”³è«‹æƒ…å ±ã‚’ç·åˆçš„ã«åˆ†æã—ã€å¯©æŸ»åˆ¤å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n\nåˆ¤å®šé …ç›®:\n- äº‹æ¥­å†…å®¹ã®é©æ³•æ€§\n- ç‰¹å®šå•†å–å¼•æ³•ã®éµå®ˆ\n- Webã‚µã‚¤ãƒˆã®é©åˆ‡æ€§\n- è²¡å‹™å¥å…¨æ€§\n- åç¤¾ãƒã‚§ãƒƒã‚¯çµæœ\n\nå‡ºåŠ›å½¢å¼: JSON { decision, risk_level, score, findings[], conditions[] }" },
          { name: "AIãƒãƒ£ãƒƒãƒˆã‚µãƒãƒ¼ãƒˆ", desc: "åŠ ç›Ÿåº—å‘ã‘ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ", model: "claude-haiku-35-20241022", maxTokens: 1500, temp: 0.7, prompt: "ã‚ãªãŸã¯æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹ã€ŒAIpaymentã€ã®ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆAIã§ã™ã€‚åŠ ç›Ÿåº—ã®ãŠå®¢æ§˜ã‹ã‚‰ã®è³ªå•ã«ä¸å¯§ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚\n\nå¯¾å¿œç¯„å›²:\n- æ±ºæ¸ˆã«é–¢ã™ã‚‹ä¸€èˆ¬çš„ãªè³ªå•\n- ç®¡ç†ç”»é¢ã®æ“ä½œæ–¹æ³•\n- å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ã„ã¦\n- APIé€£æºã®åŸºæœ¬çš„ãªè³ªå•\n\nã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¡ä»¶:\n- å€‹åˆ¥ã®å–å¼•ã«é–¢ã™ã‚‹è‹¦æƒ…\n- å¥‘ç´„å†…å®¹ã®å¤‰æ›´\n- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ" },
          { name: "ãƒ¬ãƒãƒ¼ãƒˆAI", desc: "æ—¥æ¬¡ãƒ»æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ", model: "claude-sonnet-4-20250514", maxTokens: 8000, temp: 0.3, prompt: "ã‚ãªãŸã¯æ±ºæ¸ˆãƒ‡ãƒ¼ã‚¿ã®åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹AIã§ã™ã€‚æä¾›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’å«ã‚€ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\nãƒ¬ãƒãƒ¼ãƒˆé …ç›®:\n- ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼\n- KPIåˆ†æï¼ˆå£²ä¸Šã€ä»¶æ•°ã€æˆåŠŸç‡ï¼‰\n- ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ\n- ç•°å¸¸å€¤æ¤œå‡º\n- æ”¹å–„ææ¡ˆ" },
          { name: "URLå·¡å›AI", desc: "åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆã‚’å·¡å›ã—ã€è¦ç´„é•åã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ", model: "claude-sonnet-4-20250514", maxTokens: 3000, temp: 0.1, prompt: "ã‚ãªãŸã¯åŠ ç›Ÿåº—Webã‚µã‚¤ãƒˆã®ç›£è¦–AIã§ã™ã€‚æä¾›ã•ã‚ŒãŸWebãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ†æã—ã€æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨è¦ç´„ã¸ã®é•åãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚\n\nãƒã‚§ãƒƒã‚¯é …ç›®:\n- ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜ã®æœ‰ç„¡\n- ç¦æ­¢æ¥­ç¨®ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„\n- è™šå½ãƒ»èª‡å¤§åºƒå‘Š\n- æ¶ˆè²»è€…ä¿è­·ã«åã™ã‚‹è¡¨ç¾\n- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡Œ" },
          { name: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°AI", desc: "æœ€é©ãªæ±ºæ¸ˆçµŒè·¯ã‚’é¸æŠã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ", model: "claude-haiku-35-20241022", maxTokens: 500, temp: 0.0, prompt: "ã‚ãªãŸã¯æ±ºæ¸ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æœ€é©åŒ–AIã§ã™ã€‚ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±ã¨å„ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã®çŠ¶æ…‹ã‹ã‚‰ã€æœ€é©ãªå‡¦ç†çµŒè·¯ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\n\nè€ƒæ…®è¦ç´ :\n- ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã®ç¨¼åƒçŠ¶æ³\n- ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·\n- æ‰‹æ•°æ–™ç‡\n- æˆåŠŸç‡\n- ã‚«ãƒ¼ãƒ‰ãƒ–ãƒ©ãƒ³ãƒ‰ã®å¯¾å¿œçŠ¶æ³" },
        ].map((ai, i) => (
          <div key={i} className="bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div className="flex justify-between items-center mb-2">
              <div>
                <span className="text-xs font-bold text-slate-700">ğŸ¤– {ai.name}</span>
                <span className="text-xs text-slate-400 ml-2">{ai.desc}</span>
              </div>
              <div className="flex gap-2">
                <button onClick={() => { toast(`${ai.name}ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...`, "info"); setTimeout(() => toast(`${ai.name}ã®ãƒ†ã‚¹ãƒˆå®Œäº†`, "success"), 1500); }} className="text-xs text-blue-600 hover:underline">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button onClick={() => toast(`${ai.name}ã®å®Ÿè¡Œå±¥æ­´ã‚’è¡¨ç¤º`, "info")} className="text-xs text-slate-500 hover:underline">å±¥æ­´</button>
              </div>
            </div>
            <div className="grid grid-cols-3 gap-2 mb-2">
              <div><label className="text-xs text-slate-400">ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue={ai.model}><option>claude-sonnet-4-20250514</option><option>claude-opus-4-20250514</option><option>claude-haiku-35-20241022</option></select></div>
              <div><label className="text-xs text-slate-400">æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue={ai.maxTokens} /></div>
              <div><label className="text-xs text-slate-400">Temperature</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue={ai.temp} /></div>
            </div>
            <div>
              <label className="text-xs text-slate-400">ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</label>
              <textarea className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 font-mono bg-white" rows={4} defaultValue={ai.prompt} />
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* External API Keys (Payment Gateways) */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">ğŸ”‘ å¤–éƒ¨API ã‚­ãƒ¼ç®¡ç†</p>
      <table className="w-full text-xs">
        <thead><tr className="bg-slate-50 text-slate-500">
          <th className="px-3 py-2 text-left font-semibold">ã‚µãƒ¼ãƒ“ã‚¹</th>
          <th className="px-3 py-2 text-left font-semibold">ã‚­ãƒ¼ã‚¿ã‚¤ãƒ—</th>
          <th className="px-3 py-2 text-left font-semibold">å€¤</th>
          <th className="px-3 py-2 text-center font-semibold">ç’°å¢ƒ</th>
          <th className="px-3 py-2 text-center font-semibold">æœ€çµ‚æ›´æ–°</th>
          <th className="px-3 py-2 text-center font-semibold">æ“ä½œ</th>
        </tr></thead>
        <tbody>
        {[
          { service: "Univa Pay cast", type: "ãƒãƒ¼ãƒãƒ£ãƒ³ãƒˆID", value: "mid_univa_xxxx", env: "æœ¬ç•ª", updated: "2026-01-15" },
          { service: "Univa Pay cast", type: "APIã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ", value: "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢", env: "æœ¬ç•ª", updated: "2026-01-15" },
          { service: "æ¥½å¤©éŠ€è¡Œ", type: "ã‚·ãƒ§ãƒƒãƒ—ID", value: "rb_shop_xxxx", env: "æœ¬ç•ª", updated: "2025-12-20" },
          { service: "æ¥½å¤©éŠ€è¡Œ", type: "APIã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ", value: "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢", env: "æœ¬ç•ª", updated: "2025-12-20" },
          { service: "Worldpay", type: "API Key", value: "wp_xxxxxxxxxxxx", env: "æœ¬ç•ª", updated: "2026-02-01" },
          { service: "Worldpay", type: "API Secret", value: "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢", env: "æœ¬ç•ª", updated: "2026-02-01" },
          { service: "ãƒšã‚¤ãƒ‡ã‚£", type: "API Key", value: "paidy_xxxxxxxxxxxx", env: "æœ¬ç•ª", updated: "2026-02-01" },
          { service: "ãƒšã‚¤ãƒ‡ã‚£", type: "API Secret", value: "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢", env: "æœ¬ç•ª", updated: "2026-02-01" },
        ].map((k, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-3 py-2 font-semibold text-slate-700">{k.service}</td>
            <td className="px-3 py-2 text-slate-600">{k.type}</td>
            <td className="px-3 py-2 text-slate-500 font-mono">{k.value}</td>
            <td className="px-3 py-2 text-center"><Badge text={k.env} color="purple" /></td>
            <td className="px-3 py-2 text-center text-slate-400">{k.updated}</td>
            <td className="px-3 py-2 text-center"><div className="flex gap-1 justify-center">
              <button onClick={() => toast(`${k.service} ${k.type}ã‚’ç·¨é›†ä¸­`, "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded">ç·¨é›†</button>
              <button onClick={() => toast(`${k.service} ${k.type}ã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã—ãŸ`, "success")} className="px-2 py-1 bg-blue-50 text-blue-600 rounded">å›è»¢</button>
            </div></td>
          </tr>
        ))}
        </tbody>
      </table>
    </div>

    {/* Webhook Settings */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ğŸ”” Webhookè¨­å®š</p>
        <button onClick={() => toast("Webhookã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold">+ Webhookè¿½åŠ </button>
      </div>
      <div className="space-y-2">
        {[
          { url: "https://api.company.jp/webhook/payment", events: "æ±ºæ¸ˆå®Œäº†, è¿”é‡‘å®Œäº†", status: true, lastCall: "2så‰", successRate: "99.9%" },
          { url: "https://api.company.jp/webhook/alert", events: "ä¸æ­£æ¤œçŸ¥, å…¥é‡‘ã‚¨ãƒ©ãƒ¼", status: true, lastCall: "5må‰", successRate: "100%" },
        ].map((w, i) => (
          <div key={i} className="flex items-center gap-3 p-2 rounded border text-xs">
            <div className={`w-2 h-2 rounded-full ${w.status ? "bg-emerald-500" : "bg-slate-300"}`} />
            <div className="flex-1">
              <p className="font-mono text-slate-700">{w.url}</p>
              <p className="text-slate-400">ã‚¤ãƒ™ãƒ³ãƒˆ: {w.events}</p>
            </div>
            <span className="text-slate-400">æœ€çµ‚: {w.lastCall}</span>
            <span className="text-emerald-600 font-semibold">{w.successRate}</span>
            <button onClick={() => toast("Webhookè¨­å®šã‚’é–‹ãã¾ã—ãŸ", "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded">è¨­å®š</button>
          </div>
        ))}
      </div>
    </div>
    </>)}

    {/* â”€â”€â”€ Tab 4: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ â”€â”€â”€ */}
    {sysTab === 4 && (<>
    <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700 mb-2">
      ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç³»è¨­å®šã®å¤‰æ›´ã¯ <strong>adminç”³è«‹ â†’ super_adminæ‰¿èª</strong> ãŒå¿…è¦ã§ã™ã€‚
    </div>

    {/* Password Policy */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ <span className="text-emerald-600 font-normal">PCI DSS v4.0 Req 8.3.6æº–æ‹ </span></p>
      <div className="grid grid-cols-2 gap-3">
        <div><label className="text-xs text-slate-500">æœ€å°æ–‡å­—æ•°ï¼ˆPCI DSS: 12ä»¥ä¸Šï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="12" /></div>
        <div><label className="text-xs text-slate-500">æœ‰åŠ¹æœŸé™ï¼ˆæ—¥ï¼‰ï¼ˆPCI DSS: 90æ—¥ä»¥å†…ï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="90" /></div>
        <div className="col-span-2 space-y-1.5">
          <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">å¤§æ–‡å­—ã‚’å«ã‚€</span></label>
          <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">å°æ–‡å­—ã‚’å«ã‚€</span></label>
          <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">æ•°å­—ã‚’å«ã‚€</span></label>
          <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€</span></label>
          <label className="flex items-center gap-2 text-xs"><input type="checkbox" defaultChecked className="w-3.5 h-3.5" /><span className="text-slate-700">éå»5å›ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†åˆ©ç”¨ã‚’ç¦æ­¢</span></label>
        </div>
      </div>
    </div>

    {/* Two-Factor Authentication */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">ğŸ“± äºŒè¦ç´ èªè¨¼ï¼ˆ2FAï¼‰</p>
      <div className="space-y-2">
        {[
          { role: "super_admin", required: true, method: "TOTPï¼ˆGoogle Authenticatorï¼‰" },
          { role: "admin", required: true, method: "TOTP / SMS" },
          { role: "operator", required: true, method: "TOTP / SMS" },
          { role: "viewer", required: false, method: "æ¨å¥¨ï¼ˆä»»æ„ï¼‰" },
        ].map((r, i) => (
          <div key={i} className="flex items-center gap-3 p-2 rounded border text-xs">
            <Badge text={r.role} color={r.role === "super_admin" ? "purple" : r.role === "admin" ? "blue" : r.role === "operator" ? "green" : "gray"} />
            <span className="flex-1 text-slate-700">æ–¹å¼: {r.method}</span>
            <div className={`w-8 h-5 rounded-full relative cursor-pointer ${r.required ? "bg-emerald-500" : "bg-slate-300"}`}>
              <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all ${r.required ? "right-0.5" : "left-0.5"}`} />
            </div>
            <span className="text-xs text-slate-400">{r.required ? "å¿…é ˆ" : "ä»»æ„"}</span>
          </div>
        ))}
      </div>
    </div>

    {/* IP Restrictions */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ğŸŒ IPã‚¢ãƒ‰ãƒ¬ã‚¹åˆ¶é™</p>
        <button onClick={() => toast("IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold">+ IPè¿½åŠ </button>
      </div>
      <table className="w-full text-xs">
        <thead><tr className="bg-slate-50 text-slate-500">
          <th className="px-3 py-2 text-left font-semibold">IP / CIDR</th>
          <th className="px-3 py-2 text-left font-semibold">èª¬æ˜</th>
          <th className="px-3 py-2 text-center font-semibold">å¯¾è±¡</th>
          <th className="px-3 py-2 text-center font-semibold">è¿½åŠ æ—¥</th>
          <th className="px-3 py-2 text-center font-semibold">æ“ä½œ</th>
        </tr></thead>
        <tbody>
        {[
          { ip: "203.0.113.0/24", desc: "æœ¬ç¤¾ã‚ªãƒ•ã‚£ã‚¹", target: "ç®¡ç†ç”»é¢", date: "2025-11-01" },
          { ip: "198.51.100.10", desc: "VPNå‡ºå£", target: "ç®¡ç†ç”»é¢", date: "2025-12-15" },
          { ip: "192.0.2.0/28", desc: "é–‹ç™ºãƒãƒ¼ãƒ ", target: "ãƒ†ã‚¹ãƒˆç’°å¢ƒ", date: "2026-01-10" },
        ].map((ip, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-3 py-2 font-mono font-semibold text-slate-700">{ip.ip}</td>
            <td className="px-3 py-2 text-slate-600">{ip.desc}</td>
            <td className="px-3 py-2 text-center"><Badge text={ip.target} color="blue" /></td>
            <td className="px-3 py-2 text-center text-slate-400">{ip.date}</td>
            <td className="px-3 py-2 text-center"><div className="flex gap-1 justify-center">
              <button onClick={() => toast(`${ip.ip}ã®IPåˆ¶é™ã‚’ç·¨é›†ä¸­`, "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded">ç·¨é›†</button>
              <button onClick={() => toast(`${ip.ip}ã®IPåˆ¶é™ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "warning")} className="px-2 py-1 bg-rose-50 text-rose-600 rounded">å‰Šé™¤</button>
            </div></td>
          </tr>
        ))}
        </tbody>
      </table>
    </div>

    {/* Session & Rate Limiting */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">â±ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»ãƒ¬ãƒ¼ãƒˆåˆ¶é™</p>
      <div className="grid grid-cols-2 gap-3">
        <div><label className="text-xs text-slate-500">ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆåˆ†ï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="30" /></div>
        <div><label className="text-xs text-slate-500">åŒæ™‚ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ä¸Šé™</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="3" /></div>
        <div><label className="text-xs text-slate-500">ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ãƒ­ãƒƒã‚¯å›æ•°ï¼ˆPCI DSS: 10å›ä»¥å†…ï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="5" /></div>
        <div><label className="text-xs text-slate-500">ãƒ­ãƒƒã‚¯è§£é™¤æ™‚é–“ï¼ˆåˆ†ï¼‰ï¼ˆPCI DSS: 30åˆ†ä»¥ä¸Šï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="30" /></div>
        <div><label className="text-xs text-slate-500">API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆreq/minï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="120" /></div>
        <div><label className="text-xs text-slate-500">ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ¤œçŸ¥é–¾å€¤</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="10å›/åˆ†" /></div>
      </div>
    </div>

    {/* Encryption & Compliance */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-3">ğŸ”’ æš—å·åŒ–ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹</p>
      <div className="space-y-2 text-xs">
        {[
          { item: "é€šä¿¡æš—å·åŒ–", value: "TLS 1.3", status: "é©åˆ" },
          { item: "ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ï¼ˆä¿å­˜æ™‚ï¼‰", value: "AES-256-GCM", status: "é©åˆ" },
          { item: "PCI DSS", value: "v4.0 Level 1 æº–æ‹ ", status: "é©åˆ" },
          { item: "ã‚«ãƒ¼ãƒ‰ç•ªå·ãƒˆãƒ¼ã‚¯ãƒ³åŒ–", value: "æœ‰åŠ¹ï¼ˆCDE iframeæ–¹å¼ï¼‰", status: "é©åˆ" },
          { item: "ãƒ­ã‚°æš—å·åŒ–", value: "æœ‰åŠ¹", status: "é©åˆ" },
          { item: "ãƒ­ã‚°ä¿æŒæœŸé–“", value: "12ãƒ¶æœˆï¼ˆ3ãƒ¶æœˆå³æ™‚ + 9ãƒ¶æœˆS3ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰", status: "é©åˆ" },
          { item: "SIEMè‡ªå‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼", value: "CloudWatch Logs Insightsï¼ˆæ—¥æ¬¡è‡ªå‹•ï¼‰", status: "é©åˆ" },
          { item: "éµãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", value: "90æ—¥ã”ã¨ï¼ˆæ¬¡å›: 2026-03-15ï¼‰", status: "é©åˆ" },
          { item: "æ±ºæ¸ˆãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒªãƒ—ãƒˆç›£è¦–", value: "CSP + SRI + é€±æ¬¡ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼ï¼ˆReq 6.4.3/11.6.1ï¼‰", status: "é©åˆ" },
        ].map((c, i) => (
          <div key={i} className="flex items-center gap-3 p-2 rounded border">
            <span className="w-48 font-semibold text-slate-700">{c.item}</span>
            <span className="flex-1 text-slate-600">{c.value}</span>
            <Badge text={c.status} color="green" />
          </div>
        ))}
      </div>
    </div>

    {/* Maintenance Mode */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-slate-700">ğŸ”§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰</p>
        <div className="flex items-center gap-2">
          <div className="w-8 h-5 rounded-full bg-slate-300 relative cursor-pointer">
            <div className="absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow" />
          </div>
          <span className="text-xs text-slate-400">OFF</span>
        </div>
      </div>
      <p className="text-xs text-slate-500">ONæ™‚: ç®¡ç†ç”»é¢ãƒ»åŠ ç›Ÿåº—ç”»é¢ã‚’ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è¡¨ç¤ºã«åˆ‡æ›¿ã€‚<span className="font-semibold text-emerald-600">æ±ºæ¸ˆå‡¦ç†ï¼ˆZone Aï¼‰ã¯åœæ­¢ã—ã¾ã›ã‚“ã€‚</span></p>
    </div>

    {/* Backup Settings */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-slate-700">ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š</p>
        <button onClick={() => { toast("æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œä¸­...", "info"); setTimeout(() => toast("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ", "success"), 2000); }} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ</button>
      </div>
      <div className="space-y-1.5 text-xs">
        {[
          { target: "DBï¼ˆPostgreSQLï¼‰", schedule: "æ¯æ—¥ AM4:00", lastRun: "2026-02-12 04:00", status: "æˆåŠŸ", retention: "30æ—¥" },
          { target: "S3ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰", schedule: "æ¯æ—¥ AM5:00", lastRun: "2026-02-12 05:00", status: "æˆåŠŸ", retention: "90æ—¥" },
        ].map((b, i) => (
          <div key={i} className="flex items-center gap-3 p-2 rounded border border-slate-200">
            <span className="w-40 font-semibold text-slate-700">{b.target}</span>
            <span className="text-slate-500">{b.schedule}</span>
            <span className="text-slate-400">å‰å›: {b.lastRun}</span>
            <Badge text={b.status} color="green" />
            <span className="text-slate-400">ä¿æŒ: {b.retention}</span>
          </div>
        ))}
      </div>
    </div>

    {/* Audit Log */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-slate-700">ğŸ“ è¨­å®šå¤‰æ›´ ç›£æŸ»ãƒ­ã‚°ï¼ˆç›´è¿‘ï¼‰</p>
        <button onClick={() => toast("ç›£æŸ»ãƒ­ã‚°ã®å…¨ä»¶æ¤œç´¢ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™", "info")} className="text-xs text-blue-600 hover:underline">å…¨ãƒ­ã‚°æ¤œç´¢ â†’</button>
      </div>
      <div className="space-y-1 text-xs">
        {[
          { time: "02/12 10:15", user: "ç”°ä¸­å¤ªéƒ", action: "é€šçŸ¥è¨­å®šå¤‰æ›´", detail: "ä¸æ­£æ¤œçŸ¥â†’Email: OFFâ†’ON", role: "admin" },
          { time: "02/11 16:30", user: "ä½è—¤èŠ±å­", action: "æ±ºæ¸ˆæ‰‹æ®µå¤‰æ›´", detail: "Apple Pay: OFFâ†’ON", role: "admin" },
          { time: "02/11 09:00", user: "ç”°ä¸­å¤ªéƒ", action: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š", detail: "IPåˆ¶é™è¿½åŠ  â†’ æ‰¿èªå¾…ã¡", role: "admin" },
        ].map((l, i) => (
          <div key={i} className="flex items-center gap-2 p-1.5 rounded border border-slate-200">
            <span className="w-24 text-slate-400">{l.time}</span>
            <span className="w-20 text-slate-600">{l.user}</span>
            <Badge text={l.role} color="blue" />
            <span className="w-28 font-semibold text-slate-700">{l.action}</span>
            <span className="flex-1 text-slate-500">{l.detail}</span>
          </div>
        ))}
      </div>
    </div>
    </>)}

    {/* â”€â”€â”€ Tab 5: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§ â”€â”€â”€ */}
    {sysTab === 5 && (<>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§</p>
        <div className="flex gap-2 items-center">
          <input className="text-xs border rounded px-2 py-1.5 w-56" placeholder="ã‚³ãƒ¼ãƒ‰ or ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æ¤œç´¢..." />
          <select className="text-xs border rounded px-2 py-1.5"><option>å…¨ã‚«ãƒ†ã‚´ãƒª</option><option>èªè¨¼ã‚¨ãƒ©ãƒ¼</option><option>é€šä¿¡ã‚¨ãƒ©ãƒ¼</option><option>ã‚«ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼</option><option>3DSã‚¨ãƒ©ãƒ¼</option><option>ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼</option></select>
          <button onClick={() => toast("ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold">æ¤œç´¢</button>
        </div>
      </div>
      <div className="text-xs text-slate-400 mb-2">å…¨ 287ä»¶ è¡¨ç¤º: 1-20ä»¶ï¼ˆ1/15ãƒšãƒ¼ã‚¸ï¼‰</div>
      <table className="w-full text-xs">
        <thead><tr className="bg-slate-50 border-b">
          <th className="text-left p-2 text-slate-500 font-semibold w-24">ã‚³ãƒ¼ãƒ‰</th>
          <th className="text-left p-2 text-slate-500 font-semibold w-24">ã‚«ãƒ†ã‚´ãƒª</th>
          <th className="text-left p-2 text-slate-500 font-semibold">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆæ—¥æœ¬èªï¼‰</th>
          <th className="text-left p-2 text-slate-500 font-semibold w-48">å¯¾å‡¦æ³•</th>
          <th className="text-center p-2 text-slate-500 font-semibold w-16">API</th>
          <th className="text-center p-2 text-slate-500 font-semibold w-16">ãƒªãƒ³ã‚¯æ±ºæ¸ˆ</th>
        </tr></thead>
        <tbody>
          {[
            { code: "E001", cat: "èªè¨¼", msg: "ã‚«ãƒ¼ãƒ‰ç•ªå·ãŒä¸æ­£ã§ã™", fix: "ã‚«ãƒ¼ãƒ‰ç•ªå·ã‚’å†ç¢ºèª", api: true, link: true },
            { code: "E002", cat: "èªè¨¼", msg: "æœ‰åŠ¹æœŸé™åˆ‡ã‚Œ", fix: "æœ‰åŠ¹ãªã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨", api: true, link: true },
            { code: "E003", cat: "èªè¨¼", msg: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ä¸ä¸€è‡´", fix: "CVV/CVCã‚’å†ç¢ºèª", api: true, link: true },
            { code: "E010", cat: "3DS", msg: "3Dã‚»ã‚­ãƒ¥ã‚¢èªè¨¼å¤±æ•—", fix: "ã‚«ãƒ¼ãƒ‰ç™ºè¡Œä¼šç¤¾ã«ç¢ºèª", api: true, link: true },
            { code: "E011", cat: "3DS", msg: "3Dã‚»ã‚­ãƒ¥ã‚¢ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ", fix: "å†è©¦è¡Œã‚’æ¡ˆå†…", api: true, link: true },
            { code: "E020", cat: "ã‚«ãƒ¼ãƒ‰", msg: "åˆ©ç”¨é™åº¦é¡è¶…é", fix: "åˆ©ç”¨é™åº¦é¡ã®å¼•ä¸Šã’", api: true, link: true },
            { code: "E021", cat: "ã‚«ãƒ¼ãƒ‰", msg: "ã‚«ãƒ¼ãƒ‰å–æ‰±ä¸å¯", fix: "åˆ¥ã®ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨", api: true, link: true },
            { code: "E022", cat: "ã‚«ãƒ¼ãƒ‰", msg: "æš—è¨¼ç•ªå·ã‚¨ãƒ©ãƒ¼", fix: "æš—è¨¼ç•ªå·ã‚’å†ç¢ºèª", api: false, link: false },
            { code: "E030", cat: "é€šä¿¡", msg: "æ¥ç¶šå…ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ", fix: "æ™‚é–“ã‚’ç½®ã„ã¦å†è©¦è¡Œ", api: true, link: false },
            { code: "E031", cat: "é€šä¿¡", msg: "æ¥ç¶šå…ˆå¿œç­”ã‚¨ãƒ©ãƒ¼", fix: "æ¥ç¶šå…ˆã®çŠ¶æ…‹ã‚’ç¢ºèª", api: true, link: false },
            { code: "E040", cat: "ã‚·ã‚¹ãƒ†ãƒ ", msg: "å†…éƒ¨å‡¦ç†ã‚¨ãƒ©ãƒ¼", fix: "ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«é€£çµ¡", api: true, link: true },
            { code: "E041", cat: "ã‚·ã‚¹ãƒ†ãƒ ", msg: "äºŒé‡å‡¦ç†æ¤œçŸ¥", fix: "å–å¼•çµæœã‚’ç¢ºèª", api: true, link: false },
            { code: "E050", cat: "ã‚«ãƒ¼ãƒ‰", msg: "å–å¼•æ‹’å¦ï¼ˆä¸æ­£æ¤œçŸ¥ï¼‰", fix: "ä¸æ­£æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª", api: true, link: true },
            { code: "E051", cat: "ã‚«ãƒ¼ãƒ‰", msg: "ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆä¸€è‡´", fix: "åˆ¶é™ãƒªã‚¹ãƒˆã‚’ç¢ºèª", api: true, link: true },
            { code: "E060", cat: "èªè¨¼", msg: "åŠ ç›Ÿåº—èªè¨¼å¤±æ•—", fix: "APIã‚­ãƒ¼ã‚’å†ç¢ºèª", api: true, link: false },
            { code: "E070", cat: "é€šä¿¡", msg: "ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼ä¸æ­£", fix: "APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§", api: true, link: false },
            { code: "E080", cat: "3DS", msg: "3DSãƒãƒ¼ã‚¸ãƒ§ãƒ³éå¯¾å¿œ", fix: "å¯¾å¿œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª", api: true, link: true },
            { code: "E090", cat: "ã‚·ã‚¹ãƒ†ãƒ ", msg: "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­", fix: "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹çµ‚äº†å¾Œã«å†è©¦è¡Œ", api: true, link: true },
            { code: "E091", cat: "ã‚·ã‚¹ãƒ†ãƒ ", msg: "ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆè¶…é", fix: "ãƒªã‚¯ã‚¨ã‚¹ãƒˆé »åº¦ã‚’èª¿æ•´", api: true, link: false },
            { code: "E100", cat: "ã‚«ãƒ¼ãƒ‰", msg: "ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³", fix: "ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†å–å¾—", api: true, link: false },
          ].map((e, i) => (
            <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""} hover:bg-blue-50`}>
              <td className="p-2 font-mono font-bold text-blue-600">{e.code}</td>
              <td className="p-2"><Badge text={e.cat} color={e.cat === "èªè¨¼" ? "blue" : e.cat === "3DS" ? "purple" : e.cat === "ã‚«ãƒ¼ãƒ‰" ? "yellow" : e.cat === "é€šä¿¡" ? "red" : "default"} /></td>
              <td className="p-2 text-slate-700">{e.msg}</td>
              <td className="p-2 text-slate-500">{e.fix}</td>
              <td className="p-2 text-center">{e.api ? "âœ…" : "â€”"}</td>
              <td className="p-2 text-center">{e.link ? "âœ…" : "â€”"}</td>
            </tr>
          ))}
        </tbody>
      </table>
      <div className="flex justify-between items-center mt-3 text-xs">
        <span className="text-slate-400">287ä»¶ä¸­ 1-20ä»¶</span>
        <div className="flex gap-1">{[1,2,3,"...",14,15].map((p,i) => <button key={i} className={`px-2 py-1 rounded ${p === 1 ? "bg-blue-600 text-white" : "bg-slate-100 text-slate-600 hover:bg-slate-200"}`}>{p}</button>)}</div>
      </div>
    </div>
    </>)}

    {/* â”€â”€â”€ Tab 6: ãŠçŸ¥ã‚‰ã›ç®¡ç† â”€â”€â”€ */}
    {sysTab === 6 && (<>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ãŠçŸ¥ã‚‰ã›ç®¡ç†</p>
        <button onClick={() => toast("ãŠçŸ¥ã‚‰ã›ã‚’æ–°è¦ä½œæˆã—ã¦ã„ã¾ã™", "info")} className="text-xs bg-blue-600 text-white px-3 py-1.5 rounded font-semibold">+ æ–°è¦ä½œæˆ</button>
      </div>
      <div className="grid grid-cols-4 gap-2 mb-3">
        <div><label className="text-xs text-slate-400">ã‚µã‚¤ãƒˆID</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="ã‚µã‚¤ãƒˆIDã§çµè¾¼" /></div>
        <div><label className="text-xs text-slate-400">å…¬é–‹çŠ¶æ…‹</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ã¦</option><option>å…¬é–‹ä¸­</option><option>æœªå…¬é–‹</option><option>çµ‚äº†</option></select></div>
        <div><label className="text-xs text-slate-400">ç¨®åˆ¥</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ã¦</option><option>éšœå®³</option><option>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹</option><option>æ©Ÿèƒ½ãƒªãƒªãƒ¼ã‚¹</option><option>ãŠçŸ¥ã‚‰ã›</option></select></div>
        <div className="flex items-end"><button onClick={() => toast("ãŠçŸ¥ã‚‰ã›ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="text-xs bg-blue-600 text-white px-4 py-1.5 rounded font-semibold w-full">æ¤œç´¢</button></div>
      </div>
      <table className="w-full text-xs">
        <thead><tr className="bg-slate-50 border-b">
          <th className="text-left p-2 text-slate-500 font-semibold w-16">ID</th>
          <th className="text-left p-2 text-slate-500 font-semibold w-28">ä½œæˆæ—¥æ™‚</th>
          <th className="text-left p-2 text-slate-500 font-semibold">ã‚¿ã‚¤ãƒˆãƒ«</th>
          <th className="text-left p-2 text-slate-500 font-semibold w-24">ç¨®åˆ¥</th>
          <th className="text-center p-2 text-slate-500 font-semibold w-20">å…¬é–‹çŠ¶æ…‹</th>
          <th className="text-left p-2 text-slate-500 font-semibold w-20">å¯¾è±¡</th>
          <th className="text-center p-2 text-slate-500 font-semibold w-16">æ“ä½œ</th>
        </tr></thead>
        <tbody>
          {[
            { id: "N-001", date: "02/17 10:00", title: "æ±ºæ¸ˆå‡¦ç†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›ï¼ˆ2/20 AM2:00-4:00ï¼‰", type: "ãƒ¡ãƒ³ãƒ†", status: "å…¬é–‹ä¸­", sColor: "green", target: "å…¨ä½“" },
            { id: "N-002", date: "02/15 14:30", title: "æ–°æ©Ÿèƒ½: Apple Pay / Google Pay å¯¾å¿œé–‹å§‹", type: "ãƒªãƒªãƒ¼ã‚¹", status: "å…¬é–‹ä¸­", sColor: "green", target: "å…¨ä½“" },
            { id: "N-003", date: "02/14 09:00", title: "ã€å¾©æ—§æ¸ˆã€‘2/14 æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼å¢—åŠ ã«ã¤ã„ã¦", type: "éšœå®³", status: "å…¬é–‹ä¸­", sColor: "green", target: "å…¨ä½“" },
            { id: "N-004", date: "02/12 11:00", title: "3Dã‚»ã‚­ãƒ¥ã‚¢2.0 å®Œå…¨ç§»è¡Œã®ãŠçŸ¥ã‚‰ã›", type: "ãŠçŸ¥ã‚‰ã›", status: "å…¬é–‹ä¸­", sColor: "green", target: "å…¨ä½“" },
            { id: "N-005", date: "02/10 16:00", title: "APIä»•æ§˜å¤‰æ›´äºˆå‘Šï¼ˆv3.2 â†’ v3.3ï¼‰", type: "ãŠçŸ¥ã‚‰ã›", status: "æœªå…¬é–‹", sColor: "yellow", target: "å…¨ä½“" },
            { id: "N-006", date: "02/08 09:00", title: "å¹´æœ«å¹´å§‹ã®ç²¾ç®—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å¤‰æ›´", type: "ãŠçŸ¥ã‚‰ã›", status: "çµ‚äº†", sColor: "default", target: "å…¨ä½“" },
          ].map((n, i) => (
            <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""} hover:bg-blue-50`}>
              <td className="p-2 font-mono text-slate-500">{n.id}</td>
              <td className="p-2 text-slate-400">{n.date}</td>
              <td className="p-2 text-slate-700 font-semibold">{n.title}</td>
              <td className="p-2"><Badge text={n.type} color={n.type === "éšœå®³" ? "red" : n.type === "ãƒ¡ãƒ³ãƒ†" ? "yellow" : n.type === "ãƒªãƒªãƒ¼ã‚¹" ? "blue" : "default"} /></td>
              <td className="p-2 text-center"><Badge text={n.status} color={n.sColor} /></td>
              <td className="p-2 text-slate-500">{n.target}</td>
              <td className="p-2 text-center"><button onClick={() => toast(`${n.title}ã‚’ç·¨é›†ä¸­`, "info")} className="text-blue-600 hover:underline">ç·¨é›†</button></td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    </>)}

    {/* â”€â”€â”€ Tab 7: æ“ä½œãƒ­ã‚° â”€â”€â”€ */}
    {sysTab === 7 && (<>
    <div className="bg-blue-50 rounded border border-blue-200 p-2 flex items-center gap-2 text-xs">
      <span>ğŸ”’</span>
      <span className="text-blue-700"><strong>PCI DSS v4.0æº–æ‹ </strong> â€” ç®¡ç†ç”»é¢ã®å…¨æ“ä½œã‚’è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚ãƒ­ã‚°ã¯12ãƒ¶æœˆé–“ä¿æŒã•ã‚Œã¾ã™ï¼ˆç›´è¿‘3ãƒ¶æœˆ: å³æ™‚æ¤œç´¢ / 3ã€œ12ãƒ¶æœˆ: S3ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰ã€‚SIEMè‡ªå‹•æ—¥æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½ä¸­ã€‚</span>
    </div>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-3">
        <p className="text-xs font-bold text-slate-600">ç®¡ç†ç”»é¢æ“ä½œãƒ­ã‚°æ¤œç´¢</p>
        <button onClick={() => toast("æ“ä½œãƒ­ã‚°ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 text-slate-600 px-3 py-1.5 rounded border">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      </div>
      <div className="grid grid-cols-4 gap-2 mb-3">
        <div><label className="text-xs text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="ã‚¹ã‚¿ãƒƒãƒ•åã§æ¤œç´¢" /></div>
        <div><label className="text-xs text-slate-400">IPã‚¢ãƒ‰ãƒ¬ã‚¹</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="192.168.x.x" /></div>
        <div><label className="text-xs text-slate-400">æ“ä½œå¯¾è±¡ãƒšãƒ¼ã‚¸</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ãƒšãƒ¼ã‚¸</option><option>åŠ ç›Ÿåº—ç®¡ç†</option><option>æ±ºæ¸ˆæ¤œç´¢</option><option>ä¸æ­£æ¤œçŸ¥</option><option>ç²¾ç®—ç®¡ç†</option><option>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</option><option>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</option></select></div>
        <div><label className="text-xs text-slate-400">ç¨®åˆ¥</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ã¦</option><option>ç”»é¢æ“ä½œ</option><option>ãƒ¡ãƒ¼ãƒ«é€ä¿¡</option><option>ãƒ‡ãƒ¼ã‚¿å¤‰æ›´</option><option>ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</option></select></div>
        <div><label className="text-xs text-slate-400">æ“ä½œæ—¥æ™‚ï¼ˆFromï¼‰</label><input type="datetime-local" className="w-full text-xs border rounded px-2 py-1.5" defaultValue="2026-02-10T00:00" /></div>
        <div><label className="text-xs text-slate-400">æ“ä½œæ—¥æ™‚ï¼ˆToï¼‰</label><input type="datetime-local" className="w-full text-xs border rounded px-2 py-1.5" defaultValue="2026-02-17T23:59" /></div>
        <div><label className="text-xs text-slate-400">URL</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="/admin/..." /></div>
        <div className="flex items-end"><button onClick={() => toast("æ“ä½œãƒ­ã‚°ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="text-xs bg-blue-600 text-white px-4 py-1.5 rounded font-semibold w-full">æ¤œç´¢</button></div>
      </div>
      <div className="text-xs text-slate-400 mb-2">æ¤œç´¢çµæœ: 1,248ä»¶ï¼ˆ1/63ãƒšãƒ¼ã‚¸ï¼‰</div>
      <table className="w-full text-xs table-fixed">
        <thead><tr className="bg-slate-50 border-b">
          <th className="text-left p-2 text-slate-500 font-semibold" style={{width:"50px"}}>ID</th>
          <th className="text-left p-2 text-slate-500 font-semibold" style={{width:"72px"}}>ã‚¹ã‚¿ãƒƒãƒ•</th>
          <th className="text-left p-2 text-slate-500 font-semibold" style={{width:"120px"}}>æ“ä½œæ—¥æ™‚</th>
          <th className="text-left p-2 text-slate-500 font-semibold" style={{width:"110px"}}>IPã‚¢ãƒ‰ãƒ¬ã‚¹</th>
          <th className="text-left p-2 text-slate-500 font-semibold whitespace-nowrap" style={{width:"90px"}}>ç¨®åˆ¥</th>
          <th className="text-left p-2 text-slate-500 font-semibold" style={{width:"90px"}}>å¯¾è±¡ãƒšãƒ¼ã‚¸</th>
          <th className="text-left p-2 text-slate-500 font-semibold">URL / è©³ç´°</th>
        </tr></thead>
        <tbody>
          {[
            { id: 1248, staff: "ç”°ä¸­å¤ªéƒ", time: "02/17 13:42:15", ip: "192.168.1.10", type: "ç”»é¢æ“ä½œ", page: "åŠ ç›Ÿåº—ç®¡ç†", url: "/admin/merchants/M-001/edit" },
            { id: 1247, staff: "ä½è—¤èŠ±å­", time: "02/17 13:38:02", ip: "10.0.0.55", type: "ãƒ‡ãƒ¼ã‚¿å¤‰æ›´", page: "ä¸æ­£æ¤œçŸ¥", url: "/admin/fraud/rules/FR-001 â€” é–¾å€¤å¤‰æ›´ Â¥500,000â†’Â¥600,000" },
            { id: 1246, staff: "ç”°ä¸­å¤ªéƒ", time: "02/17 13:25:10", ip: "192.168.1.10", type: "ç”»é¢æ“ä½œ", page: "æ±ºæ¸ˆæ¤œç´¢", url: "/admin/transactions/search?q=TXN-14516" },
            { id: 1245, staff: "éˆ´æœ¨ä¸€éƒ", time: "02/17 12:55:33", ip: "172.16.0.8", type: "ãƒ¡ãƒ¼ãƒ«é€ä¿¡", page: "ç²¾ç®—ç®¡ç†", url: "ç²¾ç®—å ±å‘Šæ›¸é€ä¿¡ â†’ merchant@example.com" },
            { id: 1244, staff: "ä½è—¤èŠ±å­", time: "02/17 12:40:18", ip: "10.0.0.55", type: "ãƒ‡ãƒ¼ã‚¿å¤‰æ›´", page: "ã‚·ã‚¹ãƒ†ãƒ è¨­å®š", url: "/admin/settings/notifications â€” Slacké€šçŸ¥ON" },
            { id: 1243, staff: "é«˜æ©‹æ˜ç¾", time: "02/17 12:15:45", ip: "192.168.1.22", type: "ãƒ­ã‚°ã‚¤ãƒ³", page: "â€”", url: "ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ â€” 2FAèªè¨¼æ¸ˆ" },
            { id: 1242, staff: "ç”°ä¸­å¤ªéƒ", time: "02/17 11:50:30", ip: "192.168.1.10", type: "ç”»é¢æ“ä½œ", page: "ãƒ¬ãƒãƒ¼ãƒˆ", url: "/admin/report/daily?month=2026-02" },
            { id: 1241, staff: "éˆ´æœ¨ä¸€éƒ", time: "02/17 11:20:05", ip: "172.16.0.8", type: "ãƒ‡ãƒ¼ã‚¿å¤‰æ›´", page: "ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†", url: "æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ  â€” yamada@example.com (viewer)" },
          ].map((l, i) => (
            <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""} hover:bg-blue-50`}>
              <td className="p-2 font-mono text-slate-400">{l.id}</td>
              <td className="p-2 text-slate-700 font-semibold">{l.staff}</td>
              <td className="p-2 text-slate-500 font-mono">{l.time}</td>
              <td className="p-2 font-mono text-slate-500">{l.ip}</td>
              <td className="p-2 whitespace-nowrap"><Badge text={l.type} color={l.type === "ãƒ‡ãƒ¼ã‚¿å¤‰æ›´" ? "yellow" : l.type === "ãƒ¡ãƒ¼ãƒ«é€ä¿¡" ? "blue" : l.type === "ãƒ­ã‚°ã‚¤ãƒ³" ? "green" : "default"} /></td>
              <td className="p-2 text-slate-600 whitespace-nowrap">{l.page}</td>
              <td className="p-2 text-slate-400 truncate" title={l.url}>{l.url}</td>
            </tr>
          ))}
        </tbody>
      </table>
      <div className="flex justify-between items-center mt-3 text-xs">
        <span className="text-slate-400">1,248ä»¶ä¸­ 1-20ä»¶</span>
        <div className="flex gap-1">{[1,2,3,"...",62,63].map((p,i) => <button key={i} className={`px-2 py-1 rounded ${p === 1 ? "bg-blue-600 text-white" : "bg-slate-100 text-slate-600 hover:bg-slate-200"}`}>{p}</button>)}</div>
      </div>
    </div>
    </>)}
  </div>
  );
};

// â”€â”€â”€ S07: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† â”€â”€â”€
const MerchantUserManagement = () => {
  const toast = useToast();
  const [showInviteS07, setShowInviteS07] = useState(false);
  const [selectedUser, setSelectedUser] = useState(null);
  const [showEditModal, setShowEditModal] = useState(null);
  const users = [
    { name: "ä½ã€…æœ¨ å¥ä¸€", email: "sasaki@techshop.jp", role: "ã‚ªãƒ¼ãƒŠãƒ¼", rColor: "purple", mfa: true, last: "2026-02-11 14:30", ip: "203.0.113.45", sessions: 3, created: "2024-06-01", logs: [
      { action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-11 14:30", ip: "203.0.113.45" },
      { action: "APIã‚­ãƒ¼å†ç™ºè¡Œ", time: "2026-02-11 13:00", ip: "203.0.113.45" },
      { action: "Webhook URLå¤‰æ›´", time: "2026-02-10 16:20", ip: "203.0.113.45" },
      { action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-10 09:15", ip: "203.0.113.45" },
    ]},
    { name: "ä¸­æ‘ ç¾æœˆ", email: "nakamura@techshop.jp", role: "ç®¡ç†è€…", rColor: "blue", mfa: true, last: "2026-02-11 12:00", ip: "198.51.100.10", sessions: 1, created: "2025-01-15", logs: [
      { action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-11 12:00", ip: "198.51.100.10" },
      { action: "è¿”é‡‘å‡¦ç†å®Ÿè¡Œ", time: "2026-02-11 11:45", ip: "198.51.100.10" },
      { action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-10 09:30", ip: "198.51.100.10" },
    ]},
    { name: "å°æ— å¤§è¼”", email: "kobayashi@techshop.jp", role: "ã‚¹ã‚¿ãƒƒãƒ•", rColor: "green", mfa: true, last: "2026-02-10 18:20", ip: "192.0.2.55", sessions: 0, created: "2025-06-20", logs: [
      { action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-10 18:20", ip: "192.0.2.55" },
      { action: "å–å¼•è©³ç´°é–²è¦§", time: "2026-02-10 17:50", ip: "192.0.2.55" },
    ]},
    { name: "æ¸¡è¾º ã•ãã‚‰", email: "watanabe@techshop.jp", role: "é–²è¦§ã®ã¿", rColor: "gray", mfa: false, last: "2026-02-08 10:00", ip: "192.0.2.100", sessions: 0, created: "2025-11-01", logs: [
      { action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-08 10:00", ip: "192.0.2.100" },
    ]},
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
      <div className="flex items-center gap-2">
        <span className="text-xs text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•: <span className="font-bold text-slate-700">{users.length}å</span></span>
        <button onClick={() => setShowInviteS07(!showInviteS07)} className="text-xs bg-emerald-600 text-white px-3 py-1.5 rounded font-semibold hover:bg-emerald-700">+ ã‚¹ã‚¿ãƒƒãƒ•ã‚’æ‹›å¾…</button>
      </div>
    </div>

    {showInviteS07 && (
      <div className="bg-emerald-50 rounded-lg border border-emerald-200 p-3 space-y-3">
        <div className="flex justify-between items-center"><p className="text-xs font-bold text-emerald-700">ğŸ“§ ã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾…</p><button onClick={() => setShowInviteS07(false)} className="text-slate-400 text-sm">âœ•</button></div>
        <div className="grid grid-cols-2 gap-2">
          <div><label className="text-xs text-slate-500">æ°å *</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: ç”°ä¸­ èŠ±å­" /></div>
          <div><label className="text-xs text-slate-500">ãƒ¡ãƒ¼ãƒ« *</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: tanaka@shop.jp" /></div>
          <div><label className="text-xs text-slate-500">æ¨©é™ *</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ç®¡ç†è€…</option><option>ã‚¹ã‚¿ãƒƒãƒ•</option><option>é–²è¦§ã®ã¿</option></select></div>
          <div><label className="text-xs text-slate-500">MFA *</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å¿…é ˆ</option><option>ä»»æ„</option></select></div>
        </div>
        <div className="flex gap-2 justify-end">
          <button onClick={() => setShowInviteS07(false)} className="px-3 py-1.5 text-xs text-slate-500 border rounded">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button onClick={() => setShowInviteS07(false)} className="px-3 py-1.5 text-xs bg-emerald-600 text-white rounded font-semibold">æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
        </div>
      </div>
    )}

    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "åå‰", w: "w-36" }, { label: "ãƒ¡ãƒ¼ãƒ«", w: "flex-1" }, { label: "æ¨©é™", w: "w-28" }, { label: "MFA", w: "w-14" }, { label: "æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³", w: "w-32" }, { label: "æ“ä½œ", w: "w-28" }]}>
      {users.map((u, i) => (
        <tr key={i} onClick={() => setSelectedUser(u)} className={`border-b cursor-pointer hover:bg-blue-50 ${i % 2 ? "bg-slate-50" : ""}`}>
          <td className="px-4 py-2 whitespace-nowrap w-36 font-semibold text-slate-700"><div className="flex items-center gap-2">
            <div className="w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center text-xs">ğŸ‘¤</div>
            {u.name}
          </div></td>
          <td className="px-4 py-2 whitespace-nowrap text-slate-500">{u.email}</td>
          <td className="px-4 py-2 whitespace-nowrap w-28"><Badge text={u.role} color={u.rColor} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-14">{u.mfa ? "âœ…" : "âŒ"}</td>
          <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-400">{u.last}</td>
          <td className="px-4 py-2 whitespace-nowrap w-28"><div className="flex gap-1">
            <button onClick={e => { e.stopPropagation(); setShowEditModal(u); }} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">ç·¨é›†</button>
            {u.role !== "ã‚ªãƒ¼ãƒŠãƒ¼" && <button onClick={e => e.stopPropagation()} className="px-2 py-1 bg-rose-50 text-rose-600 rounded text-xs">å‰Šé™¤</button>}
          </div></td>
        </tr>
      ))}
      </TableHeader>
    </div>

    {/* Permission Matrix */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-600 mb-2">æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹</p>
      <div className="text-xs">
        <div className="flex bg-slate-50 py-1.5 px-2 font-semibold text-slate-500 border-b">
          <div className="w-36">æ©Ÿèƒ½</div>
          <div className="w-20 text-center">ã‚ªãƒ¼ãƒŠãƒ¼</div>
          <div className="w-20 text-center">ç®¡ç†è€…</div>
          <div className="w-20 text-center">ã‚¹ã‚¿ãƒƒãƒ•</div>
          <div className="w-20 text-center">é–²è¦§ã®ã¿</div>
        </div>
        {[
          { feat: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é–²è¦§", perms: [true, true, true, true] },
          { feat: "æ³¨æ–‡ä¸€è¦§ãƒ»è©³ç´°", perms: [true, true, true, true] },
          { feat: "è¿”é‡‘å‡¦ç†ã®å®Ÿè¡Œ", perms: [true, true, false, false] },
          { feat: "APIã‚­ãƒ¼ç™ºè¡Œãƒ»ç®¡ç†", perms: [true, false, false, false] },
          { feat: "Webhookè¨­å®š", perms: [true, true, false, false] },
          { feat: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†", perms: [true, false, false, false] },
          { feat: "å£åº§ãƒ»ä¼šç¤¾æƒ…å ±å¤‰æ›´", perms: [true, false, false, false] },
        ].map((r, i) => (
          <div key={i} className={`flex py-1.5 px-2 ${i % 2 ? "bg-slate-50" : ""}`}>
            <div className="w-36 text-slate-700">{r.feat}</div>
            {r.perms.map((p, j) => <div key={j} className="w-20 text-center">{p ? "âœ…" : "â€”"}</div>)}
          </div>
        ))}
      </div>
    </div>

    {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedUser && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedUser(null)} />
        <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b flex items-center justify-between sticky top-0 bg-white z-10">
            <p className="text-sm font-bold">{selectedUser.name}</p>
            <button onClick={() => setSelectedUser(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            {/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« */}
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-xl">ğŸ‘¤</div>
              <div>
                <p className="text-sm font-bold text-slate-800">{selectedUser.name}</p>
                <p className="text-xs text-slate-400">{selectedUser.email}</p>
              </div>
            </div>
            <div className="grid grid-cols-2 gap-2">
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">æ¨©é™</p><Badge text={selectedUser.role} color={selectedUser.rColor} /></div>
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">MFA</p><p className="text-xs font-bold">{selectedUser.mfa ? "æœ‰åŠ¹ âœ…" : "ç„¡åŠ¹ âŒ"}</p></div>
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³</p><p className="text-xs font-bold">{selectedUser.sessions}ä»¶</p></div>
              <div className="bg-slate-50 rounded p-2"><p className="text-xs text-slate-400">ç™»éŒ²æ—¥</p><p className="text-xs font-bold">{selectedUser.created}</p></div>
            </div>

            {/* æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ */}
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">æœ€çµ‚ã‚¢ã‚¯ã‚»ã‚¹</p>
              <div className="space-y-1">
                <div className="flex text-xs"><span className="w-20 text-slate-400">æ—¥æ™‚</span><span className="font-bold">{selectedUser.last}</span></div>
                <div className="flex text-xs"><span className="w-20 text-slate-400">IPã‚¢ãƒ‰ãƒ¬ã‚¹</span><span className="font-mono">{selectedUser.ip}</span></div>
              </div>
            </div>

            {/* æ´»å‹•ãƒ­ã‚° */}
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">æ´»å‹•ãƒ­ã‚°ï¼ˆç›´è¿‘ï¼‰</p>
              <div className="space-y-0">
                {selectedUser.logs.map((log, i) => (
                  <div key={i} className="flex items-start gap-3 py-1.5">
                    <div className="flex flex-col items-center">
                      <div className="w-2 h-2 rounded-full bg-blue-400 mt-1" />
                      {i < selectedUser.logs.length - 1 && <div className="w-0.5 h-4 bg-slate-200" />}
                    </div>
                    <div>
                      <p className="text-xs font-bold text-slate-700">{log.action}</p>
                      <p className="text-xs text-slate-400">{log.time} Â· {log.ip}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}
            <div className="space-y-2 pt-2 border-t">
              <button onClick={() => { setShowEditModal(selectedUser); setSelectedUser(null); }} className="w-full py-2 bg-blue-50 text-blue-600 rounded text-xs font-bold border border-blue-200 hover:bg-blue-100">æ¨©é™ã‚’å¤‰æ›´</button>
              {selectedUser.role !== "ã‚ªãƒ¼ãƒŠãƒ¼" && (
                <button onClick={() => { toast(`${selectedUser.name}ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ`, "warning"); setSelectedUser(null); }} className="w-full py-2 bg-red-50 text-red-600 rounded text-xs font-bold border border-red-200 hover:bg-red-100">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–</button>
              )}
            </div>
          </div>
        </div>
      </div>
    )}

    {/* ãƒ­ãƒ¼ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showEditModal && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowEditModal(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[400px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">æ¨©é™ã®å¤‰æ›´</p>
            <button onClick={() => setShowEditModal(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-3">
            <div className="flex items-center gap-2 text-xs"><span className="text-slate-400">å¯¾è±¡:</span><span className="font-bold">{showEditModal.name}</span><Badge text={showEditModal.role} color={showEditModal.rColor} /></div>
            <div>
              <label className="text-xs text-slate-500">æ–°ã—ã„æ¨©é™</label>
              <select className="w-full border rounded px-2 py-1.5 text-xs mt-0.5">
                <option>ç®¡ç†è€…</option><option>ã‚¹ã‚¿ãƒƒãƒ•</option><option>é–²è¦§ã®ã¿</option>
              </select>
            </div>
            <div>
              <label className="text-xs text-slate-500">å¤‰æ›´ç†ç”±ï¼ˆä»»æ„ï¼‰</label>
              <textarea className="w-full border rounded px-2 py-1.5 text-xs mt-0.5 h-16" placeholder="å¤‰æ›´ç†ç”±ã‚’å…¥åŠ›..." />
            </div>
            <div className="flex gap-2">
              <button onClick={() => setShowEditModal(null)} className="flex-1 py-2 border rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setShowEditModal(null)} className="flex-1 py-2 bg-blue-600 text-white rounded text-xs font-bold hover:bg-blue-700">æ¨©é™ã‚’æ›´æ–°</button>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ S04: å…¥é‡‘ç¢ºèª â”€â”€â”€
const MerchantPayouts = () => {
  const toast = useToast();
  const [payoutTab, setPayoutTab] = useState("payout");
  const [selectedPayout, setSelectedPayout] = useState(null);

  const payoutData = [
    { date: "02/07", period: "01/28ã€œ02/03", sales: "Â¥1,450,000", fee: "-Â¥46,400", hold: "-Â¥145,000", release: "+Â¥92,000", payout: "Â¥1,350,600", status: "å…¥é‡‘æ¸ˆã¿", sColor: "green",
      breakdown: [
        { brand: "VISA", count: 82, amount: "Â¥680,000", fee: "Â¥21,760", rate: "3.2%" },
        { brand: "Mastercard", count: 45, amount: "Â¥380,000", fee: "Â¥12,160", rate: "3.2%" },
        { brand: "JCB", count: 38, amount: "Â¥290,000", fee: "Â¥9,280", rate: "3.2%" },
        { brand: "AMEX", count: 12, amount: "Â¥100,000", fee: "Â¥3,200", rate: "3.2%" },
      ],
      bank: { name: "ä¸‰è±UFJéŠ€è¡Œ", branch: "æ¸‹è°·æ”¯åº—", type: "æ™®é€š", number: "****567", holder: "ã‚«ï¼‰ã‚µãƒ³ãƒ—ãƒ«ã‚·ãƒ§ãƒƒãƒ—" }
    },
    { date: "01/31", period: "01/21ã€œ01/27", sales: "Â¥1,180,000", fee: "-Â¥37,760", hold: "-Â¥118,000", release: "+Â¥88,000", payout: "Â¥1,112,240", status: "å…¥é‡‘æ¸ˆã¿", sColor: "green",
      breakdown: [
        { brand: "VISA", count: 65, amount: "Â¥540,000", fee: "Â¥17,280", rate: "3.2%" },
        { brand: "Mastercard", count: 38, amount: "Â¥320,000", fee: "Â¥10,240", rate: "3.2%" },
        { brand: "JCB", count: 30, amount: "Â¥220,000", fee: "Â¥7,040", rate: "3.2%" },
        { brand: "AMEX", count: 10, amount: "Â¥100,000", fee: "Â¥3,200", rate: "3.2%" },
      ],
      bank: { name: "ä¸‰è±UFJéŠ€è¡Œ", branch: "æ¸‹è°·æ”¯åº—", type: "æ™®é€š", number: "****567", holder: "ã‚«ï¼‰ã‚µãƒ³ãƒ—ãƒ«ã‚·ãƒ§ãƒƒãƒ—" }
    },
    { date: "01/24", period: "01/14ã€œ01/20", sales: "Â¥980,000", fee: "-Â¥31,360", hold: "-Â¥98,000", release: "+Â¥0", payout: "Â¥850,640", status: "å…¥é‡‘æ¸ˆã¿", sColor: "green",
      breakdown: [
        { brand: "VISA", count: 55, amount: "Â¥450,000", fee: "Â¥14,400", rate: "3.2%" },
        { brand: "Mastercard", count: 32, amount: "Â¥280,000", fee: "Â¥8,960", rate: "3.2%" },
        { brand: "JCB", count: 28, amount: "Â¥200,000", fee: "Â¥6,400", rate: "3.2%" },
        { brand: "AMEX", count: 6, amount: "Â¥50,000", fee: "Â¥1,600", rate: "3.2%" },
      ],
      bank: { name: "ä¸‰è±UFJéŠ€è¡Œ", branch: "æ¸‹è°·æ”¯åº—", type: "æ™®é€š", number: "****567", holder: "ã‚«ï¼‰ã‚µãƒ³ãƒ—ãƒ«ã‚·ãƒ§ãƒƒãƒ—" }
    },
  ];

  // Calendar data for this month
  const calendarDays = Array.from({length: 28}, (_, i) => {
    const day = i + 1;
    const isPayout = [7, 14, 21, 28].includes(day);
    const isToday = day === 17;
    return { day, isPayout, isToday };
  });

  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">å…¥é‡‘ç¢ºèª</h2>
      <div className="flex gap-2">
        <select className="text-xs border rounded px-2 py-1"><option>2026å¹´2æœˆ</option><option>2026å¹´1æœˆ</option></select>
      </div>
    </div>

    <div className="flex gap-3">
      <KPICard label="ä»Šæœˆã®å…¥é‡‘æ¸ˆã¿" value="Â¥3,825,000" sub="3å›å…¥é‡‘" color="green" />
      <KPICard label="æ¬¡å›å…¥é‡‘äºˆå®š" value="Â¥1,248,000" sub="2/14ï¼ˆé‡‘ï¼‰" color="blue" />
      <KPICard label="ãƒªã‚¶ãƒ¼ãƒ–æ®‹é«˜" value="Â¥620,000" sub="è§£æ”¾äºˆå®š Â¥180,000" color="purple" />
      <KPICard label="æ‰‹æ•°æ–™åˆè¨ˆ" value="Â¥127,500" sub="ç‡: 3.2%" />
    </div>

    {/* Tab */}
    <div className="flex gap-1 border-b">
      {[{ id: "payout", label: "å…¥é‡‘å±¥æ­´" }, { id: "calendar", label: "å…¥é‡‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼" }, { id: "reserve", label: "ãƒªã‚¶ãƒ¼ãƒ–ï¼ˆãƒ‡ãƒã‚¸ãƒƒãƒˆï¼‰" }].map(t => (
        <button key={t.id} onClick={() => setPayoutTab(t.id)} className={`text-xs px-4 py-2 border-b-2 ${payoutTab === t.id ? "border-emerald-500 text-emerald-700 font-semibold" : "border-transparent text-slate-400"}`}>{t.label}</button>
      ))}
    </div>

    {payoutTab === "payout" && (<>
    {/* Next Payout Preview */}
    <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-blue-700">ğŸ’° æ¬¡å›å…¥é‡‘ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</p>
        <Badge text="2/14ï¼ˆé‡‘ï¼‰æŒ¯è¾¼äºˆå®š" color="blue" />
      </div>
      <div className="grid grid-cols-5 gap-3 text-xs">
        <div><span className="text-slate-500">ç²¾ç®—æœŸé–“:</span> <span className="font-semibold">02/04 ã€œ 02/10</span></div>
        <div><span className="text-slate-500">ç·æ±ºæ¸ˆé«˜:</span> <span className="font-semibold">Â¥1,290,000</span></div>
        <div><span className="text-slate-500">æ‰‹æ•°æ–™:</span> <span className="text-rose-500">-Â¥41,280</span></div>
        <div><span className="text-slate-500">ãƒªã‚¶ãƒ¼ãƒ–ç•™ä¿:</span> <span className="text-purple-600">-Â¥129,000</span></div>
        <div><span className="text-slate-500">å…¥é‡‘é¡:</span> <span className="font-bold text-blue-700">Â¥1,119,720</span></div>
      </div>
    </div>

    {/* Search */}
    <div className="flex gap-2">
      <input className="text-xs border rounded px-2 py-1 w-40" placeholder="ç²¾ç®—æœŸé–“ã§æ¤œç´¢" />
      <select className="text-xs border rounded px-2 py-1"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>å…¥é‡‘æ¸ˆã¿</option><option>å‡¦ç†ä¸­</option><option>ä¿ç•™</option></select>
      <input type="date" className="text-xs border rounded px-2 py-1" />
      <span className="text-xs text-slate-400">ã€œ</span>
      <input type="date" className="text-xs border rounded px-2 py-1" />
      <button onClick={() => toast("å…¥é‡‘å±¥æ­´ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="text-xs bg-emerald-600 text-white px-3 py-1 rounded">æ¤œç´¢</button>
      <button onClick={() => toast("å…¥é‡‘æ˜ç´°ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 px-2 py-1 rounded border border-slate-200" title="CSVå‡ºåŠ›">ğŸ“¥ CSV</button>
    </div>

    {/* Payout History */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "å…¥é‡‘æ—¥", w: "w-20" }, { label: "ç²¾ç®—æœŸé–“", w: "w-32" }, { label: "ç·æ±ºæ¸ˆé«˜", w: "w-24" }, { label: "æ‰‹æ•°æ–™", w: "w-20" }, { label: "ãƒªã‚¶ãƒ¼ãƒ–ç•™ä¿", w: "w-24" }, { label: "ãƒªã‚¶ãƒ¼ãƒ–è§£æ”¾", w: "w-24" }, { label: "å…¥é‡‘é¡", w: "w-24" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-20" }, { label: "æ˜ç´°", w: "w-14" }]}>
      {payoutData.map((p, i) => (
        <tr key={i} className={`border-b cursor-pointer hover:bg-blue-50 ${i % 2 ? "bg-slate-50" : ""}`} onClick={() => setSelectedPayout(p)}>
          <td className="px-4 py-2 whitespace-nowrap w-20 text-slate-600">{p.date}</td>
          <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-500">{p.period}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-slate-600">{p.sales}</td>
          <td className="px-4 py-2 whitespace-nowrap w-20 text-right text-rose-500">{p.fee}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-purple-500">{p.hold}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-emerald-600">{p.release}</td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-right font-semibold text-slate-700">{p.payout}</td>
          <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={p.status} color={p.sColor} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-14"><button onClick={e => { e.stopPropagation(); setSelectedPayout(p); }} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs hover:bg-slate-200">ğŸ“„</button></td>
        </tr>
      ))}
      </TableHeader>
    </div>
    </>)}

    {payoutTab === "calendar" && (
    <div className="space-y-3">
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4">
        <div className="flex justify-between items-center mb-3">
          <p className="text-xs font-bold text-slate-700">ğŸ“… 2026å¹´2æœˆ å…¥é‡‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</p>
          <div className="flex gap-3 text-xs">
            <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-emerald-500" /> å…¥é‡‘æ—¥</span>
            <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-blue-500" /> ä»Šæ—¥</span>
          </div>
        </div>
        <div className="grid grid-cols-7 gap-1 text-center mb-1">
          {["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"].map(d => (
            <div key={d} className="text-xs font-bold text-slate-400 py-1">{d}</div>
          ))}
        </div>
        <div className="grid grid-cols-7 gap-1">
          {/* Offset for Feb 2026 starting on Sunday - add empty cells */}
          {[null, null, null, null, null, null].map((_, i) => <div key={`empty-${i}`} />)}
          {calendarDays.map((d, i) => (
            <div key={i} className={`text-xs p-2 rounded text-center cursor-pointer transition-colors
              ${d.isToday ? "bg-blue-500 text-white font-bold" : d.isPayout ? "bg-emerald-100 text-emerald-700 font-semibold border border-emerald-300 hover:bg-emerald-200" : "hover:bg-slate-100 text-slate-600"}`}
              onClick={() => d.isPayout && setSelectedPayout(payoutData[0])}
            >
              {d.day}
              {d.isPayout && <div className="text-xs mt-0.5" style={{fontSize: "7px"}}>ğŸ’°</div>}
            </div>
          ))}
        </div>
      </div>
      <div className="bg-slate-50 rounded border p-2 text-xs text-slate-500">
        å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«: é€±æ¬¡ï¼ˆæ¯é€±é‡‘æ›œæ—¥ï¼‰ | ç²¾ç®—æœŸé–“: å‰é€±æœˆæ›œã€œæ—¥æ›œ | æŒ¯è¾¼å…ˆ: ä¸‰è±UFJéŠ€è¡Œ æ¸‹è°·æ”¯åº—
      </div>
    </div>
    )}

    {payoutTab === "reserve" && (
    <div className="space-y-3">
      {/* Reserve Summary */}
      <div className="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border border-purple-200 p-3">
        <p className="text-xs font-bold text-purple-700 mb-2">ğŸ”’ ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–ï¼ˆãƒ‡ãƒã‚¸ãƒƒãƒˆï¼‰</p>
        <div className="grid grid-cols-4 gap-3">
          {[
            { label: "ç¾åœ¨ã®ãƒªã‚¶ãƒ¼ãƒ–æ®‹é«˜", value: "Â¥620,000", color: "text-purple-700" },
            { label: "ä»Šæœˆè§£æ”¾äºˆå®š", value: "Â¥180,000", color: "text-emerald-600" },
            { label: "æ¥æœˆè§£æ”¾äºˆå®š", value: "Â¥210,000", color: "text-blue-600" },
            { label: "ä»Šæœˆæ–°è¦ç•™ä¿", value: "Â¥263,000", color: "text-slate-700" },
          ].map((r, i) => (
            <div key={i} className="bg-white rounded-lg border border-slate-200 p-2.5 text-center">
              <p className="text-xs text-slate-400">{r.label}</p>
              <p className={`text-sm font-bold ${r.color}`}>{r.value}</p>
            </div>
          ))}
        </div>
      </div>

      {/* Reserve Conditions */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-700 mb-2">é©ç”¨ä¸­ã®ãƒªã‚¶ãƒ¼ãƒ–æ¡ä»¶</p>
        <div className="space-y-1">
          {[
            { proc: "Univa Pay cast", rate: "10%", period: "180æ—¥", balance: "Â¥420,000", next: "Â¥120,000ï¼ˆ3æœˆè§£æ”¾ï¼‰" },
            { proc: "æ¥½å¤©éŠ€è¡Œ", rate: "5%", period: "90æ—¥", balance: "Â¥200,000", next: "Â¥60,000ï¼ˆ3æœˆè§£æ”¾ï¼‰" },
          ].map((c, i) => (
            <div key={i} className="flex items-center gap-3 p-2 rounded border text-xs">
              <span className="w-32 font-semibold text-slate-700">{c.proc}</span>
              <Badge text={`${c.rate} / ${c.period}`} color="purple" />
              <span className="flex-1 text-slate-500">æ®‹é«˜: <span className="font-bold text-purple-700">{c.balance}</span></span>
              <span className="text-slate-400">æ¬¡å›è§£æ”¾: {c.next}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Reserve History Search */}
      <div className="flex gap-2">
        <select className="text-xs border rounded px-2 py-1"><option>å…¨ç¨®åˆ¥</option><option>ç•™ä¿</option><option>è§£æ”¾</option></select>
        <input type="date" className="text-xs border rounded px-2 py-1" />
        <span className="text-xs text-slate-400">ã€œ</span>
        <input type="date" className="text-xs border rounded px-2 py-1" />
        <button onClick={() => toast("æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ", "info")} className="text-xs bg-purple-600 text-white px-3 py-1 rounded">æ¤œç´¢</button>
      </div>

      {/* Reserve Transaction History */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
        <TableHeader cols={[{ label: "æ—¥ä»˜", w: "w-24" }, { label: "ç¨®åˆ¥", w: "w-16" }, { label: "æ¥ç¶šå…ˆ", w: "w-32" }, { label: "å¯¾è±¡ç²¾ç®—", w: "w-32" }, { label: "é‡‘é¡", w: "w-24" }, { label: "æ®‹é«˜", w: "w-24" }]}>
        {[
          { date: "2026-02-07", type: "ç•™ä¿", tColor: "purple", proc: "Univa Pay cast", target: "01/28ã€œ02/03ç²¾ç®—åˆ†", amount: "-Â¥145,000", balance: "Â¥620,000" },
          { date: "2026-02-07", type: "è§£æ”¾", tColor: "green", proc: "æ¥½å¤©éŠ€è¡Œ", target: "2025å¹´8æœˆç•™ä¿åˆ†", amount: "+Â¥60,000", balance: "Â¥475,000" },
          { date: "2026-01-31", type: "ç•™ä¿", tColor: "purple", proc: "Univa Pay cast", target: "01/21ã€œ01/27ç²¾ç®—åˆ†", amount: "-Â¥118,000", balance: "Â¥535,000" },
          { date: "2026-01-31", type: "ç•™ä¿", tColor: "purple", proc: "æ¥½å¤©éŠ€è¡Œ", target: "01/21ã€œ01/27ç²¾ç®—åˆ†", amount: "-Â¥59,000", balance: "Â¥653,000" },
          { date: "2026-01-24", type: "è§£æ”¾", tColor: "green", proc: "Worldpay", target: "2025å¹´7æœˆç•™ä¿åˆ†", amount: "+Â¥92,000", balance: "Â¥712,000" },
        ].map((r, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-500">{r.date}</td>
            <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.type} color={r.tColor} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-600">{r.proc}</td>
            <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-400">{r.target}</td>
            <td className={`px-4 py-2 whitespace-nowrap w-24 text-right font-semibold ${r.type === "è§£æ”¾" ? "text-emerald-600" : "text-purple-600"}`}>{r.amount}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-right text-slate-700">{r.balance}</td>
          </tr>
        ))}
        </TableHeader>
      </div>
    </div>
    )}

    {/* â”€â”€ Slide Panel: å…¥é‡‘è©³ç´° â”€â”€ */}
    {selectedPayout && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedPayout(null)} />
        <div className="w-[440px] bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b bg-slate-50 flex justify-between items-center sticky top-0 z-10">
            <h3 className="text-sm font-bold text-slate-800">ğŸ’° å…¥é‡‘æ˜ç´°</h3>
            <button onClick={() => setSelectedPayout(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            {/* Summary */}
            <div className="text-center">
              <p className="text-xs text-slate-400">å…¥é‡‘é¡</p>
              <p className="text-2xl font-bold text-slate-800">{selectedPayout.payout}</p>
              <div className="flex items-center justify-center gap-2 mt-1">
                <Badge text={selectedPayout.status} color={selectedPayout.sColor} />
                <span className="text-xs text-slate-400">å…¥é‡‘æ—¥: {selectedPayout.date}</span>
              </div>
            </div>

            {/* Settlement Summary */}
            <div className="bg-slate-50 rounded-lg p-3">
              <p className="text-xs font-bold text-slate-700 mb-2">ç²¾ç®—ã‚µãƒãƒªãƒ¼</p>
              <div className="space-y-1.5 text-xs">
                <div className="flex justify-between"><span className="text-slate-500">ç²¾ç®—æœŸé–“</span><span className="font-semibold">{selectedPayout.period}</span></div>
                <div className="flex justify-between"><span className="text-slate-500">ç·æ±ºæ¸ˆé«˜</span><span className="font-semibold">{selectedPayout.sales}</span></div>
                <div className="flex justify-between"><span className="text-rose-500">æ‰‹æ•°æ–™</span><span className="text-rose-500">{selectedPayout.fee}</span></div>
                <div className="flex justify-between"><span className="text-purple-500">ãƒªã‚¶ãƒ¼ãƒ–ç•™ä¿</span><span className="text-purple-500">{selectedPayout.hold}</span></div>
                <div className="flex justify-between"><span className="text-emerald-600">ãƒªã‚¶ãƒ¼ãƒ–è§£æ”¾</span><span className="text-emerald-600">{selectedPayout.release}</span></div>
                <div className="flex justify-between border-t pt-1.5"><span className="font-bold text-slate-700">å…¥é‡‘é¡</span><span className="font-bold text-slate-800">{selectedPayout.payout}</span></div>
              </div>
            </div>

            {/* Brand Breakdown */}
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">ğŸ’³ ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥å†…è¨³</p>
              <table className="w-full text-xs">
                <thead><tr className="bg-slate-50 border-b">
                  <th className="text-left px-2 py-1 font-semibold text-slate-600">ãƒ–ãƒ©ãƒ³ãƒ‰</th>
                  <th className="text-right px-2 py-1 font-semibold text-slate-600">ä»¶æ•°</th>
                  <th className="text-right px-2 py-1 font-semibold text-slate-600">é‡‘é¡</th>
                  <th className="text-right px-2 py-1 font-semibold text-slate-600">æ‰‹æ•°æ–™</th>
                  <th className="text-right px-2 py-1 font-semibold text-slate-600">ç‡</th>
                </tr></thead>
                <tbody>
                  {selectedPayout.breakdown.map((b, i) => (
                    <tr key={i} className="border-b"><td className="px-2 py-1">{b.brand}</td><td className="px-2 py-1 text-right">{b.count}</td><td className="px-2 py-1 text-right">{b.amount}</td><td className="px-2 py-1 text-right text-rose-500">{b.fee}</td><td className="px-2 py-1 text-right text-slate-400">{b.rate}</td></tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Bank Info */}
            <div className="bg-blue-50 rounded border border-blue-200 p-3">
              <p className="text-xs font-bold text-blue-700 mb-2">ğŸ¦ æŒ¯è¾¼å…ˆå£åº§</p>
              <div className="grid grid-cols-2 gap-2 text-xs">
                <div><span className="text-slate-400">éŠ€è¡Œå: </span><span className="text-slate-700">{selectedPayout.bank.name}</span></div>
                <div><span className="text-slate-400">æ”¯åº—: </span><span className="text-slate-700">{selectedPayout.bank.branch}</span></div>
                <div><span className="text-slate-400">ç¨®åˆ¥: </span><span className="text-slate-700">{selectedPayout.bank.type}</span></div>
                <div><span className="text-slate-400">å£åº§ç•ªå·: </span><span className="text-slate-700">{selectedPayout.bank.number}</span></div>
                <div className="col-span-2"><span className="text-slate-400">åç¾©: </span><span className="text-slate-700">{selectedPayout.bank.holder}</span></div>
              </div>
            </div>

            {/* Actions */}
            <div className="flex gap-2 pt-2 border-t">
              <button onClick={() => toast("å…¥é‡‘æ˜ç´°ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="flex-1 px-3 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">ğŸ“¥ æ˜ç´°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
              <button onClick={() => setSelectedPayout(null)} className="px-3 py-2 bg-slate-100 text-slate-600 rounded text-xs border hover:bg-slate-200">é–‰ã˜ã‚‹</button>
            </div>
          </div>
        </div>
      </div>
    )}
    </div>
  );
};

// â”€â”€â”€ P01: åŠ ç›Ÿåº—ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ  â”€â”€â”€
const MerchantApplicationForm = () => {
  const [step, setStep] = useState(0);
  const steps = ["ä¼æ¥­æƒ…å ±", "äº‹æ¥­å†…å®¹", "æ±ºæ¸ˆè¨­å®š", "æ›¸é¡æå‡º", "ç¢ºèªãƒ»ç”³è¾¼"];
  const [submitted, setSubmitted] = useState(false);

  if (submitted) {
    return (
      <div className="min-h-full bg-gradient-to-b from-gray-50 to-white flex items-center justify-center">
        <div className="max-w-md text-center py-16">
          <div className="w-16 h-16 rounded-full bg-emerald-100 flex items-center justify-center text-2xl mx-auto mb-4">âœ…</div>
          <h2 className="text-lg font-bold text-slate-800 mb-2">ç”³è¾¼ã‚’å—ä»˜ã—ã¾ã—ãŸ</h2>
          <p className="text-xs text-slate-500 mb-3">ç”³è¾¼ç•ªå·: <span className="font-mono font-bold text-blue-600">APP-2026-0211-009</span></p>
          <div className="bg-blue-50 rounded-lg border border-blue-200 p-4 mb-4 text-left">
            <p className="text-xs font-bold text-blue-700 mb-2">ğŸ¤– AIå¯©æŸ»ã‚’é–‹å§‹ã—ã¾ã—ãŸ <span className="font-normal text-blue-500 animate-pulse">â— ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ä¸­ï¼ˆWebSocketï¼‰</span></p>
            <div className="text-xs text-slate-600 space-y-1.5">
              <div className="flex items-center gap-2"><span className="text-blue-500 animate-pulse">âŸ³</span> åç¤¾ãƒã‚§ãƒƒã‚¯... ç…§åˆä¸­</div>
              <div className="flex items-center gap-2"><span className="text-blue-500 animate-pulse">âŸ³</span> Webã‚µã‚¤ãƒˆè§£æ... ã‚¯ãƒ­ãƒ¼ãƒ«ä¸­</div>
              <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> æ±ºç®—æ›¸è§£æ... å¾…æ©Ÿä¸­</div>
              <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> æ¥­ç•Œãƒªã‚¹ã‚¯è©•ä¾¡... å¾…æ©Ÿä¸­</div>
              <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> ç·åˆåˆ¤å®š... å¾…æ©Ÿä¸­</div>
            </div>
          </div>
          <p className="text-xs text-slate-500 mb-4">å¯©æŸ»çŠ¶æ³ã¯ãƒ¡ãƒ¼ãƒ«ï¼ˆsato@techshop.jpï¼‰ã«éšæ™‚é€šçŸ¥ã•ã‚Œã¾ã™ã€‚<br/>é€šå¸¸ã€AIå¯©æŸ»ã¯1ã€œ3æ™‚é–“ã§å®Œäº†ã—ã¾ã™ã€‚</p>
          <button onClick={() => { setSubmitted(false); setStep(0); }} className="px-4 py-2 bg-slate-100 text-slate-600 rounded text-xs">ãƒ•ã‚©ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-full bg-gradient-to-b from-gray-50 to-white">
      <div className="max-w-2xl mx-auto py-6 px-4">
        {/* Header */}
        <div className="text-center mb-6">
          <div className="inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg mb-3">
            <span className="text-lg font-bold">â¬¡</span>
            <span className="text-sm font-bold">AI Payment</span>
          </div>
          <h1 className="text-base font-bold text-slate-800">åŠ ç›Ÿåº— æ–°è¦ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </h1>
          <p className="text-xs text-slate-500 mt-1">AIå¯©æŸ»ã«ã‚ˆã‚Šã€æœ€çŸ­å³æ—¥ã§å¯©æŸ»ãŒå®Œäº†ã—ã¾ã™</p>
          <div className="mt-2 inline-flex items-center gap-1.5 bg-emerald-50 text-emerald-700 text-xs px-3 py-1 rounded-full border border-emerald-200">
            <span>ğŸ’¾</span> å…¥åŠ›å†…å®¹ã¯ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ã€‚é€”ä¸­ã§é–‰ã˜ã¦ã‚‚å†é–‹ã§ãã¾ã™ã€‚
          </div>
        </div>

        {/* Progress Steps */}
        <div className="flex items-center gap-1 mb-6 px-4">
          {steps.map((s, i) => (
            <div key={i} className="flex items-center gap-1 flex-1">
              <div
                className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold cursor-pointer transition-all ${
                  i < step ? "bg-emerald-500 text-white" : i === step ? "bg-blue-600 text-white" : "bg-slate-200 text-slate-400"
                }`}
                onClick={() => i <= step && setStep(i)}
              >
                {i < step ? "âœ“" : i + 1}
              </div>
              <span className={`text-xs ${i < step ? "text-emerald-600" : i === step ? "text-blue-600 font-semibold" : "text-slate-400"}`}>{s}</span>
              {i < 4 && <div className={`flex-1 h-0.5 ${i < step ? "bg-emerald-300" : "bg-slate-200"}`} />}
            </div>
          ))}
        </div>

        {/* â•â•â• Step 1: ä¼æ¥­æƒ…å ± â•â•â• */}
        {step === 0 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 1: ä¼æ¥­æƒ…å ±</p>
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ³•äººå *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ³•äººç•ªå·ï¼ˆ13æ¡ï¼‰</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 1234567890123" />
                <span className="text-xs text-slate-400 mt-0.5">å…¥åŠ›æ™‚ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å›½ç¨åºDBç…§åˆ+é‡è¤‡ç”³è¾¼ãƒã‚§ãƒƒã‚¯</span>
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">ä»£è¡¨è€…å *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: å±±ç”° å¤ªéƒ" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">è¨­ç«‹å¹´æœˆ *</label>
                <input className="w-full text-xs border rounded px-3 py-2" type="month" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">è³‡æœ¬é‡‘ *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 5,000,000" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">å¾“æ¥­å“¡æ•°</label>
                <select className="w-full text-xs border rounded px-3 py-2">
                  <option>1ã€œ5å</option><option>6ã€œ20å</option><option>21ã€œ50å</option><option>51åä»¥ä¸Š</option>
                </select>
              </div>
              <div className="col-span-2">
                <label className="text-xs text-slate-500 block mb-1">æœ¬ç¤¾æ‰€åœ¨åœ° *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: æ±äº¬éƒ½æ¸‹è°·åŒº..." />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ‹…å½“è€…å *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: ä½è—¤ èŠ±å­" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ‹…å½“è€…ãƒ¡ãƒ¼ãƒ« *</label>
                <input className="w-full text-xs border rounded px-3 py-2" type="email" placeholder="ä¾‹: sato@techshop.jp" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ‹…å½“è€…é›»è©±ç•ªå· *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 03-1234-5678" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">Webã‚µã‚¤ãƒˆURL <span className="text-slate-400 text-[10px]">(ä»»æ„)</span></label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: https://example.jp" />
                <span className="text-xs text-slate-400 mt-0.5">â€» ã‚µã‚¤ãƒˆãŒã¾ã ãªã„å ´åˆã¯ç©ºæ¬„ã§ã‚‚ç”³è¾¼å¯èƒ½ã§ã™</span>
              </div>
            </div>
            <div className="bg-blue-50 rounded p-2 border border-blue-200">
              <p className="text-xs text-blue-700">ğŸ¤– <span className="font-semibold">AIå¯©æŸ»ã®ãƒã‚¤ãƒ³ãƒˆ:</span> æ³•äººç•ªå·ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€å›½ç¨åºãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨è‡ªå‹•ç…§åˆã—ã¾ã™ã€‚Webã‚µã‚¤ãƒˆURLãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚µã‚¤ãƒˆå†…å®¹ã®AIè§£æã‚‚è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚</p>
            </div>
            <div className="flex justify-end gap-2 pt-2 border-t">
              <button onClick={() => setStep(1)} className="px-6 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">æ¬¡ã¸: äº‹æ¥­å†…å®¹ â†’</button>
            </div>
          </div>
        )}

        {/* â•â•â• Step 2: äº‹æ¥­å†…å®¹ â•â•â• */}
        {step === 1 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 2: äº‹æ¥­å†…å®¹</p>
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ¥­ç¨® *</label>
                <select className="w-full text-xs border rounded px-3 py-2">
                  <option>é¸æŠã—ã¦ãã ã•ã„</option>
                  <option>ç‰©è²©ECï¼ˆè¡£æ–™ãƒ»é›‘è²¨ï¼‰</option>
                  <option>ç‰©è²©ECï¼ˆå®¶é›»ãƒ»ã‚¬ã‚¸ã‚§ãƒƒãƒˆï¼‰</option>
                  <option>ãƒ‡ã‚¸ã‚¿ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</option>
                  <option>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</option>
                  <option>æ—…è¡Œãƒ»å®¿æ³Š</option>
                  <option>é£²é£Ÿãƒ»ãƒ‡ãƒªãƒãƒªãƒ¼</option>
                  <option>æ•™è‚²ãƒ»ã‚¹ã‚¯ãƒ¼ãƒ«</option>
                  <option>ãã®ä»–</option>
                </select>
                <input className="w-full text-xs border rounded px-3 py-2 mt-1 hidden" placeholder="ã€Œãã®ä»–ã€ã‚’é¸æŠã—ãŸå ´åˆã€æ¥­ç¨®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆå¿…é ˆï¼‰" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ« *</label>
                <select className="w-full text-xs border rounded px-3 py-2">
                  <option>é¸æŠã—ã¦ãã ã•ã„</option>
                  <option>BtoCï¼ˆæ¶ˆè²»è€…å‘ã‘ï¼‰</option>
                  <option>BtoBï¼ˆæ³•äººå‘ã‘ï¼‰</option>
                  <option>CtoCï¼ˆå€‹äººé–“å–å¼•ï¼‰</option>
                  <option>BtoBtoC</option>
                </select>
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜ *</label>
                <select className="w-full text-xs border rounded px-3 py-2">
                  <option>é¸æŠã—ã¦ãã ã•ã„</option>
                  <option>ã€œÂ¥500,000</option>
                  <option>Â¥500,000ã€œÂ¥1,000,000</option>
                  <option>Â¥1,000,000ã€œÂ¥5,000,000</option>
                  <option>Â¥5,000,000ã€œÂ¥10,000,000</option>
                  <option>Â¥10,000,000ä»¥ä¸Š</option>
                </select>
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">å¹³å‡å–å¼•å˜ä¾¡ *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 5,000" />
              </div>
              <div className="col-span-2">
                <label className="text-xs text-slate-500 block mb-1">å–æ‰±å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®èª¬æ˜ *</label>
                <textarea className="w-full text-xs border rounded px-3 py-2 h-16 resize-none" placeholder="ä¾‹: ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ–ãƒ©ãƒ³ãƒ‰ã®ã‚¢ãƒ‘ãƒ¬ãƒ«å•†å“ã‚’ECã‚µã‚¤ãƒˆã§è²©å£²ã€‚ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯20ã€œ30ä»£å¥³æ€§ã€‚" />
              </div>
              <div className="col-span-2">
                <label className="text-xs text-slate-500 block mb-1">éå»ã®ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆåˆ©ç”¨çµŒé¨“</label>
                <div className="flex gap-4 mt-1">
                  {["åˆã‚ã¦", "ä»–ç¤¾ã§åˆ©ç”¨ä¸­", "ä»–ç¤¾ã‹ã‚‰ä¹—ã‚Šæ›ãˆ"].map((opt, i) => (
                    <label key={i} className="flex items-center gap-1.5 text-xs text-slate-600">
                      <input type="radio" name="experience" className="w-3 h-3" defaultChecked={i===0} />{opt}
                    </label>
                  ))}
                </div>
              </div>
            </div>
            <div className="bg-blue-50 rounded p-2 border border-blue-200">
              <p className="text-xs text-blue-700">ğŸ¤– <span className="font-semibold">AIå¯©æŸ»ã®ãƒã‚¤ãƒ³ãƒˆ:</span> æ¥­ç¨®ã¨å–æ‰±å•†å“ã®çµ„ã¿åˆã‚ã›ã§ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã‚’è‡ªå‹•åˆ¤å®šã—ã¾ã™ã€‚è©³ã—ãè¨˜è¼‰ã„ãŸã ãã¨å¯©æŸ»ãŒã‚¹ãƒ ãƒ¼ã‚ºã«é€²ã¿ã¾ã™ã€‚</p>
            </div>
            <div className="flex justify-between pt-2 border-t">
              <button onClick={() => setStep(0)} className="px-6 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">â† æˆ»ã‚‹</button>
              <button onClick={() => setStep(2)} className="px-6 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">æ¬¡ã¸: æ±ºæ¸ˆè¨­å®š â†’</button>
            </div>
          </div>
        )}

        {/* â•â•â• Step 3: æ±ºæ¸ˆè¨­å®š â•â•â• */}
        {step === 2 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 3: æ±ºæ¸ˆè¨­å®š</p>

            <div>
              <label className="text-xs text-slate-500 block mb-2">åˆ©ç”¨ã—ãŸã„æ±ºæ¸ˆæ‰‹æ®µ *ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
              <div className="grid grid-cols-2 gap-2">
                {[
                  { name: "VISA / Mastercard", icon: "ğŸ’³", desc: "æ‰‹æ•°æ–™ 3.0%ã€œ", checked: true },
                  { name: "JCB", icon: "ğŸ’³", desc: "æ‰‹æ•°æ–™ 3.3%ã€œ", checked: true },
                  { name: "American Express", icon: "ğŸ’³", desc: "æ‰‹æ•°æ–™ 3.5%ã€œ", checked: false },
                  { name: "WEBãƒãƒãƒ¼ï¼ˆ7ç¨®ï¼‰", icon: "ğŸ’°", desc: "æ‰‹æ•°æ–™ 3.5%ã€œ5.0%", checked: false },
                ].map((m, i) => (
                  <label key={i} className={`flex items-center gap-2 text-xs p-2.5 rounded border cursor-pointer transition-all ${m.checked ? "bg-blue-50 border-blue-300" : "bg-white border-slate-200 hover:border-slate-300"}`}>
                    <input type="checkbox" defaultChecked={m.checked} className="w-3.5 h-3.5" />
                    <span>{m.icon}</span>
                    <div>
                      <span className="font-semibold text-slate-700">{m.name}</span>
                      <span className="text-slate-400 ml-1">({m.desc})</span>
                    </div>
                  </label>
                ))}
              </div>
            </div>

            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="text-xs text-slate-500 block mb-1">å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ« *</label>
                <select className="w-full text-xs border rounded px-3 py-2">
                  <option>æœˆæœ«ç· ã‚ / ç¿Œæœˆæœ«æ‰•ã„</option>
                  <option>15æ—¥ãƒ»æœˆæœ«ç· ã‚ / ç¿Œæœˆ15æ—¥ãƒ»æœ«æ—¥æ‰•ã„</option>
                  <option>é€±æ¬¡å…¥é‡‘ï¼ˆæ¯é€±é‡‘æ›œï¼‰</option>
                </select>
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">å…¥é‡‘å…ˆå£åº§ *</label>
                <select className="w-full text-xs border rounded px-3 py-2">
                  <option>æ™®é€šå£åº§</option>
                  <option>å½“åº§å£åº§</option>
                </select>
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">éŠ€è¡Œå *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: ä¸‰è±UFJéŠ€è¡Œ" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ”¯åº—å *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: æ¸‹è°·æ”¯åº—" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">å£åº§ç•ªå· *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 1234567" />
              </div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">å£åº§åç¾©ï¼ˆã‚«ãƒŠï¼‰ *</label>
                <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: ã‚«ï¼‰ã‚µãƒ³ãƒ—ãƒ«" />
              </div>
            </div>

            <div className="bg-blue-50 rounded p-2 border border-blue-200">
              <p className="text-xs text-blue-700">ğŸ¤– <span className="font-semibold">AIå¯©æŸ»ã®ãƒã‚¤ãƒ³ãƒˆ:</span> å£åº§åç¾©ã¨æ³•äººåã®ç…§åˆã‚’è‡ªå‹•ã§è¡Œã„ã¾ã™ã€‚æ³•äººåç¾©ã¨ä¸€è‡´ã—ãªã„å ´åˆã€ç¢ºèªã®é€£çµ¡ã‚’ã•ã›ã¦ã„ãŸã ãå ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
            </div>

            <div className="flex justify-between pt-2 border-t">
              <button onClick={() => setStep(1)} className="px-6 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">â† æˆ»ã‚‹</button>
              <button onClick={() => setStep(3)} className="px-6 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">æ¬¡ã¸: æ›¸é¡æå‡º â†’</button>
            </div>
          </div>
        )}

        {/* â•â•â• Step 4: æ›¸é¡æå‡º â•â•â• */}
        {step === 3 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 4: æ›¸é¡æå‡º</p>

            <div className="space-y-3">
              {[
                { name: "ç™»è¨˜ç°¿è¬„æœ¬ï¼ˆå±¥æ­´äº‹é …å…¨éƒ¨è¨¼æ˜æ›¸ï¼‰", required: true, desc: "ç™ºè¡Œã‹ã‚‰3ãƒ¶æœˆä»¥å†…ã®ã‚‚ã®", status: "uploaded", fileName: "tokibo_20260205.pdf" },
                { name: "ä»£è¡¨è€…ã®æœ¬äººç¢ºèªæ›¸é¡", required: true, desc: "é‹è»¢å…è¨±è¨¼ãƒ»ãƒ‘ã‚¹ãƒãƒ¼ãƒˆãƒ»ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ç­‰", status: "uploaded", fileName: "id_tanaka.jpg" },
                { name: "ç›´è¿‘ã®æ±ºç®—æ›¸ï¼ˆ2æœŸåˆ†ï¼‰", required: true, desc: "æç›Šè¨ˆç®—æ›¸ãƒ»è²¸å€Ÿå¯¾ç…§è¡¨", status: "pending" },
                { name: "ã‚µã‚¤ãƒˆã®ç‰¹å®šå•†å–å¼•æ³•è¡¨è¨˜ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ", required: true, desc: "ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜ãƒšãƒ¼ã‚¸", status: "pending" },
                { name: "å¤ç‰©å•†è¨±å¯è¨¼ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰", required: false, desc: "ä¸­å¤å“ã‚’å–ã‚Šæ‰±ã†å ´åˆã®ã¿", status: "na" },
              ].map((doc, i) => (
                <div key={i} className={`rounded border p-3 ${doc.status === "uploaded" ? "bg-emerald-50 border-emerald-200" : doc.status === "na" ? "bg-slate-50 border-slate-200" : "bg-white"}`}>
                  <div className="flex justify-between items-start mb-1">
                    <div>
                      <span className="text-xs font-semibold text-slate-700">{doc.name}</span>
                      {doc.required && <span className="text-rose-500 text-xs ml-1">*</span>}
                      {!doc.required && <span className="text-slate-400 text-xs ml-1">(ä»»æ„)</span>}
                    </div>
                    {doc.status === "uploaded" && <Badge text="âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆ" color="green" />}
                    {doc.status === "pending" && <Badge text="â¬† æœªæå‡º" color="yellow" />}
                    {doc.status === "na" && <Badge text="â€” è©²å½“ãªã—" color="gray" />}
                  </div>
                  <p className="text-xs text-slate-400 mb-2">{doc.desc}</p>
                  {doc.status === "uploaded" && (
                    <div className="flex items-center gap-2 text-xs text-emerald-700 bg-emerald-100 rounded px-2 py-1">
                      <span>ğŸ“ {doc.fileName}</span>
                      <span className="text-emerald-500">ğŸ›¡ï¸ ã‚¹ã‚­ãƒ£ãƒ³æ¸ˆ</span>
                      <button onClick={() => toast("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ", "warning")} className="text-rose-500 hover:text-rose-700 ml-auto">å‰Šé™¤</button>
                    </div>
                  )}
                  {doc.status === "pending" && (
                    <div className="border-2 border-dashed border-slate-300 rounded p-3 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all">
                      <p className="text-xs text-slate-400">ğŸ“ ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>
                      <p className="text-xs text-slate-300 mt-0.5">PDF / JPG / PNGï¼ˆæœ€å¤§10MBï¼‰</p>
                    </div>
                  )}
                </div>
              ))}
            </div>

            <div className="bg-blue-50 rounded p-2 border border-blue-200">
              <p className="text-xs text-blue-700">ğŸ¤– <span className="font-semibold">AIå¯©æŸ»ã®ãƒã‚¤ãƒ³ãƒˆ:</span> ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸæ›¸é¡ã¯AI-OCRã§è‡ªå‹•èª­å–ã•ã‚Œã€ç”³è¾¼å†…å®¹ã¨ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚æ±ºç®—æ›¸ã‹ã‚‰ã¯è²¡å‹™å¥å…¨æ€§ã‚¹ã‚³ã‚¢ã‚’è‡ªå‹•ç®—å‡ºã—ã¾ã™ã€‚</p>
            </div>

            <div className="flex justify-between pt-2 border-t">
              <button onClick={() => setStep(2)} className="px-6 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">â† æˆ»ã‚‹</button>
              <button onClick={() => setStep(4)} className="px-6 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">æ¬¡ã¸: ç¢ºèªãƒ»ç”³è¾¼ â†’</button>
            </div>
          </div>
        )}

        {/* â•â•â• Step 5: ç¢ºèªãƒ»ç”³è¾¼ â•â•â• */}
        {step === 4 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 5: ç¢ºèªãƒ»ç”³è¾¼</p>

            {/* Summary Cards */}
            <div className="space-y-2">
              <div className="bg-slate-50 rounded p-3">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ“‹ ä¼æ¥­æƒ…å ±</p>
                  <button onClick={() => setStep(0)} className="text-xs text-blue-600 hover:underline">ç·¨é›†</button>
                </div>
                <div className="grid grid-cols-3 gap-2 text-xs text-slate-600">
                  <div><span className="text-slate-400">æ³•äººå:</span> æ ªå¼ä¼šç¤¾ãƒ†ãƒƒã‚¯ã‚·ãƒ§ãƒƒãƒ—</div>
                  <div><span className="text-slate-400">ä»£è¡¨è€…:</span> ä½ã€…æœ¨ å¥ä¸€</div>
                  <div><span className="text-slate-400">è¨­ç«‹:</span> 2022å¹´8æœˆ</div>
                  <div><span className="text-slate-400">è³‡æœ¬é‡‘:</span> Â¥5,000,000</div>
                  <div><span className="text-slate-400">æ‰€åœ¨åœ°:</span> æ±äº¬éƒ½æ¸‹è°·åŒº...</div>
                  <div><span className="text-slate-400">URL:</span> techshop.jp</div>
                </div>
              </div>

              <div className="bg-slate-50 rounded p-3">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ¢ äº‹æ¥­å†…å®¹</p>
                  <button onClick={() => setStep(1)} className="text-xs text-blue-600 hover:underline">ç·¨é›†</button>
                </div>
                <div className="grid grid-cols-3 gap-2 text-xs text-slate-600">
                  <div><span className="text-slate-400">æ¥­ç¨®:</span> ç‰©è²©ECï¼ˆå®¶é›»ãƒ»ã‚¬ã‚¸ã‚§ãƒƒãƒˆï¼‰</div>
                  <div><span className="text-slate-400">ãƒ¢ãƒ‡ãƒ«:</span> BtoC</div>
                  <div><span className="text-slate-400">æœˆé–“äºˆæƒ³:</span> Â¥5,000,000ã€œ</div>
                  <div><span className="text-slate-400">å¹³å‡å˜ä¾¡:</span> Â¥15,000</div>
                  <div className="col-span-2"><span className="text-slate-400">çµŒé¨“:</span> ä»–ç¤¾ã§åˆ©ç”¨ä¸­</div>
                </div>
              </div>

              <div className="bg-slate-50 rounded p-3">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ’³ æ±ºæ¸ˆè¨­å®š</p>
                  <button onClick={() => setStep(2)} className="text-xs text-blue-600 hover:underline">ç·¨é›†</button>
                </div>
                <div className="grid grid-cols-2 gap-2 text-xs text-slate-600">
                  <div><span className="text-slate-400">æ±ºæ¸ˆæ‰‹æ®µ:</span> VISA / MC / JCB / WEBãƒãƒãƒ¼</div>
                  <div><span className="text-slate-400">å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«:</span> æœˆæœ«ç· ã‚ / ç¿Œæœˆæœ«æ‰•ã„</div>
                  <div><span className="text-slate-400">éŠ€è¡Œ:</span> ä¸‰è±UFJéŠ€è¡Œ æ¸‹è°·æ”¯åº—</div>
                  <div><span className="text-slate-400">å£åº§:</span> æ™®é€š 1234567 ã‚«ï¼‰ãƒ†ãƒƒã‚¯ã‚·ãƒ§ãƒƒãƒ—</div>
                </div>
              </div>

              <div className="bg-slate-50 rounded p-3">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ“ æ›¸é¡æå‡º</p>
                  <button onClick={() => setStep(3)} className="text-xs text-blue-600 hover:underline">ç·¨é›†</button>
                </div>
                <div className="text-xs space-y-1">
                  <div className="flex items-center gap-2 text-slate-600"><span className="text-emerald-500">âœ…</span> ç™»è¨˜ç°¿è¬„æœ¬ â€” tokibo_20260205.pdf</div>
                  <div className="flex items-center gap-2 text-slate-600"><span className="text-emerald-500">âœ…</span> æœ¬äººç¢ºèªæ›¸é¡ â€” id_tanaka.jpg</div>
                  <div className="flex items-center gap-2 text-amber-600"><span className="text-amber-500">âš </span> æ±ºç®—æ›¸ â€” <span className="font-semibold">æœªæå‡ºï¼ˆå¯©æŸ»ä¸­ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯ï¼‰</span></div>
                  <div className="flex items-center gap-2 text-amber-600"><span className="text-amber-500">âš </span> ç‰¹å®šå•†å–å¼•æ³•è¡¨è¨˜ â€” <span className="font-semibold">æœªæå‡ºï¼ˆå¯©æŸ»ä¸­ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯ï¼‰</span></div>
                </div>
              </div>
            </div>

            {/* Terms */}
            <div className="border rounded p-3">
              <label className="flex items-start gap-2 text-xs cursor-pointer">
                <input type="checkbox" className="w-3.5 h-3.5 mt-0.5" defaultChecked />
                <span className="text-slate-600">
                  <span className="text-blue-600 underline">åˆ©ç”¨è¦ç´„</span>ãŠã‚ˆã³
                  <span className="text-blue-600 underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</span>ã«åŒæ„ã—ã¾ã™ã€‚
                  ç”³è¾¼å†…å®¹ã«è™šå½ãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã€AIå¯©æŸ»ã«ã‚ˆã‚‹è‡ªå‹•åˆ¤å®šãŒè¡Œã‚ã‚Œã‚‹ã“ã¨ã«åŒæ„ã—ã¾ã™ã€‚
                </span>
              </label>
            </div>

            <div className="bg-emerald-50 rounded p-2 border border-emerald-200">
              <p className="text-xs text-emerald-700">ğŸ¤– ç”³è¾¼å¾Œã€AIãŒè‡ªå‹•çš„ã«å¯©æŸ»ã‚’é–‹å§‹ã—ã¾ã™ã€‚é€šå¸¸1ã€œ3æ™‚é–“ã§çµæœã‚’ãƒ¡ãƒ¼ãƒ«ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚äººé–“ã«ã‚ˆã‚‹è¿½åŠ ç¢ºèªãŒå¿…è¦ãªå ´åˆã¯ã€åˆ¥é€”ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚</p>
            </div>

            <div className="flex justify-between pt-2 border-t">
              <button onClick={() => setStep(3)} className="px-6 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">â† æˆ»ã‚‹</button>
              <button onClick={() => setSubmitted(true)} className="px-8 py-2.5 bg-emerald-600 text-white rounded text-xs font-bold hover:bg-emerald-700 shadow-sm">âœ“ ã“ã®å†…å®¹ã§ç”³è¾¼ã‚€</button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

// â”€â”€â”€ P03: ä»£ç†åº—ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ  â”€â”€â”€
const AgentApplicationForm = () => {
  const [step, setStep] = useState(0);
  const steps = ["ä¼æ¥­æƒ…å ±", "ä»£ç†åº—æƒ…å ±", "å£åº§æƒ…å ±", "ç¢ºèªãƒ»ç”³è¾¼"];
  const [submitted, setSubmitted] = useState(false);

  if (submitted) {
    return (
      <div className="min-h-full bg-gradient-to-b from-gray-50 to-white flex items-center justify-center">
        <div className="max-w-md text-center py-16">
          <div className="w-16 h-16 rounded-full bg-orange-100 flex items-center justify-center text-2xl mx-auto mb-4">âœ…</div>
          <h2 className="text-lg font-bold text-slate-800 mb-2">ä»£ç†åº—ç”³è¾¼ã‚’å—ä»˜ã—ã¾ã—ãŸ</h2>
          <p className="text-xs text-slate-500 mb-3">ç”³è¾¼ç•ªå·: <span className="font-mono font-bold text-orange-600">AGT-2026-0211-004</span></p>
          <div className="bg-orange-50 rounded-lg border border-orange-200 p-4 mb-4 text-left">
            <p className="text-xs font-bold text-orange-700 mb-2">ğŸ“‹ ä»Šå¾Œã®æµã‚Œ</p>
            <div className="text-xs text-slate-600 space-y-1.5">
              <div className="flex items-center gap-2"><span className="text-emerald-500">âœ…</span> â‘  ç”³è¾¼å—ä»˜ â€” å®Œäº†</div>
              <div className="flex items-center gap-2"><span className="text-orange-500 animate-pulse">âŸ³</span> â‘¡ å¯©æŸ»ï¼ˆåç¤¾ãƒã‚§ãƒƒã‚¯ãƒ»ä¼æ¥­èª¿æŸ»ï¼‰â€” é€²è¡Œä¸­</div>
              <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> â‘¢ å¥‘ç´„æ¡ä»¶ã®æç¤ºãƒ»åˆæ„</div>
              <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> â‘£ å¥‘ç´„æ›¸ã®ç· çµ</div>
              <div className="flex items-center gap-2"><span className="text-slate-300">â—‹</span> â‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™ºè¡Œãƒ»ç¨¼åƒé–‹å§‹</div>
            </div>
          </div>
          <p className="text-xs text-slate-500 mb-1">å¯©æŸ»çµæœã¯é€šå¸¸1ã€œ3å–¶æ¥­æ—¥ä»¥å†…ã«ãƒ¡ãƒ¼ãƒ«ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚</p>
          <p className="text-xs text-slate-400 mb-4">â€» åŠ ç›Ÿåº—ã®ç´ã¥ã‘ã¯å¯©æŸ»å®Œäº†å¾Œã«é‹å–¶ãŒè¨­å®šã—ã¾ã™ã€‚</p>
          <button onClick={() => { setSubmitted(false); setStep(0); }} className="px-4 py-2 bg-slate-100 text-slate-600 rounded text-xs">ãƒ•ã‚©ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-full bg-gradient-to-b from-gray-50 to-white">
      <div className="max-w-2xl mx-auto py-6 px-4">
        {/* Header */}
        <div className="text-center mb-6">
          <div className="inline-flex items-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg mb-3">
            <span className="text-lg font-bold">â¬¡</span>
            <span className="text-sm font-bold">AI Payment</span>
          </div>
          <h1 className="text-base font-bold text-slate-800">ä»£ç†åº— æ–°è¦ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </h1>
          <p className="text-xs text-slate-500 mt-1">ä»£ç†åº—ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã—ã¦åŠ ç›Ÿåº—ã®ç´¹ä»‹ãƒ»å–æ¬¡ã‚’è¡Œãˆã¾ã™</p>
        </div>

        {/* Progress Steps */}
        <div className="flex items-center gap-1 mb-6 px-4">
          {steps.map((s, i) => (
            <div key={i} className="flex items-center gap-1 flex-1">
              <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0 cursor-pointer ${i < step ? "bg-orange-500 text-white" : i === step ? "bg-orange-600 text-white ring-2 ring-orange-300" : "bg-slate-200 text-slate-400"}`} onClick={() => i < step && setStep(i)}>
                {i < step ? "âœ“" : i + 1}
              </div>
              <span className={`text-xs whitespace-nowrap ${i === step ? "text-orange-700 font-bold" : "text-slate-400"}`}>{s}</span>
              {i < steps.length - 1 && <div className={`flex-1 h-px mx-1 ${i < step ? "bg-orange-400" : "bg-slate-200"}`} />}
            </div>
          ))}
        </div>

        {/* â•â•â• Step 1: ä¼æ¥­æƒ…å ± â•â•â• */}
        {step === 0 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 1: ä¼æ¥­æƒ…å ±</p>
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs text-slate-500 block mb-1">æ³•äººå *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«" /></div>
              <div><label className="text-xs text-slate-500 block mb-1">æ³•äººç•ªå·ï¼ˆ13æ¡ï¼‰</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 1234567890123" /></div>
            </div>
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs text-slate-500 block mb-1">ä»£è¡¨è€…å *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: å±±ç”° å¤ªéƒ" /></div>
              <div><label className="text-xs text-slate-500 block mb-1">è¨­ç«‹å¹´æœˆ *</label><input type="month" className="w-full text-xs border rounded px-3 py-2" /></div>
            </div>
            <div><label className="text-xs text-slate-500 block mb-1">æœ¬ç¤¾æ‰€åœ¨åœ° *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: æ±äº¬éƒ½æ¸¯åŒº..." /></div>
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs text-slate-500 block mb-1">æ‹…å½“è€…å *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: ç”°ä¸­ èŠ±å­" /></div>
              <div><label className="text-xs text-slate-500 block mb-1">æ‹…å½“è€…ãƒ¡ãƒ¼ãƒ« *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: tanaka@example.com" /></div>
            </div>
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs text-slate-500 block mb-1">æ‹…å½“è€…é›»è©±ç•ªå· *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 03-1234-5678" /></div>
              <div><label className="text-xs text-slate-500 block mb-1">Webã‚µã‚¤ãƒˆURL</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: https://example.jp" /></div>
            </div>
            <div className="flex justify-end pt-2 border-t">
              <button onClick={() => setStep(1)} className="px-6 py-2 bg-orange-600 text-white rounded text-xs font-semibold hover:bg-orange-700">æ¬¡ã¸: ä»£ç†åº—æƒ…å ± â†’</button>
            </div>
          </div>
        )}

        {/* â•â•â• Step 2: ä»£ç†åº—æƒ…å ± â•â•â• */}
        {step === 1 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 2: ä»£ç†åº—æƒ…å ±</p>
            <div>
              <label className="text-xs text-slate-500 block mb-2">ä»£ç†åº—ç¨®åˆ¥ *</label>
              <div className="grid grid-cols-2 gap-2">
                {[
                  { name: "ç´¹ä»‹å‹", desc: "åŠ ç›Ÿåº—å€™è£œã‚’ç´¹ä»‹ã—ã€å¥‘ç´„æˆç«‹å¾Œã«å ±é…¬ã‚’å—ã‘å–ã‚‹", checked: true },
                  { name: "å–æ¬¡å‹", desc: "åŠ ç›Ÿåº—ã¨ã®å¥‘ç´„äº¤æ¸‰ã‚‚å«ã‚ã¦ä»£è¡Œã™ã‚‹", checked: false },
                ].map((t, i) => (
                  <label key={i} className={`flex items-start gap-2 p-3 rounded-lg border-2 cursor-pointer text-xs ${t.checked ? "border-orange-400 bg-orange-50" : "border-slate-200 hover:border-orange-300"}`}>
                    <input type="radio" name="agentType" className="mt-0.5" defaultChecked={t.checked} />
                    <div>
                      <span className="font-semibold text-slate-700">{t.name}</span>
                      <p className="text-slate-400 mt-0.5">{t.desc}</p>
                    </div>
                  </label>
                ))}
              </div>
            </div>
            <div>
              <label className="text-xs text-slate-500 block mb-2">ç´¹ä»‹äºˆå®šã®æ¥­ç¨®ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
              <div className="flex flex-wrap gap-2">
                {["ECãƒ»ç‰©è²©", "é£²é£Ÿãƒ»ãƒ•ãƒ¼ãƒ‰", "æ—…è¡Œãƒ»ãƒ¬ã‚¸ãƒ£ãƒ¼", "ã‚µãƒ–ã‚¹ã‚¯ãƒ»SaaS", "æ•™è‚²ãƒ»ã‚¹ã‚¯ãƒ¼ãƒ«", "ç¾å®¹ãƒ»å¥åº·", "ä¸å‹•ç”£", "ãã®ä»–"].map((cat, i) => (
                  <label key={i} className="flex items-center gap-1 text-xs bg-slate-50 border rounded px-2 py-1 cursor-pointer hover:bg-orange-50">
                    <input type="checkbox" className="w-3 h-3" defaultChecked={i < 2} />{cat}
                  </label>
                ))}
              </div>
            </div>
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs text-slate-500 block mb-1">æœˆé–“ç´¹ä»‹äºˆå®šä»¶æ•°</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 5ä»¶" /></div>
              <div>
                <label className="text-xs text-slate-500 block mb-1">æ±ºæ¸ˆä»£è¡Œã®å–¶æ¥­çµŒé¨“</label>
                <select className="w-full text-xs border rounded px-3 py-2">
                  <option>ãªã—ï¼ˆåˆã‚ã¦ï¼‰</option><option>1å¹´æœªæº€</option><option>1ã€œ3å¹´</option><option>3å¹´ä»¥ä¸Š</option>
                </select>
              </div>
            </div>
            <div>
              <label className="text-xs text-slate-500 block mb-1">è‡ªå·±ç´¹ä»‹ãƒ»å®Ÿç¸¾ï¼ˆä»»æ„ï¼‰</label>
              <textarea className="w-full text-xs border rounded px-3 py-2 h-16" placeholder="éå»ã®å–¶æ¥­å®Ÿç¸¾ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã¤ã„ã¦ã”è¨˜å…¥ãã ã•ã„" />
            </div>
            <div className="bg-orange-50 rounded p-2 border border-orange-200">
              <p className="text-xs text-orange-700">ğŸ’¡ <span className="font-semibold">ã”æ³¨æ„:</span> ä»£ç†åº—ãƒ•ã‚£ãƒ¼ï¼ˆå ±é…¬ç‡ï¼‰ã¯æ±ºæ¸ˆç¨®åˆ¥ã”ã¨ã«é‹å–¶ãŒè¨­å®šã—ã¾ã™ã€‚å¥‘ç´„æ™‚ã«æ¡ä»¶ã‚’ã”æç¤ºã„ãŸã—ã¾ã™ã€‚</p>
            </div>
            <div className="flex justify-between pt-2 border-t">
              <button onClick={() => setStep(0)} className="px-6 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">â† æˆ»ã‚‹</button>
              <button onClick={() => setStep(2)} className="px-6 py-2 bg-orange-600 text-white rounded text-xs font-semibold hover:bg-orange-700">æ¬¡ã¸: å£åº§æƒ…å ± â†’</button>
            </div>
          </div>
        )}

        {/* â•â•â• Step 3: å£åº§æƒ…å ± â•â•â• */}
        {step === 2 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 3: å ±é…¬æŒ¯è¾¼å…ˆå£åº§</p>
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="text-xs text-slate-500 block mb-1">å£åº§ç¨®åˆ¥ *</label>
                <select className="w-full text-xs border rounded px-3 py-2"><option>æ™®é€šå£åº§</option><option>å½“åº§å£åº§</option></select>
              </div>
              <div><label className="text-xs text-slate-500 block mb-1">éŠ€è¡Œå *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: ä¸‰è±UFJéŠ€è¡Œ" /></div>
            </div>
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs text-slate-500 block mb-1">æ”¯åº—å *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: æ¸‹è°·æ”¯åº—" /></div>
              <div><label className="text-xs text-slate-500 block mb-1">å£åº§ç•ªå· *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: 1234567" /></div>
            </div>
            <div><label className="text-xs text-slate-500 block mb-1">å£åº§åç¾©ï¼ˆã‚«ãƒŠï¼‰ *</label><input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: ã‚«ï¼‰ã‚µãƒ³ãƒ—ãƒ«" /></div>
            <div className="bg-amber-50 rounded p-2 border border-amber-200">
              <p className="text-xs text-amber-700">âš  å£åº§åç¾©ã¯æ³•äººåç¾©ã¨ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å€‹äººå£åº§ã¯å—ä»˜ã§ãã¾ã›ã‚“ã€‚</p>
            </div>
            <div className="flex justify-between pt-2 border-t">
              <button onClick={() => setStep(1)} className="px-6 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">â† æˆ»ã‚‹</button>
              <button onClick={() => setStep(3)} className="px-6 py-2 bg-orange-600 text-white rounded text-xs font-semibold hover:bg-orange-700">æ¬¡ã¸: ç¢ºèª â†’</button>
            </div>
          </div>
        )}

        {/* â•â•â• Step 4: ç¢ºèªãƒ»ç”³è¾¼ â•â•â• */}
        {step === 3 && (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
            <p className="text-xs font-bold text-slate-700 border-b pb-2">Step 4: ç¢ºèªãƒ»ç”³è¾¼</p>
            <div className="space-y-2">
              <div className="bg-slate-50 rounded p-3">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ“‹ ä¼æ¥­æƒ…å ±</p>
                  <button onClick={() => setStep(0)} className="text-xs text-orange-600 hover:underline">ç·¨é›†</button>
                </div>
                <div className="grid grid-cols-2 gap-2 text-xs text-slate-600">
                  <div><span className="text-slate-400">æ³•äººå:</span> æ ªå¼ä¼šç¤¾ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</div>
                  <div><span className="text-slate-400">ä»£è¡¨è€…:</span> ç”°ä¸­å¤ªéƒ</div>
                  <div><span className="text-slate-400">è¨­ç«‹:</span> 2020å¹´4æœˆ</div>
                  <div><span className="text-slate-400">æ‰€åœ¨åœ°:</span> æ±äº¬éƒ½æ¸¯åŒº...</div>
                </div>
              </div>
              <div className="bg-slate-50 rounded p-3">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ¤ ä»£ç†åº—æƒ…å ±</p>
                  <button onClick={() => setStep(1)} className="text-xs text-orange-600 hover:underline">ç·¨é›†</button>
                </div>
                <div className="grid grid-cols-2 gap-2 text-xs text-slate-600">
                  <div><span className="text-slate-400">ç¨®åˆ¥:</span> ç´¹ä»‹å‹</div>
                  <div><span className="text-slate-400">ç´¹ä»‹äºˆå®š:</span> ECãƒ»ç‰©è²©, é£²é£Ÿãƒ»ãƒ•ãƒ¼ãƒ‰</div>
                  <div><span className="text-slate-400">æœˆé–“äºˆå®š:</span> 5ä»¶</div>
                  <div><span className="text-slate-400">çµŒé¨“:</span> 1ã€œ3å¹´</div>
                </div>
              </div>
              <div className="bg-slate-50 rounded p-3">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ¦ å£åº§æƒ…å ±</p>
                  <button onClick={() => setStep(2)} className="text-xs text-orange-600 hover:underline">ç·¨é›†</button>
                </div>
                <div className="grid grid-cols-2 gap-2 text-xs text-slate-600">
                  <div><span className="text-slate-400">éŠ€è¡Œ:</span> ä¸‰è±UFJéŠ€è¡Œ æ¸‹è°·æ”¯åº—</div>
                  <div><span className="text-slate-400">å£åº§:</span> æ™®é€š 1234567 ã‚«ï¼‰ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</div>
                </div>
              </div>
            </div>
            <div className="border rounded p-3">
              <label className="flex items-start gap-2 text-xs cursor-pointer">
                <input type="checkbox" className="w-3.5 h-3.5 mt-0.5" defaultChecked />
                <span className="text-slate-600">
                  <span className="text-orange-600 underline">ä»£ç†åº—å¥‘ç´„è¦ç´„</span>ãŠã‚ˆã³
                  <span className="text-orange-600 underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</span>ã«åŒæ„ã—ã¾ã™ã€‚
                  ä»£ç†åº—ãƒ•ã‚£ãƒ¼ã¯æ±ºæ¸ˆç¨®åˆ¥ã”ã¨ã«é‹å–¶ãŒè¨­å®šã—ã€æ±ºæ¸ˆæ‰‹æ•°æ–™ã‹ã‚‰å·®ã—å¼•ã‹ã‚Œã‚‹ã“ã¨ã‚’ç†è§£ã—ã¦ã„ã¾ã™ã€‚
                </span>
              </label>
            </div>
            <div className="flex justify-between pt-2 border-t">
              <button onClick={() => setStep(2)} className="px-6 py-2 bg-slate-100 text-slate-600 rounded text-xs font-semibold hover:bg-slate-200">â† æˆ»ã‚‹</button>
              <button onClick={() => setSubmitted(true)} className="px-8 py-2.5 bg-orange-600 text-white rounded text-xs font-bold hover:bg-orange-700 shadow-sm">âœ“ ã“ã®å†…å®¹ã§ç”³è¾¼ã‚€</button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

// â”€â”€â”€ M10: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° â”€â”€â”€
const MasterRouting = () => {
  const toast = useToast();
  const [selectedMerchant, setSelectedMerchant] = useState("M-001");
  const [merchantSearch, setMerchantSearch] = useState("");
  const [showMerchantDropdown, setShowMerchantDropdown] = useState(false);
  const [showAddRouteRule, setShowAddRouteRule] = useState(false);
  const [routeTab, setRouteTab] = useState("config");
  const [actionConfirm, setActionConfirm] = useState(null);
  const currentMerchant = merchantData.find(m => m.id === selectedMerchant);
  const filteredMerchants = merchantData.filter(m => m.status === "æœ‰åŠ¹").filter(m =>
    merchantSearch === "" || m.name.toLowerCase().includes(merchantSearch.toLowerCase()) || m.id.toLowerCase().includes(merchantSearch.toLowerCase())
  );
  const approvedProcs = currentMerchant?.processors.filter(p => p.status === "approved") || [];

  return (
    <div className="p-5 space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-sm font-bold text-slate-800">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š</h2>
      </div>

      <div className="flex gap-1 border-b">
        {[{ id: "config", label: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š" }, { id: "bulk", label: "ä¸€æ‹¬å¤‰æ›´" }].map(t => (
          <button key={t.id} onClick={() => setRouteTab(t.id)} className={`text-xs px-3 py-2 border-b-2 ${routeTab === t.id ? "border-blue-500 text-blue-600 font-semibold" : "border-transparent text-slate-400"}`}>{t.label}</button>
        ))}
      </div>

      {/* ä¸€æ‹¬å¤‰æ›´ã‚¿ãƒ– */}
      {routeTab === "bulk" && (
        <div className="space-y-3">
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4">
            <p className="text-xs font-bold text-slate-600 mb-3">æ±ºæ¸ˆãƒ©ã‚¤ãƒ³ä¸€æ‹¬å¤‰æ›´</p>
            <div className="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label className="text-xs text-slate-400">å¤‰æ›´ç¨®åˆ¥</label>
                <div className="flex gap-2 mt-1">
                  <label className="flex items-center gap-1 text-xs"><input type="radio" name="lineType" defaultChecked className="w-3 h-3" />é€šå¸¸æ±ºæ¸ˆãƒ©ã‚¤ãƒ³</label>
                  <label className="flex items-center gap-1 text-xs"><input type="radio" name="lineType" className="w-3 h-3" />ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°æ±ºæ¸ˆãƒ©ã‚¤ãƒ³</label>
                </div>
              </div>
              <div>
                <label className="text-xs text-slate-400">å¯¾è±¡ã‚µã‚¤ãƒˆIDï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
                <textarea className="w-full text-xs border rounded px-2 py-1.5 h-16 font-mono" placeholder="SITE-001, SITE-002, SITE-003..." />
              </div>
            </div>
            <p className="text-xs font-bold text-slate-600 mb-2">ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥ æ¥ç¶šå…ˆå¤‰æ›´</p>
            <table className="w-full text-xs mb-3">
              <thead><tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold w-20">ãƒ–ãƒ©ãƒ³ãƒ‰</th>
                <th className="text-left p-2 text-slate-500 font-semibold">å¤‰æ›´å‰ï¼ˆç¾åœ¨ï¼‰</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-8">â†’</th>
                <th className="text-left p-2 text-slate-500 font-semibold">å¤‰æ›´å¾Œ</th>
              </tr></thead>
              <tbody>
                {["VISA", "Mastercard", "JCB", "AMEX", "Diners"].map((b, i) => (
                  <tr key={i} className="border-b">
                    <td className="p-2 font-semibold text-slate-700">{b}</td>
                    <td className="p-2"><select className="w-full text-xs border rounded px-2 py-1.5"><option>Univa Pay cast</option><option>æ¥½å¤©éŠ€è¡Œ</option><option>Worldpay</option><option>TCMS</option><option>Simpletransact</option><option>å¤‰æ›´ãªã—</option></select></td>
                    <td className="p-2 text-center text-slate-400">â†’</td>
                    <td className="p-2"><select className="w-full text-xs border rounded px-2 py-1.5"><option>å¤‰æ›´ãªã—</option><option>Univa Pay cast</option><option>æ¥½å¤©éŠ€è¡Œ</option><option>Worldpay</option><option>TCMS</option><option>Simpletransact</option></select></td>
                  </tr>
                ))}
              </tbody>
            </table>
            <div className="bg-amber-50 rounded border border-amber-200 p-2 text-xs text-amber-700 mb-3">
              âš ï¸ <strong>å½±éŸ¿ç¯„å›²:</strong> å¯¾è±¡ã‚µã‚¤ãƒˆ 3ä»¶ / å½±éŸ¿å–å¼• ç´„ 1,200ä»¶/æ—¥ã€‚å¤‰æ›´ã¯å³æ™‚åæ˜ ã•ã‚Œã¾ã™ã€‚
            </div>
            <div className="flex gap-2">
              <button onClick={() => setActionConfirm({ title: "ä¸€æ‹¬å¤‰æ›´å®Ÿè¡Œ", description: "é¸æŠã—ãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¤‰æ›´ã‚’ä¸€æ‹¬å®Ÿè¡Œã—ã¾ã™ã€‚", warning: "å¯¾è±¡ã‚µã‚¤ãƒˆ 3ä»¶ / å½±éŸ¿å–å¼• ç´„ 1,200ä»¶/æ—¥ã€‚å¤‰æ›´ã¯å³æ™‚åæ˜ ã•ã‚Œã¾ã™ã€‚", type: "warning", onConfirm: () => toast("ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸€æ‹¬å¤‰æ›´ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ", "success") })} className="text-xs bg-blue-600 text-white px-4 py-2 rounded font-semibold">ä¸€æ‹¬å¤‰æ›´ã‚’å®Ÿè¡Œ</button>
              <button onClick={() => toast("ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ", "info")} className="text-xs bg-slate-100 text-slate-600 px-4 py-2 rounded border">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
            </div>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold text-slate-600 mb-2">å¤‰æ›´å±¥æ­´</p>
            <table className="w-full text-xs">
              <thead><tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold w-28">æ—¥æ™‚</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-20">ç¨®åˆ¥</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-16">å¯¾è±¡æ•°</th>
                <th className="text-left p-2 text-slate-500 font-semibold">å¤‰æ›´å†…å®¹</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-20">å®Ÿè¡Œè€…</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-16">æ“ä½œ</th>
              </tr></thead>
              <tbody>
                {[
                  { date: "02/15 14:00", type: "é€šå¸¸", count: "5ä»¶", detail: "VISA: Worldpay â†’ Univa Pay cast", user: "ç”°ä¸­å¤ªéƒ" },
                  { date: "02/10 11:00", type: "ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°", count: "3ä»¶", detail: "JCB: ONTHELINE â†’ TCMS", user: "ä½è—¤èŠ±å­" },
                  { date: "01/28 09:30", type: "é€šå¸¸", count: "12ä»¶", detail: "å…¨ãƒ–ãƒ©ãƒ³ãƒ‰: Asiabill â†’ Univa Pay castï¼ˆéšœå®³å¯¾å¿œï¼‰", user: "ç”°ä¸­å¤ªéƒ" },
                ].map((h, i) => (
                  <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
                    <td className="p-2 text-slate-400 font-mono">{h.date}</td>
                    <td className="p-2"><Badge text={h.type} color={h.type === "ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°" ? "purple" : "blue"} /></td>
                    <td className="p-2 text-slate-600">{h.count}</td>
                    <td className="p-2 text-slate-700">{h.detail}</td>
                    <td className="p-2 text-slate-600">{h.user}</td>
                    <td className="p-2 text-center"><button onClick={() => setActionConfirm({ title: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¤‰æ›´ã‚’æˆ»ã™", description: `${h.date} ã®å¤‰æ›´ã€Œ${h.detail}ã€ã‚’å…ƒã«æˆ»ã—ã¾ã™ã€‚`, type: "warning", onConfirm: () => toast("ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¤‰æ›´ã‚’å…ƒã«æˆ»ã—ã¾ã—ãŸ", "success") })} className="text-amber-600 hover:underline text-xs">æˆ»ã™</button></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã‚¿ãƒ– */}
      {routeTab === "config" && (<>
      <div className="flex justify-between items-center">
        <div />
        <div className="flex gap-2 items-center">
          <div className="relative">
            <div className="flex items-center border rounded bg-white">
              <span className="text-xs text-slate-400 pl-2">ğŸ”</span>
              <input
                className="text-xs px-2 py-1 w-64 outline-none"
                placeholder="åŠ ç›Ÿåº—ã‚’æ¤œç´¢ï¼ˆIDãƒ»åå‰ï¼‰"
                value={merchantSearch}
                onChange={e => { setMerchantSearch(e.target.value); setShowMerchantDropdown(true); }}
                onFocus={() => setShowMerchantDropdown(true)}
              />
              {selectedMerchant && (
                <button className="text-xs text-slate-400 pr-2 hover:text-rose-400" onClick={() => { setSelectedMerchant(""); setMerchantSearch(""); }}>âœ•</button>
              )}
            </div>
            {showMerchantDropdown && (
              <div className="absolute right-0 top-full mt-1 w-80 bg-white border rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto">
                <div className="px-3 py-1.5 text-xs text-slate-400 border-b bg-slate-50">
                  {filteredMerchants.length}ä»¶ / {merchantData.filter(m => m.status === "æœ‰åŠ¹").length}ç¤¾
                </div>
                <button
                  className={`w-full text-left px-3 py-2 text-xs hover:bg-blue-50 border-b ${!selectedMerchant ? "bg-blue-50 font-bold" : ""}`}
                  onClick={() => { setSelectedMerchant(""); setMerchantSearch(""); setShowMerchantDropdown(false); }}
                >--- ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š ---</button>
                {filteredMerchants.map(m => (
                  <button
                    key={m.id}
                    className={`w-full text-left px-3 py-2 text-xs hover:bg-blue-50 border-b flex items-center justify-between ${selectedMerchant === m.id ? "bg-blue-50 font-bold" : ""}`}
                    onClick={() => { setSelectedMerchant(m.id); setMerchantSearch(m.name); setShowMerchantDropdown(false); }}
                  >
                    <span><span className="font-mono text-slate-400">{m.id}</span> {m.name}</span>
                    <span className="text-slate-400">{m.processors.filter(p=>p.status==="approved").length}æ¥ç¶šå…ˆ</span>
                  </button>
                ))}
                {filteredMerchants.length === 0 && (
                  <div className="px-3 py-4 text-xs text-slate-400 text-center">è©²å½“ã™ã‚‹åŠ ç›Ÿåº—ãŒã‚ã‚Šã¾ã›ã‚“</div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Core Concept */}
      <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200 p-3">
        <p className="text-xs font-bold text-blue-700 mb-1">ğŸ¤– AIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ä»•çµ„ã¿</p>
        <p className="text-xs text-slate-600">
          æ±ºæ¸ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡ â†’ <span className="font-semibold text-blue-700">åŠ ç›Ÿåº—ã®æ‰¿èªæ¸ˆã¿æ¥ç¶šå…ˆã‚’å–å¾—</span> â†’ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ â†’ AIæœ€é©åŒ– â†’ æ¥ç¶šå…ˆæ±ºå®šã€‚
          åŠ ç›Ÿåº—ã”ã¨ã«<span className="font-semibold text-rose-600">å¯©æŸ»é€šéæ¸ˆã¿ã®æ¥ç¶šå…ˆã‹ã‚‰ã®ã¿</span>ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚æ¥ç¶šå…ˆãŒ1ã¤ã®å ´åˆã€ãã®æ¥ç¶šå…ˆã«å›ºå®šã•ã‚Œã¾ã™ã€‚
        </p>
      </div>

      {/* Selected Merchant's Available Processors */}
      {currentMerchant && (
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
          <div className="flex items-center justify-between mb-2">
            <p className="text-xs font-bold text-slate-700">ğŸ”Œ {currentMerchant.name} â€” åˆ©ç”¨å¯èƒ½ãªæ¥ç¶šå…ˆ</p>
            <div className="flex gap-1">
              <Badge text={`æ‰¿èªæ¸ˆ: ${approvedProcs.length}`} color="green" />
              <Badge text={`å¯©æŸ»ä¸­: ${currentMerchant.processors.filter(p=>p.status==="reviewing").length}`} color="blue" />
              <Badge text={`æº–å‚™ä¸­: ${currentMerchant.processors.filter(p=>p.status==="pending").length}`} color="gray" />
            </div>
          </div>
          <div className="flex gap-2">
            {currentMerchant.processors.map((proc, i) => {
              const st = PROC_STATUS[proc.status];
              return (
                <div key={i} className={`flex-1 rounded border p-2 text-xs ${
                  proc.status === "approved" ? "bg-emerald-50 border-emerald-200" :
                  proc.status === "reviewing" ? "bg-blue-50 border-blue-200 opacity-60" :
                  proc.status === "suspended" ? "bg-rose-50 border-rose-200 opacity-40" :
                  "bg-slate-50 border-slate-200 opacity-40"
                }`}>
                  <div className="font-semibold text-slate-700">{proc.name}</div>
                  <div className="text-slate-400">{proc.brands}</div>
                  <Badge text={st.label} color={st.color} />
                  {proc.status === "approved" && <div className="mt-1 text-slate-500">{proc.txnCount.toLocaleString()}ä»¶å‡¦ç†</div>}
                </div>
              );
            })}
          </div>
          {approvedProcs.length <= 1 && (
            <div className="bg-amber-50 rounded border border-amber-200 p-2 mt-2">
              <p className="text-xs text-amber-700">âš ï¸ <span className="font-semibold">æ¥ç¶šå…ˆãŒ{approvedProcs.length}ã¤ã®ã¿:</span> ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ»ã‚³ã‚¹ãƒˆæœ€é©åŒ–ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚æ¥ç¶šå…ˆã‚’è¿½åŠ ã™ã‚‹ã¨ã€éšœå®³æ™‚ã®è‡ªå‹•åˆ‡æ›¿ã‚„AIæœ€é©ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚</p>
            </div>
          )}
        </div>
      )}

      {/* Routing Rules */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex items-center justify-between mb-2">
          <p className="text-xs font-bold text-slate-700">ğŸ“‹ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ï¼ˆå„ªå…ˆé †ä½é †ï¼‰</p>
          <button onClick={() => setShowAddRouteRule(true)} className="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">+ ãƒ«ãƒ¼ãƒ«è¿½åŠ </button>
        </div>
        <div className="space-y-2">
          {[
            { priority: 1, name: "æ¥ç¶šå…ˆåˆ¶ç´„ãƒ•ã‚£ãƒ«ã‚¿", type: "ã‚·ã‚¹ãƒ†ãƒ ", desc: "åŠ ç›Ÿåº—ã®æ‰¿èªæ¸ˆã¿æ¥ç¶šå…ˆã®ã¿ã«çµã‚Šè¾¼ã¿", scope: "å…¨åŠ ç›Ÿåº—ï¼ˆè‡ªå‹•ï¼‰", enabled: true, locked: true },
            { priority: 2, name: "ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°", type: "ãƒ«ãƒ¼ãƒ«", desc: "ã‚«ãƒ¼ãƒ‰ãƒ–ãƒ©ãƒ³ãƒ‰ã«å¿œã˜ãŸæ¥ç¶šå…ˆãƒãƒƒãƒ”ãƒ³ã‚°", scope: "ã‚°ãƒ­ãƒ¼ãƒãƒ«", enabled: true, locked: false },
            { priority: 3, name: "åŠ ç›Ÿåº—å›ºå®šãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°", type: "ãƒ«ãƒ¼ãƒ«", desc: "ç‰¹å®šåŠ ç›Ÿåº—ã‚’ç‰¹å®šæ¥ç¶šå…ˆã«å›ºå®š", scope: "åŠ ç›Ÿåº—æŒ‡å®š", enabled: true, locked: false },
            { priority: 4, name: "é‡‘é¡é–¾å€¤ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°", type: "ãƒ«ãƒ¼ãƒ«", desc: "é«˜é¡æ±ºæ¸ˆï¼ˆÂ¥100,000ä»¥ä¸Šï¼‰ã¯ç›´æ¥æ¥ç¶šå…ˆã¸", scope: "ã‚°ãƒ­ãƒ¼ãƒãƒ«", enabled: true, locked: false },
            { priority: 5, name: "ã‚³ã‚¹ãƒˆæœ€é©åŒ–ï¼ˆAIï¼‰", type: "AI", desc: "æ‰‹æ•°æ–™ç‡ã‚’è€ƒæ…®ã—AIãŒæœ€å®‰æ¥ç¶šå…ˆã‚’é¸æŠ", scope: "æ¥ç¶šå…ˆ2+ã®åŠ ç›Ÿåº—", enabled: true, locked: false },
            { priority: 6, name: "æˆåŠŸç‡æœ€é©åŒ–ï¼ˆAIï¼‰", type: "AI", desc: "æ™‚é–“å¸¯ãƒ»ã‚«ãƒ¼ãƒ‰ç¨®åˆ¥ã®æˆåŠŸç‡ã‚’AIãŒåˆ†æã—æœ€é©åŒ–", scope: "æ¥ç¶šå…ˆ2+ã®åŠ ç›Ÿåº—", enabled: true, locked: false },
            { priority: 7, name: "é‡ã¿ä»˜ã‘åˆ†æ•£", type: "ãƒ«ãƒ¼ãƒ«", desc: "ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æ¥ç¶šå…ˆé–“ã§æ¯”ç‡åˆ†æ•£ï¼ˆA:70%, B:30%ç­‰ï¼‰", scope: "åŠ ç›Ÿåº—æŒ‡å®š", enabled: false, locked: false },
            { priority: 8, name: "ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼", type: "ã‚·ã‚¹ãƒ†ãƒ ", desc: "ãƒ—ãƒ©ã‚¤ãƒãƒªéšœå®³æ™‚ã«ã‚»ã‚«ãƒ³ãƒ€ãƒªã¸è‡ªå‹•åˆ‡æ›¿", scope: "æ¥ç¶šå…ˆ2+ã®åŠ ç›Ÿåº—", enabled: true, locked: false },
            { priority: 9, name: "ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰ãƒªãƒˆãƒ©ã‚¤", type: "ã‚·ã‚¹ãƒ†ãƒ ", desc: "æ¥ç¶šå…ˆAã§å¤±æ•— â†’ B â†’ C ã¨é †æ¬¡å†è©¦è¡Œ", scope: "æ¥ç¶šå…ˆ2+ã®åŠ ç›Ÿåº—", enabled: true, locked: false },
          ].map((rule, i) => (
            <div key={i} className={`flex items-center gap-3 p-2 rounded border text-xs ${rule.locked ? "bg-slate-50 border-slate-300" : ""}`}>
              <span className="w-6 h-6 flex items-center justify-center bg-slate-100 rounded text-slate-500 font-bold">{rule.priority}</span>
              <div className={`w-8 h-5 rounded-full relative cursor-pointer ${rule.enabled ? "bg-emerald-500" : "bg-slate-300"} ${rule.locked ? "opacity-60" : ""}`}>
                <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all ${rule.enabled ? "right-0.5" : "left-0.5"}`} />
              </div>
              <div className="flex-1">
                <div className="flex items-center gap-2">
                  <span className="font-semibold text-slate-700">{rule.name}</span>
                  <Badge text={rule.type} color={rule.type === "AI" ? "purple" : rule.type === "ã‚·ã‚¹ãƒ†ãƒ " ? "blue" : "gray"} />
                  {rule.locked && <span className="text-slate-400">ğŸ”’</span>}
                </div>
                <p className="text-slate-400 mt-0.5">{rule.desc}</p>
              </div>
              <div className="w-40 text-slate-400">{rule.scope}</div>
              {!rule.locked && <button className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">ç·¨é›†</button>}
            </div>
          ))}
        </div>
      </div>

      {/* Routing Flow Diagram */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-700 mb-2">ğŸ”€ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åˆ¤å®šãƒ•ãƒ­ãƒ¼</p>
        <div className="bg-slate-50 rounded p-3">
          <div className="flex items-center justify-center gap-1 text-xs flex-wrap">
            {[
              { label: "æ±ºæ¸ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ", color: "bg-slate-200 text-slate-700" },
              { label: "â†’" },
              { label: "â‘ åŠ ç›Ÿåº—ã®æ‰¿èªæ¸ˆã¿\næ¥ç¶šå…ˆã‚’å–å¾—", color: "bg-rose-100 text-rose-700 border border-rose-300" },
              { label: "â†’" },
              { label: "â‘¡ãƒ–ãƒ©ãƒ³ãƒ‰\nãƒãƒƒãƒ”ãƒ³ã‚°", color: "bg-blue-100 text-blue-700" },
              { label: "â†’" },
              { label: "â‘¢å›ºå®š/é–¾å€¤\nãƒ«ãƒ¼ãƒ«é©ç”¨", color: "bg-blue-100 text-blue-700" },
              { label: "â†’" },
              { label: "â‘£AIæœ€é©åŒ–\n(ã‚³ã‚¹ãƒˆ/æˆåŠŸç‡)", color: "bg-purple-100 text-purple-700" },
              { label: "â†’" },
              { label: "â‘¤æ¥ç¶šå…ˆæ±ºå®š", color: "bg-emerald-100 text-emerald-700" },
            ].map((step, i) => (
              step.color ? (
                <div key={i} className={`${step.color} rounded px-2 py-1.5 text-center whitespace-pre-line font-semibold`}>{step.label}</div>
              ) : (
                <span key={i} className="text-slate-300 font-bold">â†’</span>
              )
            ))}
          </div>
          <div className="text-center mt-2">
            <span className="text-xs text-slate-400">æ¥ç¶šå…ˆãŒ1ã¤ã®ã¿ã®åŠ ç›Ÿåº— â†’ â‘¡ã€œâ‘£ã‚’ã‚¹ã‚­ãƒƒãƒ— â†’ ãã®ã¾ã¾â‘¤ã§ç¢ºå®š</span>
          </div>
        </div>
      </div>

      {/* Routing Performance */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“Š ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®Ÿç¸¾ï¼ˆç›´è¿‘7æ—¥ï¼‰</p>
        <div className="flex gap-3 mb-3">
          <KPICard label="ç·æ±ºæ¸ˆä»¶æ•°" value="8,729ä»¶" sub="å‰é€±æ¯”" trend={6} />
          <KPICard label="AIæœ€é©åŒ–é©ç”¨ç‡" value="42.3%" sub="æ¥ç¶šå…ˆ2+ã®åŠ ç›Ÿåº—" color="purple" />
          <KPICard label="ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ç™ºå‹•" value="12ä»¶" sub="æˆåŠŸç‡: 100%" color="green" />
          <KPICard label="æ¨å®šã‚³ã‚¹ãƒˆå‰Šæ¸›" value="Â¥38,200" sub="AIæœ€é©åŒ–ã«ã‚ˆã‚‹" color="green" />
        </div>
        <div className="grid grid-cols-2 gap-3">
          <div>
            <p className="text-xs text-slate-500 mb-1">æ¥ç¶šå…ˆåˆ¥ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ†å¸ƒ</p>
            <div className="space-y-1.5">
              {[
                { name: "Univa Pay cast", pct: 28, count: "2,444ä»¶", color: "bg-blue-500" },
                { name: "æ¥½å¤©éŠ€è¡Œ", pct: 22, count: "1,920ä»¶", color: "bg-emerald-500" },
                { name: "TCMS", pct: 15, count: "1,309ä»¶", color: "bg-purple-500" },
                { name: "Worldpay", pct: 12, count: "1,047ä»¶", color: "bg-cyan-500" },
                { name: "ãƒšã‚¤ãƒ‡ã‚£", pct: 8, count: "698ä»¶", color: "bg-orange-500" },
                { name: "ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥", pct: 6, count: "524ä»¶", color: "bg-amber-500" },
                { name: "ãã®ä»–", pct: 9, count: "787ä»¶", color: "bg-slate-400" },
              ].map((p, i) => (
                <div key={i} className="flex items-center gap-2 text-xs">
                  <span className="w-28 text-slate-600">{p.name}</span>
                  <div className="flex-1 h-3 bg-slate-100 rounded-full overflow-hidden">
                    <div className={`h-full ${p.color} rounded-full`} style={{ width: `${p.pct}%` }} />
                  </div>
                  <span className="w-16 text-right text-slate-500">{p.pct}%</span>
                  <span className="w-20 text-right text-slate-400">{p.count}</span>
                </div>
              ))}
            </div>
          </div>
          <div>
            <p className="text-xs text-slate-500 mb-1">åŠ ç›Ÿåº—åˆ¥ æ¥ç¶šå…ˆæ•°ã®åˆ†å¸ƒ</p>
            <div className="space-y-2">
              {[
                { label: "1æ¥ç¶šå…ˆã®ã¿", count: 3, merchants: "M-004, M-005, M-008", note: "ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ä¸å¯", color: "yellow" },
                { label: "2æ¥ç¶šå…ˆ", count: 2, merchants: "M-002, M-007", note: "åŸºæœ¬ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼å¯", color: "blue" },
                { label: "3æ¥ç¶šå…ˆä»¥ä¸Š", count: 2, merchants: "M-001, M-006", note: "AIæœ€é©åŒ–ãƒ•ãƒ«ç¨¼åƒ", color: "green" },
                { label: "å¯©æŸ»ä¸­ï¼ˆ0æ¥ç¶šå…ˆï¼‰", count: 1, merchants: "M-003", note: "æ±ºæ¸ˆæœªé–‹å§‹", color: "gray" },
              ].map((g, i) => (
                <div key={i} className="flex items-center gap-2 text-xs">
                  <Badge text={g.label} color={g.color} />
                  <span className="font-semibold text-slate-700">{g.count}ç¤¾</span>
                  <span className="text-slate-400">{g.note}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      {/* Cascade / Failover Config */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-700 mb-2">âš¡ ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ / ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰è¨­å®š</p>
        <div className="space-y-2">
          {[
            { primary: "Univa Pay cast", pFee: "V3.55%", secondary: "Worldpay", sFee: "V3.42%", tertiary: "â€”", trigger: "HTTP 5xx / ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ 10ç§’", retries: 2, status: "ç¨¼åƒä¸­", sColor: "green", costDiff: "+0.13%" },
            { primary: "æ¥½å¤©éŠ€è¡Œ", pFee: "V2.65%", secondary: "Simpletransact", sFee: "V4.45%", tertiary: "â€”", trigger: "HTTP 5xx / ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ 10ç§’", retries: 2, status: "ç¨¼åƒä¸­", sColor: "green", costDiff: "-1.80%" },
            { primary: "TCMS", pFee: "J3.60%", secondary: "ONTHELINE", sFee: "J3.50%", tertiary: "â€”", trigger: "HTTP 5xx / ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ 10ç§’", retries: 1, status: "ç¨¼åƒä¸­", sColor: "green", costDiff: "+0.10%" },
            { primary: "Asiabill", pFee: "A2.95%", secondary: "â€”", sFee: "-", tertiary: "â€”", trigger: "â€”", retries: 0, status: "å˜ç‹¬ï¼ˆåˆ‡æ›¿ä¸å¯ï¼‰", sColor: "gray", costDiff: "-" },
          ].map((f, i) => (
            <div key={i} className="flex items-center gap-2 p-2 rounded border text-xs">
              <div className="flex items-center gap-1">
                <span className="bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-semibold">{f.primary}</span>
                <span className="text-blue-500 text-xs">{f.pFee}</span>
                {f.secondary !== "â€”" && <><span className="text-slate-300">â†’</span><span className="bg-slate-100 text-slate-600 px-2 py-0.5 rounded">{f.secondary}</span><span className="text-slate-400 text-xs">{f.sFee}</span></>}
                {f.tertiary !== "â€”" && <><span className="text-slate-300">â†’</span><span className="bg-slate-100 text-slate-500 px-2 py-0.5 rounded">{f.tertiary}</span></>}
              </div>
              <span className="text-slate-400 flex-1 truncate">{f.trigger}</span>
              {f.costDiff !== "-" && <span className={`px-1.5 py-0.5 rounded text-xs font-semibold ${parseFloat(f.costDiff) > 0 ? "bg-rose-50 text-rose-600" : "bg-emerald-50 text-emerald-600"}`}>FBæ™‚ {f.costDiff}</span>}
              <Badge text={f.status} color={f.sColor} />
              <button onClick={() => toast(`${f.name} ã®ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹ãã¾ã—ãŸ`, "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded">ç·¨é›†</button>
            </div>
          ))}
        </div>
      </div>

      {/* Simulation */}
      <div className="bg-amber-50 rounded-lg border border-amber-300 p-3">
        <div className="flex items-center justify-between mb-2">
          <p className="text-xs font-bold text-amber-800">ğŸ§ª ãƒ«ãƒ¼ãƒ«å¤‰æ›´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</p>
          <button onClick={() => toast("ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼ˆéå»30æ—¥ãƒ‡ãƒ¼ã‚¿ï¼‰", "info")} className="text-xs bg-amber-600 text-white px-3 py-1 rounded font-semibold">éå»30æ—¥ãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¡Œ</button>
        </div>
        <p className="text-xs text-amber-700 mb-2">ãƒ«ãƒ¼ãƒ«å¤‰æ›´å‰ã«ã€éå»å–å¼•ãƒ‡ãƒ¼ã‚¿ã§ã®å½±éŸ¿ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
        <div className="bg-white rounded-lg border border-slate-200 p-2.5 grid grid-cols-4 gap-2 text-xs">
          <div className="text-center"><span className="text-slate-400">æ¥ç¶šå…ˆæŒ¯ã‚Šåˆ†ã‘å¤‰æ›´</span><p className="font-bold text-blue-700">Univa Pay cast +12% / æ¥½å¤©éŠ€è¡Œ -12%</p></div>
          <div className="text-center"><span className="text-slate-400">ã‚³ã‚¹ãƒˆå·®åˆ†</span><p className="font-bold text-emerald-700">-Â¥23,400/æœˆ</p></div>
          <div className="text-center"><span className="text-slate-400">æˆåŠŸç‡å¤‰åŒ–</span><p className="font-bold text-emerald-700">98.2% â†’ 98.5%</p></div>
          <div className="text-center"><span className="text-slate-400">å½±éŸ¿åŠ ç›Ÿåº—</span><p className="font-bold text-slate-700">5ç¤¾</p></div>
        </div>
      </div>

      {/* Maintenance Mode */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex justify-between items-center mb-2">
          <p className="text-xs font-bold text-slate-700">ğŸ”§ æ¥ç¶šå…ˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰</p>
          <span className="text-xs text-slate-400">ãƒ¡ãƒ³ãƒ†ä¸­ã®æ¥ç¶šå…ˆã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¯¾è±¡ã‹ã‚‰è‡ªå‹•é™¤å¤–ã•ã‚Œã¾ã™</span>
        </div>
        <div className="space-y-1.5">
          {[
            { name: "Univa Pay cast", status: false },
            { name: "æ¥½å¤©éŠ€è¡Œ", status: false },
            { name: "TCMS", status: false },
            { name: "Worldpay", status: false },
            { name: "Simpletransact", status: false },
            { name: "ONTHELINE", status: false },
            { name: "Asiabill", status: true },
          ].map((p, i) => (
            <div key={i} className={`flex items-center gap-3 p-2 rounded border text-xs ${p.status ? "bg-blue-50 border-blue-200" : ""}`}>
              <div className={`w-8 h-5 rounded-full relative cursor-pointer ${p.status ? "bg-blue-500" : "bg-slate-300"}`}>
                <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all ${p.status ? "right-0.5" : "left-0.5"}`} />
              </div>
              <span className="font-semibold text-slate-700">{p.name}</span>
              {p.status && <Badge text="ğŸ”µ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­" color="blue" />}
              {!p.status && <Badge text="ç¨¼åƒä¸­" color="green" />}
            </div>
          ))}
        </div>
      </div>

      {/* Routing Log */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3 overflow-x-auto">
        <div className="flex justify-between items-center mb-2">
          <p className="text-xs font-bold text-slate-700">ğŸ“Š ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ­ã‚°ï¼ˆç›´è¿‘ï¼‰</p>
          <button className="text-xs text-blue-600 hover:underline">å…¨ãƒ­ã‚°æ¤œç´¢ â†’</button>
        </div>
        <TableHeader cols={[{ label: "æ—¥æ™‚", w: "w-28" }, { label: "å–å¼•ID", w: "w-36" }, { label: "åŠ ç›Ÿåº—", w: "w-32" }, { label: "ãƒ–ãƒ©ãƒ³ãƒ‰", w: "w-16" }, { label: "AIåˆ¤å®š", w: "flex-1" }, { label: "é¸æŠ", w: "w-24" }, { label: "çµæœ", w: "w-16" }, { label: "F/O", w: "w-12" }]}>
        {[
          { time: "14:52:31", txn: "TXN-14523", merchant: "ABCãƒãƒ¼ãƒˆ", brand: "VISA", ai: "Univa(92) > Worldpay(78) > TCMS(65)", selected: "Univa Pay cast", result: "æˆåŠŸ", fo: "â€”" },
          { time: "14:51:40", txn: "TXN-14520", merchant: "ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", brand: "VISA", ai: "Univa(88)", selected: "Univa Pay cast", result: "å¤±æ•—", fo: "â†’Worldpay" },
          { time: "14:51:22", txn: "TXN-14519", merchant: "ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ©ã‚¹", brand: "MC", ai: "æ¥½å¤©(85) > Simple(72)", selected: "æ¥½å¤©éŠ€è¡Œ", result: "æˆåŠŸ", fo: "â€”" },
          { time: "14:50:58", txn: "TXN-14518", merchant: "ABCãƒãƒ¼ãƒˆ", brand: "WEB", ai: "ãƒšã‚¤ãƒ‡ã‚£(å›ºå®š)", selected: "ãƒšã‚¤ãƒ‡ã‚£", result: "æˆåŠŸ", fo: "â€”" },
        ].map((l, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-400 font-mono">{l.time}</td>
            <td className="px-4 py-2 whitespace-nowrap w-36 font-mono text-slate-500">{l.txn}</td>
            <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-700">{l.merchant}</td>
            <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={l.brand} color="blue" /></td>
            <td className="px-4 py-2 whitespace-nowrap text-slate-500 font-mono">{l.ai}</td>
            <td className="px-4 py-2 whitespace-nowrap w-24 font-semibold text-slate-700">{l.selected}</td>
            <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={l.result} color={l.result === "æˆåŠŸ" ? "green" : "red"} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-12 text-center">{l.fo !== "â€”" ? <span className="text-amber-600 font-semibold">{l.fo}</span> : "â€”"}</td>
          </tr>
        ))}
        </TableHeader>
      </div>

      {/* â”€â”€ Modal: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«è¿½åŠ  â”€â”€ */}
      {showAddRouteRule && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowAddRouteRule(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[520px] max-h-[85vh] overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«è¿½åŠ </h3>
              <button onClick={() => setShowAddRouteRule(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div><label className="text-xs font-semibold text-slate-600">ãƒ«ãƒ¼ãƒ«å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: é«˜é¡å–å¼•ã¯Univa Pay castå„ªå…ˆ" /></div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">æ¡ä»¶ã‚¿ã‚¤ãƒ— <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>é‡‘é¡ç¯„å›²</option><option>ãƒ–ãƒ©ãƒ³ãƒ‰</option><option>åŠ ç›Ÿåº—</option><option>æ™‚é–“å¸¯</option><option>åœ°åŸŸ</option></select></div>
                <div><label className="text-xs font-semibold text-slate-600">å„ªå…ˆæ¥ç¶šå…ˆ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>Univa Pay cast</option><option>æ¥½å¤©éŠ€è¡Œ</option><option>Worldpay</option><option>TCMS</option><option>Simpletransact</option><option>ONTHELINE</option><option>Asiabill</option></select></div>
              </div>
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-3 space-y-2">
                <p className="text-xs font-bold text-slate-600">æ¡ä»¶è©³ç´°</p>
                <div className="grid grid-cols-3 gap-2">
                  <div><label className="text-xs text-slate-500">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</label><select className="w-full text-xs border rounded px-2 py-1"><option>é‡‘é¡</option><option>ãƒ–ãƒ©ãƒ³ãƒ‰</option><option>BIN</option></select></div>
                  <div><label className="text-xs text-slate-500">æ¼”ç®—å­</label><select className="w-full text-xs border rounded px-2 py-1"><option>â‰§ï¼ˆä»¥ä¸Šï¼‰</option><option>ï¼œï¼ˆæœªæº€ï¼‰</option><option>ï¼</option></select></div>
                  <div><label className="text-xs text-slate-500">å€¤</label><input className="w-full text-xs border rounded px-2 py-1" placeholder="500000" /></div>
                </div>
                <button onClick={() => toast("ANDæ¡ä»¶ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "info")} className="text-xs text-blue-600 hover:underline">+ ANDæ¡ä»¶ã‚’è¿½åŠ </button>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å…ˆ</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>è‡ªå‹•ï¼ˆAIåˆ¤å®šï¼‰</option><option>Worldpay</option><option>Simpletransact</option><option>ONTHELINE</option></select></div>
                <div><label className="text-xs font-semibold text-slate-600">å„ªå…ˆåº¦</label><input type="number" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="5" min="1" max="99" /></div>
              </div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowAddRouteRule(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowAddRouteRule(false); toast("ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ", "success"); }} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆ</button>
            </div>
          </div>
        </div>
      )}
      <ConfirmDialog config={actionConfirm} onClose={() => setActionConfirm(null)} />
      </>)}
    </div>
  );
};

// â”€â”€â”€ M09: æ¥ç¶šå…ˆå¯©æŸ» â”€â”€â”€
const processorList = [
  { id: "PROC-001", name: "Univa Pay cast", type: "ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼", brands: ["VISA","MC"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.95%", merchants: 5, reviewing: 1, avgReviewDays: 10,
    fees: { visa: "3.55%", master: "3.55%", jcb: "3.80%", amex: "3.80%", diners: "3.80%" },
    trFees: { success: "30å††", fail: "30å††", cb: "3,000å††", refund: "100å††", tds: "4å††/ä»¶", cbCancel: "-" },
    fixedCost: { initial: "Â¥0", monthly: "Â¥0" },
    deposit: { rate: "10%", period: "180æ—¥", type: "ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–" },
    limits: { trMax: "-", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "é‡‘æ›œç· ã‚ç¿Œç¿Œã€…æœˆæ›œ / 15æ—¥ç· ã‚æœ«æ‰•ã„ãƒ»æœ«ç· ã‚ç¿Œ15æ—¥æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "ãªã—ï¼ˆLINKæ±ºæ¸ˆ/APIã‚¹ãƒ”ãƒ¼ãƒ‰æ±ºæ¸ˆã®ã¿ï¼‰", ngGenre: "FXã€ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã€ã‚¢ãƒ€ãƒ«ãƒˆ", usd: false },
  },
  { id: "PROC-002", name: "æ¥½å¤©éŠ€è¡Œ", type: "ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼", brands: ["VISA","MC"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.91%", merchants: 4, reviewing: 1, avgReviewDays: 12,
    fees: { visa: "2.65%", master: "2.65%", jcb: "3.00%", amex: "3.00%", diners: "3.00%" },
    trFees: { success: "10å††", fail: "-", cb: "1,300å††", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "Â¥0", monthly: "Â¥500" },
    deposit: { rate: "5%", period: "120æ—¥", type: "ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–" },
    limits: { trMax: "Â¥500,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æ¥½å¤©å£åº§ä¿æœ‰: æ¯æ—¥ç· ã‚æ¯æ—¥æ‰•ã„ / éä¿æœ‰: æœˆæœ«ç· ã‚ç¿Œå–¶æ¥­æ—¥æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "å¿…é ˆ", ngGenre: "è–¬å“ã€å…ãƒãƒ«ã€FXã€ã‚®ãƒ£ãƒ³ãƒ–ãƒ«", usd: false },
  },
  { id: "PROC-003", name: "Worldpay", type: "ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼", brands: ["VISA","MC","AMEX"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.93%", merchants: 3, reviewing: 0, avgReviewDays: 14,
    fees: { visa: "3.42%", master: "3.59%", jcb: "-", amex: "-", diners: "-" },
    trFees: { success: "11å††", fail: "11å††", cb: "1,200å††", refund: "500å††", tds: "1å††/ä»¶", cbCancel: "-" },
    fixedCost: { initial: "Â¥300,000", monthly: "Â¥30,000" },
    deposit: { rate: "10%", period: "180æ—¥", type: "ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–" },
    limits: { trMax: "-", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æ¯æ—¥ç· ã‚ T+3ï¼ˆæ±ºæ¸ˆæ—¥ã®3å–¶æ¥­æ—¥å¾Œï¼‰", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "FXã€ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã€ã‚¢ãƒ€ãƒ«ãƒˆ", usd: false },
  },
  { id: "PROC-004", name: "TCMS", type: "ã‚¢ã‚¯ãƒ¯ã‚¤ã‚¢ãƒ©ãƒ¼ç›´æ¥", brands: ["VISA","MC","JCB"], protocol: "å°‚ç”¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.90%", merchants: 3, reviewing: 1, avgReviewDays: 21,
    fees: { visa: "3.80%", master: "3.80%", jcb: "3.60%", amex: "-", diners: "3.30%" },
    trFees: { success: "20å††", fail: "-", cb: "-", refund: "-", tds: "1å††/ä»¶", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥200,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "-", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "PROC-005", name: "Simpletransact", type: "ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼", brands: ["VISA","MC"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.88%", merchants: 2, reviewing: 0, avgReviewDays: 7,
    fees: { visa: "4.45%", master: "4.45%", jcb: "4.10%", amex: "-", diners: "-" },
    trFees: { success: "0.35USD", fail: "0.35USD", cb: "45USD", refund: "2USD", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "100USD" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥1,000,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "T+14ï¼ˆæ±ºæ¸ˆæ—¥ã®14å–¶æ¥­æ—¥å¾Œï¼‰/ æ¯é€±", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "å¿…é ˆ", ngGenre: "è–¬å“ã€å…ãƒãƒ«ã€FXã€ã‚®ãƒ£ãƒ³ãƒ–ãƒ«", usd: true },
  },
  { id: "PROC-006", name: "ONTHELINE", type: "ã‚¢ã‚¯ãƒ¯ã‚¤ã‚¢ãƒ©ãƒ¼ç›´æ¥", brands: ["JCB"], protocol: "å°‚ç”¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.92%", merchants: 2, reviewing: 0, avgReviewDays: 18,
    fees: { visa: "-", master: "-", jcb: "3.50%", amex: "-", diners: "-" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "5%", period: "180æ—¥", type: "ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–" },
    limits: { trMax: "-", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "-", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "PROC-007", name: "Asiabill", type: "ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼", brands: ["AMEX","Diners"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.85%", merchants: 1, reviewing: 1, avgReviewDays: 25,
    fees: { visa: "-", master: "-", jcb: "-", amex: "2.95%", diners: "3.30%" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "10%", period: "180æ—¥", type: "ãƒ­ãƒ¼ãƒªãƒ³ã‚°ãƒªã‚¶ãƒ¼ãƒ–" },
    limits: { trMax: "-", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "-", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: true },
  },
  { id: "WEBM-001", name: "ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥", type: "WEBãƒãƒãƒ¼", brands: ["WEBãƒãƒãƒ¼"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.80%", merchants: 4, reviewing: 0, avgReviewDays: 5,
    fees: { webmoney: "5.0%" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥200,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æœˆæœ«ç· ã‚ ç¿Œæœˆæœ«æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "WEBM-002", name: "ã‚¹ãƒãƒ¼ãƒˆãƒ”ãƒƒãƒˆ", type: "WEBãƒãƒãƒ¼", brands: ["WEBãƒãƒãƒ¼"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.75%", merchants: 3, reviewing: 0, avgReviewDays: 5,
    fees: { webmoney: "Â¥300/ä»¶" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥300,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æœˆæœ«ç· ã‚ ç¿Œæœˆæœ«æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "WEBM-003", name: "ãƒãƒƒãƒˆãƒ©ã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥", type: "WEBãƒãƒãƒ¼", brands: ["WEBãƒãƒãƒ¼"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.82%", merchants: 2, reviewing: 0, avgReviewDays: 5,
    fees: { webmoney: "5.0%" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥100,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æœˆæœ«ç· ã‚ ç¿Œæœˆæœ«æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "WEBM-004", name: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒãƒ¼", type: "WEBãƒãƒãƒ¼", brands: ["WEBãƒãƒãƒ¼"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.78%", merchants: 2, reviewing: 0, avgReviewDays: 5,
    fees: { webmoney: "5.0%" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥100,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æœˆæœ«ç· ã‚ ç¿Œæœˆæœ«æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "WEBM-005", name: "Gãƒãƒãƒ¼", type: "WEBãƒãƒãƒ¼", brands: ["WEBãƒãƒãƒ¼"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.70%", merchants: 1, reviewing: 0, avgReviewDays: 5,
    fees: { webmoney: "4.5%" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥150,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æœˆæœ«ç· ã‚ ç¿Œæœˆæœ«æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "WEBM-006", name: "ãƒšã‚¤ãƒ‡ã‚£", type: "WEBãƒãƒãƒ¼", brands: ["WEBãƒãƒãƒ¼"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.90%", merchants: 3, reviewing: 0, avgReviewDays: 5,
    fees: { webmoney: "3.5%" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥500,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æœˆæœ«ç· ã‚ ç¿Œæœˆæœ«æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
  { id: "WEBM-007", name: "ãƒ‹ãƒ¼ãƒã‚ªãƒšã‚¤", type: "WEBãƒãƒãƒ¼", brands: ["WEBãƒãƒãƒ¼"], protocol: "REST API", status: "ç¨¼åƒä¸­", sColor: "green", uptime: "99.72%", merchants: 1, reviewing: 0, avgReviewDays: 5,
    fees: { webmoney: "4.0%" },
    trFees: { success: "-", fail: "-", cb: "-", refund: "-", tds: "-", cbCancel: "-" },
    fixedCost: { initial: "-", monthly: "-" },
    deposit: { rate: "-", period: "-", type: "-" },
    limits: { trMax: "Â¥200,000", monthlyMax: "-", countLimit: "-" },
    settlement: { cycle: "æœˆæœ«ç· ã‚ ç¿Œæœˆæœ«æ‰•ã„", account: "æ—¥æœ¬å£åº§ï¼ˆå††ï¼‰" },
    restrictions: { cvv: "-", ngGenre: "-", usd: false },
  },
];

const reviewFlowData = [
  {
    merchantId: "M-002", merchantName: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", processorId: "PROC-001", processorName: "Univa Pay cast",
    reviewType: "initial", // åˆå›æ³•äººå¯©æŸ»
    status: "reviewing", appliedAt: "2026-01-28", currentStep: 3, totalSteps: 7,
    timeline: [
      { step: "å¯©æŸ»ç”³è«‹", date: "01/28", status: "done", note: "è‡ªå‹•ç”³è«‹" },
      { step: "æ›¸é¡é€ä»˜", date: "01/28", status: "done", note: "ç”³è¾¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•ç”Ÿæˆ" },
      { step: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­", date: "01/29ã€œ", status: "active", note: "Univa Pay castå´ã§å¯©æŸ»ä¸­" },
      { step: "è¿½åŠ æ›¸é¡å¯¾å¿œ", date: "â€”", status: "pending", note: "" },
      { step: "æ¡ä»¶ç¢ºå®š", date: "â€”", status: "pending", note: "æ‰‹æ•°æ–™ç‡ãƒ»å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«ç­‰" },
      { step: "å¥‘ç´„æ›¸é€ä»˜", date: "â€”", status: "pending", note: "æ¡ä»¶ã‚’åæ˜ ã—ãŸå¥‘ç´„æ›¸ã‚’åŠ ç›Ÿåº—ã«é€ä»˜" },
      { step: "æ±ºæ¸ˆé–‹å§‹", date: "â€”", status: "pending", note: "åŠ ç›Ÿåº—ãŒå¥‘ç´„æ›¸ã«ç½²åå¾Œ" },
    ],
    documents: [
      { name: "åŠ ç›Ÿåº—å¯©æŸ»ç”³è«‹æ›¸", type: "è‡ªå‹•ç”Ÿæˆ", format: "PDF", size: "245KB", date: "01/28", status: "sent", auto: true },
      { name: "ç™»è¨˜ç°¿è¬„æœ¬", type: "ç”³è¾¼æ™‚æå‡º", format: "PDF", size: "1.2MB", date: "01/28", status: "sent", auto: false },
      { name: "ä»£è¡¨è€…æœ¬äººç¢ºèªæ›¸é¡", type: "ç”³è¾¼æ™‚æå‡º", format: "JPEG", size: "890KB", date: "01/28", status: "sent", auto: false },
      { name: "ç›´è¿‘2æœŸåˆ†æ±ºç®—æ›¸", type: "ç”³è¾¼æ™‚æå‡º", format: "PDF", size: "3.4MB", date: "01/28", status: "sent", auto: false },
      { name: "ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ", type: "è‡ªå‹•ç”Ÿæˆ", format: "PNG", size: "2.1MB", date: "01/28", status: "sent", auto: true },
      { name: "ç‰¹å®šå•†å–å¼•æ³•è¡¨è¨˜", type: "ç”³è¾¼æ™‚æå‡º", format: "PNG", size: "560KB", date: "01/28", status: "sent", auto: false },
    ],
    additionalRequests: [],
  },
  {
    merchantId: "M-006", merchantName: "æ ªå¼ä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", processorId: "PROC-007", processorName: "Asiabill",
    reviewType: "initial", // åˆå›æ³•äººå¯©æŸ»
    status: "additional_docs", appliedAt: "2026-01-15", currentStep: 4, totalSteps: 7,
    timeline: [
      { step: "å¯©æŸ»ç”³è«‹", date: "01/15", status: "done", note: "æ‰‹å‹•ç”³è«‹" },
      { step: "æ›¸é¡é€ä»˜", date: "01/15", status: "done", note: "ç”³è¾¼ãƒ‡ãƒ¼ã‚¿ + è¿½åŠ è³‡æ–™" },
      { step: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­", date: "01/16ã€œ02/05", status: "done", note: "ä¸€æ¬¡å¯©æŸ»é€šé" },
      { step: "è¿½åŠ æ›¸é¡å¯¾å¿œ", date: "02/06ã€œ", status: "active", note: "è¿½åŠ æ›¸é¡ã‚’è¦æ±‚ã•ã‚ŒãŸ" },
      { step: "æ¡ä»¶ç¢ºå®š", date: "â€”", status: "pending", note: "æ‰‹æ•°æ–™ç‡ãƒ»å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«ç­‰" },
      { step: "å¥‘ç´„æ›¸é€ä»˜", date: "â€”", status: "pending", note: "æ¡ä»¶ã‚’åæ˜ ã—ãŸå¥‘ç´„æ›¸ã‚’åŠ ç›Ÿåº—ã«é€ä»˜" },
      { step: "æ±ºæ¸ˆé–‹å§‹", date: "â€”", status: "pending", note: "åŠ ç›Ÿåº—ãŒå¥‘ç´„æ›¸ã«ç½²åå¾Œ" },
    ],
    documents: [
      { name: "åŠ ç›Ÿåº—å¯©æŸ»ç”³è«‹æ›¸", type: "è‡ªå‹•ç”Ÿæˆ", format: "PDF", size: "245KB", date: "01/15", status: "sent", auto: true },
      { name: "ç™»è¨˜ç°¿è¬„æœ¬", type: "ç”³è¾¼æ™‚æå‡º", format: "PDF", size: "1.1MB", date: "01/15", status: "sent", auto: false },
      { name: "ä»£è¡¨è€…æœ¬äººç¢ºèªæ›¸é¡", type: "ç”³è¾¼æ™‚æå‡º", format: "JPEG", size: "920KB", date: "01/15", status: "sent", auto: false },
      { name: "ç›´è¿‘2æœŸåˆ†æ±ºç®—æ›¸", type: "ç”³è¾¼æ™‚æå‡º", format: "PDF", size: "4.2MB", date: "01/15", status: "sent", auto: false },
      { name: "ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ", type: "è‡ªå‹•ç”Ÿæˆ", format: "PNG", size: "1.8MB", date: "01/15", status: "sent", auto: true },
      { name: "æ—…è¡Œæ¥­ç™»éŒ²è¨¼", type: "è¿½åŠ è¦æ±‚", format: "â€”", size: "â€”", date: "â€”", status: "waiting", auto: false },
      { name: "éå»6ãƒ¶æœˆã®CBå®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆ", type: "è¿½åŠ è¦æ±‚", format: "â€”", size: "â€”", date: "â€”", status: "waiting", auto: false },
    ],
    additionalRequests: [
      { date: "02/06", from: "Asiabillå¯©æŸ»éƒ¨", items: ["æ—…è¡Œæ¥­ç™»éŒ²è¨¼ã®å†™ã—", "éå»6ãƒ¶æœˆã®ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯å®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆ"], deadline: "02/13", status: "å¯¾å¿œä¸­" },
    ],
  },
  {
    merchantId: "M-1002", merchantName: "æ ªå¼ä¼šç¤¾ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ«", processorId: "PROC-001", processorName: "Univa Pay cast",
    reviewType: "site_add", // æ—¢å­˜åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»
    siteName: "ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆEC", siteUrl: "https://outlet.fashion-mall.jp", siteGenre: "ç‰©è²©ECï¼ˆè¡£æ–™ï¼‰",
    status: "reviewing", appliedAt: "2026-02-10", currentStep: 2, totalSteps: 5,
    timeline: [
      { step: "ã‚µã‚¤ãƒˆå¯©æŸ»ç”³è«‹", date: "02/10", status: "done", note: "æ—¢å­˜åŠ ç›Ÿåº—ã‹ã‚‰ã®ã‚µã‚¤ãƒˆè¿½åŠ " },
      { step: "æ¥ç¶šå…ˆã‚µã‚¤ãƒˆå¯©æŸ»", date: "02/11ã€œ", status: "active", note: "Univa Pay castå´ã§ã‚µã‚¤ãƒˆå¯©æŸ»ä¸­ï¼ˆæ³•äººå¯©æŸ»æ¸ˆã¿ï¼‰" },
      { step: "æ¡ä»¶ç¢ºå®š", date: "â€”", status: "pending", note: "ã‚µã‚¤ãƒˆåˆ¥æ‰‹æ•°æ–™ãƒ»åˆ¶é™ã®ç¢ºå®š" },
      { step: "å¥‘ç´„è¿½è£œ", date: "â€”", status: "pending", note: "æ—¢å­˜å¥‘ç´„ã¸ã®è¿½è£œï¼ˆã‚µã‚¤ãƒˆè¿½åŠ ï¼‰" },
      { step: "æ±ºæ¸ˆé–‹å§‹", date: "â€”", status: "pending", note: "æ–°ã‚µã‚¤ãƒˆã®æ±ºæ¸ˆé–‹å§‹" },
    ],
    documents: [
      { name: "ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ç”³è«‹æ›¸", type: "è‡ªå‹•ç”Ÿæˆ", format: "PDF", size: "180KB", date: "02/10", status: "sent", auto: true },
      { name: "ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ", type: "è‡ªå‹•ç”Ÿæˆ", format: "PNG", size: "1.5MB", date: "02/10", status: "sent", auto: true },
      { name: "ç‰¹å®šå•†å–å¼•æ³•è¡¨è¨˜", type: "è‡ªå‹•ç”Ÿæˆ", format: "PNG", size: "420KB", date: "02/10", status: "sent", auto: true },
    ],
    additionalRequests: [],
  },
  {
    merchantId: "M-1005", merchantName: "åˆåŒä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒã‚¯ã‚¹ãƒˆ", processorId: "PROC-004", processorName: "TCMS",
    reviewType: "site_add", // æ—¢å­˜åŠ ç›Ÿåº—ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»
    siteName: "æµ·å¤–ãƒ„ã‚¢ãƒ¼äºˆç´„ã‚µã‚¤ãƒˆ", siteUrl: "https://overseas.travelnext.co.jp", siteGenre: "æ—…è¡Œãƒ»å®¿æ³Š",
    status: "reviewing", appliedAt: "2026-02-11", currentStep: 1, totalSteps: 5,
    timeline: [
      { step: "ã‚µã‚¤ãƒˆå¯©æŸ»ç”³è«‹", date: "02/11", status: "done", note: "æ—¢å­˜åŠ ç›Ÿåº—ã‹ã‚‰ã®ã‚µã‚¤ãƒˆè¿½åŠ " },
      { step: "æ¥ç¶šå…ˆã‚µã‚¤ãƒˆå¯©æŸ»", date: "â€”", status: "active", note: "TCMSå´ã§ã‚µã‚¤ãƒˆå¯©æŸ»ä¸­" },
      { step: "æ¡ä»¶ç¢ºå®š", date: "â€”", status: "pending", note: "ã‚µã‚¤ãƒˆåˆ¥æ‰‹æ•°æ–™ã®ç¢ºå®š" },
      { step: "å¥‘ç´„è¿½è£œ", date: "â€”", status: "pending", note: "æ—¢å­˜å¥‘ç´„ã¸ã®è¿½è£œ" },
      { step: "æ±ºæ¸ˆé–‹å§‹", date: "â€”", status: "pending", note: "" },
    ],
    documents: [
      { name: "ã‚µã‚¤ãƒˆè¿½åŠ å¯©æŸ»ç”³è«‹æ›¸", type: "è‡ªå‹•ç”Ÿæˆ", format: "PDF", size: "195KB", date: "02/11", status: "sent", auto: true },
      { name: "ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ", type: "è‡ªå‹•ç”Ÿæˆ", format: "PNG", size: "2.0MB", date: "02/11", status: "sent", auto: true },
    ],
    additionalRequests: [],
  },
];

const approvedHistory = [
  { merchantName: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", processorName: "ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥", reviewType: "initial", approvedAt: "2025-10-18", reviewDays: 4, docs: 5 },
  { merchantName: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", processorName: "TCMS", reviewType: "initial", approvedAt: "2025-08-22", reviewDays: 18, docs: 6 },
  { merchantName: "æ ªå¼ä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", processorName: "ONTHELINE", reviewType: "initial", approvedAt: "2025-07-10", reviewDays: 16, docs: 7 },
  { merchantName: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", processorName: "Simpletransact", reviewType: "initial", approvedAt: "2025-06-05", reviewDays: 5, docs: 5 },
  { merchantName: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", processorName: "Univa Pay cast", reviewType: "initial", approvedAt: "2025-04-12", reviewDays: 6, docs: 5 },
  { merchantName: "æ ªå¼ä¼šç¤¾ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ«", processorName: "æ¥½å¤©éŠ€è¡Œ", reviewType: "site_add", siteName: "ãƒ¡ãƒ³ã‚ºå°‚é–€EC", approvedAt: "2025-12-05", reviewDays: 3, docs: 3 },
  { merchantName: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", processorName: "Worldpay", reviewType: "site_add", siteName: "æµ·å¤–å‘ã‘EC", approvedAt: "2025-11-20", reviewDays: 5, docs: 3 },
];

const MasterProcessors = () => {
  const toast = useToast();
  const [selectedProc, setSelectedProc] = useState(null);
  const [activeTab, setActiveTab] = useState("overview");
  const [confirmDialog, setConfirmDialog] = useState(null);
  const [showAddProc, setShowAddProc] = useState(false);

  return (
    <div className="p-5 space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-sm font-bold text-slate-800">æ¥ç¶šå…ˆå¯©æŸ»</h2>
        <div className="flex gap-2">
          <button onClick={() => setShowAddProc(true)} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold hover:bg-blue-700">+ æ¥ç¶šå…ˆè¿½åŠ </button>
        </div>
      </div>

      {/* Tab navigation */}
      <div className="flex gap-1 border-b">
        {[
          { id: "overview", label: "æ¥ç¶šå…ˆä¸€è¦§", badge: null },
          { id: "reviews", label: "å¯©æŸ»ãƒ•ãƒ­ãƒ¼ç®¡ç†", badge: 4 },
          { id: "history", label: "å¯©æŸ»å®Œäº†å±¥æ­´", badge: null },
          { id: "documents", label: "å¯©æŸ»è³‡æ–™ç®¡ç†", badge: 1 },
        ].map((tab) => (
          <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`text-xs px-3 py-2 border-b-2 flex items-center gap-1 ${activeTab === tab.id ? "border-blue-500 text-blue-600 font-semibold" : "border-transparent text-slate-400 hover:text-slate-600"}`}>
            {tab.label}
            {tab.badge && <span className="bg-rose-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">{tab.badge}</span>}
          </button>
        ))}
      </div>

      {/* â•â•â• Tab: æ¥ç¶šå…ˆä¸€è¦§ â•â•â• */}
      {activeTab === "overview" && (
        <div className="space-y-3">
          <div className="flex gap-3">
            <KPICard label="æœ‰åŠ¹æ¥ç¶šå…ˆ" value="5ç¤¾" sub="" color="green" />
            <KPICard label="å¯©æŸ»é€²è¡Œä¸­" value="2ä»¶" sub="XYZã‚·ãƒ§ãƒƒãƒ— / ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹" color="blue" />
            <KPICard label="è¿½åŠ æ›¸é¡å¾…ã¡" value="1ä»¶" sub="è¦å¯¾å¿œ" color="yellow" />
            <KPICard label="å¹³å‡å¯©æŸ»æ—¥æ•°" value="12æ—¥" sub="å…¨æ¥ç¶šå…ˆå¹³å‡" />
          </div>

          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "æ¥ç¶šå…ˆID", w: "w-24" }, { label: "æ¥ç¶šå…ˆå", w: "w-36" }, { label: "ç¨®åˆ¥", w: "w-36" }, { label: "å¯¾å¿œãƒ–ãƒ©ãƒ³ãƒ‰", w: "w-32" }, { label: "ç¨¼åƒç‡", w: "w-20" }, { label: "æ‰¿èªæ¸ˆåŠ ç›Ÿåº—", w: "w-24" }, { label: "å¯©æŸ»ä¸­", w: "w-16" }, { label: "çŠ¶æ…‹", w: "w-20" }, { label: "æ“ä½œ", w: "w-16" }]}>
            {processorList.map((p, i) => (
              <tr key={p.id} className={`border-b ${i % 2 ? "bg-slate-50" : ""} hover:bg-blue-50 cursor-pointer`} onClick={() => setSelectedProc(selectedProc === p.id ? null : p.id)}>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-slate-500">{p.id}</td>
                <td className="px-4 py-2 whitespace-nowrap w-36 font-semibold text-slate-700">{p.name}</td>
                <td className="px-4 py-2 whitespace-nowrap w-36 text-slate-500">{p.type}</td>
                <td className="px-4 py-2 whitespace-nowrap w-32"><div className="flex gap-1 flex-wrap">{p.brands.map(b => <Badge key={b} text={b} color="blue" />)}</div></td>
                <td className="px-4 py-2 whitespace-nowrap w-20 text-emerald-600 font-semibold">{p.uptime}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-center text-slate-700 font-semibold">{p.merchants}ç¤¾</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-center">{p.reviewing > 0 ? <Badge text={`${p.reviewing}ä»¶`} color="yellow" /> : <span className="text-slate-300">â€”</span>}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={p.status} color={p.sColor} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><button onClick={(e) => { e.stopPropagation(); toast(`${p.name}ã®è¨­å®šã‚’é–‹ãã¾ã—ãŸ`, "info"); }} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">è¨­å®š</button></td>
              </tr>
            ))}
            </TableHeader>
          </div>

          {/* Processor Detail Expand */}
          {selectedProc && (() => {
            const p = processorList.find(x => x.id === selectedProc);
            const linkedMerchants = merchantData.filter(m => m.processors.some(mp => mp.name === p.name));
            const isCard = p.type !== "WEBãƒãƒãƒ¼";
            return (
              <div className="bg-blue-50 rounded-lg border border-blue-200 p-3 space-y-3">
                <div className="flex justify-between items-center">
                  <p className="text-xs font-bold text-slate-700">ğŸ”Œ {p.name} â€” æ¥ç¶šå…ˆè©³ç´°</p>
                  <button onClick={() => setSelectedProc(null)} className="text-xs text-slate-400 hover:text-slate-600">âœ• é–‰ã˜ã‚‹</button>
                </div>

                {/* 3-A: ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥æ‰‹æ•°æ–™ãƒãƒˆãƒªã‚¯ã‚¹ */}
                <div className="bg-white rounded-lg border border-slate-200 p-3">
                  <p className="text-xs font-bold text-slate-600 mb-2">ğŸ’° ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥åŸä¾¡æ‰‹æ•°æ–™ç‡ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</p>
                  {isCard ? (
                    <div className="grid grid-cols-5 gap-2">
                      {[{b:"VISA",k:"visa"},{b:"MC",k:"master"},{b:"JCB",k:"jcb"},{b:"AMEX",k:"amex"},{b:"Diners",k:"diners"}].map(({b,k}) => (
                        <div key={k} className={`rounded-lg border p-2 text-center ${p.fees[k] !== "-" ? "bg-blue-50 border-blue-200" : "bg-slate-50 border-slate-200"}`}>
                          <p className="text-xs text-slate-400 mb-0.5">{b}</p>
                          <p className={`text-sm font-bold ${p.fees[k] !== "-" ? "text-blue-700" : "text-slate-300"}`}>{p.fees[k]}</p>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="bg-blue-50 rounded-lg border border-blue-200 p-2 text-center">
                      <p className="text-xs text-slate-400 mb-0.5">WEBãƒãƒãƒ¼æ‰‹æ•°æ–™</p>
                      <p className="text-lg font-bold text-blue-700">{p.fees.webmoney}</p>
                    </div>
                  )}
                </div>

                {/* 3-B: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ‰‹æ•°æ–™ãƒ–ãƒ¬ã‚¤ã‚¯ãƒ€ã‚¦ãƒ³ */}
                {isCard && (
                <div className="bg-white rounded-lg border border-slate-200 p-3">
                  <p className="text-xs font-bold text-slate-600 mb-2">ğŸ“Š ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ‰‹æ•°æ–™</p>
                  <div className="grid grid-cols-3 gap-2">
                    {[{l:"TR(æˆåŠŸ)",v:p.trFees.success,c:"emerald"},{l:"TR(å¤±æ•—)",v:p.trFees.fail,c:"amber"},{l:"CBæ‰‹æ•°æ–™",v:p.trFees.cb,c:"rose"},
                      {l:"è¿”é‡‘æ‰‹æ•°æ–™",v:p.trFees.refund,c:"purple"},{l:"3DSèªè¨¼æ–™",v:p.trFees.tds,c:"blue"},{l:"CBå–æ¶ˆ",v:p.trFees.cbCancel,c:"slate"}
                    ].map(({l,v,c}) => (
                      <div key={l} className="bg-slate-50 rounded border border-slate-200 p-2">
                        <p className="text-xs text-slate-400">{l}</p>
                        <p className={`text-xs font-bold ${v !== "-" ? `text-${c}-700` : "text-slate-300"}`}>{v}</p>
                      </div>
                    ))}
                  </div>
                </div>
                )}

                {/* 3-C: åˆ¶é™ãƒ»æ¡ä»¶ */}
                <div className="bg-white rounded-lg border border-slate-200 p-3">
                  <p className="text-xs font-bold text-slate-600 mb-2">âš™ï¸ æ¡ä»¶ãƒ»åˆ¶é™</p>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <p className="text-xs font-semibold text-purple-700 mb-1">ğŸ”’ ãƒ‡ãƒã‚¸ãƒƒãƒˆï¼ˆç•™ä¿ï¼‰</p>
                      <div className="bg-purple-50 rounded border border-purple-200 p-2 space-y-1 text-xs">
                        <div className="flex justify-between"><span className="text-slate-400">ç•™ä¿ç‡</span><span className="font-semibold">{p.deposit.rate}</span></div>
                        <div className="flex justify-between"><span className="text-slate-400">æœŸé–“</span><span className="font-semibold">{p.deposit.period}</span></div>
                        <div className="flex justify-between"><span className="text-slate-400">ã‚¿ã‚¤ãƒ—</span><span className="font-semibold">{p.deposit.type}</span></div>
                      </div>
                    </div>
                    <div>
                      <p className="text-xs font-semibold text-amber-700 mb-1">ğŸ“ å–å¼•åˆ¶é™</p>
                      <div className="bg-amber-50 rounded border border-amber-200 p-2 space-y-1 text-xs">
                        <div className="flex justify-between"><span className="text-slate-400">TRä¸Šé™é¡</span><span className="font-semibold">{p.limits.trMax}</span></div>
                        <div className="flex justify-between"><span className="text-slate-400">æœˆé–“ä¸Šé™</span><span className="font-semibold">{p.limits.monthlyMax}</span></div>
                        <div className="flex justify-between"><span className="text-slate-400">å›æ•°åˆ¶é™</span><span className="font-semibold">{p.limits.countLimit}</span></div>
                      </div>
                    </div>
                    <div>
                      <p className="text-xs font-semibold text-emerald-700 mb-1">ğŸ’µ å›ºå®šè²»</p>
                      <div className="bg-emerald-50 rounded border border-emerald-200 p-2 space-y-1 text-xs">
                        <div className="flex justify-between"><span className="text-slate-400">åˆæœŸè²»ç”¨</span><span className="font-semibold">{p.fixedCost.initial}</span></div>
                        <div className="flex justify-between"><span className="text-slate-400">æœˆé¡è²»ç”¨</span><span className="font-semibold">{p.fixedCost.monthly}</span></div>
                      </div>
                    </div>
                    <div>
                      <p className="text-xs font-semibold text-blue-700 mb-1">ğŸ¦ å…¥é‡‘æƒ…å ±</p>
                      <div className="bg-blue-50 rounded border border-blue-200 p-2 space-y-1 text-xs">
                        <div className="flex justify-between"><span className="text-slate-400">å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«</span><span className="font-semibold text-right flex-1 ml-2">{p.settlement.cycle}</span></div>
                        <div className="flex justify-between"><span className="text-slate-400">å£åº§</span><span className="font-semibold">{p.settlement.account}</span></div>
                      </div>
                    </div>
                  </div>
                  {isCard && (
                    <div className="mt-2 bg-slate-50 rounded border border-slate-200 p-2">
                      <p className="text-xs font-semibold text-slate-600 mb-1">ğŸš« åˆ¶é™äº‹é …</p>
                      <div className="grid grid-cols-3 gap-2 text-xs">
                        <div><span className="text-slate-400">CVV: </span><span className="font-semibold">{p.restrictions.cvv}</span></div>
                        <div><span className="text-slate-400">NGã‚¸ãƒ£ãƒ³ãƒ«: </span><span className="font-semibold">{p.restrictions.ngGenre}</span></div>
                        <div><span className="text-slate-400">USDæ±ºæ¸ˆ: </span><span className="font-semibold">{p.restrictions.usd ? "å¯¾å¿œ" : "éå¯¾å¿œ"}</span></div>
                      </div>
                    </div>
                  )}
                </div>

                {/* 3-E: ã‚µã‚¤ãƒˆåˆ¥åŠ ç›Ÿåº—æ¥ç¶šä¸€è¦§ */}
                <div className="bg-white rounded-lg border border-slate-200 p-3">
                  <p className="text-xs font-bold text-slate-600 mb-2">ğŸª æ¥ç¶šåŠ ç›Ÿåº—ãƒ»ã‚µã‚¤ãƒˆä¸€è¦§</p>
                  <div className="overflow-x-auto">
                    <table className="w-full text-xs">
                      <thead><tr className="bg-slate-50 text-slate-500 border-b">
                        <th className="px-2 py-1.5 text-left font-semibold">åŠ ç›Ÿåº—</th>
                        <th className="px-2 py-1.5 text-left font-semibold">ã‚µã‚¤ãƒˆID</th>
                        <th className="px-2 py-1.5 text-left font-semibold">ã‚µã‚¤ãƒˆå</th>
                        <th className="px-2 py-1.5 text-center font-semibold">MID</th>
                        <th className="px-2 py-1.5 text-center font-semibold">çŠ¶æ…‹</th>
                        {isCard && <th className="px-2 py-1.5 text-center font-semibold">VISA</th>}
                        {isCard && <th className="px-2 py-1.5 text-center font-semibold">MC</th>}
                        {!isCard && <th className="px-2 py-1.5 text-center font-semibold">æ‰‹æ•°æ–™</th>}
                        <th className="px-2 py-1.5 text-center font-semibold">ãƒ‡ãƒ</th>
                        <th className="px-2 py-1.5 text-center font-semibold">ç´¯è¨ˆTX</th>
                      </tr></thead>
                      <tbody>
                      {linkedMerchants.flatMap((m) =>
                        (m.sites || []).filter(s => s.processors.some(sp => sp.name === p.name)).map((site) => {
                          const mp = site.processors.find(x => x.name === p.name);
                          const st = PROC_STATUS[mp.status];
                          const hasOverride = mp.feeOverride && Object.values(mp.feeOverride).some(v => v);
                          return (
                            <tr key={`${m.id}-${site.siteId}`} className="border-b hover:bg-blue-50">
                              <td className="px-2 py-1.5 font-semibold text-slate-700">{m.name}</td>
                              <td className="px-2 py-1.5 font-mono text-slate-500">{site.siteId}</td>
                              <td className="px-2 py-1.5 text-slate-600">{site.siteName}</td>
                              <td className="px-2 py-1.5 text-center font-mono text-slate-500">{mp.mid || "â€”"}</td>
                              <td className="px-2 py-1.5 text-center"><Badge text={st.label} color={st.color} /></td>
                              {isCard && <td className={`px-2 py-1.5 text-center font-semibold ${hasOverride && mp.feeOverride?.visa ? "text-amber-600 bg-amber-50" : "text-slate-500"}`}>{mp.feeOverride?.visa || p.fees.visa}</td>}
                              {isCard && <td className={`px-2 py-1.5 text-center font-semibold ${hasOverride && mp.feeOverride?.master ? "text-amber-600 bg-amber-50" : "text-slate-500"}`}>{mp.feeOverride?.master || p.fees.master}</td>}
                              {!isCard && <td className={`px-2 py-1.5 text-center font-semibold ${hasOverride && mp.feeOverride?.webmoney ? "text-amber-600 bg-amber-50" : "text-slate-500"}`}>{mp.feeOverride?.webmoney || p.fees.webmoney}</td>}
                              <td className={`px-2 py-1.5 text-center ${mp.depositOverride?.rate ? "text-amber-600 bg-amber-50 font-semibold" : "text-slate-500"}`}>{mp.depositOverride?.rate || p.deposit.rate}</td>
                              <td className="px-2 py-1.5 text-center text-slate-600">{mp.txnCount > 0 ? mp.txnCount.toLocaleString() + "ä»¶" : "â€”"}</td>
                            </tr>
                          );
                        })
                      )}
                      </tbody>
                    </table>
                  </div>
                  <p className="text-xs text-amber-600 mt-1">â€» ã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å€¤</p>
                </div>
              </div>
            );
          })()}
        </div>
      )}

      {/* â•â•â• Tab: å¯©æŸ»ãƒ•ãƒ­ãƒ¼ç®¡ç† â•â•â• */}
      {activeTab === "reviews" && (
        <div className="space-y-3">
          {/* Alert: è¿½åŠ æ›¸é¡è¦æ±‚ */}
          <div className="bg-amber-50 rounded-lg border border-amber-300 p-3">
            <div className="flex items-center gap-2 mb-1">
              <span className="text-sm">âš ï¸</span>
              <span className="text-xs font-bold text-amber-800">è¿½åŠ æ›¸é¡è¦æ±‚ã‚ã‚Šï¼ˆå¯¾å¿œæœŸé™: 2026-02-13ï¼‰</span>
            </div>
            <p className="text-xs text-amber-700">Asiabill â†’ æ ªå¼ä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹: æ—…è¡Œæ¥­ç™»éŒ²è¨¼ã®å†™ã—ã€éå»6ãƒ¶æœˆã®CBå®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆ ãŒè¦æ±‚ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
          </div>

          {/* Confirmation Dialog */}
          {confirmDialog && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setConfirmDialog(null)}>
              <div className="bg-white rounded-xl shadow-2xl w-[520px] max-w-[90vw]" onClick={e => e.stopPropagation()}>
                {/* Dialog Header */}
                <div className={`p-4 rounded-t-xl border-b ${
                  confirmDialog.type === "approve" ? "bg-emerald-50" :
                  confirmDialog.type === "reject" ? "bg-rose-50" :
                  confirmDialog.type === "send_docs" ? "bg-blue-50" :
                  confirmDialog.type === "request_docs" ? "bg-amber-50" :
                  confirmDialog.type === "conditions" ? "bg-indigo-50" :
                  "bg-slate-50"
                }`}>
                  <div className="flex items-center gap-2">
                    <span className="text-lg">{
                      confirmDialog.type === "approve" ? "âœ…" :
                      confirmDialog.type === "reject" ? "âŒ" :
                      confirmDialog.type === "send_docs" ? "ğŸ“¤" :
                      confirmDialog.type === "request_docs" ? "ğŸ“©" :
                      confirmDialog.type === "conditions" ? "ğŸ“‹" :
                      "âš¡"
                    }</span>
                    <h3 className="text-sm font-bold text-slate-800">{confirmDialog.title}</h3>
                  </div>
                </div>

                {/* Dialog Body */}
                <div className="p-5 space-y-4">
                  <p className="text-xs text-slate-600">{confirmDialog.description}</p>

                  {/* å¯¾è±¡æƒ…å ± */}
                  <div className="bg-slate-50 rounded-lg border border-slate-200 p-3 space-y-1">
                    <div className="flex text-xs"><span className="w-24 text-slate-400">åŠ ç›Ÿåº—:</span><span className="font-semibold text-slate-700">{confirmDialog.merchantName}</span></div>
                    <div className="flex text-xs"><span className="w-24 text-slate-400">æ¥ç¶šå…ˆ:</span><span className="font-semibold text-slate-700">{confirmDialog.processorName}</span></div>
                    <div className="flex text-xs"><span className="w-24 text-slate-400">ç¾åœ¨ã‚¹ãƒ†ãƒƒãƒ—:</span><span className="text-blue-600">{confirmDialog.currentStep}</span></div>
                    {confirmDialog.nextStep && (
                      <div className="flex text-xs"><span className="w-24 text-slate-400">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</span><span className="font-semibold text-emerald-600">{confirmDialog.nextStep}</span></div>
                    )}
                  </div>

                  {/* å½±éŸ¿ç¯„å›² */}
                  {confirmDialog.impacts && (
                    <div className="bg-blue-50 rounded border border-blue-200 p-2">
                      <p className="text-xs font-semibold text-blue-700 mb-1">ã“ã®æ“ä½œã®å½±éŸ¿:</p>
                      <ul className="space-y-0.5">
                        {confirmDialog.impacts.map((imp, i) => (
                          <li key={i} className="text-xs text-blue-600 flex items-center gap-1">
                            <span>â†’</span> {imp}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}

                  {/* å´ä¸‹ã®å ´åˆã®ç†ç”±å…¥åŠ› */}
                  {confirmDialog.type === "reject" && (
                    <div>
                      <p className="text-xs font-semibold text-slate-600 mb-1">å´ä¸‹ç†ç”±ï¼ˆå¿…é ˆï¼‰:</p>
                      <textarea className="w-full border rounded p-2 text-xs h-16" placeholder="å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." />
                    </div>
                  )}

                  {/* æ¡ä»¶ç¢ºå®šãƒ•ã‚©ãƒ¼ãƒ  */}
                  {confirmDialog.type === "conditions" && (
                    <div className="space-y-2">
                      <p className="text-xs font-semibold text-slate-600">æ¥ç¶šå…ˆã‹ã‚‰æç¤ºã•ã‚ŒãŸæ¡ä»¶:</p>
                      <div className="bg-slate-50 rounded-lg border border-slate-200 p-3 space-y-2">
                        <p className="text-xs font-semibold text-blue-700">ğŸ’° ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥æ‰‹æ•°æ–™ç‡</p>
                        <div className="grid grid-cols-5 gap-2">
                          <div><label className="text-xs text-slate-500 block mb-0.5">VISA (%)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="3.25" defaultValue="3.25" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">MC (%)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="3.25" defaultValue="3.25" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">JCB (%)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="3.50" defaultValue="3.50" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">AMEX (%)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="" defaultValue="" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">Diners (%)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="" defaultValue="" /></div>
                        </div>
                        <p className="text-xs font-semibold text-emerald-700 mt-2">ğŸ“Š ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ‰‹æ•°æ–™</p>
                        <div className="grid grid-cols-3 gap-2">
                          <div><label className="text-xs text-slate-500 block mb-0.5">TR(æˆåŠŸ) (å††/ä»¶)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 30" defaultValue="30" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">TR(å¤±æ•—) (å††/ä»¶)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 30" defaultValue="30" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">3DSèªè¨¼æ–™ (å††/ä»¶)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 4" defaultValue="4" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">CBæ‰‹æ•°æ–™ (å††/ä»¶)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 3000" defaultValue="3000" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">è¿”é‡‘æ‰‹æ•°æ–™ (å††/ä»¶)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 100" defaultValue="100" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">æœˆé¡å›ºå®šè²» (å††)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 0" defaultValue="0" /></div>
                        </div>
                        <p className="text-xs font-semibold text-purple-700 mt-2">ğŸ”’ ãƒ‡ãƒã‚¸ãƒƒãƒˆãƒ»åˆ¶é™</p>
                        <div className="grid grid-cols-3 gap-2">
                          <div><label className="text-xs text-slate-500 block mb-0.5">ãƒ‡ãƒã‚¸ãƒƒãƒˆç‡ (%)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 10" defaultValue="10" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">ãƒ‡ãƒã‚¸ãƒƒãƒˆæœŸé–“</label>
                            <select className="w-full border rounded p-1.5 text-xs"><option>90æ—¥</option><option>120æ—¥</option><option selected>180æ—¥</option><option>365æ—¥</option></select></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">TRä¸Šé™é¡ (å††/ä»¶)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 500000" defaultValue="500000" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">æœˆé–“ä¸Šé™é¡ (å††)</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 50000000" defaultValue="" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">å›æ•°åˆ¶é™</label><input className="w-full border rounded p-1.5 text-xs" placeholder="ä¾‹: 3å›/æ—¥ã€7å›/æœˆ" defaultValue="" /></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">CVVè¦å¦</label>
                            <select className="w-full border rounded p-1.5 text-xs"><option>å¿…é ˆ</option><option>ä»»æ„</option><option>ä¸è¦</option></select></div>
                        </div>
                        <p className="text-xs font-semibold text-blue-700 mt-2">ğŸ¦ å…¥é‡‘æƒ…å ±</p>
                        <div className="grid grid-cols-2 gap-2">
                          <div><label className="text-xs text-slate-500 block mb-0.5">å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«</label>
                            <select className="w-full border rounded p-1.5 text-xs">
                              <option>æœˆæœ«ç· ã‚ / ç¿Œæœˆæœ«æ‰•ã„</option><option>15æ—¥ãƒ»æœˆæœ«ç· ã‚ / ç¿Œæœˆ15æ—¥ãƒ»æœˆæœ«æ‰•ã„</option>
                              <option>æ¯æ—¥ç· ã‚ T+3</option><option>T+14 / æ¯é€±</option><option>é€±æ¬¡å…¥é‡‘ï¼ˆæ¯é€±é‡‘æ›œæ—¥ï¼‰</option>
                              <option>ãã®ä»–ï¼ˆå‚™è€ƒæ¬„ã«è¨˜è¼‰ï¼‰</option>
                            </select></div>
                          <div><label className="text-xs text-slate-500 block mb-0.5">åˆå›å…¥é‡‘ç•™ä¿æœŸé–“</label>
                            <select className="w-full border rounded p-1.5 text-xs"><option>ãªã—</option><option>åˆæœˆç•™ä¿</option><option>åˆå›2ãƒ¶æœˆç•™ä¿</option></select></div>
                        </div>
                        <div><label className="text-xs text-slate-500 block mb-0.5">ç‰¹è¨˜äº‹é …ãƒ»å€‹åˆ¥æ¡ä»¶</label>
                          <textarea className="w-full border rounded p-1.5 text-xs h-14" placeholder="æ¥ç¶šå…ˆã‹ã‚‰æç¤ºã•ã‚ŒãŸå€‹åˆ¥æ¡ä»¶ãŒã‚ã‚Œã°è¨˜è¼‰ï¼ˆä¾‹: åˆå¹´åº¦ã¯æ‰‹æ•°æ–™0.25%å‰²å¼•ã€CBç‡0.7%ä»¥ä¸‹å³å®ˆã€NGã‚¸ãƒ£ãƒ³ãƒ«: FX/ã‚®ãƒ£ãƒ³ãƒ–ãƒ« ç­‰ï¼‰" /></div>
                      </div>
                      <div className="bg-blue-50 rounded border border-blue-200 p-2">
                        <p className="text-xs text-blue-600">ğŸ’¡ ã“ã“ã§ç™»éŒ²ã—ãŸæ¡ä»¶ã¯ä»¥ä¸‹ã«è‡ªå‹•åæ˜ ã•ã‚Œã¾ã™:</p>
                        <ul className="text-xs text-blue-500 ml-3 mt-1 space-y-0.5">
                          <li>â†’ å¥‘ç´„æ›¸PDFï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§è‡ªå‹•ç”Ÿæˆï¼‰</li>
                          <li>â†’ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚³ã‚¹ãƒˆæœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
                          <li>â†’ ç²¾ç®—ã‚¨ãƒ³ã‚¸ãƒ³ã®å…¥é‡‘ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</li>
                        </ul>
                      </div>
                    </div>
                  )}

                  {/* å‚™è€ƒå…¥åŠ› */}
                  {confirmDialog.type !== "reject" && confirmDialog.type !== "conditions" && (
                    <div>
                      <p className="text-xs font-semibold text-slate-600 mb-1">å‚™è€ƒï¼ˆä»»æ„ï¼‰:</p>
                      <input className="w-full border rounded p-2 text-xs" placeholder="æ“ä½œã«é–¢ã™ã‚‹ãƒ¡ãƒ¢ã‚’å…¥åŠ›..." />
                    </div>
                  )}

                  {/* è­¦å‘Š */}
                  {confirmDialog.type === "approve" && (
                    <div className="bg-amber-50 rounded border border-amber-200 p-2">
                      <p className="text-xs text-amber-700">âš ï¸ å¯©æŸ»å®Œäº†å¾Œã€ã“ã®åŠ ç›Ÿåº—ã®æ¥ç¶šå…ˆã¯<span className="font-bold">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¯¾è±¡ã«è¿½åŠ </span>ã•ã‚Œã¾ã™ã€‚æ‰¿èªæ¸ˆã¿æ¥ç¶šå…ˆãŒè¤‡æ•°ã«ãªã‚‹å ´åˆã€AIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒè‡ªå‹•çš„ã«æœ‰åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚</p>
                    </div>
                  )}
                  {confirmDialog.type === "reject" && (
                    <div className="bg-rose-50 rounded border border-rose-200 p-2">
                      <p className="text-xs text-rose-700">âš ï¸ å´ä¸‹ã™ã‚‹ã¨ã€ã“ã®æ¥ç¶šå…ˆã®å¯©æŸ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ<span className="font-bold">ã€Œrejectedã€ã«å¤‰æ›´</span>ã•ã‚Œã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¯¾è±¡ã‹ã‚‰é™¤å¤–ã•ã‚Œã¾ã™ã€‚å†ç”³è«‹ã«ã¯æ–°è¦ã®å¯©æŸ»ãƒ—ãƒ­ã‚»ã‚¹ãŒå¿…è¦ã§ã™ã€‚</p>
                    </div>
                  )}
                </div>

                {/* Dialog Footer */}
                <div className="flex justify-end gap-2 p-4 border-t bg-slate-50 rounded-b-xl">
                  <button onClick={() => setConfirmDialog(null)} className="px-4 py-2 bg-white text-slate-600 rounded border text-xs font-semibold hover:bg-slate-100">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                  <button
                    onClick={() => setConfirmDialog(null)}
                    className={`px-4 py-2 rounded text-white text-xs font-semibold ${
                      confirmDialog.type === "approve" ? "bg-emerald-600 hover:bg-emerald-700" :
                      confirmDialog.type === "reject" ? "bg-rose-600 hover:bg-rose-700" :
                      confirmDialog.type === "conditions" ? "bg-indigo-600 hover:bg-indigo-700" :
                      "bg-blue-600 hover:bg-blue-700"
                    }`}
                  >
                    {confirmDialog.confirmLabel}
                  </button>
                </div>
              </div>
            </div>
          )}

          {reviewFlowData.map((review, ri) => (
            <div key={ri} className="bg-white rounded-lg border border-slate-200 shadow-sm">
              {/* Header */}
              <div className={`p-3 border-b ${review.status === "additional_docs" ? "bg-amber-50" : review.reviewType === "site_add" ? "bg-teal-50" : "bg-blue-50"}`}>
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-2">
                    <Badge text={review.reviewType === "site_add" ? "ã‚µã‚¤ãƒˆè¿½åŠ " : "åˆå›æ³•äºº"} color={review.reviewType === "site_add" ? "teal" : "purple"} />
                    <Badge text={review.status === "additional_docs" ? "è¿½åŠ æ›¸é¡å¾…ã¡" : "å¯©æŸ»ä¸­"} color={review.status === "additional_docs" ? "yellow" : "blue"} />
                    <span className="text-sm font-bold text-slate-800">{review.merchantName}{review.reviewType === "site_add" ? ` (${review.siteName})` : ""} â†’ {review.processorName}</span>
                  </div>
                  <div className="flex items-center gap-3">
                    <span className="text-xs text-slate-400">ç”³è«‹æ—¥: {review.appliedAt}</span>
                    <span className="text-xs text-slate-400">çµŒé: {Math.floor((new Date('2026-02-11') - new Date(review.appliedAt.replace(/\//g,'-'))) / 86400000)}æ—¥</span>
                    <span className="text-xs bg-slate-100 text-slate-500 px-2 py-0.5 rounded">Step {review.currentStep}/{review.totalSteps}</span>
                  </div>
                </div>
              </div>

              <div className="p-3">
                {/* Timeline with Action Buttons */}
                <div className="flex items-center justify-between mb-2">
                  <p className="text-xs font-bold text-slate-600">ğŸ“‹ å¯©æŸ»ãƒ•ãƒ­ãƒ¼</p>
                  <p className="text-xs text-slate-400">ğŸ’¡ å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ãƒ­ãƒ¼ã‚’é€²è¡Œ</p>
                </div>
                <div className="space-y-2 mb-4">
                  {review.timeline.map((step, si) => (
                    <div key={si} className={`flex items-center gap-3 p-2 rounded-lg border ${
                      step.status === "done" ? "bg-emerald-50 border-emerald-200" :
                      step.status === "active" ? "bg-blue-50 border-blue-300 shadow-sm" :
                      "bg-slate-50 border-slate-200"
                    }`}>
                      {/* Step indicator */}
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 ${
                        step.status === "done" ? "bg-emerald-500 text-white" :
                        step.status === "active" ? "bg-blue-500 text-white ring-2 ring-blue-300 ring-offset-1" :
                        "bg-slate-200 text-slate-400"
                      }`}>
                        {step.status === "done" ? "âœ“" : si + 1}
                      </div>

                      {/* Step info */}
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <p className={`text-xs font-semibold ${step.status === "done" ? "text-emerald-700" : step.status === "active" ? "text-blue-700" : "text-slate-400"}`}>{step.step}</p>
                          {step.status === "done" && <span className="text-xs text-emerald-500">{step.date}</span>}
                          {step.status === "active" && <Badge text="ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—" color="blue" />}
                        </div>
                        {step.note && <p className="text-xs text-slate-400 mt-0.5">{step.note}</p>}
                      </div>

                      {/* Action buttons per step */}
                      <div className="flex gap-1 flex-shrink-0">
                        {/* Step 1: å¯©æŸ»ç”³è«‹ */}
                        {si === 0 && step.status === "active" && (
                          <button onClick={() => setConfirmDialog({
                            type: "advance", title: "å¯©æŸ»ç”³è«‹ã‚’å®Ÿè¡Œ", description: "æ¥ç¶šå…ˆã«å¯¾ã—ã¦å¯©æŸ»ç”³è«‹ã‚’é€ä¿¡ã—ã¾ã™ã€‚ç”³è¾¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¯©æŸ»ç”³è«‹æ›¸ã‚’è‡ªå‹•ç”Ÿæˆã—ã€å¿…è¦æ›¸é¡ã¨åˆã‚ã›ã¦é€ä»˜æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚",
                            merchantName: review.merchantName, processorName: review.processorName, currentStep: "å¯©æŸ»ç”³è«‹", nextStep: "æ›¸é¡é€ä»˜",
                            impacts: ["å¯©æŸ»ç”³è«‹æ›¸ï¼ˆPDFï¼‰ã‚’è‡ªå‹•ç”Ÿæˆ", "å¯©æŸ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ reviewing ã«å¤‰æ›´", "æ¥ç¶šå…ˆã®å¯©æŸ»éƒ¨é–€ã«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚‹"],
                            confirmLabel: "å¯©æŸ»ç”³è«‹ã‚’å®Ÿè¡Œ"
                          })} className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700 shadow-sm">â–¶ å¯©æŸ»ç”³è«‹ã‚’å®Ÿè¡Œ</button>
                        )}

                        {/* Step 2: æ›¸é¡é€ä»˜ */}
                        {si === 1 && step.status === "active" && (
                          <button onClick={() => setConfirmDialog({
                            type: "send_docs", title: "æ›¸é¡ã‚’æ¥ç¶šå…ˆã«é€ä»˜", description: "æº–å‚™æ¸ˆã¿ã®å¯©æŸ»è³‡æ–™ã‚’æ¥ç¶šå…ˆã®å¯©æŸ»éƒ¨é–€ã«é€ä»˜ã—ã¾ã™ã€‚é€ä»˜å‰ã«æ›¸é¡ã®å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
                            merchantName: review.merchantName, processorName: review.processorName, currentStep: "æ›¸é¡é€ä»˜", nextStep: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­",
                            impacts: ["å…¨æ›¸é¡ãŒæ¥ç¶šå…ˆå¯©æŸ»éƒ¨é–€ã«é€ä»˜ã•ã‚Œã‚‹", "é€ä»˜æ—¥æ™‚ãŒè¨˜éŒ²ã•ã‚Œã‚‹", "æ¥ç¶šå…ˆå´ã®å¯©æŸ»ãƒ—ãƒ­ã‚»ã‚¹ãŒé–‹å§‹ã•ã‚Œã‚‹"],
                            confirmLabel: "ğŸ“¤ æ›¸é¡ã‚’é€ä»˜ã™ã‚‹"
                          })} className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700 shadow-sm">ğŸ“¤ æ›¸é¡ã‚’é€ä»˜</button>
                        )}

                        {/* Step 3: æ¥ç¶šå…ˆå¯©æŸ»ä¸­ â†’ å¯©æŸ»çµæœã‚’è¨˜éŒ² */}
                        {si === 2 && step.status === "active" && (
                          <>
                            <button onClick={() => setConfirmDialog({
                              type: "advance", title: "ä¸€æ¬¡å¯©æŸ»é€šéã‚’è¨˜éŒ²", description: "æ¥ç¶šå…ˆã‹ã‚‰ä¸€æ¬¡å¯©æŸ»é€šéã®é€£çµ¡ã‚’å—ã‘ãŸå ´åˆã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚ã¾ã™ã€‚è¿½åŠ æ›¸é¡ã®è¦æ±‚ãŒã‚ã‚‹å ´åˆã¯ã€Œè¿½åŠ æ›¸é¡è¦æ±‚ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­", nextStep: "è¿½åŠ æ›¸é¡å¯¾å¿œ or å¯©æŸ»å®Œäº†",
                              impacts: ["å¯©æŸ»é€²æ—ãŒæ›´æ–°ã•ã‚Œã‚‹", "ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸Šã®æ—¥æ™‚ãŒè¨˜éŒ²ã•ã‚Œã‚‹"],
                              confirmLabel: "âœ“ ä¸€æ¬¡å¯©æŸ»é€šéã‚’è¨˜éŒ²"
                            })} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700 shadow-sm">âœ“ å¯©æŸ»é€šé</button>
                            <button onClick={() => setConfirmDialog({
                              type: "request_docs", title: "è¿½åŠ æ›¸é¡è¦æ±‚ã‚’ç™»éŒ²", description: "æ¥ç¶šå…ˆã‹ã‚‰è¿½åŠ æ›¸é¡ã®æå‡ºã‚’æ±‚ã‚ã‚‰ã‚ŒãŸå ´åˆã«ç™»éŒ²ã—ã¾ã™ã€‚è¦æ±‚ã•ã‚ŒãŸæ›¸é¡ã¨æœŸé™ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­", nextStep: "è¿½åŠ æ›¸é¡å¯¾å¿œ",
                              impacts: ["è¿½åŠ æ›¸é¡è¦æ±‚ãŒã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²ã•ã‚Œã‚‹", "å¯¾å¿œæœŸé™ãŒè¨­å®šã•ã‚Œã‚‹", "æ‹…å½“è€…ã«ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚‹"],
                              confirmLabel: "ğŸ“© è¿½åŠ è¦æ±‚ã‚’ç™»éŒ²"
                            })} className="px-3 py-1.5 bg-amber-500 text-white rounded text-xs font-semibold hover:bg-amber-600 shadow-sm">ğŸ“© è¿½åŠ æ›¸é¡è¦æ±‚</button>
                            <button onClick={() => setConfirmDialog({
                              type: "reject", title: "å¯©æŸ»å´ä¸‹ã‚’è¨˜éŒ²", description: "æ¥ç¶šå…ˆã‹ã‚‰å¯©æŸ»å´ä¸‹ã®é€šçŸ¥ã‚’å—ã‘ãŸå ´åˆã«è¨˜éŒ²ã—ã¾ã™ã€‚å´ä¸‹ç†ç”±ã®å…¥åŠ›ãŒå¿…è¦ã§ã™ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "æ¥ç¶šå…ˆå¯©æŸ»ä¸­", nextStep: "â€”ï¼ˆå¯©æŸ»çµ‚äº†ï¼‰",
                              impacts: ["å¯©æŸ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ rejected ã«å¤‰æ›´", "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¯¾è±¡ã‹ã‚‰é™¤å¤–", "åŠ ç›Ÿåº—ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚‹"],
                              confirmLabel: "âŒ å´ä¸‹ã‚’è¨˜éŒ²"
                            })} className="px-2 py-1.5 bg-white text-rose-600 border border-rose-300 rounded text-xs font-semibold hover:bg-rose-50">âœ• å´ä¸‹</button>
                          </>
                        )}

                        {/* Step 4: è¿½åŠ æ›¸é¡å¯¾å¿œ */}
                        {si === 3 && step.status === "active" && (
                          <>
                            <button onClick={() => setConfirmDialog({
                              type: "send_docs", title: "è¿½åŠ æ›¸é¡ã‚’é€ä»˜", description: "è¿½åŠ ã§è¦æ±‚ã•ã‚ŒãŸæ›¸é¡ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»é€ä»˜ã—ã¾ã™ã€‚å…¨ã¦ã®è¦æ±‚æ›¸é¡ãŒæƒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "è¿½åŠ æ›¸é¡å¯¾å¿œ", nextStep: "æ¥ç¶šå…ˆã§å†å¯©æŸ»",
                              impacts: ["è¿½åŠ æ›¸é¡ãŒæ¥ç¶šå…ˆã«é€ä»˜ã•ã‚Œã‚‹", "è¿½åŠ è¦æ±‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ completed ã«å¤‰æ›´", "æ¥ç¶šå…ˆå´ã®å†å¯©æŸ»ãŒé–‹å§‹ã•ã‚Œã‚‹"],
                              confirmLabel: "ğŸ“¤ è¿½åŠ æ›¸é¡ã‚’é€ä»˜"
                            })} className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700 shadow-sm">ğŸ“¤ è¿½åŠ æ›¸é¡ã‚’é€ä»˜</button>
                            <button onClick={() => setConfirmDialog({
                              type: "advance", title: "è¿½åŠ å¯©æŸ»ã®çµæœã‚’è¨˜éŒ²", description: "è¿½åŠ æ›¸é¡é€ä»˜å¾Œã€æ¥ç¶šå…ˆã‹ã‚‰ã®å¯©æŸ»çµæœã‚’è¨˜éŒ²ã—ã¾ã™ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "è¿½åŠ æ›¸é¡å¯¾å¿œ", nextStep: "å¯©æŸ»å®Œäº†",
                              impacts: ["å¯©æŸ»ãƒ•ãƒ­ãƒ¼ãŒæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€"],
                              confirmLabel: "âœ“ çµæœã‚’è¨˜éŒ²"
                            })} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700 shadow-sm">âœ“ å¯©æŸ»é€šé</button>
                          </>
                        )}

                        {/* Step 5: æ¡ä»¶ç¢ºå®š */}
                        {si === 4 && step.status === "active" && (
                          <>
                            <button onClick={() => setConfirmDialog({
                              type: "conditions", title: "æ¥ç¶šå…ˆã®æ¡ä»¶ã‚’ç™»éŒ²", description: "æ¥ç¶šå…ˆã‹ã‚‰æç¤ºã•ã‚ŒãŸå–å¼•æ¡ä»¶ã‚’ç™»éŒ²ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ¡ä»¶ã¯å¥‘ç´„æ›¸ã«åæ˜ ã•ã‚Œã¾ã™ã€‚æ¥ç¶šå…ˆã”ã¨ã«æ¡ä»¶ãŒç•°ãªã‚‹ãŸã‚ã€æç¤ºã•ã‚ŒãŸå†…å®¹ã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "æ¡ä»¶ç¢ºå®š", nextStep: "å¥‘ç´„æ›¸é€ä»˜",
                              impacts: ["å…¥åŠ›ã—ãŸæ¡ä»¶ãŒå¥‘ç´„æ›¸ã«è‡ªå‹•åæ˜ ã•ã‚Œã‚‹", "æ‰‹æ•°æ–™ç‡ãŒãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ã‚³ã‚¹ãƒˆæœ€é©åŒ–è¨ˆç®—ã«ä½¿ç”¨ã•ã‚Œã‚‹", "å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«ãŒç²¾ç®—ã‚¨ãƒ³ã‚¸ãƒ³ã«ç™»éŒ²ã•ã‚Œã‚‹"],
                              confirmLabel: "ğŸ“‹ æ¡ä»¶ã‚’ç¢ºå®šãƒ»ç™»éŒ²"
                            })} className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700 shadow-sm">ğŸ“‹ æ¡ä»¶ã‚’ç™»éŒ²</button>
                          </>
                        )}

                        {/* Step 6: å¥‘ç´„æ›¸é€ä»˜ */}
                        {si === 5 && step.status === "active" && (
                          <>
                            <button onClick={() => setConfirmDialog({
                              type: "advance", title: "å¥‘ç´„æ›¸ã‚’ç”Ÿæˆãƒ»é€ä»˜", description: "æ¥ç¶šå…ˆã®æ¡ä»¶ï¼ˆæ‰‹æ•°æ–™ç‡ãƒ»å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«ç­‰ï¼‰ã‚’åæ˜ ã—ãŸå¥‘ç´„æ›¸ã‚’ç”Ÿæˆã—ã€åŠ ç›Ÿåº—ã«é€ä»˜ã—ã¾ã™ã€‚åŠ ç›Ÿåº—ã®ç½²åã‚’å¾…ã¡ã¾ã™ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "å¥‘ç´„æ›¸é€ä»˜", nextStep: "åŠ ç›Ÿåº—ç½²åå¾…ã¡ â†’ æ±ºæ¸ˆé–‹å§‹",
                              impacts: ["æ¡ä»¶ã‚’åæ˜ ã—ãŸå¥‘ç´„æ›¸PDFãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹", "åŠ ç›Ÿåº—ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ + é›»å­ç½²åãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹", "åŠ ç›Ÿåº—ã®ç½²åå®Œäº†å¾Œã€æ±ºæ¸ˆé–‹å§‹ã‚¹ãƒ†ãƒƒãƒ—ã«é€²è¡Œå¯èƒ½"],
                              confirmLabel: "ğŸ“„ å¥‘ç´„æ›¸ã‚’ç”Ÿæˆãƒ»é€ä»˜"
                            })} className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700 shadow-sm">ğŸ“„ å¥‘ç´„æ›¸ã‚’ç”Ÿæˆãƒ»é€ä»˜</button>
                            <button className="px-2 py-1.5 bg-white text-slate-600 border rounded text-xs hover:bg-slate-100">ğŸ‘ å¥‘ç´„æ›¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                          </>
                        )}

                        {/* Step 7: æ±ºæ¸ˆé–‹å§‹ï¼ˆæœ€çµ‚æœ‰åŠ¹åŒ–ï¼‰ */}
                        {si === 6 && step.status === "active" && (
                          <>
                            <button onClick={() => setConfirmDialog({
                              type: "approve", title: "ğŸ‰ æ±ºæ¸ˆé–‹å§‹ â€” æ¥ç¶šå…ˆã‚’æœ‰åŠ¹åŒ–", description: "åŠ ç›Ÿåº—ãŒå¥‘ç´„æ›¸ã«ç½²åæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ã“ã®æ¥ç¶šå…ˆã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚æœ‰åŠ¹åŒ–å¾Œã€æ±ºæ¸ˆãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒã“ã®æ¥ç¶šå…ˆã«ã‚‚ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "æ±ºæ¸ˆé–‹å§‹", nextStep: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æœ‰åŠ¹åŒ–",
                              impacts: [
                                "merchant_processors ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ approved ã«å¤‰æ›´",
                                "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³ã®æ¥ç¶šå…ˆå€™è£œã«è¿½åŠ ã•ã‚Œã‚‹",
                                "æ‰¿èªæ¸ˆã¿æ¥ç¶šå…ˆãŒ2ç¤¾ä»¥ä¸Šã«ãªã‚‹å ´åˆã€AIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒè‡ªå‹•æœ‰åŠ¹åŒ–",
                                "åŠ ç›Ÿåº—ã«æ±ºæ¸ˆé–‹å§‹ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚‹",
                                "ç¢ºå®šã—ãŸæ‰‹æ•°æ–™ç‡ãŒã‚³ã‚¹ãƒˆæœ€é©åŒ–ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«åæ˜ ã•ã‚Œã‚‹",
                                "å¯©æŸ»æ›¸é¡ãƒ»å¥‘ç´„æ›¸ãŒå®Œäº†å±¥æ­´ã«ç§»å‹•"
                              ],
                              confirmLabel: "ğŸ‰ æ±ºæ¸ˆé–‹å§‹ãƒ»æ¥ç¶šå…ˆã‚’æœ‰åŠ¹åŒ–"
                            })} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-bold hover:bg-emerald-700 shadow-sm ring-2 ring-emerald-300 ring-offset-1">ğŸ‰ æ±ºæ¸ˆé–‹å§‹ãƒ»æœ‰åŠ¹åŒ–</button>
                            <button onClick={() => setConfirmDialog({
                              type: "reject", title: "å¥‘ç´„ä¸æˆç«‹", description: "æ¡ä»¶ãŒæŠ˜ã‚Šåˆã‚ãªã„ç­‰ã®ç†ç”±ã§å¥‘ç´„ä¸æˆç«‹ã¨ã—ã¾ã™ã€‚",
                              merchantName: review.merchantName, processorName: review.processorName, currentStep: "æ±ºæ¸ˆé–‹å§‹", nextStep: "â€”ï¼ˆå¯©æŸ»çµ‚äº†ï¼‰",
                              impacts: ["å¯©æŸ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ rejected ã«å¤‰æ›´", "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¯¾è±¡ã‹ã‚‰é™¤å¤–", "åŠ ç›Ÿåº—ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚‹"],
                              confirmLabel: "âŒ å¥‘ç´„ä¸æˆç«‹"
                            })} className="px-2 py-1.5 bg-white text-rose-600 border border-rose-300 rounded text-xs font-semibold hover:bg-rose-50">âœ• å¥‘ç´„ä¸æˆç«‹</button>
                          </>
                        )}

                        {/* Done steps: å®Œäº†ãƒ©ãƒ™ãƒ« */}
                        {step.status === "done" && (
                          <span className="text-xs text-emerald-500 px-2 py-1">å®Œäº† {step.date}</span>
                        )}
                        {/* Pending steps: ã¾ã åˆ°é”ã—ã¦ã„ãªã„ */}
                        {step.status === "pending" && (
                          <span className="text-xs text-slate-300 px-2 py-1">æœªåˆ°é”</span>
                        )}
                      </div>
                    </div>
                  ))}
                </div>

                {/* Additional document requests */}
                {review.additionalRequests.length > 0 && (
                  <div className="bg-amber-50 rounded border border-amber-200 p-2 mb-3">
                    <p className="text-xs font-bold text-amber-800 mb-1">ğŸ“© æ¥ç¶šå…ˆã‹ã‚‰ã®è¿½åŠ æ›¸é¡è¦æ±‚</p>
                    {review.additionalRequests.map((req, qi) => (
                      <div key={qi} className="text-xs">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="text-slate-500">{req.date}</span>
                          <span className="text-slate-600">{req.from}</span>
                          <Badge text={`æœŸé™: ${req.deadline}`} color="red" />
                          <Badge text={req.status} color="yellow" />
                        </div>
                        <ul className="ml-4 space-y-0.5">
                          {req.items.map((item, ii) => (
                            <li key={ii} className="text-amber-700 flex items-center gap-1">
                              <span>ğŸ“</span> {item}
                              <button className="ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
                            </li>
                          ))}
                        </ul>
                      </div>
                    ))}
                  </div>
                )}

                {/* Documents */}
                <p className="text-xs font-bold text-slate-600 mb-1">ğŸ“„ å¯©æŸ»è³‡æ–™ä¸€è¦§</p>
                <div className="bg-slate-50 rounded-lg border border-slate-200">
                  <div className="flex bg-slate-100 border-b text-xs font-semibold text-slate-500 px-3 py-1">
                    <div className="w-48">æ›¸é¡å</div><div className="w-24">ç¨®åˆ¥</div><div className="w-16">å½¢å¼</div><div className="w-16">ã‚µã‚¤ã‚º</div><div className="w-20">é€ä»˜æ—¥</div><div className="w-20">çŠ¶æ…‹</div><div className="flex-1">æ“ä½œ</div>
                  </div>
                  {review.documents.map((doc, di) => (
                    <div key={di} className={`flex items-center px-3 py-1 text-xs border-b last:border-0 ${doc.status === "waiting" ? "bg-amber-50" : ""}`}>
                      <div className="w-48 text-slate-700 flex items-center gap-1">
                        {doc.auto && <span className="text-blue-500" title="ç”³è¾¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•ç”Ÿæˆ">ğŸ¤–</span>}
                        {doc.name}
                      </div>
                      <div className="w-24"><Badge text={doc.type} color={doc.auto ? "blue" : doc.type === "è¿½åŠ è¦æ±‚" ? "yellow" : "gray"} /></div>
                      <div className="w-16 text-slate-400">{doc.format}</div>
                      <div className="w-16 text-slate-400">{doc.size}</div>
                      <div className="w-20 text-slate-400">{doc.date}</div>
                      <div className="w-20">
                        <Badge text={doc.status === "sent" ? "é€ä»˜æ¸ˆ" : "æœªæå‡º"} color={doc.status === "sent" ? "green" : "yellow"} />
                      </div>
                      <div className="flex-1 flex gap-1">
                        {doc.status === "sent" && <button className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">â¬‡ DL</button>}
                        {doc.status === "sent" && <button className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">ğŸ‘ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>}
                        {doc.status === "waiting" && <button className="px-2 py-0.5 bg-blue-500 text-white rounded text-xs">ğŸ“ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>}
                      </div>
                    </div>
                  ))}
                </div>
                <div className="flex gap-2 mt-2 justify-end">
                  <button className="px-3 py-1 bg-slate-100 text-slate-600 rounded text-xs border">ğŸ“¦ å…¨æ›¸é¡ã‚’ä¸€æ‹¬DLï¼ˆZIPï¼‰</button>
                  <button className="px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs border border-blue-200">ğŸ“¤ æ¥ç¶šå…ˆå‘ã‘å¯©æŸ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç”Ÿæˆ</button>
                </div>
              </div>
            </div>
          ))}

          {/* å¯©æŸ»ãƒ•ãƒ­ãƒ¼æ“ä½œãƒ­ã‚° */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“ æ“ä½œãƒ­ã‚°ï¼ˆç›´è¿‘ã®å¯©æŸ»ãƒ•ãƒ­ãƒ¼æ“ä½œï¼‰</p>
            <div className="space-y-1">
              {[
                { time: "02/11 10:32", user: "admin@aipaymentsys.com", action: "æ›¸é¡é€ä»˜", target: "XYZã‚·ãƒ§ãƒƒãƒ— â†’ Univa Pay cast", detail: "å¯©æŸ»è³‡æ–™6ä»¶ã‚’é€ä»˜" },
                { time: "02/06 14:15", user: "admin@aipaymentsys.com", action: "è¿½åŠ æ›¸é¡è¦æ±‚ã‚’ç™»éŒ²", target: "ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹ â†’ Asiabill", detail: "æ—…è¡Œæ¥­ç™»éŒ²è¨¼ã€CBå®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆ" },
                { time: "02/05 09:40", user: "reviewer01@aipaymentsys.com", action: "ä¸€æ¬¡å¯©æŸ»é€šéã‚’è¨˜éŒ²", target: "ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹ â†’ Asiabill", detail: "" },
                { time: "01/28 11:20", user: "admin@aipaymentsys.com", action: "å¯©æŸ»ç”³è«‹ã‚’å®Ÿè¡Œ", target: "XYZã‚·ãƒ§ãƒƒãƒ— â†’ Univa Pay cast", detail: "ç”³è«‹æ›¸ã‚’è‡ªå‹•ç”Ÿæˆ" },
                { time: "01/15 09:05", user: "admin@aipaymentsys.com", action: "å¯©æŸ»ç”³è«‹ã‚’å®Ÿè¡Œ", target: "ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹ â†’ Asiabill", detail: "æ‰‹å‹•ç”³è«‹" },
              ].map((log, i) => (
                <div key={i} className="flex items-center gap-3 text-xs py-1 border-b last:border-0">
                  <span className="w-24 text-slate-400 font-mono">{log.time}</span>
                  <span className="w-44 text-slate-500">{log.user}</span>
                  <Badge text={log.action} color={log.action.includes("å´ä¸‹") ? "red" : log.action.includes("é€šé") || log.action.includes("å®Œäº†") ? "green" : "blue"} />
                  <span className="flex-1 text-slate-600">{log.target}</span>
                  <span className="text-slate-400">{log.detail}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* â•â•â• Tab: å¯©æŸ»å®Œäº†å±¥æ­´ â•â•â• */}
      {activeTab === "history" && (
        <div className="space-y-3">
          <div className="flex gap-3">
            <KPICard label="å¯©æŸ»é€šéï¼ˆç´¯è¨ˆï¼‰" value="12ä»¶" sub="å…¨æ¥ç¶šå…ˆåˆè¨ˆ" color="green" />
            <KPICard label="å¯©æŸ»å´ä¸‹ï¼ˆç´¯è¨ˆï¼‰" value="1ä»¶" sub="" color="red" />
            <KPICard label="å¹³å‡å¯©æŸ»æ—¥æ•°" value="12æ—¥" sub="å´ä¸‹é™¤ã" />
            <KPICard label="æœ€çŸ­å¯©æŸ»" value="4æ—¥" sub="Simpletransact" color="green" />
          </div>

          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "åŠ ç›Ÿåº—å", w: "flex-1" }, { label: "å¯©æŸ»ç¨®åˆ¥", w: "w-24" }, { label: "æ¥ç¶šå…ˆ", w: "w-32" }, { label: "æ‰¿èªæ—¥", w: "w-28" }, { label: "å¯©æŸ»æ—¥æ•°", w: "w-20" }, { label: "æå‡ºæ›¸é¡", w: "w-20" }, { label: "çµæœ", w: "w-20" }, { label: "æ›¸é¡", w: "w-20" }]}>
            {approvedHistory.map((h, i) => (
              <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
                <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">
                  {h.merchantName}
                  {h.reviewType === "site_add" && h.siteName && <span className="text-[10px] text-teal-500 ml-1">({h.siteName})</span>}
                </td>
                <td className="px-4 py-2 whitespace-nowrap w-24"><Badge text={h.reviewType === "site_add" ? "ã‚µã‚¤ãƒˆè¿½åŠ " : "åˆå›æ³•äºº"} color={h.reviewType === "site_add" ? "teal" : "purple"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-600">{h.processorName}</td>
                <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-500">{h.approvedAt}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20 text-center"><Badge text={`${h.reviewDays}æ—¥`} color={h.reviewDays <= 7 ? "green" : h.reviewDays <= 14 ? "blue" : "yellow"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-20 text-center text-slate-500">{h.docs}ä»¶</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text="âœ… æ‰¿èª" color="green" /></td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><button className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">ğŸ“„ DL</button></td>
              </tr>
            ))}
            </TableHeader>
          </div>

          {/* AI insight */}
          <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200 p-3">
            <p className="text-xs font-bold text-blue-700 mb-1">ğŸ¤– AIåˆ†æ: å¯©æŸ»å‚¾å‘</p>
            <div className="grid grid-cols-3 gap-3 text-xs text-slate-600">
              <div>Simpletransactã¯å¯©æŸ»ãŒæœ€é€Ÿï¼ˆå¹³å‡7æ—¥ï¼‰ã§ã€ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼çµŒç”±ã®ãŸã‚å¯©æŸ»åŸºæº–ãŒæ¯”è¼ƒçš„ç·©ã‚„ã‹ã€‚æ–°è¦åŠ ç›Ÿåº—ã®åˆæœŸæ¥ç¶šå…ˆã¨ã—ã¦æœ€é©ã€‚</div>
              <div>ã‚¢ã‚¯ãƒ¯ã‚¤ã‚¢ãƒ©ãƒ¼ç›´æ¥æ¥ç¶šï¼ˆTCMS/ONTHELINE/Asiabillï¼‰ã¯å¯©æŸ»ãŒå³æ ¼ï¼ˆ18ã€œ25æ—¥ï¼‰ã€‚å–å¼•å®Ÿç¸¾ãŒååˆ†ã«è“„ç©ã•ã‚ŒãŸåŠ ç›Ÿåº—ã«æ¨è–¦ã€‚</div>
              <div>è¿½åŠ æ›¸é¡è¦æ±‚ã¯ç›´æ¥æ¥ç¶šã®å¯©æŸ»ã§45%ã®ç¢ºç‡ã§ç™ºç”Ÿã€‚äº‹å‰ã«æ¥­ç•Œå›ºæœ‰ã®è¨±èªå¯è¨¼ã‚’æº–å‚™ã—ã¦ãŠãã¨å¯©æŸ»æœŸé–“ã‚’çŸ­ç¸®ã§ãã¾ã™ã€‚</div>
            </div>
          </div>
        </div>
      )}

      {/* â•â•â• Tab: å¯©æŸ»è³‡æ–™ç®¡ç† â•â•â• */}
      {activeTab === "documents" && (
        <div className="space-y-3">
          {/* Storage Architecture */}
          <div className="bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg border p-3">
            <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“ å¯©æŸ»è³‡æ–™ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹æˆ</p>
            <div className="flex gap-4 text-xs">
              <div className="flex-1 bg-white rounded-lg border border-slate-200 p-2.5">
                <p className="font-semibold text-blue-600 mb-1">â˜ï¸ S3ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«æœ¬ä½“ï¼‰</p>
                <p className="text-slate-500">s3://aipayment-documents-prod/</p>
                <p className="text-slate-400 mt-1">AES-256æš—å·åŒ– / ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹ / ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«: 7å¹´ä¿ç®¡</p>
              </div>
              <div className="text-slate-300 flex items-center">âŸ·</div>
              <div className="flex-1 bg-white rounded-lg border border-slate-200 p-2.5">
                <p className="font-semibold text-emerald-600 mb-1">ğŸ—„ï¸ RDSï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰</p>
                <p className="text-slate-500">review_documents ãƒ†ãƒ¼ãƒ–ãƒ«</p>
                <p className="text-slate-400 mt-1">ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ / ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚ / é€ä»˜æ—¥æ™‚ / ç¨®åˆ¥</p>
              </div>
            </div>
          </div>

          {/* Document type templates */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex justify-between items-center mb-2">
              <p className="text-xs font-bold text-slate-700">ğŸ“‹ å¯©æŸ»æ›¸é¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ¥ç¶šå…ˆã¸ã®é€ä»˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰</p>
              <button className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded border border-blue-200">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†</button>
            </div>
            <div className="space-y-1.5">
              {[
                { name: "åŠ ç›Ÿåº—å¯©æŸ»ç”³è«‹æ›¸", source: "è‡ªå‹•ç”Ÿæˆ", desc: "ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰PDFã‚’è‡ªå‹•ç”Ÿæˆï¼ˆæ³•äººåãƒ»ä»£è¡¨è€…ãƒ»æ¥­ç¨®ãƒ»æœˆé–“å£²ä¸Šç­‰ï¼‰", required: true, auto: true },
                { name: "ç™»è¨˜ç°¿è¬„æœ¬", source: "ç”³è¾¼æ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", desc: "åŠ ç›Ÿåº—ãŒç”³è¾¼Step4ã§æå‡ºã—ãŸæ›¸é¡ã‚’ãã®ã¾ã¾è»¢é€", required: true, auto: false },
                { name: "ä»£è¡¨è€…æœ¬äººç¢ºèªæ›¸é¡", source: "ç”³è¾¼æ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", desc: "é‹è»¢å…è¨±è¨¼ / ãƒ‘ã‚¹ãƒãƒ¼ãƒˆ / ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰", required: true, auto: false },
                { name: "ç›´è¿‘2æœŸåˆ†æ±ºç®—æ›¸", source: "ç”³è¾¼æ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", desc: "è²¡å‹™è«¸è¡¨ãƒ»æç›Šè¨ˆç®—æ›¸", required: true, auto: false },
                { name: "ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ", source: "è‡ªå‹•ç”Ÿæˆ", desc: "URLå·¡å›ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸã‚µã‚¤ãƒˆç”»åƒ", required: true, auto: true },
                { name: "ç‰¹å®šå•†å–å¼•æ³•è¡¨è¨˜", source: "ç”³è¾¼æ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", desc: "ç‰¹å•†æ³•ã«åŸºã¥ãè¡¨è¨˜ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ", required: true, auto: false },
                { name: "å¤ç‰©å•†è¨±å¯è¨¼", source: "ç”³è¾¼æ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰", desc: "ä¸­å¤å“è²©å£²ã®å ´åˆã®ã¿å¿…è¦", required: false, auto: false },
              ].map((t, i) => (
                <div key={i} className="flex items-center gap-2 p-2 rounded border text-xs hover:bg-slate-50">
                  <span className={`w-5 text-center ${t.auto ? "text-blue-500" : "text-slate-400"}`}>{t.auto ? "ğŸ¤–" : "ğŸ“"}</span>
                  <div className="w-40 font-semibold text-slate-700">{t.name}</div>
                  <Badge text={t.source} color={t.auto ? "blue" : "gray"} />
                  <span className="flex-1 text-slate-400">{t.desc}</span>
                  <span className={t.required ? "text-rose-500" : "text-slate-300"}>{t.required ? "å¿…é ˆ" : "ä»»æ„"}</span>
                </div>
              ))}
            </div>
          </div>

          {/* Data model reference */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold text-slate-700 mb-2">ğŸ—„ï¸ review_documents ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©</p>
            <div className="bg-slate-50 rounded-lg border border-slate-200">
              <div className="flex bg-slate-100 border-b text-xs font-semibold text-slate-500 px-3 py-1">
                <div className="w-36">ã‚«ãƒ©ãƒ </div><div className="w-28">å‹</div><div className="w-12">å¿…é ˆ</div><div className="flex-1">èª¬æ˜</div>
              </div>
              {[
                ["id", "UUID", "âœ…", "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDï¼ˆPKï¼‰"],
                ["merchant_id", "UUID", "âœ…", "åŠ ç›Ÿåº—IDï¼ˆFK â†’ merchantsï¼‰"],
                ["processor_id", "UUID", "âœ…", "æ¥ç¶šå…ˆIDï¼ˆFK â†’ processorsï¼‰"],
                ["document_type", "ENUM", "âœ…", "application_form / registration / id_doc / financial / screenshot / stl / license / additional"],
                ["file_path", "TEXT", "âœ…", "S3ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆs3://bucket/merchant_id/processor_id/filenameï¼‰"],
                ["file_name", "TEXT", "âœ…", "ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å"],
                ["file_size", "INTEGER", "âœ…", "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆbytesï¼‰"],
                ["mime_type", "TEXT", "âœ…", "application/pdf, image/jpeg ç­‰"],
                ["source", "ENUM", "âœ…", "auto_generated / merchant_upload / additional_request"],
                ["status", "ENUM", "âœ…", "draft / ready / sent / received / verified"],
                ["uploaded_at", "TIMESTAMP", "âœ…", "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚"],
                ["sent_at", "TIMESTAMP", "", "æ¥ç¶šå…ˆã¸ã®é€ä»˜æ—¥æ™‚"],
                ["request_id", "UUID", "", "è¿½åŠ è¦æ±‚IDï¼ˆè¿½åŠ æ›¸é¡ã®å ´åˆã®ã¿ FK â†’ additional_requestsï¼‰"],
              ].map((row, i) => (
                <div key={i} className={`flex items-center px-3 py-1 text-xs border-b last:border-0 ${i % 2 ? "bg-slate-50" : ""}`}>
                  <div className="w-36 font-mono text-blue-600">{row[0]}</div>
                  <div className="w-28 text-slate-500">{row[1]}</div>
                  <div className="w-12">{row[2]}</div>
                  <div className="flex-1 text-slate-600">{row[3]}</div>
                </div>
              ))}
            </div>
          </div>

          {/* additional_requests table */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold text-slate-700 mb-2">ğŸ—„ï¸ additional_requests ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©</p>
            <div className="bg-slate-50 rounded-lg border border-slate-200">
              <div className="flex bg-slate-100 border-b text-xs font-semibold text-slate-500 px-3 py-1">
                <div className="w-36">ã‚«ãƒ©ãƒ </div><div className="w-28">å‹</div><div className="w-12">å¿…é ˆ</div><div className="flex-1">èª¬æ˜</div>
              </div>
              {[
                ["id", "UUID", "âœ…", "è¿½åŠ è¦æ±‚IDï¼ˆPKï¼‰"],
                ["merchant_processor_id", "UUID", "âœ…", "åŠ ç›Ÿåº—Ã—æ¥ç¶šå…ˆã®çµ„åˆã›IDï¼ˆFK â†’ merchant_processorsï¼‰"],
                ["requested_by", "TEXT", "âœ…", "è¦æ±‚å…ƒï¼ˆæ¥ç¶šå…ˆã®å¯©æŸ»éƒ¨é–€åç­‰ï¼‰"],
                ["requested_at", "TIMESTAMP", "âœ…", "è¦æ±‚æ—¥æ™‚"],
                ["deadline", "DATE", "", "å¯¾å¿œæœŸé™"],
                ["items", "JSONB", "âœ…", "è¦æ±‚ã•ã‚ŒãŸæ›¸é¡ãƒªã‚¹ãƒˆï¼ˆé…åˆ—ï¼‰"],
                ["status", "ENUM", "âœ…", "open / partially_submitted / completed / expired"],
                ["completed_at", "TIMESTAMP", "", "å…¨æ›¸é¡æå‡ºå®Œäº†æ—¥æ™‚"],
              ].map((row, i) => (
                <div key={i} className={`flex items-center px-3 py-1 text-xs border-b last:border-0 ${i % 2 ? "bg-slate-50" : ""}`}>
                  <div className="w-36 font-mono text-blue-600">{row[0]}</div>
                  <div className="w-28 text-slate-500">{row[1]}</div>
                  <div className="w-12">{row[2]}</div>
                  <div className="flex-1 text-slate-600">{row[3]}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: æ¥ç¶šå…ˆè¿½åŠ  â”€â”€ */}
      {showAddProc && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowAddProc(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[520px] max-h-[85vh] overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">æ¥ç¶šå…ˆã‚’è¿½åŠ </h3>
              <button onClick={() => setShowAddProc(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div><label className="text-xs font-semibold text-slate-600">æ¥ç¶šå…ˆå <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: Univa Pay cast" /></div>
              <div><label className="text-xs font-semibold text-slate-600">æ¥ç¶šç¨®åˆ¥ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ã‚¢ã‚¯ãƒ¯ã‚¤ã‚¢ãƒ©</option><option>PSPï¼ˆæ±ºæ¸ˆä»£è¡Œï¼‰</option><option>ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ</option></select></div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">å¯¾å¿œãƒ–ãƒ©ãƒ³ãƒ‰ <span className="text-rose-500">*</span></label>
                  <div className="flex flex-wrap gap-2 mt-1">{["VISA","Mastercard","JCB","AMEX","Diners"].map((b,i) => <label key={i} className="flex items-center gap-1 text-xs"><input type="checkbox" defaultChecked={i<3} />{b}</label>)}</div>
                </div>
                <div><label className="text-xs font-semibold text-slate-600">é€šè²¨ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>JPY</option><option>USD</option><option>EUR</option></select></div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">API Base URL <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="https://api.example.com/v1" /></div>
                <div><label className="text-xs font-semibold text-slate-600">APIèªè¨¼æ–¹å¼</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>Bearer Token</option><option>Basic Auth</option><option>HMACç½²å</option></select></div>
              </div>
              <div><label className="text-xs font-semibold text-slate-600">æ‹…å½“è€…ãƒ¡ãƒ¼ãƒ«</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="contact@processor.jp" /></div>
              <div><label className="text-xs font-semibold text-slate-600">å‚™è€ƒ</label><textarea className="w-full text-xs border rounded p-2 h-12 mt-0.5" placeholder="æ¥ç¶šã«é–¢ã™ã‚‹ãƒ¡ãƒ¢..." /></div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowAddProc(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setShowAddProc(false)} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">æ¥ç¶šå…ˆã‚’è¿½åŠ </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ ãƒ¡ã‚¤ãƒ³App â”€â”€â”€
// â”€â”€â”€ M03: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦– â”€â”€â”€
const MasterTransactionMonitor = () => {
  const [selectedTxn, setSelectedTxn] = useState(null);
  const [filterStatus, setFilterStatus] = useState("all");

  const txnData = [
    { id: "TXN-20260211-14523", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", amount: 12800, brand: "VISA", processor: "Univa Pay cast", status: "æˆåŠŸ", sColor: "green", time: "14:52:31", responseMs: 320, routing: "AIæœ€é©åŒ–", is3ds: true, userId: "USR-ABC-0451", userEmail: "tanaka.t@example.com", userName: "ç”°ä¸­å¤ªéƒ" },
    { id: "TXN-20260211-14522", merchant: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", amount: 3400, brand: "MC", processor: "æ¥½å¤©éŠ€è¡Œ", status: "æˆåŠŸ", sColor: "green", time: "14:52:18", responseMs: 450, routing: "ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°", is3ds: true, userId: "USR-XYZ-1120", userEmail: "sato.h@example.jp", userName: "ä½è—¤èŠ±å­" },
    { id: "TXN-20260211-14521", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", amount: 89000, brand: "JCB", processor: "TCMS", status: "æˆåŠŸ", sColor: "green", time: "14:51:55", responseMs: 280, routing: "åŠ ç›Ÿåº—å›ºå®š", is3ds: false, userId: "USR-ABC-0892", userEmail: "suzuki.k@example.com", userName: "éˆ´æœ¨ä¸€éƒ" },
    { id: "TXN-20260211-14520", merchant: "æ ªå¼ä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", amount: 245000, brand: "VISA", processor: "Univa Pay cast", status: "å¤±æ•—", sColor: "red", time: "14:51:40", responseMs: 5020, routing: "AIæœ€é©åŒ–", is3ds: true, error: "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆæ¥ç¶šå…ˆç„¡å¿œç­”ï¼‰", failover: "Worldpayã§ãƒªãƒˆãƒ©ã‚¤ â†’ æˆåŠŸ", userId: "USR-TRV-0033", userEmail: "yamada.a@example.co.jp", userName: "å±±ç”°æ˜" },
    { id: "TXN-20260211-14519", merchant: "æœ‰é™ä¼šç¤¾ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ©ã‚¹", amount: 6500, brand: "VISA", processor: "Univa Pay cast", status: "æˆåŠŸ", sColor: "green", time: "14:51:22", responseMs: 310, routing: "ã‚³ã‚¹ãƒˆæœ€é©åŒ–", is3ds: true, userId: "USR-STP-0215", userEmail: "watanabe.m@example.net", userName: "æ¸¡è¾ºç¾å’²" },
    { id: "TXN-20260211-14518", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", amount: 1500, brand: "WEB", processor: "ãƒšã‚¤ãƒ‡ã‚£", status: "æˆåŠŸ", sColor: "green", time: "14:50:58", responseMs: 180, routing: "ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°", is3ds: false, userId: "USR-ABC-1340", userEmail: "ito.r@example.com", userName: "ä¼Šè—¤æ¶¼" },
    { id: "TXN-20260211-14517", merchant: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", amount: 27800, brand: "AMEX", processor: "Asiabill", status: "3DSå¾…ã¡", sColor: "yellow", time: "14:50:45", responseMs: null, routing: "ãƒ–ãƒ©ãƒ³ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°", is3ds: true, userId: "USR-XYZ-0788", userEmail: "takahashi.y@example.jp", userName: "é«˜æ©‹é›„å¤ª" },
    { id: "TXN-20260211-14516", merchant: "æ ªå¼ä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", amount: 158000, brand: "VISA", processor: "Worldpay", status: "ä¸æ­£æ¤œçŸ¥", sColor: "red", time: "14:50:12", responseMs: null, routing: "â€”", is3ds: false, error: "ä¸æ­£ã‚¹ã‚³ã‚¢ 0.92ï¼ˆé–¾å€¤ 0.8è¶…éï¼‰â†’ ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã¸", userId: "USR-TRV-0091", userEmail: "unknown@tempmail.xyz", userName: "â€”" },
  ];

  const filtered = filterStatus === "all" ? txnData : txnData.filter(t => t.status === filterStatus);

  return (
    <div className="p-5 space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-sm font-bold text-slate-800">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–</h2>
        <span className="flex items-center gap-1.5 text-xs"><span className="w-2 h-2 bg-rose-500 rounded-full animate-pulse" />LIVE</span>
      </div>

      {/* ===== REALTIME CONTENT ===== */}
      {(
        <div className="space-y-3">
          {/* KPIs */}
          <div className="flex gap-3">
            <KPICard label="ä»Šæ—¥ã®æ±ºæ¸ˆä»¶æ•°" value="1,847ä»¶" sub="å‰æ—¥æ¯”" trend={12} />
            <KPICard label="æ±ºæ¸ˆç·é¡" value="Â¥23.4M" sub="å‰æ—¥æ¯”" trend={8} />
            <KPICard label="æˆåŠŸç‡" value="98.2%" sub="ç›®æ¨™: 99%" color="green" />
            <KPICard label="å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹" value="342ms" sub="ç›®æ¨™: 500msä»¥å†…" color="green" />
            <KPICard label="ä¸æ­£æ¤œçŸ¥" value="3ä»¶" sub="ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š" color="red" />
          </div>

          {/* Live indicator + Filter */}
          <div className="flex justify-between items-center">
            <div className="flex gap-2 items-center">
              <span className="w-2 h-2 bg-rose-500 rounded-full animate-pulse" /><span className="text-xs text-rose-600 font-bold">ğŸ”´ LIVE</span>
              <span className="text-xs text-slate-400">5ç§’ã”ã¨æ›´æ–°</span>
            </div>
            <div className="flex gap-1">
              {[{ id: "all", label: "å…¨ã¦", count: 8 }, { id: "æˆåŠŸ", label: "æˆåŠŸ", count: 5 }, { id: "å¤±æ•—", label: "å¤±æ•—", count: 1 }, { id: "3DSå¾…ã¡", label: "3DSå¾…ã¡", count: 1 }, { id: "ä¸æ­£æ¤œçŸ¥", label: "ä¸æ­£æ¤œçŸ¥", count: 1 }].map(f => (
                <button key={f.id} onClick={() => setFilterStatus(f.id)} className={`text-xs px-2 py-1 rounded border ${filterStatus === f.id ? "bg-blue-50 text-blue-600 border-blue-200 font-semibold" : "bg-white text-slate-500"}`}>
                  {f.label} ({f.count})
                </button>
              ))}
            </div>
          </div>

          {/* Alert */}
          {txnData.some(t => t.status === "å¤±æ•—") && (
            <div className="bg-rose-50 rounded-lg border border-rose-300 p-2 flex items-center gap-2">
              <span className="text-sm">ğŸš¨</span>
              <span className="text-xs text-rose-700 font-semibold">Univa Pay castã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿï¼ˆ14:51:40ï¼‰â€” ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã§Worldpayã«ãƒªãƒˆãƒ©ã‚¤æ¸ˆã¿</span>
              <button className="ml-auto text-xs bg-rose-100 text-rose-700 px-2 py-1 rounded border border-rose-200">è©³ç´°ã‚’ç¢ºèª</button>
            </div>
          )}

          {/* Transaction Feed */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "å–å¼•ID", w: "w-40" }, { label: "åŠ ç›Ÿåº—", w: "w-36" }, { label: "è³¼å…¥è€…", w: "w-32" }, { label: "é‡‘é¡", w: "w-24" }, { label: "ãƒ–ãƒ©ãƒ³ãƒ‰", w: "w-16" }, { label: "æ¥ç¶šå…ˆ", w: "w-28" }, { label: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°", w: "w-28" }, { label: "å¿œç­”", w: "w-16" }, { label: "3DS", w: "w-10" }, { label: "çŠ¶æ…‹", w: "w-20" }, { label: "æ™‚åˆ»", w: "w-20" }]}>
            {filtered.map((t, i) => (
              <React.Fragment key={t.id}>
              <tr className={`border-b cursor-pointer transition-colors ${selectedTxn === t.id ? "bg-blue-100 border-l-2 border-l-blue-500" : i % 2 ? "bg-slate-50 hover:bg-blue-50" : "hover:bg-blue-50"} ${t.status === "å¤±æ•—" || t.status === "ä¸æ­£æ¤œçŸ¥" ? "bg-rose-50" : ""}`}
                   onClick={() => setSelectedTxn(selectedTxn === t.id ? null : t.id)}>
                <td className="px-4 py-2 whitespace-nowrap w-40 font-mono text-slate-500">{t.id}</td>
                <td className="px-4 py-2 whitespace-nowrap w-36 text-slate-700">{t.merchant}</td>
                <td className="px-4 py-2 whitespace-nowrap w-32">
                  <div className="text-slate-700 text-xs">{t.userName}</div>
                  <div className="text-slate-400" style={{fontSize: "10px"}}>{t.userId}</div>
                </td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-right font-semibold text-slate-800">Â¥{t.amount.toLocaleString()}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={t.brand} color="blue" /></td>
                <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-500">{t.processor}</td>
                <td className="px-4 py-2 whitespace-nowrap w-28"><Badge text={t.routing} color={t.routing.includes("AI") ? "purple" : "gray"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-slate-400">{t.responseMs ? t.responseMs + "ms" : "â€”"}</td>
                <td className="px-4 py-2 whitespace-nowrap w-10 text-center">{t.is3ds ? "ğŸ”’" : "â€”"}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={t.status} color={t.sColor} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-20 text-slate-400 font-mono">{t.time}</td>
              </tr>
              {/* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³è©³ç´° */}
              {selectedTxn === t.id && (
                <tr><td colSpan={11} className="p-0">
                  <div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                    <div className="flex justify-between items-center mb-2">
                      <p className="text-xs font-bold text-slate-700">ğŸ” å–å¼•è©³ç´° â€” {t.id}</p>
                      <span className="text-xs text-blue-600 cursor-pointer hover:underline">æ³¨æ–‡æ¤œç´¢ã§è©³ç´°ã‚’ç¢ºèª â†’</span>
                    </div>
                    <div className="grid grid-cols-5 gap-3 text-xs">
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="font-semibold text-slate-600 mb-1">åŸºæœ¬æƒ…å ±</p>
                        <div className="space-y-0.5 text-slate-500">
                          <div>åŠ ç›Ÿåº—: {t.merchant}</div>
                          <div>é‡‘é¡: Â¥{t.amount.toLocaleString()}</div>
                          <div>ãƒ–ãƒ©ãƒ³ãƒ‰: {t.brand}</div>
                          <div>ã‚«ãƒ¼ãƒ‰ç•ªå·: **** **** **** 1234</div>
                        </div>
                      </div>
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="font-semibold text-slate-600 mb-1">è³¼å…¥è€…æƒ…å ±</p>
                        <div className="space-y-0.5 text-slate-500">
                          <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼å: {t.userName}</div>
                          <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span className="font-mono">{t.userId}</span></div>
                          <div>ãƒ¡ãƒ¼ãƒ«: {t.userEmail}</div>
                          <div>ã‚«ãƒ¼ãƒ‰åç¾©: TARO TANAKA</div>
                        </div>
                      </div>
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="font-semibold text-slate-600 mb-1">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åˆ¤å®š</p>
                        <div className="space-y-0.5 text-slate-500">
                          <div>åˆ¤å®šç†ç”±: {t.routing}</div>
                          <div>é¸æŠæ¥ç¶šå…ˆ: {t.processor}</div>
                          <div>å€™è£œ: Univa Pay cast, Worldpay, TCMS</div>
                          <div>åˆ¤å®šæ™‚é–“: 3ms</div>
                        </div>
                      </div>
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="font-semibold text-slate-600 mb-1">3Dã‚»ã‚­ãƒ¥ã‚¢</p>
                        <div className="space-y-0.5 text-slate-500">
                          <div>3DS: {t.is3ds ? "é©ç”¨æ¸ˆã¿ï¼ˆv2.0ï¼‰" : "æœªé©ç”¨"}</div>
                          <div>èªè¨¼çµæœ: {t.is3ds ? "æˆåŠŸ" : "â€”"}</div>
                          <div>ECI: {t.is3ds ? "05" : "â€”"}</div>
                        </div>
                      </div>
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="font-semibold text-slate-600 mb-1">æ¥ç¶šå…ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹</p>
                        <div className="space-y-0.5 text-slate-500">
                          <div>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ : {t.responseMs ? t.responseMs + "ms" : "â€”"}</div>
                          <div>ã‚³ãƒ¼ãƒ‰: {t.status === "æˆåŠŸ" ? "00ï¼ˆæ­£å¸¸å®Œäº†ï¼‰" : t.error ? "TOï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰" : "â€”"}</div>
                          {t.error && <div className="text-rose-600">{t.error}</div>}
                          {t.failover && <div className="text-emerald-600">{t.failover}</div>}
                        </div>
                      </div>
                    </div>
                  </div>
                </td></tr>
              )}
              </React.Fragment>
            ))}
            </TableHeader>
          </div>

          {/* Stats Row */}
          <div className="grid grid-cols-3 gap-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold text-slate-600 mb-2">æ¥ç¶šå…ˆåˆ¥ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ </p>
              <div className="space-y-1.5">
                {[
                  { name: "ãƒšã‚¤ãƒ‡ã‚£", avg: 75, color: "bg-emerald-500" },
                  { name: "æ¥½å¤©éŠ€è¡Œ", avg: 85, color: "bg-emerald-500" },
                  { name: "TCMS", avg: 95, color: "bg-emerald-500" },
                  { name: "Worldpay", avg: 110, color: "bg-emerald-500" },
                  { name: "Univa Pay cast", avg: 120, color: "bg-emerald-500" },
                ].map((p, i) => (
                  <div key={i} className="flex items-center gap-2 text-xs">
                    <span className="w-20 text-slate-600">{p.name}</span>
                    <div className="flex-1 bg-slate-100 rounded h-3"><div className={`${p.color} rounded h-3`} style={{ width: `${Math.min(p.avg / 6, 100)}%` }} /></div>
                    <span className="w-16 text-right text-slate-500">avg {p.avg}ms</span>
                  </div>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold text-slate-600 mb-2">ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥ æ±ºæ¸ˆä»¶æ•°</p>
              <div className="space-y-1.5">
                {[
                  { brand: "VISA", count: 823, pct: 44.5, color: "bg-blue-500" },
                  { brand: "MC", count: 412, pct: 22.3, color: "bg-rose-500" },
                  { brand: "JCB", count: 356, pct: 19.3, color: "bg-emerald-500" },
                  { brand: "AMEX", count: 134, pct: 7.3, color: "bg-purple-500" },
                  { brand: "WEBãƒãƒãƒ¼", count: 122, pct: 6.6, color: "bg-amber-500" },
                ].map((b, i) => (
                  <div key={i} className="flex items-center gap-2 text-xs">
                    <span className="w-12 text-slate-600 font-semibold">{b.brand}</span>
                    <div className="flex-1 bg-slate-100 rounded h-3"><div className={`${b.color} rounded h-3`} style={{ width: `${b.pct}%` }} /></div>
                    <span className="w-12 text-right text-slate-600">{b.count}ä»¶</span>
                  </div>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold text-slate-600 mb-2">æ™‚é–“å¸¯åˆ¥ æ±ºæ¸ˆæ¨ç§»</p>
              <div className="flex items-end gap-1 h-20">
                {[20, 15, 8, 5, 3, 4, 12, 45, 78, 95, 110, 125, 130, 118, 105].map((v, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="bg-blue-400 rounded-t w-full" style={{ height: `${(v / 130) * 64}px` }} />
                    <span className="text-slate-400 mt-0.5" style={{fontSize: "7px"}}>{i}æ™‚</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* (æ³¨æ–‡æ¤œç´¢ã¯ç‹¬ç«‹ç”»é¢ MasterOrderSearch ã«åˆ†é›¢) */}
    </div>
  );
};

// â”€â”€â”€ M03b: æ³¨æ–‡æ¤œç´¢ â”€â”€â”€
const MasterOrderSearch = () => {
  const [searchSlide, setSearchSlide] = useState(null);
  const [expandedOrderId, setExpandedOrderId] = useState(null);
  const [refundDialog, setRefundDialog] = useState(null);

  const searchResults = [
    { id: "TXN-20260210-13201", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", amount: 45000, brand: "VISA", processor: "Univa Pay cast", status: "è¿”é‡‘æ¸ˆ", sColor: "purple", date: "2026-02-10 16:30:22", refundAmount: 45000, userId: "USR-ABC-0451", userEmail: "tanaka.t@example.com", userName: "ç”°ä¸­å¤ªéƒ" },
    { id: "TXN-20260210-12888", merchant: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", amount: 8900, brand: "MC", processor: "æ¥½å¤©éŠ€è¡Œ", status: "æˆåŠŸ", sColor: "green", date: "2026-02-10 14:12:05", userId: "USR-XYZ-0322", userEmail: "kobayashi.n@example.jp", userName: "å°æ—ç›´äºº" },
    { id: "TXN-20260210-12500", merchant: "æ ªå¼ä¼šç¤¾ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", amount: 320000, brand: "VISA", processor: "Worldpay", status: "æˆåŠŸ", sColor: "green", date: "2026-02-10 11:45:33", userId: "USR-TRV-0150", userEmail: "nakamura.s@example.co.jp", userName: "ä¸­æ‘ç¿”" },
    { id: "TXN-20260209-11200", merchant: "æœ‰é™ä¼šç¤¾ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ©ã‚¹", amount: 12500, brand: "JCB", processor: "TCMS", status: "æˆåŠŸ", sColor: "green", date: "2026-02-09 19:20:11", userId: "USR-STP-0087", userEmail: "yoshida.a@example.net", userName: "å‰ç”°æ„›" },
    { id: "TXN-20260209-10800", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", amount: 67000, brand: "AMEX", processor: "Asiabill", status: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", sColor: "gray", date: "2026-02-09 15:08:44", userId: "USR-ABC-0612", userEmail: "matsumoto.k@example.com", userName: "æ¾æœ¬å¥" },
  ];

  return (
    <div className="p-5 space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-sm font-bold text-slate-800">æ³¨æ–‡æ¤œç´¢</h2>
        <button className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      </div>

      {/* Search Form */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-600 mb-2">ğŸ” æ¤œç´¢æ¡ä»¶</p>
        <div className="grid grid-cols-4 gap-2">
          <div><label className="text-xs text-slate-400">å–å¼•ID</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="TXN-..." /></div>
          <div><label className="text-xs text-slate-400">åŠ ç›Ÿåº—å</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="åŠ ç›Ÿåº—åã§æ¤œç´¢" /></div>
          <div><label className="text-xs text-slate-400">ã‚«ãƒ¼ãƒ‰ä¸‹4æ¡</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="1234" maxLength={4} /></div>
          <div><label className="text-xs text-slate-400">ãƒ–ãƒ©ãƒ³ãƒ‰</label>
            <div className="flex gap-1 mt-0.5">{["VISA","MC","JCB","AMEX","WEBãƒãƒãƒ¼"].map(b => <label key={b} className="text-xs flex items-center gap-0.5"><input type="checkbox" className="w-3 h-3" />{b}</label>)}</div>
          </div>
          <div><label className="text-xs text-slate-400">é‡‘é¡ï¼ˆæœ€å°ï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="Â¥0" /></div>
          <div><label className="text-xs text-slate-400">é‡‘é¡ï¼ˆæœ€å¤§ï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="Â¥999,999" /></div>
          <div><label className="text-xs text-slate-400">é–‹å§‹æ—¥æ™‚</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5" defaultValue="2026-02-05" /></div>
          <div><label className="text-xs text-slate-400">çµ‚äº†æ—¥æ™‚</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5" defaultValue="2026-02-12" /></div>
          <div><label className="text-xs text-slate-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="USR-..." /></div>
          <div><label className="text-xs text-slate-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ¼ãƒ«</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="user@example.com" /></div>
          <div><label className="text-xs text-slate-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="æ°åã§æ¤œç´¢" /></div>
          <div><label className="text-xs text-slate-400">ä»£ç†åº—å</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="ä»£ç†åº—åã§æ¤œç´¢" /></div>
          <div><label className="text-xs text-slate-400">ãƒã‚±ãƒƒãƒˆç•ªå·</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="TKT-..." /></div>
          <div><label className="text-xs text-slate-400">èª²é‡‘æ–¹æ³•</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ã¦</option><option>é€šå¸¸æ±ºæ¸ˆ</option><option>URLæ±ºæ¸ˆ</option><option>ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°</option><option>åˆ†å‰²æ‰•ã„</option></select></div>
          <div><label className="text-xs text-slate-400">æ±ºæ¸ˆå‚™è€ƒ</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="å‚™è€ƒã§æ¤œç´¢" /></div>
        </div>
        <div className="flex justify-between items-center mt-2">
          <div className="flex gap-1 text-xs flex-wrap">
            <span className="text-slate-400">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</span>
            {["æˆåŠŸ","å¤±æ•—","è¿”é‡‘æ¸ˆ","ã‚­ãƒ£ãƒ³ã‚»ãƒ«","3DSå¤±æ•—"].map(s => <label key={s} className="flex items-center gap-0.5"><input type="checkbox" className="w-3 h-3" defaultChecked />{s}</label>)}
            <span className="text-slate-400 ml-2">|</span>
            <label className="flex items-center gap-0.5 ml-1"><input type="checkbox" className="w-3 h-3" />ãƒ†ã‚¹ãƒˆæ±ºæ¸ˆã‚’å«ã‚€</label>
            <label className="flex items-center gap-0.5 ml-1"><input type="checkbox" className="w-3 h-3" />ãƒãƒãƒ­ãƒ³ç–‘ã„</label>
          </div>
          <div className="flex gap-2">
            <button className="text-xs text-slate-400 hover:text-slate-600">æ¤œç´¢æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢</button>
            <button className="text-xs bg-blue-600 text-white px-4 py-1.5 rounded font-semibold">æ¤œç´¢</button>
          </div>
        </div>
      </div>

      {/* Search Results */}
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
        <div className="flex justify-between items-center px-3 py-2 border-b">
          <span className="text-xs text-slate-500">æ¤œç´¢çµæœ: 5ä»¶ï¼ˆ1/1ãƒšãƒ¼ã‚¸ï¼‰</span>
          <div className="flex gap-1 text-xs">
            <span className="text-slate-400">è¡¨ç¤º:</span>
            {["20","50","100"].map(n => <button key={n} className={`px-1.5 py-0.5 rounded ${n === "20" ? "bg-blue-100 text-blue-600" : "text-slate-400"}`}>{n}ä»¶</button>)}
          </div>
        </div>
        <TableHeader cols={[{ label: "å–å¼•ID", w: "w-40" }, { label: "åŠ ç›Ÿåº—", w: "w-36" }, { label: "è³¼å…¥è€…", w: "w-32" }, { label: "é‡‘é¡", w: "w-24" }, { label: "ãƒ–ãƒ©ãƒ³ãƒ‰", w: "w-16" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-20" }, { label: "æ—¥æ™‚", w: "w-36" }, { label: "æ“ä½œ", w: "w-36" }]}>
        {searchResults.map((t, i) => (
          <React.Fragment key={t.id}>
          <tr className={`border-b cursor-pointer transition-colors ${expandedOrderId === t.id ? "bg-blue-100 border-l-2 border-l-blue-500" : i % 2 ? "bg-slate-50 hover:bg-blue-50" : "hover:bg-blue-50"}`} onClick={() => setExpandedOrderId(expandedOrderId === t.id ? null : t.id)}>
            <td className="px-4 py-2 whitespace-nowrap w-40 font-mono text-slate-500">{t.id}</td>
            <td className="px-4 py-2 whitespace-nowrap w-36 text-slate-700">{t.merchant}</td>
            <td className="px-4 py-2 whitespace-nowrap w-32">
              <div className="text-slate-700 text-xs">{t.userName}</div>
              <div className="text-slate-400" style={{fontSize: "10px"}}>{t.userEmail}</div>
            </td>
            <td className="px-4 py-2 whitespace-nowrap w-24 text-right font-semibold">Â¥{t.amount.toLocaleString()}</td>
            <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={t.brand} color="blue" /></td>
            <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={t.status} color={t.sColor} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-36 text-slate-400 font-mono">{t.date}</td>
            <td className="px-4 py-2 whitespace-nowrap w-36" onClick={e => e.stopPropagation()}><div className="flex gap-1">
              {t.status === "æˆåŠŸ" && (<>
                <button onClick={() => setRefundDialog({ ...t, type: "full" })} className="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs border border-purple-200">è¿”é‡‘</button>
                <button onClick={() => setRefundDialog({ ...t, type: "cancel" })} className="px-2 py-1 bg-rose-100 text-rose-700 rounded text-xs border border-rose-200">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              </>)}
              {t.status === "è¿”é‡‘æ¸ˆ" && <span className="text-xs text-purple-500">è¿”é‡‘æ¸ˆ Â¥{t.refundAmount?.toLocaleString()}</span>}
              {t.status === "ã‚­ãƒ£ãƒ³ã‚»ãƒ«" && <span className="text-xs text-slate-400">ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆ</span>}
            </div></td>
          </tr>
          {/* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³è©³ç´° */}
          {expandedOrderId === t.id && (
            <tr><td colSpan={8} className="p-0">
              <div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-xs font-bold text-slate-700">ğŸ” æ³¨æ–‡è©³ç´° â€” {t.id}</p>
                  <Badge text={t.status} color={t.sColor} />
                </div>
                <div className="grid grid-cols-4 gap-3 text-xs">
                  <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                    <p className="font-semibold text-slate-600 mb-1">å–å¼•æƒ…å ±</p>
                    <div className="space-y-0.5 text-slate-500">
                      <div>å–å¼•ID: <span className="font-mono">{t.id}</span></div>
                      <div>åŠ ç›Ÿåº—: {t.merchant}</div>
                      <div>é‡‘é¡: <span className="font-bold text-slate-800">Â¥{t.amount.toLocaleString()}</span></div>
                      <div>ãƒ–ãƒ©ãƒ³ãƒ‰: {t.brand}</div>
                      <div>æ¥ç¶šå…ˆ: {t.processor}</div>
                      <div>æ—¥æ™‚: {t.date}</div>
                    </div>
                  </div>
                  <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                    <p className="font-semibold text-slate-600 mb-1">è³¼å…¥è€…æƒ…å ±</p>
                    <div className="space-y-0.5 text-slate-500">
                      <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼å: {t.userName}</div>
                      <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span className="font-mono">{t.userId}</span></div>
                      <div>ãƒ¡ãƒ¼ãƒ«: {t.userEmail}</div>
                      <div>ã‚«ãƒ¼ãƒ‰ç•ªå·: **** **** **** {t.id.slice(-4)}</div>
                      <div>ã‚«ãƒ¼ãƒ‰åç¾©: {t.userName.toUpperCase().replace(/[^\x00-\x7F]/g, "") || "TANAKA TARO"}</div>
                    </div>
                  </div>
                  <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                    <p className="font-semibold text-slate-600 mb-1">æ±ºæ¸ˆè©³ç´°</p>
                    <div className="space-y-0.5 text-slate-500">
                      <div>3DS: é©ç”¨æ¸ˆã¿ï¼ˆv2.0ï¼‰</div>
                      <div>èªè¨¼çµæœ: æˆåŠŸ</div>
                      <div>ECI: 05</div>
                      <div>ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 320ms</div>
                      <div>ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: AIæœ€é©åŒ–</div>
                      {t.status === "è¿”é‡‘æ¸ˆ" && <div className="text-purple-600 font-semibold">è¿”é‡‘é¡: Â¥{t.refundAmount?.toLocaleString()}</div>}
                    </div>
                  </div>
                  <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                    <p className="font-semibold text-slate-600 mb-1">å‡¦ç†ãƒ­ã‚°</p>
                    <div className="space-y-1 text-slate-500">
                      <div className="flex items-center gap-1"><span className="w-1.5 h-1.5 rounded-full bg-emerald-500 shrink-0" />{t.date.split(" ")[1]} å—ä»˜</div>
                      <div className="flex items-center gap-1"><span className="w-1.5 h-1.5 rounded-full bg-emerald-500 shrink-0" />{t.date.split(" ")[1]} 3DSèªè¨¼</div>
                      <div className="flex items-center gap-1"><span className="w-1.5 h-1.5 rounded-full bg-emerald-500 shrink-0" />{t.date.split(" ")[1]} ã‚ªãƒ¼ã‚½ãƒª</div>
                      <div className="flex items-center gap-1"><span className={`w-1.5 h-1.5 rounded-full shrink-0 ${t.status === "æˆåŠŸ" ? "bg-emerald-500" : t.status === "è¿”é‡‘æ¸ˆ" ? "bg-purple-500" : "bg-slate-400"}`} />{t.date.split(" ")[1]} {t.status === "æˆåŠŸ" ? "å£²ä¸Šç¢ºå®š" : t.status === "è¿”é‡‘æ¸ˆ" ? "è¿”é‡‘å‡¦ç†" : t.status}</div>
                    </div>
                  </div>
                </div>
              </div>
            </td></tr>
          )}
          </React.Fragment>
        ))}
        </TableHeader>
      </div>

      <div className="bg-slate-50 rounded-lg border border-slate-200 p-2.5 flex items-center gap-2 text-xs text-slate-400">
        <span>ğŸ”’</span><span>è¿”é‡‘ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ“ä½œã¯ super_admin / admin ã®ã¿ã€‚reviewer ã¯é–²è¦§ã®ã¿ã§ã™ã€‚</span>
      </div>

      {/* Refund/Cancel Dialog */}
      {refundDialog && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setRefundDialog(null)}>
          <div className="bg-white rounded-xl shadow-2xl w-[440px]" onClick={e => e.stopPropagation()}>
            <div className={`p-4 rounded-t-xl border-b ${refundDialog.type === "cancel" ? "bg-rose-50" : "bg-purple-50"}`}>
              <h3 className="text-sm font-bold text-slate-800">{refundDialog.type === "cancel" ? "ğŸš« å–å¼•ã‚­ãƒ£ãƒ³ã‚»ãƒ«" : "ğŸ’œ è¿”é‡‘å‡¦ç†"}</h3>
            </div>
            <div className="p-5 space-y-4">
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-2.5 space-y-1 text-xs">
                <div className="flex"><span className="w-20 text-slate-400">å–å¼•ID:</span><span className="font-mono">{refundDialog.id}</span></div>
                <div className="flex"><span className="w-20 text-slate-400">åŠ ç›Ÿåº—:</span><span className="font-semibold">{refundDialog.merchant}</span></div>
                <div className="flex"><span className="w-20 text-slate-400">é‡‘é¡:</span><span className="font-bold">Â¥{refundDialog.amount.toLocaleString()}</span></div>
              </div>
              {refundDialog.type !== "cancel" && (
                <div>
                  <p className="text-xs font-semibold text-slate-600 mb-1">è¿”é‡‘ç¨®åˆ¥:</p>
                  <div className="flex gap-2">
                    <label className="text-xs flex items-center gap-1"><input type="radio" name="refundType2" defaultChecked /> å…¨é¡è¿”é‡‘ï¼ˆÂ¥{refundDialog.amount.toLocaleString()}ï¼‰</label>
                    <label className="text-xs flex items-center gap-1"><input type="radio" name="refundType2" /> ä¸€éƒ¨è¿”é‡‘</label>
                  </div>
                  <input className="w-full text-xs border rounded px-2 py-1.5 mt-1" placeholder="ä¸€éƒ¨è¿”é‡‘ã®å ´åˆ: é‡‘é¡ã‚’å…¥åŠ›" />
                </div>
              )}
              <p className="text-xs text-slate-400">{refundDialog.type === "cancel" ? "ã“ã®å–å¼•ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ" : "å‡¦ç†ã«1-3å–¶æ¥­æ—¥ã‹ã‹ã‚Šã¾ã™"}</p>
            </div>
            <div className="flex justify-end gap-2 p-4 border-t">
              <button onClick={() => setRefundDialog(null)} className="px-4 py-2 text-xs text-slate-600 border rounded">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setRefundDialog(null)} className={`px-4 py-2 text-xs text-white rounded font-semibold ${refundDialog.type === "cancel" ? "bg-rose-600" : "bg-purple-600"}`}>
                {refundDialog.type === "cancel" ? "ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹" : "è¿”é‡‘ã™ã‚‹"}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Search Slide Panel */}
      {searchSlide && (
        <div className="fixed inset-0 z-50 flex">
          <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSearchSlide(null)} />
          <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">æ³¨æ–‡è©³ç´°</h3>
              <button onClick={() => setSearchSlide(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-4 space-y-3 text-xs">
              <div className="space-y-1.5">
                <div className="flex justify-between"><span className="text-slate-400">å–å¼•ID</span><span className="font-mono">{searchSlide.id}</span></div>
                <div className="flex justify-between"><span className="text-slate-400">åŠ ç›Ÿåº—</span><span className="font-semibold">{searchSlide.merchant}</span></div>
                <div className="flex justify-between"><span className="text-slate-400">é‡‘é¡</span><span className="font-bold">Â¥{searchSlide.amount.toLocaleString()}</span></div>
                <div className="flex justify-between"><span className="text-slate-400">ãƒ–ãƒ©ãƒ³ãƒ‰</span><Badge text={searchSlide.brand} color="blue" /></div>
                <div className="flex justify-between"><span className="text-slate-400">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span><Badge text={searchSlide.status} color={searchSlide.sColor} /></div>
                <div className="flex justify-between"><span className="text-slate-400">æ—¥æ™‚</span><span>{searchSlide.date}</span></div>
              </div>
              <div className="border-t pt-3">
                <p className="font-bold text-slate-600 mb-1">è³¼å…¥è€…æƒ…å ±</p>
                <div className="space-y-1.5">
                  <div className="flex justify-between"><span className="text-slate-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</span><span className="font-semibold">{searchSlide.userName}</span></div>
                  <div className="flex justify-between"><span className="text-slate-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</span><span className="font-mono">{searchSlide.userId}</span></div>
                  <div className="flex justify-between"><span className="text-slate-400">ãƒ¡ãƒ¼ãƒ«</span><span className="text-blue-600">{searchSlide.userEmail}</span></div>
                  <div className="flex justify-between"><span className="text-slate-400">ã‚«ãƒ¼ãƒ‰åç¾©</span><span>TARO TANAKA</span></div>
                </div>
              </div>
              <div className="border-t pt-3">
                <p className="font-bold text-slate-600 mb-1">è¿”é‡‘å±¥æ­´</p>
                {searchSlide.status === "è¿”é‡‘æ¸ˆ" ? (
                  <div className="bg-purple-50 rounded p-2">
                    <div className="flex justify-between"><span className="text-slate-400">è¿”é‡‘æ—¥</span><span>2026-02-10 17:00</span></div>
                    <div className="flex justify-between"><span className="text-slate-400">è¿”é‡‘é¡</span><span className="font-bold text-purple-600">Â¥{searchSlide.refundAmount?.toLocaleString()}</span></div>
                    <div className="flex justify-between"><span className="text-slate-400">æ“ä½œè€…</span><span>admin@aipaymentsys.com</span></div>
                  </div>
                ) : <span className="text-slate-400">è¿”é‡‘å±¥æ­´ãªã—</span>}
              </div>
              <div className="border-t pt-3">
                <p className="font-bold text-slate-600 mb-1">é–¢é€£å–å¼•ï¼ˆåŒä¸€ã‚«ãƒ¼ãƒ‰ä¸‹4æ¡ï¼‰</p>
                <div className="space-y-1">
                  {["TXN-...-13100 Â¥8,200 æˆåŠŸ", "TXN-...-12900 Â¥3,400 æˆåŠŸ", "TXN-...-12000 Â¥15,600 æˆåŠŸ"].map((r, i) => (
                    <div key={i} className="text-slate-500 bg-slate-50 rounded px-2 py-1">{r}</div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ M07: ä¸æ­£æ¤œçŸ¥è¨­å®š â”€â”€â”€
// â”€â”€â”€ ä¸æ­£æ¤œçŸ¥æ¡ä»¶ãƒ“ãƒ«ãƒ€ãƒ¼ â”€â”€â”€
const FRAUD_CONDITION_FIELDS = [
  { value: "amount", label: "å–å¼•é‡‘é¡", unit: "å††", type: "number", operators: [">", ">=", "<", "<=", "==", "!=", "between"] },
  { value: "card_country", label: "ã‚«ãƒ¼ãƒ‰ç™ºè¡Œå›½", type: "select", options: ["JP","US","CN","KR","GB","DE","FR","SG","TW","HK","ãã®ä»–"], operators: ["==", "!=", "in", "not_in"] },
  { value: "ip_country", label: "IPã‚¢ãƒ‰ãƒ¬ã‚¹å›½", type: "select", options: ["JP","US","CN","KR","GB","DE","FR","SG","TW","HK","ãã®ä»–"], operators: ["==", "!=", "in", "not_in"] },
  { value: "geo_mismatch", label: "IP/ã‚«ãƒ¼ãƒ‰å›½ä¸ä¸€è‡´", type: "boolean", operators: ["=="] },
  { value: "bin", label: "ã‚«ãƒ¼ãƒ‰BIN", type: "text", operators: ["==", "in", "not_in", "blocklist"] },
  { value: "card_brand", label: "ã‚«ãƒ¼ãƒ‰ãƒ–ãƒ©ãƒ³ãƒ‰", type: "select", options: ["VISA","Mastercard","JCB","AMEX","Diners","UnionPay"], operators: ["==", "!=", "in", "not_in"] },
  { value: "card_type", label: "ã‚«ãƒ¼ãƒ‰ç¨®åˆ¥", type: "select", options: ["credit","debit","prepaid"], operators: ["==", "!="] },
  { value: "email", label: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", type: "text", operators: ["==", "contains", "not_contains", "regex", "blocklist"] },
  { value: "email_domain", label: "ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³", type: "text", operators: ["==", "in", "not_in", "blocklist"] },
  { value: "email_disposable", label: "ä½¿ã„æ¨ã¦ãƒ¡ãƒ¼ãƒ«", type: "boolean", operators: ["=="] },
  { value: "ip_address", label: "IPã‚¢ãƒ‰ãƒ¬ã‚¹", type: "text", operators: ["==", "in", "not_in", "cidr", "blocklist"] },
  { value: "ip_proxy", label: "ãƒ—ãƒ­ã‚­ã‚·/VPNæ¤œçŸ¥", type: "boolean", operators: ["=="] },
  { value: "ip_tor", label: "Toræ¤œçŸ¥", type: "boolean", operators: ["=="] },
  { value: "device_fingerprint", label: "ãƒ‡ãƒã‚¤ã‚¹ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ", type: "text", operators: ["==", "blocklist", "new"] },
  { value: "device_type", label: "ãƒ‡ãƒã‚¤ã‚¹ç¨®åˆ¥", type: "select", options: ["desktop","mobile","tablet","bot","unknown"], operators: ["==", "!=", "in"] },
  { value: "browser", label: "ãƒ–ãƒ©ã‚¦ã‚¶", type: "select", options: ["Chrome","Firefox","Safari","Edge","Opera","ãã®ä»–"], operators: ["==", "!=", "in"] },
  { value: "os", label: "OS", type: "select", options: ["Windows","macOS","iOS","Android","Linux","ãã®ä»–"], operators: ["==", "!=", "in"] },
  { value: "ai_score", label: "AIä¸æ­£ã‚¹ã‚³ã‚¢", unit: "", type: "number", operators: [">", ">=", "<", "<=", "between"] },
  { value: "velocity_card", label: "åŒä¸€ã‚«ãƒ¼ãƒ‰å–å¼•å›æ•°", unit: "ä»¶", type: "number", operators: [">", ">="], timeWindow: true },
  { value: "velocity_email", label: "åŒä¸€ãƒ¡ãƒ¼ãƒ«å–å¼•å›æ•°", unit: "ä»¶", type: "number", operators: [">", ">="], timeWindow: true },
  { value: "velocity_ip", label: "åŒä¸€IPå–å¼•å›æ•°", unit: "ä»¶", type: "number", operators: [">", ">="], timeWindow: true },
  { value: "velocity_device", label: "åŒä¸€ãƒ‡ãƒã‚¤ã‚¹å–å¼•å›æ•°", unit: "ä»¶", type: "number", operators: [">", ">="], timeWindow: true },
  { value: "velocity_amount", label: "ç´¯è¨ˆå–å¼•é‡‘é¡", unit: "å††", type: "number", operators: [">", ">="], timeWindow: true },
  { value: "unique_cards_per_email", label: "åŒä¸€ãƒ¡ãƒ¼ãƒ«ã®ã‚«ãƒ¼ãƒ‰æ•°", unit: "æš", type: "number", operators: [">", ">="], timeWindow: true },
  { value: "unique_emails_per_card", label: "åŒä¸€ã‚«ãƒ¼ãƒ‰ã®ãƒ¡ãƒ¼ãƒ«æ•°", unit: "ä»¶", type: "number", operators: [">", ">="], timeWindow: true },
  { value: "hour", label: "å–å¼•æ™‚åˆ»ï¼ˆæ™‚ï¼‰", unit: "æ™‚", type: "number", operators: [">", ">=", "<", "<=", "between"] },
  { value: "day_of_week", label: "æ›œæ—¥", type: "select", options: ["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"], operators: ["==", "!=", "in"] },
  { value: "is_first_txn", label: "åˆå›å–å¼•", type: "boolean", operators: ["=="] },
  { value: "is_recurring", label: "ç¶™ç¶šèª²é‡‘å–å¼•", type: "boolean", operators: ["=="] },
  { value: "3ds_status", label: "3DSèªè¨¼çµæœ", type: "select", options: ["authenticated","attempted","failed","not_enrolled","unavailable"], operators: ["==", "!=", "in"] },
  { value: "merchant_category", label: "åŠ ç›Ÿåº—ã‚«ãƒ†ã‚´ãƒª", type: "select", options: ["EC","ãƒ‡ã‚¸ã‚¿ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„","æ—…è¡Œ","é£²é£Ÿ","å°å£²","ã‚µãƒ¼ãƒ“ã‚¹","ãã®ä»–"], operators: ["==", "!=", "in"] },
  { value: "currency", label: "é€šè²¨", type: "select", options: ["JPY","USD","EUR","GBP","CNY","KRW","TWD","HKD"], operators: ["==", "!="] },
  { value: "customer_tenure", label: "é¡§å®¢ç™»éŒ²æ—¥æ•°", unit: "æ—¥", type: "number", operators: [">", ">=", "<", "<="] },
  { value: "shipping_billing_match", label: "é…é€å…ˆ/è«‹æ±‚å…ˆä¸€è‡´", type: "boolean", operators: ["=="] },
  { value: "name_email_match", label: "æ°å/ãƒ¡ãƒ¼ãƒ«æ•´åˆæ€§", type: "boolean", operators: ["=="] },
];

const OPERATOR_LABELS = {
  ">": "ï¼ï¼ˆã‚ˆã‚Šå¤§ãã„ï¼‰", ">=": "â‰§ï¼ˆä»¥ä¸Šï¼‰", "<": "ï¼œï¼ˆã‚ˆã‚Šå°ã•ã„ï¼‰", "<=": "â‰¦ï¼ˆä»¥ä¸‹ï¼‰",
  "==": "ï¼ï¼ˆç­‰ã—ã„ï¼‰", "!=": "â‰ ï¼ˆç­‰ã—ããªã„ï¼‰", "between": "ç¯„å›²ï¼ˆã€œã®é–“ï¼‰",
  "in": "ã„ãšã‚Œã‹ã«ä¸€è‡´", "not_in": "ã„ãšã‚Œã«ã‚‚ä¸ä¸€è‡´",
  "contains": "å«ã‚€", "not_contains": "å«ã¾ãªã„", "regex": "æ­£è¦è¡¨ç¾",
  "blocklist": "ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆã«ä¸€è‡´", "cidr": "CIDRç¯„å›²", "new": "æ–°è¦ï¼ˆåˆå‡ºï¼‰",
};

const TIME_WINDOWS = ["1åˆ†","3åˆ†","5åˆ†","10åˆ†","30åˆ†","1æ™‚é–“","6æ™‚é–“","12æ™‚é–“","24æ™‚é–“","7æ—¥","30æ—¥"];

const ConditionBuilder = ({ conditions, onChange }) => {
  const addGroup = () => onChange([...conditions, { logic: "AND", rules: [{ field: "amount", operator: ">", value: "", timeWindow: "" }] }]);
  const removeGroup = (gi) => onChange(conditions.filter((_, i) => i !== gi));
  const updateGroupLogic = (gi, logic) => { const c = [...conditions]; c[gi] = { ...c[gi], logic }; onChange(c); };
  const addRule = (gi) => { const c = [...conditions]; c[gi] = { ...c[gi], rules: [...c[gi].rules, { field: "amount", operator: ">", value: "", timeWindow: "" }] }; onChange(c); };
  const removeRule = (gi, ri) => { const c = [...conditions]; c[gi] = { ...c[gi], rules: c[gi].rules.filter((_, i) => i !== ri) }; if (c[gi].rules.length === 0) c.splice(gi, 1); onChange(c); };
  const updateRule = (gi, ri, key, val) => { const c = [...conditions]; const rules = [...c[gi].rules]; rules[ri] = { ...rules[ri], [key]: val }; if (key === "field") { const fd = FRAUD_CONDITION_FIELDS.find(f => f.value === val); rules[ri].operator = fd?.operators[0] || ">"; rules[ri].value = fd?.type === "boolean" ? "true" : ""; rules[ri].value2 = ""; rules[ri].timeWindow = ""; } if (key === "operator") { rules[ri].value2 = ""; } c[gi] = { ...c[gi], rules }; onChange(c); };

  return (
    <div className="space-y-2">
      {conditions.map((group, gi) => {
        const fieldDefs = FRAUD_CONDITION_FIELDS;
        return (
          <div key={gi}>
            {gi > 0 && (
              <div className="flex items-center gap-2 my-1.5">
                <div className="flex-1 border-t border-slate-200" />
                <span className="px-2 py-0.5 rounded bg-blue-100 text-blue-700 text-xs font-bold">AND</span>
                <div className="flex-1 border-t border-slate-200" />
              </div>
            )}
            <div className={`rounded-lg border p-2.5 ${conditions.length > 1 ? "border-blue-200 bg-blue-50/30" : "border-slate-200 bg-slate-50/50"}`}>
              {group.rules.length > 1 && (
                <div className="flex items-center gap-1.5 mb-2">
                  <span className="text-xs text-slate-500">ã‚°ãƒ«ãƒ¼ãƒ—å†…æ¡ä»¶:</span>
                  {["AND","OR"].map(l => (
                    <button key={l} onClick={() => updateGroupLogic(gi, l)} className={`px-2 py-0.5 rounded text-xs font-bold ${group.logic === l ? (l === "AND" ? "bg-blue-600 text-white" : "bg-amber-500 text-white") : "bg-white text-slate-400 border"}`}>{l}</button>
                  ))}
                  <span className="text-xs text-slate-400 ml-1">{group.logic === "AND" ? "ï¼ˆã™ã¹ã¦æº€ãŸã™ï¼‰" : "ï¼ˆã„ãšã‚Œã‹æº€ãŸã™ï¼‰"}</span>
                </div>
              )}
              <div className="space-y-1.5">
                {group.rules.map((rule, ri) => {
                  const fd = fieldDefs.find(f => f.value === rule.field) || fieldDefs[0];
                  const ops = fd.operators || [">"];
                  return (
                    <div key={ri} className="flex items-center gap-1.5 bg-white rounded border border-slate-200 p-1.5">
                      {ri > 0 && group.rules.length > 1 && (
                        <span className={`text-xs font-bold px-1.5 py-0.5 rounded ${group.logic === "AND" ? "bg-blue-100 text-blue-600" : "bg-amber-100 text-amber-600"}`}>{group.logic}</span>
                      )}
                      <select value={rule.field} onChange={e => updateRule(gi, ri, "field", e.target.value)} className="text-xs border rounded px-1.5 py-1 bg-white min-w-[130px]">
                        {fieldDefs.map(f => <option key={f.value} value={f.value}>{f.label}</option>)}
                      </select>
                      <select value={rule.operator} onChange={e => updateRule(gi, ri, "operator", e.target.value)} className="text-xs border rounded px-1.5 py-1 bg-white min-w-[120px]">
                        {ops.map(o => <option key={o} value={o}>{OPERATOR_LABELS[o] || o}</option>)}
                      </select>
                      {fd.type === "boolean" ? (
                        <select value={rule.value || "true"} onChange={e => updateRule(gi, ri, "value", e.target.value)} className="text-xs border rounded px-1.5 py-1 bg-white w-16">
                          <option value="true">ã¯ã„</option><option value="false">ã„ã„ãˆ</option>
                        </select>
                      ) : fd.type === "select" && (rule.operator === "in" || rule.operator === "not_in") ? (
                        <input value={rule.value} onChange={e => updateRule(gi, ri, "value", e.target.value)} className="text-xs border rounded px-1.5 py-1 flex-1 font-mono" placeholder={`ä¾‹: ${fd.options.slice(0,2).join(", ")}`} />
                      ) : fd.type === "select" ? (
                        <select value={rule.value} onChange={e => updateRule(gi, ri, "value", e.target.value)} className="text-xs border rounded px-1.5 py-1 bg-white min-w-[80px]">
                          <option value="">é¸æŠ</option>
                          {fd.options.map(o => <option key={o} value={o}>{o}</option>)}
                        </select>
                      ) : rule.operator === "blocklist" || rule.operator === "new" ? (
                        <span className="text-xs text-slate-400 italic px-1">ï¼ˆè‡ªå‹•ç…§åˆï¼‰</span>
                      ) : (
                        <input value={rule.value} onChange={e => updateRule(gi, ri, "value", e.target.value)} className="text-xs border rounded px-1.5 py-1 flex-1 font-mono" placeholder={fd.unit ? `å€¤ï¼ˆ${fd.unit}ï¼‰` : "å€¤"} />
                      )}
                      {rule.operator === "between" && (
                        <><span className="text-xs text-slate-400">ã€œ</span><input value={rule.value2 || ""} onChange={e => updateRule(gi, ri, "value2", e.target.value)} className="text-xs border rounded px-1.5 py-1 w-20 font-mono" placeholder={fd.unit || "ä¸Šé™"} /></>
                      )}
                      {fd.timeWindow && (
                        <select value={rule.timeWindow || ""} onChange={e => updateRule(gi, ri, "timeWindow", e.target.value)} className="text-xs border rounded px-1.5 py-1 bg-white min-w-[70px]">
                          <option value="">æ™‚é–“çª“</option>
                          {TIME_WINDOWS.map(t => <option key={t} value={t}>{t}ä»¥å†…</option>)}
                        </select>
                      )}
                      <button onClick={() => removeRule(gi, ri)} className="text-slate-300 hover:text-rose-500 text-sm px-1" title="æ¡ä»¶ã‚’å‰Šé™¤">âœ•</button>
                    </div>
                  );
                })}
              </div>
              <div className="flex items-center gap-2 mt-1.5">
                <button onClick={() => addRule(gi)} className="text-xs text-blue-600 hover:text-blue-800 font-semibold">+ æ¡ä»¶ã‚’è¿½åŠ </button>
                {conditions.length > 1 && <button onClick={() => removeGroup(gi)} className="text-xs text-rose-400 hover:text-rose-600 ml-auto">ã‚°ãƒ«ãƒ¼ãƒ—å‰Šé™¤</button>}
              </div>
            </div>
          </div>
        );
      })}
      <button onClick={addGroup} className="text-xs text-blue-600 hover:text-blue-800 font-semibold border border-dashed border-blue-300 rounded-lg px-3 py-1.5 w-full hover:bg-blue-50 transition-colors">+ ANDã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¿½åŠ </button>
    </div>
  );
};

const conditionsToText = (conditions) => {
  return conditions.map(g => {
    const parts = g.rules.map(r => {
      const fd = FRAUD_CONDITION_FIELDS.find(f => f.value === r.field);
      const label = fd?.label || r.field;
      const opLabel = { ">":"ï¼", ">=":"â‰§", "<":"ï¼œ", "<=":"â‰¦", "==":"ï¼", "!=":"â‰ ", "between":"ã€œ", "in":"âˆˆ", "not_in":"âˆ‰", "contains":"å«ã‚€", "not_contains":"å«ã¾ãªã„", "regex":"æ­£è¦è¡¨ç¾", "blocklist":"ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆä¸€è‡´", "cidr":"CIDR", "new":"æ–°è¦" }[r.operator] || r.operator;
      if (fd?.type === "boolean") return `${label} ${r.value === "false" ? "= No" : "= Yes"}`;
      if (r.operator === "blocklist" || r.operator === "new") return `${label} ${opLabel}`;
      const tw = r.timeWindow ? `ï¼ˆ${r.timeWindow}ä»¥å†…ï¼‰` : "";
      if (r.operator === "between") return `${label} ${r.value}ã€œ${r.value2 || "?"}${fd?.unit || ""}${tw}`;
      return `${label} ${opLabel} ${r.value}${fd?.unit || ""}${tw}`;
    });
    return parts.length > 1 ? `(${parts.join(` ${g.logic} `)})` : parts[0];
  }).join(" AND ");
};

const MasterFraudSettings = () => {
  const toast = useToast();
  const [ruleTab, setRuleTab] = useState("rules");
  const [showAddRule, setShowAddRule] = useState(false);
  const [testMode, setTestMode] = useState(false);
  const [showAddBlock, setShowAddBlock] = useState(null);
  const [actionConfirm, setActionConfirm] = useState(null);
  const [expandedRule, setExpandedRule] = useState(null);
  const [newRuleConditions, setNewRuleConditions] = useState([{ logic: "AND", rules: [{ field: "amount", operator: ">", value: "", timeWindow: "" }] }]);

  const initConditions = {
    "FR-001": [{ logic: "AND", rules: [{ field: "amount", operator: ">", value: "500000", timeWindow: "" }] }],
    "FR-002": [{ logic: "AND", rules: [{ field: "velocity_card", operator: ">=", value: "3", timeWindow: "5åˆ†" }] }],
    "FR-003": [{ logic: "AND", rules: [
      { field: "card_country", operator: "!=", value: "JP", timeWindow: "" },
      { field: "amount", operator: ">", value: "100000", timeWindow: "" },
    ] }],
    "FR-004": [{ logic: "AND", rules: [
      { field: "hour", operator: "between", value: "0", value2: "6", timeWindow: "" },
      { field: "amount", operator: ">", value: "200000", timeWindow: "" },
    ] }],
    "FR-005": [{ logic: "AND", rules: [{ field: "ai_score", operator: ">", value: "0.80", timeWindow: "" }] }],
    "FR-006": [{ logic: "AND", rules: [
      { field: "ai_score", operator: ">", value: "0.60", timeWindow: "" },
      { field: "ai_score", operator: "<=", value: "0.80", timeWindow: "" },
    ] }],
    "FR-007": [{ logic: "AND", rules: [
      { field: "is_first_txn", operator: "==", value: "true", timeWindow: "" },
      { field: "amount", operator: ">", value: "300000", timeWindow: "" },
    ] }],
    "FR-008": [{ logic: "AND", rules: [{ field: "bin", operator: "blocklist", value: "", timeWindow: "" }] }],
  };
  const [ruleConditions, setRuleConditions] = useState(initConditions);
  const updateRuleConditions = (ruleId, conds) => setRuleConditions(prev => ({ ...prev, [ruleId]: conds }));

  const fraudRules = [
    { id: "FR-001", name: "é«˜é¡å–å¼•ãƒã‚§ãƒƒã‚¯", type: "é‡‘é¡é–¾å€¤", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š", priority: 1, enabled: true, hits30d: 12 },
    { id: "FR-002", name: "çŸ­æ™‚é–“é€£ç¶šå–å¼•", type: "é€Ÿåº¦ãƒã‚§ãƒƒã‚¯", action: "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯", priority: 2, enabled: true, hits30d: 8 },
    { id: "FR-003", name: "æµ·å¤–ã‚«ãƒ¼ãƒ‰åˆ¶é™", type: "åœ°åŸŸåˆ¶é™", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š", priority: 3, enabled: true, hits30d: 23 },
    { id: "FR-004", name: "æ·±å¤œå¸¯é«˜é¡", type: "æ™‚é–“å¸¯+é‡‘é¡", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š", priority: 4, enabled: true, hits30d: 3 },
    { id: "FR-005", name: "AIã‚¹ã‚³ã‚¢é–¾å€¤", type: "AIåˆ¤å®š", action: "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯", priority: 5, enabled: true, hits30d: 15 },
    { id: "FR-006", name: "AIã‚¹ã‚³ã‚¢æ³¨æ„", type: "AIåˆ¤å®š", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Šï¼ˆç¢ºèªï¼‰", priority: 6, enabled: true, hits30d: 42 },
    { id: "FR-007", name: "åˆå›å¤§å£å–å¼•", type: "ãƒ‘ã‚¿ãƒ¼ãƒ³", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š", priority: 7, enabled: false, hits30d: 0 },
    { id: "FR-008", name: "BINãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆ", type: "ãƒªã‚¹ãƒˆç…§åˆ", action: "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯", priority: 8, enabled: true, hits30d: 5 },
  ];

  return (
    <div className="p-5 space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-sm font-bold text-slate-800">ä¸æ­£æ¤œçŸ¥è¨­å®š</h2>
        <div className="flex gap-2">
          <button onClick={() => setTestMode(!testMode)} className={`text-xs px-3 py-1 rounded border font-semibold ${testMode ? "bg-amber-500 text-white border-yellow-500" : "bg-amber-100 text-amber-700 border-amber-300"}`}>{testMode ? "ğŸ§ª ãƒ†ã‚¹ãƒˆä¸­" : "ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰"}</button>
          <button onClick={() => setShowAddRule(true)} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">+ ãƒ«ãƒ¼ãƒ«è¿½åŠ </button>
        </div>
      </div>

      {/* KPIs */}
      <div className="flex gap-3">
        <KPICard label="ä»Šæœˆã®æ¤œçŸ¥ä»¶æ•°" value="89ä»¶" sub="å‰æœˆæ¯”" trend={-15} />
        <KPICard label="è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯" value="28ä»¶" sub="31.5%" color="red" />
        <KPICard label="ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š" value="61ä»¶" sub="68.5%" color="yellow" />
        <KPICard label="èª¤æ¤œçŸ¥ç‡" value="4.2%" sub="ç›®æ¨™: 5%ä»¥ä¸‹" color="green" />
        <KPICard label="AIåˆ¤å®šç²¾åº¦" value="96.8%" sub="ãƒ¢ãƒ‡ãƒ« v2.1" color="blue" />
      </div>

      {/* Tabs */}
      <div className="flex gap-1 border-b">
        {[{ id: "rules", label: "ãƒ«ãƒ¼ãƒ«ç®¡ç†" }, { id: "ai", label: "AIãƒ¢ãƒ‡ãƒ«è¨­å®š" }, { id: "lists", label: "ãƒ–ãƒ­ãƒƒã‚¯/ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ" }, { id: "import", label: "CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ" }, { id: "ng_list", label: "åˆ¶é™ç™»éŒ²ç¦æ­¢ãƒªã‚¹ãƒˆ" }, { id: "candidates", label: "å€™è£œ" }, { id: "log", label: "æ¤œçŸ¥ãƒ­ã‚°" }, { id: "merchant", label: "åŠ ç›Ÿåº—åˆ¥è¨­å®š" }].map(tab => (
          <button key={tab.id} onClick={() => setRuleTab(tab.id)} className={`text-xs px-3 py-2 border-b-2 ${ruleTab === tab.id ? "border-blue-500 text-blue-600 font-semibold" : "border-transparent text-slate-400"}`}>{tab.label}</button>
        ))}
      </div>

      {/* Tab: ãƒ«ãƒ¼ãƒ«ç®¡ç† */}
      {ruleTab === "rules" && (
        <div className="space-y-3">
          {/* Approval Flow Notice */}
          <div className="bg-blue-50 rounded border border-blue-200 p-2 flex items-center gap-2 text-xs">
            <span>ğŸ”’</span>
            <span className="text-blue-700">ãƒ«ãƒ¼ãƒ«å¤‰æ›´ã¯ <strong>admin â†’ super_admin ã®2æ®µéšæ‰¿èª</strong>ãŒå¿…è¦ã§ã™ã€‚super_adminã¯ç›´æ¥å¤‰æ›´å¯èƒ½ã€‚</span>
          </div>
          {/* ãƒ«ãƒ¼ãƒ«ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ */}
          <div className="space-y-2">
            {fraudRules.map((r) => (
              <div key={r.id} className={`bg-white rounded-lg border shadow-sm ${!r.enabled ? "opacity-60" : ""} ${expandedRule === r.id ? "border-blue-300 ring-1 ring-blue-100" : "border-slate-200"}`}>
                {/* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼‰ */}
                <button onClick={() => setExpandedRule(expandedRule === r.id ? null : r.id)} className="w-full flex items-center gap-3 px-4 py-2.5 text-left hover:bg-slate-50 transition-colors rounded-lg">
                  <span className={`text-xs transition-transform ${expandedRule === r.id ? "rotate-90" : ""}`}>â–¶</span>
                  <span className="text-xs font-mono text-slate-400 w-16">{r.id}</span>
                  <span className="text-xs font-bold text-slate-700 w-32">{r.name}</span>
                  <Badge text={r.type} color={r.type === "AIåˆ¤å®š" ? "purple" : r.type === "é€Ÿåº¦ãƒã‚§ãƒƒã‚¯" ? "blue" : "gray"} />
                  <span className="text-xs text-slate-500 font-mono flex-1 truncate ml-2">{conditionsToText(ruleConditions[r.id] || [])}</span>
                  <Badge text={r.action} color={r.action.includes("ãƒ–ãƒ­ãƒƒã‚¯") ? "red" : "yellow"} />
                  <span className="text-xs text-slate-500 w-16 text-right">å„ªå…ˆ: {r.priority}</span>
                  <span className="text-xs text-slate-500 w-16 text-right">{r.hits30d}ä»¶/30d</span>
                  {r.enabled ? <span className="text-emerald-500 text-xs">â—æœ‰åŠ¹</span> : <span className="text-slate-300 text-xs">â—‹ç„¡åŠ¹</span>}
                </button>
                {/* å±•é–‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                {expandedRule === r.id && (
                  <div className="border-t px-4 py-3 space-y-3 bg-slate-50/50">
                    <div className="grid grid-cols-3 gap-3">
                      <div>
                        <label className="text-xs font-semibold text-slate-600">ãƒ«ãƒ¼ãƒ«å</label>
                        <input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 bg-white" defaultValue={r.name} />
                      </div>
                      <div>
                        <label className="text-xs font-semibold text-slate-600">ç¨®åˆ¥</label>
                        <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 bg-white" defaultValue={r.type}>
                          <option>é‡‘é¡é–¾å€¤</option><option>é€Ÿåº¦ãƒã‚§ãƒƒã‚¯</option><option>åœ°åŸŸåˆ¶é™</option><option>æ™‚é–“å¸¯+é‡‘é¡</option><option>AIåˆ¤å®š</option><option>ãƒ‘ã‚¿ãƒ¼ãƒ³</option><option>ãƒªã‚¹ãƒˆç…§åˆ</option>
                        </select>
                      </div>
                      <div>
                        <label className="text-xs font-semibold text-slate-600">å„ªå…ˆé †ä½</label>
                        <input type="number" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 bg-white" defaultValue={r.priority} min="1" max="99" />
                      </div>
                    </div>
                    <div>
                      <label className="text-xs font-semibold text-slate-600 mb-1 block">æ¡ä»¶è¨­å®š</label>
                      <ConditionBuilder conditions={ruleConditions[r.id] || [{ logic: "AND", rules: [{ field: "amount", operator: ">", value: "" }] }]} onChange={(c) => updateRuleConditions(r.id, c)} />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="text-xs font-semibold text-slate-600">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
                        <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 bg-white" defaultValue={r.action}>
                          <option>è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯</option><option>ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š</option><option>ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Šï¼ˆç¢ºèªï¼‰</option><option>ãƒ•ãƒ©ã‚°ã®ã¿</option>
                        </select>
                      </div>
                      <div>
                        <label className="text-xs font-semibold text-slate-600">æœ‰åŠ¹/ç„¡åŠ¹</label>
                        <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5 bg-white" defaultValue={r.enabled ? "true" : "false"}>
                          <option value="true">æœ‰åŠ¹</option><option value="false">ç„¡åŠ¹</option>
                        </select>
                      </div>
                    </div>
                    <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700">
                      <div className="flex justify-between"><span>30æ—¥é–“ã®æ¤œçŸ¥æ•°: <strong>{r.hits30d}ä»¶</strong></span><span>ä½œæˆè€…: admin</span><span>æœ€çµ‚æ›´æ–°: 2026-02-10</span></div>
                    </div>
                    <div className="flex items-center justify-between pt-1">
                      <div className="flex gap-2">
                        <button onClick={() => toast(`${r.id} ã®ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã—ãŸ`, "info")} className="px-3 py-1.5 bg-amber-100 text-amber-700 rounded text-xs font-semibold border border-amber-200">ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                        <button onClick={() => setActionConfirm({ title: "ãƒ«ãƒ¼ãƒ«å‰Šé™¤", description: `${r.id} "${r.name}" ã‚’å‰Šé™¤ã—ã¾ã™ã€‚`, warning: "å‰Šé™¤å¾Œã€ã“ã®ãƒ«ãƒ¼ãƒ«ã«ã‚ˆã‚‹æ¤œçŸ¥ã¯è¡Œã‚ã‚Œãªããªã‚Šã¾ã™ã€‚æ¤œçŸ¥ãƒ­ã‚°ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚", type: "danger", onConfirm: () => { setExpandedRule(null); toast(`${r.id} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "warning"); } })} className="px-3 py-1.5 bg-rose-100 text-rose-600 rounded text-xs border border-rose-200">å‰Šé™¤</button>
                      </div>
                      <button onClick={() => setActionConfirm({ title: "ãƒ«ãƒ¼ãƒ«å¤‰æ›´ã®ä¿å­˜", description: `${r.id} "${r.name}" ã®å¤‰æ›´ã‚’ä¿å­˜ã—ã¾ã™ã€‚`, warning: "ãƒ«ãƒ¼ãƒ«å¤‰æ›´ã¯å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚adminæ¨©é™ã®å ´åˆã¯super_adminã®æ‰¿èªå¾Œã«é©ç”¨ã•ã‚Œã¾ã™ã€‚", type: "warning", onConfirm: () => { setExpandedRule(null); toast(`${r.id} "${r.name}" ã‚’ä¿å­˜ã—ã¾ã—ãŸ`, "success"); } })} className="px-4 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">ğŸ’¾ å¤‰æ›´ã‚’ä¿å­˜</button>
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
          {/* Simulation Panel */}
          <div className="bg-amber-50 rounded-lg border border-amber-300 p-3">
            <div className="flex items-center justify-between mb-2">
              <p className="text-xs font-bold text-amber-800">ğŸ§ª ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</p>
              <button onClick={() => toast("ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼ˆéå»30æ—¥ãƒ‡ãƒ¼ã‚¿ï¼‰", "info")} className="text-xs bg-amber-600 text-white px-3 py-1 rounded font-semibold">éå»30æ—¥ãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¡Œ</button>
            </div>
            <p className="text-xs text-amber-700 mb-2">ãƒ«ãƒ¼ãƒ«å¤‰æ›´å‰ã«ã€éå»30æ—¥ã®å–å¼•ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦å¤‰æ›´å¾Œã®ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã—ã€å½±éŸ¿ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
            <div className="bg-white rounded-lg border border-slate-200 p-2.5">
              <p className="text-xs text-slate-500 mb-1">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼ˆä¾‹ï¼‰:</p>
              <div className="grid grid-cols-3 gap-2 text-xs">
                <div className="bg-emerald-50 rounded p-1.5 text-center"><span className="text-slate-400">ãƒ–ãƒ­ãƒƒã‚¯å¢—åŠ </span><p className="font-bold text-emerald-700">+8ä»¶</p></div>
                <div className="bg-rose-50 rounded p-1.5 text-center"><span className="text-slate-400">ãƒ–ãƒ­ãƒƒã‚¯æ¸›å°‘</span><p className="font-bold text-rose-700">-2ä»¶</p></div>
                <div className="bg-blue-50 rounded p-1.5 text-center"><span className="text-slate-400">å½±éŸ¿åŠ ç›Ÿåº—</span><p className="font-bold text-blue-700">3ç¤¾</p></div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Tab: AIãƒ¢ãƒ‡ãƒ«è¨­å®š */}
      {ruleTab === "ai" && (
        <div className="space-y-3">
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex justify-between items-center mb-3">
              <p className="text-xs font-bold text-slate-700">ğŸ¤– ä¸æ­£æ¤œçŸ¥AIãƒ¢ãƒ‡ãƒ«</p>
              <Badge text="v2.1 ç¨¼åƒä¸­" color="green" />
            </div>
            <div className="grid grid-cols-3 gap-4">
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-2.5">
                <p className="text-xs font-semibold text-slate-600 mb-2">é–¾å€¤è¨­å®š</p>
                <div className="space-y-2">
                  <div>
                    <div className="flex justify-between text-xs mb-1"><span className="text-slate-500">è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯é–¾å€¤</span><span className="font-semibold text-rose-600">0.80</span></div>
                    <div className="w-full bg-slate-200 rounded h-2"><div className="bg-rose-500 rounded h-2" style={{ width: "80%" }} /></div>
                  </div>
                  <div>
                    <div className="flex justify-between text-xs mb-1"><span className="text-slate-500">è¦ç¢ºèªé–¾å€¤</span><span className="font-semibold text-amber-600">0.60</span></div>
                    <div className="w-full bg-slate-200 rounded h-2"><div className="bg-amber-500 rounded h-2" style={{ width: "60%" }} /></div>
                  </div>
                  <p className="text-xs text-slate-400 mt-2">é–¾å€¤ã‚’ä¸‹ã’ã‚‹ã¨æ¤œçŸ¥ç‡â†‘ èª¤æ¤œçŸ¥ç‡â†‘</p>
                  <p className="text-xs text-slate-400">é–¾å€¤ã‚’ä¸Šã’ã‚‹ã¨æ¤œçŸ¥ç‡â†“ èª¤æ¤œçŸ¥ç‡â†“</p>
                </div>
              </div>
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-2.5">
                <p className="text-xs font-semibold text-slate-600 mb-2">ãƒ¢ãƒ‡ãƒ«æ€§èƒ½</p>
                <div className="space-y-1.5 text-xs text-slate-600">
                  <div className="flex justify-between"><span>ç²¾åº¦ï¼ˆAccuracyï¼‰</span><span className="text-emerald-600 font-semibold">96.8%</span></div>
                  <div className="flex justify-between"><span>é©åˆç‡ï¼ˆPrecisionï¼‰</span><span className="text-emerald-600 font-semibold">95.8%</span></div>
                  <div className="flex justify-between"><span>å†ç¾ç‡ï¼ˆRecallï¼‰</span><span className="text-blue-600 font-semibold">91.2%</span></div>
                  <div className="flex justify-between"><span>F1ã‚¹ã‚³ã‚¢</span><span className="text-blue-600 font-semibold">93.5%</span></div>
                  <div className="flex justify-between"><span>èª¤æ¤œçŸ¥ç‡ï¼ˆFPRï¼‰</span><span className="text-emerald-600 font-semibold">4.2%</span></div>
                  <div className="flex justify-between"><span>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿</span><span className="text-slate-500">125,000ä»¶</span></div>
                  <div className="flex justify-between"><span>æœ€çµ‚å­¦ç¿’</span><span className="text-slate-500">2026-02-01</span></div>
                </div>
              </div>
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-2.5">
                <p className="text-xs font-semibold text-slate-600 mb-2">ç‰¹å¾´é‡ã®é‡è¦åº¦ï¼ˆTop 5ï¼‰</p>
                <div className="space-y-1.5">
                  {[
                    { name: "å–å¼•é‡‘é¡", imp: 0.23 },
                    { name: "ã‚«ãƒ¼ãƒ‰åˆ©ç”¨é »åº¦", imp: 0.19 },
                    { name: "ãƒ‡ãƒã‚¤ã‚¹ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ", imp: 0.16 },
                    { name: "åœ°åŸŸä¸ä¸€è‡´ã‚¹ã‚³ã‚¢", imp: 0.14 },
                    { name: "æ™‚é–“å¸¯ãƒªã‚¹ã‚¯", imp: 0.11 },
                  ].map((f, i) => (
                    <div key={i} className="flex items-center gap-2 text-xs">
                      <span className="w-40 text-slate-600">{f.name}</span>
                      <div className="flex-1 bg-slate-200 rounded h-2"><div className="bg-blue-500 rounded h-2" style={{ width: `${f.imp * 400}%` }} /></div>
                      <span className="w-10 text-right text-slate-500">{(f.imp * 100).toFixed(0)}%</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
          <div className="bg-amber-50 rounded-lg border border-amber-300 p-3">
            <p className="text-xs font-bold text-amber-800 mb-1">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚·ãƒ£ãƒ‰ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼‰</p>
            <p className="text-xs text-amber-700 mb-2">ã‚·ãƒ£ãƒ‰ãƒ¼ãƒ¢ãƒ¼ãƒ‰: åˆ¤å®šã™ã‚‹ãŒå®Ÿéš›ã®å–å¼•ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚æ–°ãƒ«ãƒ¼ãƒ«ã‚„ãƒ¢ãƒ‡ãƒ«ã®å½±éŸ¿ã‚’å®‰å…¨ã«ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚</p>
          </div>
          {/* Auto Retrain Schedule */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex justify-between items-center mb-2">
              <p className="text-xs font-bold text-slate-700">ğŸ”„ è‡ªå‹•å†å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</p>
              <Badge text="æ¯é€±æ—¥æ›œ AM3:00" color="blue" />
            </div>
            <div className="space-y-2">
              <div className="flex items-center gap-3 text-xs">
                <div className="flex items-center gap-1.5"><span className="w-5 h-5 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xs">1</span><span className="text-slate-600">è‡ªå‹•å†å­¦ç¿’</span></div>
                <span className="text-slate-300">â†’</span>
                <div className="flex items-center gap-1.5"><span className="w-5 h-5 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs">2</span><span className="text-slate-600">ã‚·ãƒ£ãƒ‰ãƒ¼ãƒ¢ãƒ¼ãƒ‰ 1é€±é–“</span></div>
                <span className="text-slate-300">â†’</span>
                <div className="flex items-center gap-1.5"><span className="w-5 h-5 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center text-xs">3</span><span className="text-slate-600">ç²¾åº¦æ¯”è¼ƒãƒ¬ãƒãƒ¼ãƒˆ</span></div>
                <span className="text-slate-300">â†’</span>
                <div className="flex items-center gap-1.5"><span className="w-5 h-5 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xs">4</span><span className="text-slate-600 font-semibold">äººé–“ãŒåˆ‡æ›¿åˆ¤æ–­</span></div>
              </div>
              {/* New model ready banner */}
              <div className="bg-emerald-50 rounded border border-emerald-300 p-2">
                <div className="flex justify-between items-center">
                  <div>
                    <p className="text-xs font-bold text-emerald-800">âœ… æ–°ãƒ¢ãƒ‡ãƒ« v2.4 ãŒæº–å‚™ã§ãã¾ã—ãŸ</p>
                    <p className="text-xs text-emerald-700 mt-0.5">å½é™½æ€§ç‡: <span className="font-semibold">0.3% â†’ 0.2%</span>ï¼ˆæ”¹å–„ï¼‰/ æ¤œçŸ¥ç‡: 96.8% â†’ 97.1%ï¼ˆæ”¹å–„ï¼‰</p>
                  </div>
                  <div className="flex gap-2">
                    <button onClick={() => setActionConfirm({ title: "æ–°ãƒ¢ãƒ‡ãƒ«å´ä¸‹", description: "æ–°ãƒ¢ãƒ‡ãƒ« v2.4 ã‚’å´ä¸‹ã—ã¾ã™ã€‚ç¾è¡Œãƒ¢ãƒ‡ãƒ« v2.3 ãŒç¶™ç¶šä½¿ç”¨ã•ã‚Œã¾ã™ã€‚", type: "warning", onConfirm: () => toast("æ–°ãƒ¢ãƒ‡ãƒ« v2.4 ã‚’å´ä¸‹ã—ã¾ã—ãŸ", "warning") })} className="px-3 py-1.5 bg-white text-slate-600 rounded text-xs border">å´ä¸‹</button>
                    <button onClick={() => setActionConfirm({ title: "æœ¬ç•ªãƒ¢ãƒ‡ãƒ«åˆ‡æ›¿", description: "ä¸æ­£æ¤œçŸ¥AIãƒ¢ãƒ‡ãƒ«ã‚’ v2.3 â†’ v2.4 ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚", warning: "åˆ‡æ›¿å¾Œã¯å³æ™‚åæ˜ ã•ã‚Œã¾ã™ã€‚å•é¡Œç™ºç”Ÿæ™‚ã¯æ‰‹å‹•ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå¿…è¦ã§ã™ã€‚", type: "approve", onConfirm: () => toast("ä¸æ­£æ¤œçŸ¥AIãƒ¢ãƒ‡ãƒ«ã‚’ v2.4 ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ", "success") })} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-semibold">âœ… æœ¬ç•ªã«åˆ‡æ›¿</button>
                  </div>
                </div>
              </div>
              <div className="flex gap-4 text-xs text-slate-400">
                <span>æ¬¡å›å®Ÿè¡Œ: 2026-02-16 AM3:00</span>
                <span>å‰å›çµæœ: 2026-02-09 æˆåŠŸï¼ˆv2.3 â†’ v2.4 ã‚·ãƒ£ãƒ‰ãƒ¼ä¸­ï¼‰</span>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Tab: ãƒ–ãƒ­ãƒƒã‚¯/ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ */}
      {ruleTab === "lists" && (
        <div className="grid grid-cols-2 gap-3">
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex justify-between items-center mb-2">
              <p className="text-xs font-bold text-rose-600">ğŸš« ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆ</p>
              <button onClick={() => setShowAddBlock("block")} className="text-xs bg-rose-100 text-rose-700 px-2 py-1 rounded border border-rose-200">+ è¿½åŠ </button>
            </div>
            <div className="space-y-1">
              {[
                { type: "BIN", value: "411111", reason: "ä¸æ­£åˆ©ç”¨å ±å‘Šå¤šæ•°", added: "02/05" },
                { type: "IP", value: "192.168.x.x", reason: "è‡ªå‹•æ”»æ’ƒæ¤œçŸ¥", added: "02/08" },
                { type: "ãƒ¡ãƒ¼ãƒ«", value: "*@temp-mail.xxx", reason: "ä½¿ã„æ¨ã¦ãƒ¡ãƒ¼ãƒ«", added: "01/28" },
              ].map((b, i) => (
                <div key={i} className="flex items-center gap-2 text-xs p-1.5 border rounded">
                  <Badge text={b.type} color="red" />
                  <span className="font-mono text-slate-700">{b.value}</span>
                  <span className="text-slate-400 flex-1">{b.reason}</span>
                  <span className="text-slate-400">{b.added}</span>
                  <button onClick={() => toast(`ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆã‹ã‚‰ ${b.value} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "warning")} className="text-rose-400 hover:text-rose-600">âœ•</button>
                </div>
              ))}
            </div>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex justify-between items-center mb-2">
              <p className="text-xs font-bold text-emerald-600">âœ… ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ</p>
              <button onClick={() => setShowAddBlock("white")} className="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded border border-emerald-200">+ è¿½åŠ </button>
            </div>
            <div className="space-y-1">
              {[
                { type: "åŠ ç›Ÿåº—", value: "M-001 ABCãƒãƒ¼ãƒˆ", reason: "è‡ªç¤¾ãƒ†ã‚¹ãƒˆç”¨", added: "01/15" },
                { type: "IP", value: "10.0.x.x", reason: "ç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯", added: "01/15" },
              ].map((w, i) => (
                <div key={i} className="flex items-center gap-2 text-xs p-1.5 border rounded">
                  <Badge text={w.type} color="green" />
                  <span className="font-mono text-slate-700">{w.value}</span>
                  <span className="text-slate-400 flex-1">{w.reason}</span>
                  <span className="text-slate-400">{w.added}</span>
                  <button onClick={() => toast(`ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‹ã‚‰ ${w.value} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "warning")} className="text-rose-400 hover:text-rose-600">âœ•</button>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* Tab: CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ */}
      {ruleTab === "import" && (
        <div className="space-y-3">
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4">
            <p className="text-xs font-bold text-slate-600 mb-3">ğŸ“¤ æ±ºæ¸ˆåˆ¶é™CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</p>
            <div className="border-2 border-dashed border-slate-300 rounded-lg p-8 text-center bg-slate-50 hover:bg-blue-50 hover:border-blue-300 transition-colors cursor-pointer">
              <p className="text-2xl mb-2">ğŸ“</p>
              <p className="text-xs font-semibold text-slate-600">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
              <p className="text-xs text-slate-400 mt-1">å¯¾å¿œå½¢å¼: CSVï¼ˆUTF-8ï¼‰/ æœ€å¤§10,000è¡Œ</p>
            </div>
            <div className="mt-3 p-2 bg-blue-50 rounded border border-blue-200 text-xs text-blue-700">
              <p className="font-semibold mb-1">CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:</p>
              <p className="font-mono">å¯¾è±¡é …ç›®,å¯¾è±¡å€¤,åˆ¶é™ç¨®åˆ¥,åˆ¶é™é‡‘é¡,å‚™è€ƒ</p>
              <p className="mt-1 text-blue-500">å¯¾è±¡é …ç›®: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ / ã‚«ãƒ¼ãƒ‰ç•ªå· / IPã‚¢ãƒ‰ãƒ¬ã‚¹ / BIN</p>
              <p className="text-blue-500">åˆ¶é™ç¨®åˆ¥: æ±ºæ¸ˆä¸å¯ / é‡‘é¡åˆ¶é™</p>
            </div>
            <div className="flex gap-2 mt-3">
              <button onClick={() => toast("CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼ˆ3ä»¶æˆåŠŸ / 0ä»¶å¤±æ•—ï¼‰", "success")} className="text-xs bg-blue-600 text-white px-4 py-1.5 rounded font-semibold">ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ</button>
              <button onClick={() => toast("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆCSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 text-slate-600 px-4 py-1.5 rounded border">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDL</button>
            </div>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold text-slate-600 mb-2">ã‚¤ãƒ³ãƒãƒ¼ãƒˆå±¥æ­´</p>
            <table className="w-full text-xs">
              <thead><tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold w-28">æ—¥æ™‚</th>
                <th className="text-left p-2 text-slate-500 font-semibold">ãƒ•ã‚¡ã‚¤ãƒ«å</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-16">ç·ä»¶æ•°</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-16">æˆåŠŸ</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-16">å¤±æ•—</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-20">å®Ÿè¡Œè€…</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-20">çŠ¶æ…‹</th>
              </tr></thead>
              <tbody>
                {[
                  { date: "02/15 14:30", file: "block_list_202602.csv", total: 156, ok: 152, ng: 4, user: "ä½è—¤èŠ±å­", status: "å®Œäº†", sColor: "green" },
                  { date: "02/10 10:00", file: "fraud_emails_batch.csv", total: 89, ok: 89, ng: 0, user: "ç”°ä¸­å¤ªéƒ", status: "å®Œäº†", sColor: "green" },
                  { date: "02/05 16:45", file: "ip_block_update.csv", total: 230, ok: 0, ng: 230, user: "éˆ´æœ¨ä¸€éƒ", status: "ã‚¨ãƒ©ãƒ¼", sColor: "red" },
                ].map((h, i) => (
                  <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
                    <td className="p-2 text-slate-400 font-mono">{h.date}</td>
                    <td className="p-2 text-slate-700 font-semibold">{h.file}</td>
                    <td className="p-2 text-center">{h.total}</td>
                    <td className="p-2 text-center text-emerald-600 font-semibold">{h.ok}</td>
                    <td className="p-2 text-center text-rose-600 font-semibold">{h.ng}</td>
                    <td className="p-2 text-slate-600">{h.user}</td>
                    <td className="p-2 text-center"><Badge text={h.status} color={h.sColor} /></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* Tab: åˆ¶é™ç™»éŒ²ç¦æ­¢ãƒªã‚¹ãƒˆ */}
      {ruleTab === "ng_list" && (
        <div className="space-y-3">
          <div className="bg-amber-50 rounded border border-amber-200 p-2 text-xs text-amber-700">
            âš ï¸ ã“ã®ã€Œç¦æ­¢ãƒªã‚¹ãƒˆã€ã«ç™»éŒ²ã•ã‚ŒãŸå€¤ã¯ã€æ±ºæ¸ˆåˆ¶é™ã«è¿½åŠ ã§ããªããªã‚Šã¾ã™ã€‚èª¤ãƒ–ãƒ­ãƒƒã‚¯é˜²æ­¢ã®ãŸã‚ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã§ã™ã€‚
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex justify-between items-center mb-3">
              <p className="text-xs font-bold text-slate-600">åˆ¶é™ç™»éŒ²ç¦æ­¢ãƒªã‚¹ãƒˆæ¤œç´¢</p>
              <button onClick={() => setShowAddBlock("ng")} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">+ æ–°è¦ç™»éŒ²</button>
            </div>
            <div className="grid grid-cols-4 gap-2 mb-3">
              <div><label className="text-xs text-slate-400">å¯¾è±¡é …ç›®</label><select className="w-full text-xs border rounded px-2 py-1.5"><option>å…¨ã¦</option><option>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</option><option>ã‚«ãƒ¼ãƒ‰ç•ªå·</option><option>IPã‚¢ãƒ‰ãƒ¬ã‚¹</option><option>BIN</option></select></div>
              <div><label className="text-xs text-slate-400">å¯¾è±¡å€¤</label><input className="w-full text-xs border rounded px-2 py-1.5" placeholder="å€¤ã§æ¤œç´¢" /></div>
              <div><label className="text-xs text-slate-400">ç™»éŒ²æ—¥</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5" /></div>
              <div className="flex items-end"><button onClick={() => toast("æ¤œç´¢æ¡ä»¶ã‚’é©ç”¨ã—ã¾ã—ãŸ", "info")} className="text-xs bg-blue-600 text-white px-4 py-1.5 rounded font-semibold w-full">æ¤œç´¢</button></div>
            </div>
            <table className="w-full text-xs">
              <thead><tr className="bg-slate-50 border-b">
                <th className="text-left p-2 text-slate-500 font-semibold w-12">ID</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-28">å¯¾è±¡é …ç›®</th>
                <th className="text-left p-2 text-slate-500 font-semibold">å¯¾è±¡å€¤</th>
                <th className="text-left p-2 text-slate-500 font-semibold">ç†ç”±</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-20">ç™»éŒ²è€…</th>
                <th className="text-left p-2 text-slate-500 font-semibold w-28">ç™»éŒ²æ—¥æ™‚</th>
                <th className="text-center p-2 text-slate-500 font-semibold w-16">æ“ä½œ</th>
              </tr></thead>
              <tbody>
                {[
                  { id: 1, item: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", value: "ceo@abcmart.co.jp", reason: "ABCãƒãƒ¼ãƒˆä»£è¡¨ â€” æ­£å½“ãªé«˜é¡å–å¼•ã‚ã‚Š", user: "ç”°ä¸­å¤ªéƒ", date: "01/20 09:00" },
                  { id: 2, item: "IPã‚¢ãƒ‰ãƒ¬ã‚¹", value: "203.0.113.0/24", reason: "Univa Pay castãƒ†ã‚¹ãƒˆç’°å¢ƒ", user: "ä½è—¤èŠ±å­", date: "01/15 14:30" },
                  { id: 3, item: "ã‚«ãƒ¼ãƒ‰ç•ªå·", value: "4111-****-****-1111", reason: "ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰", user: "ç”°ä¸­å¤ªéƒ", date: "01/10 10:00" },
                  { id: 4, item: "BIN", value: "411111", reason: "VISAãƒ†ã‚¹ãƒˆBIN", user: "éˆ´æœ¨ä¸€éƒ", date: "12/25 16:00" },
                ].map((r, i) => (
                  <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""} hover:bg-blue-50`}>
                    <td className="p-2 font-mono text-slate-400">{r.id}</td>
                    <td className="p-2"><Badge text={r.item} color={r.item === "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" ? "blue" : r.item === "IPã‚¢ãƒ‰ãƒ¬ã‚¹" ? "purple" : r.item === "ã‚«ãƒ¼ãƒ‰ç•ªå·" ? "yellow" : "default"} /></td>
                    <td className="p-2 font-mono text-slate-700">{r.value}</td>
                    <td className="p-2 text-slate-500">{r.reason}</td>
                    <td className="p-2 text-slate-600">{r.user}</td>
                    <td className="p-2 text-slate-400 font-mono">{r.date}</td>
                    <td className="p-2 text-center"><button onClick={() => setActionConfirm({ title: "ç¦æ­¢ãƒªã‚¹ãƒˆé …ç›®å‰Šé™¤", description: `${r.item}: ${r.value} ã‚’ç¦æ­¢ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã€‚`, warning: "å‰Šé™¤å¾Œã€ã“ã®å€¤ã¯åˆ¶é™ç™»éŒ²ã®å¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚", type: "danger", onConfirm: () => toast(`${r.value} ã‚’ç¦æ­¢ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ`, "warning") })} className="text-rose-500 hover:text-rose-700">å‰Šé™¤</button></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* Tab: å€™è£œï¼ˆåˆ¶é™å€™è£œã®è‡ªå‹•æ¤œçŸ¥â†’æ¡ç”¨/ä¸æ¡ç”¨ï¼‰ */}
      {ruleTab === "candidates" && (
        <div className="space-y-3">
          <div className="bg-amber-50 rounded border border-amber-200 p-2 text-xs text-amber-800">
            ğŸ¤– AI/ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§ä¸æ­£ã®ç–‘ã„ãŒã‚ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è‡ªå‹•æ¤œå‡ºã—ã¦ã„ã¾ã™ã€‚å†…å®¹ã‚’ç¢ºèªã—ã€Œæ¡ç”¨ã€ï¼ˆãƒ–ãƒ­ãƒƒã‚¯è¿½åŠ ï¼‰ã¾ãŸã¯ã€Œä¸æ¡ç”¨ã€ï¼ˆé™¤å¤–ï¼‰ã‚’åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚
          </div>
          <div className="flex gap-3">
            <KPICard label="æœªå‡¦ç†" value="12ä»¶" sub="è¦ç¢ºèª" color="yellow" />
            <KPICard label="ä»Šæœˆæ¡ç”¨" value="34ä»¶" sub="ãƒ–ãƒ­ãƒƒã‚¯è¿½åŠ æ¸ˆ" color="red" />
            <KPICard label="ä»Šæœˆä¸æ¡ç”¨" value="8ä»¶" sub="é™¤å¤–æ¸ˆ" color="green" />
            <KPICard label="è‡ªå‹•æœŸé™åˆ‡ã‚Œ" value="3ä»¶" sub="30æ—¥è¶…é" />
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex items-center gap-3 mb-3">
              <div className="flex gap-1">
                {["å…¨ã¦","æœªå‡¦ç†","æ¡ç”¨æ¸ˆ","ä¸æ¡ç”¨"].map((s, i) => (
                  <button key={s} className={`text-xs px-2.5 py-1 rounded ${i === 1 ? "bg-amber-500 text-white font-semibold" : "bg-slate-100 text-slate-500"}`}>{s}</button>
                ))}
              </div>
              <select className="text-xs border rounded px-2 py-1"><option>å…¨ç¨®åˆ¥</option><option>ã‚«ãƒ¼ãƒ‰BIN</option><option>IPã‚¢ãƒ‰ãƒ¬ã‚¹</option><option>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</option><option>ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³</option><option>ãƒ‡ãƒã‚¤ã‚¹</option></select>
              <select className="text-xs border rounded px-2 py-1"><option>ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢: å…¨ã¦</option><option>90ä»¥ä¸Šï¼ˆæ¥µé«˜ï¼‰</option><option>70-89ï¼ˆé«˜ï¼‰</option><option>50-69ï¼ˆä¸­ï¼‰</option></select>
            </div>
            <table className="w-full text-xs">
              <thead>
                <tr className="bg-slate-50 border-b">
                  <th className="text-left p-2 text-slate-500 font-semibold">æ¤œå‡ºæ—¥</th>
                  <th className="text-left p-2 text-slate-500 font-semibold">ç¨®åˆ¥</th>
                  <th className="text-left p-2 text-slate-500 font-semibold">å€¤</th>
                  <th className="text-left p-2 text-slate-500 font-semibold">æ¤œå‡ºç†ç”±</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">ã‚¹ã‚³ã‚¢</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">è©²å½“å–å¼•</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                {[
                  { date: "2026-02-21 14:32", type: "ã‚«ãƒ¼ãƒ‰BIN", value: "411111", reason: "5åˆ†é–“ã«8å›å¤±æ•—ï¼ˆé–¾å€¤: 5å›ï¼‰", score: 92, txns: 23, status: "æœªå‡¦ç†" },
                  { date: "2026-02-21 12:15", type: "IPã‚¢ãƒ‰ãƒ¬ã‚¹", value: "203.0.113.45", reason: "ç•°ãªã‚‹10æšã®ã‚«ãƒ¼ãƒ‰ã§æ±ºæ¸ˆè©¦è¡Œ", score: 88, txns: 10, status: "æœªå‡¦ç†" },
                  { date: "2026-02-21 10:05", type: "ãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³", value: "@tempmail.xyz", reason: "ä½¿ã„æ¨ã¦ãƒ¡ãƒ¼ãƒ« + ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ç‡12%", score: 85, txns: 45, status: "æœªå‡¦ç†" },
                  { date: "2026-02-20 22:41", type: "ãƒ‡ãƒã‚¤ã‚¹", value: "fp_a3f8c2...d91e", reason: "3ã‚µã‚¤ãƒˆã§åŒä¸€ãƒ‡ãƒã‚¤ã‚¹ã€å…¨ã¦å¤±æ•—", score: 78, txns: 9, status: "æœªå‡¦ç†" },
                  { date: "2026-02-20 18:30", type: "ã‚«ãƒ¼ãƒ‰BIN", value: "520000", reason: "æµ·å¤–ç™ºè¡Œ + é«˜é¡å–å¼•é›†ä¸­", score: 71, txns: 15, status: "æœªå‡¦ç†" },
                  { date: "2026-02-20 09:12", type: "IPã‚¢ãƒ‰ãƒ¬ã‚¹", value: "198.51.100.22", reason: "Torå‡ºå£ãƒãƒ¼ãƒ‰ + é€£ç¶šæ±ºæ¸ˆ", score: 95, txns: 7, status: "æ¡ç”¨æ¸ˆ" },
                  { date: "2026-02-19 16:55", type: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", value: "test***@gmail.com", reason: "åŒä¸€ãƒ¡ãƒ¼ãƒ«ã§5åŠ ç›Ÿåº—ã«æ±ºæ¸ˆ", score: 62, txns: 5, status: "ä¸æ¡ç”¨" },
                  { date: "2026-02-19 08:20", type: "ã‚«ãƒ¼ãƒ‰BIN", value: "601100", reason: "AIã‚¹ã‚³ã‚¢å¹³å‡0.82", score: 74, txns: 31, status: "æ¡ç”¨æ¸ˆ" },
                ].map((c, i) => (
                  <tr key={i} className={`border-b ${c.status === "æœªå‡¦ç†" ? "bg-amber-50/50" : ""}`}>
                    <td className="p-2 text-slate-500">{c.date}</td>
                    <td className="p-2"><Badge text={c.type} color={c.type === "ã‚«ãƒ¼ãƒ‰BIN" ? "blue" : c.type === "IPã‚¢ãƒ‰ãƒ¬ã‚¹" ? "purple" : c.type.includes("ãƒ¡ãƒ¼ãƒ«") ? "cyan" : "slate"} /></td>
                    <td className="p-2 font-mono font-semibold text-slate-700">{c.value}</td>
                    <td className="p-2 text-slate-600">{c.reason}</td>
                    <td className="p-2 text-center"><span className={`inline-block px-2 py-0.5 rounded-full font-bold ${c.score >= 90 ? "bg-rose-100 text-rose-700" : c.score >= 70 ? "bg-amber-100 text-amber-700" : "bg-yellow-100 text-yellow-700"}`}>{c.score}</span></td>
                    <td className="p-2 text-center text-slate-600">{c.txns}ä»¶</td>
                    <td className="p-2 text-center"><Badge text={c.status} color={c.status === "æœªå‡¦ç†" ? "yellow" : c.status === "æ¡ç”¨æ¸ˆ" ? "red" : "green"} /></td>
                    <td className="p-2 text-center">
                      {c.status === "æœªå‡¦ç†" ? (
                        <div className="flex gap-1 justify-center">
                          <button onClick={() => toast(`${c.type} ${c.value} ã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ`, "warning")} className="px-2 py-0.5 bg-rose-600 text-white rounded text-xs font-semibold">æ¡ç”¨</button>
                          <button onClick={() => toast(`${c.type} ${c.value} ã‚’ä¸æ¡ç”¨ã«ã—ã¾ã—ãŸ`, "info")} className="px-2 py-0.5 bg-slate-200 text-slate-600 rounded text-xs">ä¸æ¡ç”¨</button>
                        </div>
                      ) : (
                        <span className="text-xs text-slate-400">{c.status === "æ¡ç”¨æ¸ˆ" ? "ãƒ–ãƒ­ãƒƒã‚¯ä¸­" : "é™¤å¤–æ¸ˆ"}</span>
                      )}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          <div className="bg-slate-50 rounded border border-slate-200 p-2 text-xs text-slate-500">
            ğŸ’¡ å€™è£œã¯æ¤œå‡ºã‹ã‚‰30æ—¥é–“æœªå‡¦ç†ã®å ´åˆã€è‡ªå‹•çš„ã«æœŸé™åˆ‡ã‚Œã¨ãªã‚Šã¾ã™ã€‚æ¡ç”¨ã•ã‚ŒãŸå€™è£œã¯M07ã€Œãƒ–ãƒ­ãƒƒã‚¯/ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã€ã‚¿ãƒ–ã«è‡ªå‹•è¿½åŠ ã•ã‚Œã¾ã™ã€‚
          </div>
        </div>
      )}

      {/* Tab: æ¤œçŸ¥ãƒ­ã‚° */}
      {ruleTab === "log" && (
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
          <TableHeader cols={[{ label: "æ—¥æ™‚", w: "w-32" }, { label: "å–å¼•ID", w: "w-36" }, { label: "åŠ ç›Ÿåº—", w: "flex-1" }, { label: "é‡‘é¡", w: "w-24" }, { label: "æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«", w: "w-36" }, { label: "AIã‚¹ã‚³ã‚¢", w: "w-20" }, { label: "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³", w: "w-28" }, { label: "çµæœ", w: "w-20" }]}>
          {[
            { time: "02/11 14:50", txn: "TXN-14516", merchant: "ãƒˆãƒ©ãƒ™ãƒ«ãƒ—ãƒ©ã‚¹", amount: "Â¥158,000", rule: "AIã‚¹ã‚³ã‚¢é–¾å€¤", score: "0.92", action: "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯", result: "æ­£æ¤œçŸ¥", rColor: "green" },
            { time: "02/11 12:15", txn: "TXN-12103", merchant: "ABCãƒãƒ¼ãƒˆ", amount: "Â¥520,000", rule: "é«˜é¡å–å¼•ãƒã‚§ãƒƒã‚¯", score: "0.45", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", result: "æ­£å¸¸å–å¼•", rColor: "yellow" },
            { time: "02/11 09:30", txn: "TXN-09288", merchant: "XYZã‚·ãƒ§ãƒƒãƒ—", amount: "Â¥8,500", rule: "çŸ­æ™‚é–“é€£ç¶šå–å¼•", score: "0.72", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", result: "æ­£æ¤œçŸ¥", rColor: "green" },
            { time: "02/10 22:10", txn: "TXN-22041", merchant: "ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ©ã‚¹", amount: "Â¥250,000", rule: "æ·±å¤œå¸¯é«˜é¡", score: "0.55", action: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", result: "æ­£å¸¸å–å¼•", rColor: "yellow" },
          ].map((l, i) => (
            <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
              <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-400 font-mono">{l.time}</td>
              <td className="px-4 py-2 whitespace-nowrap w-36 font-mono text-slate-500">{l.txn}</td>
              <td className="px-4 py-2 whitespace-nowrap text-slate-700">{l.merchant}</td>
              <td className="px-4 py-2 whitespace-nowrap w-24 text-right font-semibold">{l.amount}</td>
              <td className="px-4 py-2 whitespace-nowrap w-36"><Badge text={l.rule} color="purple" /></td>
              <td className="px-4 py-2 whitespace-nowrap w-20 text-center font-mono">{l.score}</td>
              <td className="px-4 py-2 whitespace-nowrap w-28"><Badge text={l.action} color={l.action === "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯" ? "red" : "yellow"} /></td>
              <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={l.result} color={l.rColor} /></td>
            </tr>
          ))}
          </TableHeader>
        </div>
      )}

      {/* Tab: åŠ ç›Ÿåº—åˆ¥è¨­å®š */}
      {ruleTab === "merchant" && (
        <div className="space-y-3">
          <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700">
            ğŸ’¡ åŠ ç›Ÿåº—ã”ã¨ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ«ãƒ¼ãƒ«ã®é–¾å€¤ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ãã¾ã™ã€‚æ¥­æ…‹ã«åˆã‚ã›ãŸæŸ”è»Ÿãªè¨­å®šã§<strong>å¥å…¨ãªæ±ºæ¸ˆã‚’æ­¢ã‚ãªã„</strong>ã“ã¨ãŒç›®çš„ã§ã™ã€‚
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex items-center gap-3 mb-3">
              <label className="text-xs font-bold text-slate-600">åŠ ç›Ÿåº—é¸æŠ:</label>
              <div className="relative">
                <div className="flex items-center border rounded bg-white">
                  <span className="text-xs text-slate-400 pl-2">ğŸ”</span>
                  <input className="text-xs px-2 py-1.5 w-56 outline-none" placeholder="IDãƒ»åå‰ã§æ¤œç´¢" />
                </div>
              </div>
              <Badge text="M-001 æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ" color="blue" />
              <button onClick={() => setShowAddBlock("custom")} className="text-xs bg-blue-600 text-white px-3 py-1 rounded">+ ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’è¿½åŠ </button>
            </div>
            <table className="w-full text-xs">
              <thead>
                <tr className="bg-slate-50 border-b">
                  <th className="text-left p-2 text-slate-500 font-semibold">ãƒ«ãƒ¼ãƒ«</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">ã‚«ã‚¹ã‚¿ãƒ å€¤</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">å·®åˆ†</th>
                  <th className="text-center p-2 text-slate-500 font-semibold">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                {[
                  { rule: "é«˜é¡å–å¼•ãƒã‚§ãƒƒã‚¯", global: "Â¥500,000", custom: "Â¥2,000,000", diff: "â†‘ ç·©å’Œ" },
                  { rule: "æµ·å¤–ã‚«ãƒ¼ãƒ‰åˆ¶é™", global: "Â¥100,000", custom: "Â¥500,000", diff: "â†‘ ç·©å’Œ" },
                  { rule: "æ·±å¤œå¸¯é«˜é¡", global: "Â¥200,000", custom: "Â¥1,000,000", diff: "â†‘ ç·©å’Œ" },
                  { rule: "AIã‚¹ã‚³ã‚¢ ãƒ–ãƒ­ãƒƒã‚¯é–¾å€¤", global: "0.70", custom: "0.80", diff: "â†‘ ç·©å’Œ" },
                ].map((r, i) => (
                  <tr key={i} className="border-b">
                    <td className="p-2 font-semibold text-slate-700">{r.rule} <span className="text-amber-500">âš ï¸</span></td>
                    <td className="p-2 text-center text-slate-400">{r.global}</td>
                    <td className="p-2 text-center font-bold text-blue-700">{r.custom}</td>
                    <td className="p-2 text-center font-semibold text-blue-600">{r.diff}</td>
                    <td className="p-2 text-center"><button onClick={() => toast(`${r.rule} ã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’ç·¨é›†ä¸­`, "info")} className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">ç·¨é›†</button> <button onClick={() => setActionConfirm({ title: "ã‚«ã‚¹ã‚¿ãƒ è¨­å®šå‰Šé™¤", description: `${r.rule} ã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤ ${r.global} ã«æˆ»ã‚Šã¾ã™ã€‚`, type: "danger", onConfirm: () => toast(`${r.rule} ã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "warning") })} className="px-2 py-0.5 bg-rose-100 text-rose-600 rounded text-xs">å‰Šé™¤</button></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          <div className="bg-amber-50 rounded border border-amber-300 p-2 flex items-center justify-between">
            <span className="text-xs text-amber-800">ğŸ§ª ã“ã®åŠ ç›Ÿåº—ã®éå»å–å¼•ãƒ‡ãƒ¼ã‚¿ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã¾ã™</span>
            <button onClick={() => toast("åŠ ç›Ÿåº—åˆ¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã—ãŸ", "info")} className="text-xs bg-amber-600 text-white px-3 py-1 rounded font-semibold">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: ãƒ«ãƒ¼ãƒ«è¿½åŠ  â”€â”€ */}

      {/* â”€â”€ Modal: ãƒ–ãƒ­ãƒƒã‚¯/ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆè¿½åŠ  â”€â”€ */}
      {showAddBlock && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowAddBlock(null)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
            <div className={`p-4 border-b rounded-t-xl flex justify-between items-center ${showAddBlock === "block" ? "bg-rose-50" : "bg-emerald-50"}`}>
              <h3 className="text-sm font-bold text-slate-800">{showAddBlock === "block" ? "ğŸš« ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆã«è¿½åŠ " : "âœ… ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«è¿½åŠ "}</h3>
              <button onClick={() => setShowAddBlock(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div><label className="text-xs font-semibold text-slate-600">ç¨®åˆ¥ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>BINï¼ˆã‚«ãƒ¼ãƒ‰ç•ªå·å…ˆé ­6æ¡ï¼‰</option><option>IPã‚¢ãƒ‰ãƒ¬ã‚¹</option><option>ãƒ‡ãƒã‚¤ã‚¹ID</option><option>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</option></select></div>
              <div><label className="text-xs font-semibold text-slate-600">å€¤ <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: 411111 / 192.168.1.1" /></div>
              <div><label className="text-xs font-semibold text-slate-600">ç†ç”± <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="è¿½åŠ ç†ç”±ã‚’å…¥åŠ›" /></div>
              <div><label className="text-xs font-semibold text-slate-600">æœ‰åŠ¹æœŸé™</label><div className="flex gap-2 mt-0.5"><select className="text-xs border rounded px-2 py-1.5"><option>æ°¸ä¹…</option><option>æ—¥æ™‚æŒ‡å®š</option></select><input type="date" className="text-xs border rounded px-2 py-1.5" /></div></div>
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-2.5 text-xs text-slate-500">ğŸ’¡ CSVã§ä¸€æ‹¬è¿½åŠ ã™ã‚‹å ´åˆã¯ã€Œãƒ–ãƒ­ãƒƒã‚¯/ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã€ã‚¿ãƒ–ã®CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ãã ã•ã„</div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowAddBlock(null)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { const type = showAddBlock === "block" ? "ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆ" : showAddBlock === "white" ? "ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ" : showAddBlock === "ng" ? "ç¦æ­¢ãƒªã‚¹ãƒˆ" : "ã‚«ã‚¹ã‚¿ãƒ è¨­å®š"; setShowAddBlock(null); toast(`${type}ã«è¿½åŠ ã—ã¾ã—ãŸ`, "success"); }} className={`px-4 py-2 text-xs text-white rounded font-semibold ${showAddBlock === "block" ? "bg-rose-600 hover:bg-rose-700" : "bg-emerald-600 hover:bg-emerald-700"}`}>è¿½åŠ ã™ã‚‹</button>
            </div>
          </div>
        </div>
      )}

      <ConfirmDialog config={actionConfirm} onClose={() => setActionConfirm(null)} />

      {showAddRule && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowAddRule(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[560px] max-h-[85vh] overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">ä¸æ­£æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«è¿½åŠ </h3>
              <button onClick={() => setShowAddRule(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              {/* ãƒ«ãƒ¼ãƒ«ç¨®åˆ¥ */}
              <div>
                <label className="text-xs font-semibold text-slate-600">ãƒ«ãƒ¼ãƒ«ç¨®åˆ¥ <span className="text-rose-500">*</span></label>
                <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                  <option>é¸æŠã—ã¦ãã ã•ã„</option>
                  <option>é‡‘é¡é–¾å€¤</option>
                  <option>é€Ÿåº¦ãƒã‚§ãƒƒã‚¯ï¼ˆé€£ç¶šå–å¼•ï¼‰</option>
                  <option>åœ°åŸŸåˆ¶é™</option>
                  <option>æ™‚é–“å¸¯+é‡‘é¡</option>
                  <option>AIåˆ¤å®šã‚¹ã‚³ã‚¢</option>
                  <option>ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œçŸ¥</option>
                  <option>ãƒªã‚¹ãƒˆç…§åˆï¼ˆBIN/ã‚«ãƒ¼ãƒ‰ï¼‰</option>
                  <option>ã‚«ã‚¹ã‚¿ãƒ æ¡ä»¶</option>
                </select>
              </div>
              {/* ãƒ«ãƒ¼ãƒ«å */}
              <div>
                <label className="text-xs font-semibold text-slate-600">ãƒ«ãƒ¼ãƒ«å <span className="text-rose-500">*</span></label>
                <input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: é«˜é¡å–å¼•ãƒã‚§ãƒƒã‚¯" />
              </div>
              {/* æ¡ä»¶è¨­å®š */}
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-3 space-y-2">
                <p className="text-xs font-bold text-slate-600">æ¡ä»¶è¨­å®š <span className="text-rose-500">*</span></p>
                <ConditionBuilder conditions={newRuleConditions} onChange={setNewRuleConditions} />
              </div>
              {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */}
              <div>
                <label className="text-xs font-semibold text-slate-600">æ¤œçŸ¥æ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ <span className="text-rose-500">*</span></label>
                <div className="flex gap-3 mt-1">
                  {[
                    { label: "è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯", desc: "å³æ™‚ãƒ–ãƒ­ãƒƒã‚¯", color: "border-rose-300 bg-rose-50" },
                    { label: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼é€ã‚Š", desc: "ç›®è¦–ç¢ºèª", color: "border-amber-300 bg-amber-50" },
                    { label: "ãƒ•ãƒ©ã‚°ã®ã¿", desc: "è¨˜éŒ²ã®ã¿", color: "border-slate-300 bg-slate-50" },
                  ].map((a, i) => (
                    <label key={i} className={`flex-1 rounded border-2 p-2 text-center cursor-pointer text-xs ${i === 1 ? a.color + " font-bold" : a.color}`}>
                      <input type="radio" name="action" className="sr-only" defaultChecked={i === 1} />
                      <p className="font-semibold">{a.label}</p>
                      <p className="text-slate-400 mt-0.5">{a.desc}</p>
                    </label>
                  ))}
                </div>
              </div>
              {/* å„ªå…ˆé †ä½ */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="text-xs font-semibold text-slate-600">å„ªå…ˆé †ä½ <span className="text-rose-500">*</span></label>
                  <input type="number" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="9" min="1" max="99" />
                  <p className="text-xs text-slate-400 mt-0.5">æ•°å­—ãŒå°ã•ã„ã»ã©å…ˆã«è©•ä¾¡</p>
                </div>
                <div>
                  <label className="text-xs font-semibold text-slate-600">é©ç”¨ã‚¹ã‚³ãƒ¼ãƒ—</label>
                  <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                    <option>ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆå…¨åŠ ç›Ÿåº—ï¼‰</option>
                    <option>åŠ ç›Ÿåº—æŒ‡å®š</option>
                  </select>
                </div>
              </div>
              {/* ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ */}
              <div className="bg-blue-50 rounded border border-blue-200 p-2 flex items-center justify-between">
                <div>
                  <p className="text-xs font-bold text-blue-700">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§ä½œæˆ</p>
                  <p className="text-xs text-blue-500">å®Ÿéš›ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯è¡Œã‚ãšã€æ¤œçŸ¥ãƒ­ã‚°ã«ã®ã¿è¨˜éŒ²ã—ã¾ã™</p>
                </div>
                <div className="w-10 h-5 rounded-full bg-blue-500 relative cursor-pointer">
                  <div className="absolute top-0.5 right-0.5 w-4 h-4 bg-white rounded-full shadow" />
                </div>
              </div>
            </div>
            {/* Footer */}
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowAddRule(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setActionConfirm({ title: "ãƒ«ãƒ¼ãƒ«ä½œæˆã®ç¢ºèª", description: "æ–°ã—ã„ä¸æ­£æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚", warning: "ä½œæˆå¾Œã€adminæ¨©é™ã®å ´åˆã¯super_adminã®æ‰¿èªå¾…ã¡ã«ãªã‚Šã¾ã™ã€‚super_adminã®å ´åˆã¯å³åº§ã«æœ‰åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚", type: "approve", onConfirm: () => { setShowAddRule(false); setNewRuleConditions([{ logic: "AND", rules: [{ field: "amount", operator: ">", value: "", timeWindow: "" }] }]); toast("ä¸æ­£æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸï¼ˆæ‰¿èªå¾…ã¡ï¼‰", "success"); } })} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆ</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ M11: ãƒ¬ãƒãƒ¼ãƒˆ â”€â”€â”€
const MasterReport = () => {
  const toast = useToast();
  const [showReportModal, setShowReportModal] = useState(null);
  const [reportTab, setReportTab] = useState("summary");
  const [previewReport, setPreviewReport] = useState(null);
  const [showDeliveryLog, setShowDeliveryLog] = useState(false);

  const reportTemplates = [
    { name: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", icon: "ğŸ’°", desc: "æ—¥åˆ¥ã®ç²¾ç®—é‡‘é¡ãƒ»ä»¶æ•°ãƒ»æ‰‹æ•°æ–™", schedule: "æ¯æ—¥ 9:00", formats: ["PDF", "CSV"], type: "daily" },
    { name: "æœˆæ¬¡ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ", icon: "ğŸ“Š", desc: "æœˆæ¬¡ã®å£²ä¸Šãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»KPI", schedule: "æ¯æœˆ1æ—¥ 9:00", formats: ["PDF", "Excel"], type: "monthly" },
    { name: "åŠ ç›Ÿåº—åˆ¥ãƒ¬ãƒãƒ¼ãƒˆ", icon: "ğŸ¢", desc: "åŠ ç›Ÿåº—ã”ã¨ã®å–å¼•ãƒ»ç²¾ç®—ãƒ»CBçŠ¶æ³", schedule: "æ‰‹å‹•", formats: ["PDF", "CSV"], type: "merchant" },
    { name: "æ¥ç¶šå…ˆåˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", icon: "ğŸ”Œ", desc: "æ¥ç¶šå…ˆã®æˆåŠŸç‡ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ»ã‚³ã‚¹ãƒˆ", schedule: "é€±æ¬¡ï¼ˆæœˆæ›œï¼‰", formats: ["PDF"], type: "processor" },
    { name: "ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ", icon: "ğŸ”„", desc: "CBç™ºç”ŸçŠ¶æ³ãƒ»å‹ç‡ãƒ»é‡‘é¡", schedule: "æ‰‹å‹•", formats: ["PDF", "CSV"], type: "chargeback" },
    { name: "ä¸æ­£æ¤œçŸ¥ãƒ¬ãƒãƒ¼ãƒˆ", icon: "ğŸ›¡ï¸", desc: "æ¤œçŸ¥ä»¶æ•°ãƒ»èª¤æ¤œçŸ¥ç‡ãƒ»AIãƒ¢ãƒ‡ãƒ«ç²¾åº¦", schedule: "é€±æ¬¡ï¼ˆæœˆæ›œï¼‰", formats: ["PDF"], type: "fraud" },
  ];

  const recentReports = [
    { date: "02/11 09:00", name: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", period: "2026-02-10", format: "PDF", ai: true, by: "è‡ªå‹•ï¼ˆå®šæœŸï¼‰", size: "1.2MB", pages: 8 },
    { date: "02/10 09:00", name: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", period: "2026-02-09", format: "PDF", ai: true, by: "è‡ªå‹•ï¼ˆå®šæœŸï¼‰", size: "1.1MB", pages: 7 },
    { date: "02/10 14:30", name: "åŠ ç›Ÿåº—åˆ¥ãƒ¬ãƒãƒ¼ãƒˆï¼ˆABCãƒãƒ¼ãƒˆï¼‰", period: "2026å¹´1æœˆ", format: "CSV", ai: false, by: "admin@...", size: "340KB", pages: 0 },
    { date: "02/03 09:00", name: "æ¥ç¶šå…ˆåˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", period: "2026-W05", format: "PDF", ai: true, by: "è‡ªå‹•ï¼ˆå®šæœŸï¼‰", size: "980KB", pages: 5 },
    { date: "02/01 09:00", name: "æœˆæ¬¡ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ", period: "2026å¹´1æœˆ", format: "PDF", ai: true, by: "è‡ªå‹•ï¼ˆå®šæœŸï¼‰", size: "2.4MB", pages: 14 },
  ];

  const deliveryLogs = [
    { date: "02/11 09:05", report: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", method: "ãƒ¡ãƒ¼ãƒ«", recipient: "admin@company.jp", status: "æˆåŠŸ", duration: "2.1s" },
    { date: "02/11 09:05", report: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", method: "Slack", recipient: "#finance", status: "æˆåŠŸ", duration: "0.8s" },
    { date: "02/10 09:04", report: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", method: "ãƒ¡ãƒ¼ãƒ«", recipient: "admin@company.jp", status: "æˆåŠŸ", duration: "1.9s" },
    { date: "02/10 09:04", report: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", method: "Slack", recipient: "#finance", status: "æˆåŠŸ", duration: "0.7s" },
    { date: "02/03 09:06", report: "æ¥ç¶šå…ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", method: "ãƒ¡ãƒ¼ãƒ«", recipient: "admin@company.jp", status: "æˆåŠŸ", duration: "3.2s" },
    { date: "02/03 09:06", report: "æ¥ç¶šå…ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", method: "Slack", recipient: "#ops", status: "å¤±æ•—", duration: "â€”" },
    { date: "02/01 09:10", report: "æœˆæ¬¡ã‚µãƒãƒªãƒ¼", method: "ãƒ¡ãƒ¼ãƒ«", recipient: "admin@company.jp", status: "æˆåŠŸ", duration: "4.5s" },
    { date: "02/01 09:10", report: "æœˆæ¬¡ã‚µãƒãƒªãƒ¼", method: "ãƒ¡ãƒ¼ãƒ«", recipient: "ceo@company.jp", status: "æˆåŠŸ", duration: "4.6s" },
  ];

  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">ãƒ¬ãƒãƒ¼ãƒˆ</h2>
      <div className="flex gap-2">
        <button onClick={() => setShowDeliveryLog(!showDeliveryLog)} className="text-xs bg-slate-100 text-slate-600 px-3 py-1 rounded border border-slate-200">ğŸ“¨ é…ä¿¡ãƒ­ã‚°</button>
        <button onClick={() => setShowReportModal("generate")} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">+ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
      </div>
    </div>

    <div className="flex gap-3">
      <KPICard label="ä»Šæœˆã®ç”Ÿæˆæ•°" value="34ä»¶" sub="" />
      <KPICard label="å®šæœŸé…ä¿¡è¨­å®š" value="8ä»¶" sub="ã‚¢ã‚¯ãƒ†ã‚£ãƒ–" color="green" />
      <KPICard label="AIè¦ç´„ä»˜ã" value="12ä»¶" sub="35.3%" color="blue" />
      <KPICard label="é…ä¿¡æˆåŠŸç‡" value="97.5%" sub="ç›´è¿‘30æ—¥" color="green" />
    </div>

    {/* Delivery Log Section */}
    {showDeliveryLog && (
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
        <div className="flex justify-between items-center p-3 border-b">
          <p className="text-xs font-bold text-slate-700">ğŸ“¨ é…ä¿¡ãƒ­ã‚°ï¼ˆç›´è¿‘ï¼‰</p>
          <button onClick={() => setShowDeliveryLog(false)} className="text-xs text-slate-400 hover:text-slate-600">âœ• é–‰ã˜ã‚‹</button>
        </div>
        <TableHeader cols={[{ label: "é…ä¿¡æ—¥æ™‚", w: "w-28" }, { label: "ãƒ¬ãƒãƒ¼ãƒˆå", w: "flex-1" }, { label: "æ–¹æ³•", w: "w-16" }, { label: "å®›å…ˆ", w: "w-40" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-20" }, { label: "æ‰€è¦æ™‚é–“", w: "w-20" }]}>
        {deliveryLogs.map((d, i) => (
          <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
            <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-400">{d.date}</td>
            <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{d.report}</td>
            <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={d.method} color={d.method === "Slack" ? "purple" : "blue"} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-40 text-slate-500">{d.recipient}</td>
            <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={d.status} color={d.status === "æˆåŠŸ" ? "green" : "red"} /></td>
            <td className="px-4 py-2 whitespace-nowrap w-20 text-slate-400">{d.duration}</td>
          </tr>
        ))}
        </TableHeader>
      </div>
    )}

    {/* Report Templates */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ <span className="text-slate-400 font-normal">ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§è‡ªå‹•å…¥åŠ›ã—ã¦ç”Ÿæˆï¼‰</span></p>
      <div className="grid grid-cols-3 gap-2">
        {reportTemplates.map((t, i) => (
          <div key={i} onClick={() => setShowReportModal(t.type)} className="border rounded-lg p-3 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors">
            <div className="flex items-center gap-2 mb-1">
              <span className="text-sm">{t.icon}</span>
              <span className="text-xs font-bold text-slate-700">{t.name}</span>
            </div>
            <p className="text-xs text-slate-400 mb-2">{t.desc}</p>
            <div className="flex items-center justify-between">
              <div className="flex gap-1">{t.formats.map(f => <Badge key={f} text={f} color="blue" />)}</div>
              <span className="text-xs text-slate-400">{t.schedule}</span>
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* AI Summary example */}
    <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200 p-3">
      <p className="text-xs font-bold text-blue-700 mb-1">ğŸ¤– AIè¦ç´„ï¼ˆæœˆæ¬¡ã‚µãƒãƒªãƒ¼ 2026å¹´1æœˆï¼‰</p>
      <p className="text-xs text-slate-600 leading-relaxed">1æœˆã®æ±ºæ¸ˆç·é¡ã¯å‰æœˆæ¯”+12%ã®Â¥180.5Mã§ã—ãŸã€‚æˆåŠŸç‡ã¯98.5%ã§ç›®æ¨™ã‚’é”æˆã€‚Univa Pay castçµŒç”±ã®å–å¼•ãŒå…¨ä½“ã®28%ã‚’å ã‚ã€ã‚³ã‚¹ãƒˆæœ€é©åŒ–ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚Šæ¨å®šÂ¥120Kã®æ‰‹æ•°æ–™å‰Šæ¸›ã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ç‡ã¯0.8%ã§æ¥­ç•Œå¹³å‡ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™ã€‚æ³¨æ„ç‚¹ã¨ã—ã¦ã€æœˆæœ«ã«ã‹ã‘ã¦AsiabillçµŒç”±ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒå¢—åŠ å‚¾å‘ï¼ˆP99: 1200msï¼‰ã«ã‚ã‚Šã€æ¥ç¶šå…ˆã¸ã®ç¢ºèªã‚’æ¨å¥¨ã—ã¾ã™ã€‚</p>
    </div>

    {/* Recent Reports */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <div className="flex justify-between items-center p-3 border-b">
        <p className="text-xs font-bold text-slate-700">ğŸ“‚ ç”Ÿæˆæ¸ˆã¿ãƒ¬ãƒãƒ¼ãƒˆï¼ˆç›´è¿‘ï¼‰</p>
        <button onClick={() => toast("å…¨ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™", "info")} className="text-xs text-blue-600">ã™ã¹ã¦è¡¨ç¤º â†’</button>
      </div>
      <TableHeader cols={[{ label: "ç”Ÿæˆæ—¥", w: "w-28" }, { label: "ãƒ¬ãƒãƒ¼ãƒˆå", w: "flex-1" }, { label: "æœŸé–“", w: "w-32" }, { label: "å½¢å¼", w: "w-16" }, { label: "AIè¦ç´„", w: "w-16" }, { label: "ç”Ÿæˆè€…", w: "w-28" }, { label: "æ“ä½œ", w: "w-28" }]}>
      {recentReports.map((r, i) => (
        <tr key={i} className={`border-b hover:bg-blue-50 cursor-pointer ${i % 2 ? "bg-slate-50" : ""}`} onClick={() => setPreviewReport(r)}>
          <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-400">{r.date}</td>
          <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{r.name}</td>
          <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-500">{r.period}</td>
          <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.format} color="blue" /></td>
          <td className="px-4 py-2 whitespace-nowrap w-16 text-center">{r.ai ? "ğŸ¤–" : "â€”"}</td>
          <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-400">{r.by}</td>
          <td className="px-4 py-2 whitespace-nowrap w-28"><div className="flex gap-1" onClick={e => e.stopPropagation()}>
            <button onClick={() => toast(`${r.name}ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`, "success")} className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs hover:bg-slate-200">â¬‡ DL</button>
            <button onClick={() => setPreviewReport(r)} className="px-2 py-0.5 bg-blue-100 text-blue-600 rounded text-xs hover:bg-blue-200">ğŸ‘ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
          </div></td>
        </tr>
      ))}
      </TableHeader>
    </div>

    {/* Scheduled Reports */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-slate-700">â° å®šæœŸé…ä¿¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</p>
        <button onClick={() => setShowReportModal("schedule")} className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded border border-blue-200">+ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ </button>
      </div>
      <div className="space-y-1">
        {[
          { name: "æ—¥æ¬¡ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ", schedule: "æ¯æ—¥ 9:00", recipients: "admin@..., finance@...", format: "PDF", enabled: true },
          { name: "æœˆæ¬¡ã‚µãƒãƒªãƒ¼", schedule: "æ¯æœˆ1æ—¥ 9:00", recipients: "admin@..., ceo@...", format: "PDF + Excel", enabled: true },
          { name: "æ¥ç¶šå…ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", schedule: "æ¯é€±æœˆæ›œ 9:00", recipients: "admin@...", format: "PDF", enabled: true },
          { name: "ä¸æ­£æ¤œçŸ¥ãƒ¬ãƒãƒ¼ãƒˆ", schedule: "æ¯é€±æœˆæ›œ 9:00", recipients: "admin@..., security@...", format: "PDF", enabled: true },
        ].map((s, i) => (
          <div key={i} className="flex items-center gap-3 text-xs p-2 border rounded">
            <span className={`w-2 h-2 rounded-full ${s.enabled ? "bg-emerald-500" : "bg-slate-300"}`} />
            <span className="w-44 font-semibold text-slate-700">{s.name}</span>
            <span className="w-32 text-slate-500">{s.schedule}</span>
            <span className="flex-1 text-slate-400">{s.recipients}</span>
            <Badge text={s.format} color="blue" />
            <button onClick={() => { setShowReportModal("schedule"); toast(`${s.name}ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç·¨é›†ä¸­`, "info"); }} className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">ç·¨é›†</button>
          </div>
        ))}
      </div>
      <div className="mt-2 flex gap-2 text-xs">
        <span className="text-slate-400">é…ä¿¡å…ˆ:</span>
        <label className="flex items-center gap-1"><input type="checkbox" defaultChecked className="w-3 h-3" /> ãƒ¡ãƒ¼ãƒ«</label>
        <label className="flex items-center gap-1"><input type="checkbox" defaultChecked className="w-3 h-3" /> Slack</label>
        <span className="text-slate-300">|</span>
        <span className="text-slate-400">Slack Webhook:</span>
        <span className="text-emerald-600">âœ… è¨­å®šæ¸ˆã¿</span>
      </div>
      <div className="mt-2 bg-rose-50 rounded border border-rose-200 p-2 text-xs text-rose-700">
        âš ï¸ è‡ªå‹•ç”Ÿæˆå¤±æ•—æ™‚ã¯adminã«ãƒ¡ãƒ¼ãƒ«+Slacké€šçŸ¥ã€‚ãƒªãƒˆãƒ©ã‚¤ã¯æ‰‹å‹•ã§å†å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
      </div>
    </div>

    {/* Custom Report Builder */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <div className="flex justify-between items-center mb-2">
        <p className="text-xs font-bold text-slate-700">ğŸ› ï¸ ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ</p>
        <button onClick={() => setShowReportModal("custom")} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">+ æ–°è¦ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ</button>
      </div>
      <p className="text-xs text-slate-500 mb-2">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é …ç›®ã‚’è‡ªç”±ã«çµ„ã¿åˆã‚ã›ã¦ç‹¬è‡ªãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã§ãã¾ã™ã€‚å®šæœŸé…ä¿¡ã«ã‚‚è¨­å®šå¯èƒ½ã€‚</p>
      <div className="flex gap-2 flex-wrap">
        {["å–å¼•ã‚µãƒãƒªãƒ¼", "ç²¾ç®—æ˜ç´°", "CBåˆ†æ", "æ¥ç¶šå…ˆåˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", "ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥åˆ†æ", "æ™‚é–“å¸¯åˆ¥åˆ†æ", "åŠ ç›Ÿåº—åˆ¥å†…è¨³", "URLæ±ºæ¸ˆåˆ†æ"].map(item => (
          <label key={item} className="text-xs flex items-center gap-1 px-2 py-1 border rounded cursor-pointer hover:bg-blue-50">
            <input type="checkbox" className="w-3 h-3" />
            {item}
          </label>
        ))}
      </div>
    </div>

    {/* â”€â”€ Modal: ãƒ¬ãƒãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (PDFé¢¨) â”€â”€ */}
    {previewReport && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setPreviewReport(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[680px] max-h-[85vh] flex flex-col">
          <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
            <div>
              <h3 className="text-sm font-bold text-slate-800">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
              <p className="text-xs text-slate-400 mt-0.5">{previewReport.name} â€” {previewReport.period}</p>
            </div>
            <div className="flex items-center gap-2">
              <button onClick={() => { toast("ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success"); }} className="px-3 py-1 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">â¬‡ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
              <button onClick={() => setPreviewReport(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
          </div>
          <div className="flex-1 overflow-y-auto p-6 bg-slate-100">
            {/* PDF-style preview */}
            <div className="bg-white shadow-lg rounded border mx-auto max-w-[580px] p-8">
              <div className="border-b pb-4 mb-4">
                <div className="flex justify-between items-start">
                  <div>
                    <h4 className="text-base font-bold text-slate-800">{previewReport.name}</h4>
                    <p className="text-xs text-slate-400 mt-1">å¯¾è±¡æœŸé–“: {previewReport.period}</p>
                  </div>
                  <div className="text-right">
                    <p className="text-xs font-bold text-blue-600">AI Payment System</p>
                    <p className="text-xs text-slate-400">ç”Ÿæˆæ—¥: {previewReport.date}</p>
                    <p className="text-xs text-slate-400">{previewReport.pages}ãƒšãƒ¼ã‚¸ / {previewReport.size}</p>
                  </div>
                </div>
              </div>

              {/* Summary Section */}
              <div className="mb-4">
                <p className="text-xs font-bold text-slate-700 mb-2 border-b pb-1">1. ã‚µãƒãƒªãƒ¼</p>
                <div className="grid grid-cols-4 gap-2">
                  {[
                    { label: "å–å¼•ä»¶æ•°", value: "12,450ä»¶", change: "+8.2%" },
                    { label: "æ±ºæ¸ˆç·é¡", value: "Â¥45.2M", change: "+12.1%" },
                    { label: "æˆåŠŸç‡", value: "98.5%", change: "+0.3%" },
                    { label: "æ‰‹æ•°æ–™", value: "Â¥1.35M", change: "+11.8%" },
                  ].map((s, i) => (
                    <div key={i} className="bg-slate-50 rounded p-2 text-center">
                      <p className="text-xs text-slate-400">{s.label}</p>
                      <p className="text-sm font-bold text-slate-800">{s.value}</p>
                      <p className="text-xs text-emerald-600">{s.change}</p>
                    </div>
                  ))}
                </div>
              </div>

              {/* Chart placeholder */}
              <div className="mb-4">
                <p className="text-xs font-bold text-slate-700 mb-2 border-b pb-1">2. ãƒˆãƒ¬ãƒ³ãƒ‰</p>
                <div className="bg-slate-50 rounded border p-4 text-center">
                  <div className="flex items-end justify-center gap-1 h-20">
                    {[35, 42, 38, 50, 55, 48, 62, 58, 70, 65, 72, 78].map((v, i) => (
                      <div key={i} className="w-6 bg-blue-400 rounded-t" style={{ height: `${v}%` }} />
                    ))}
                  </div>
                  <p className="text-xs text-slate-400 mt-2">æœˆæ¬¡å–å¼•é‡‘é¡æ¨ç§»ï¼ˆç›´è¿‘12ãƒ¶æœˆï¼‰</p>
                </div>
              </div>

              {/* Table preview */}
              <div className="mb-4">
                <p className="text-xs font-bold text-slate-700 mb-2 border-b pb-1">3. ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥å†…è¨³</p>
                <table className="w-full text-xs">
                  <thead><tr className="bg-slate-50 border-b">
                    <th className="text-left px-2 py-1 font-semibold text-slate-600">ãƒ–ãƒ©ãƒ³ãƒ‰</th>
                    <th className="text-right px-2 py-1 font-semibold text-slate-600">ä»¶æ•°</th>
                    <th className="text-right px-2 py-1 font-semibold text-slate-600">é‡‘é¡</th>
                    <th className="text-right px-2 py-1 font-semibold text-slate-600">æ§‹æˆæ¯”</th>
                  </tr></thead>
                  <tbody>
                    {[
                      { brand: "VISA", count: "5,980", amount: "Â¥21.6M", ratio: "47.8%" },
                      { brand: "Mastercard", count: "3,240", amount: "Â¥12.8M", ratio: "28.3%" },
                      { brand: "JCB", count: "2,100", amount: "Â¥7.2M", ratio: "15.9%" },
                      { brand: "AMEX", count: "1,130", amount: "Â¥3.6M", ratio: "8.0%" },
                    ].map((b, i) => (
                      <tr key={i} className="border-b"><td className="px-2 py-1">{b.brand}</td><td className="px-2 py-1 text-right">{b.count}</td><td className="px-2 py-1 text-right">{b.amount}</td><td className="px-2 py-1 text-right">{b.ratio}</td></tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* AI Summary in preview */}
              {previewReport.ai && (
                <div className="bg-blue-50 rounded border border-blue-200 p-3">
                  <p className="text-xs font-bold text-blue-700 mb-1">ğŸ¤– AIè¦ç´„</p>
                  <p className="text-xs text-slate-600 leading-relaxed">å¯¾è±¡æœŸé–“ã®æ±ºæ¸ˆã¯é †èª¿ã«æ¨ç§»ã€‚VISAæ¯”ç‡ãŒæœ€ã‚‚é«˜ãå®‰å®šã€‚ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ç‡ã¯ç›®æ¨™ç¯„å›²å†…ã€‚ç‰¹è¨˜äº‹é …ãªã—ã€‚</p>
                </div>
              )}

              <div className="mt-4 pt-3 border-t text-center">
                <p className="text-xs text-slate-300">â€” {previewReport.pages > 0 ? `1 / ${previewReport.pages}` : "1 / 1"} â€”</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    )}

    {/* â”€â”€ Modal: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ/ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«/ã‚«ã‚¹ã‚¿ãƒ  â”€â”€ */}
    {showReportModal && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowReportModal(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[520px]">
          <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
            <h3 className="text-sm font-bold text-slate-800">
              {showReportModal === "generate" ? "ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ" : showReportModal === "schedule" ? "ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ " : showReportModal === "custom" ? "ğŸ“ æ–°è¦ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ" : `ğŸ“Š ${(reportTemplates.find(t => t.type === showReportModal) || {}).name || "ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"}`}
            </h3>
            <button onClick={() => setShowReportModal(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            {(showReportModal === "generate" || (!["schedule", "custom"].includes(showReportModal))) && (<>
              <div><label className="text-xs font-semibold text-slate-600">ãƒ¬ãƒãƒ¼ãƒˆç¨®åˆ¥ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue={showReportModal !== "generate" ? showReportModal : "daily"}><option value="daily">æ—¥æ¬¡ã‚µãƒãƒªãƒ¼</option><option value="monthly">æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</option><option value="fraud">ä¸æ­£æ¤œçŸ¥ãƒ¬ãƒãƒ¼ãƒˆ</option><option value="chargeback">ç²¾ç®—ãƒ¬ãƒãƒ¼ãƒˆ</option><option value="merchant">åŠ ç›Ÿåº—åˆ¥ãƒ¬ãƒãƒ¼ãƒˆ</option><option value="processor">æ¥ç¶šå…ˆåˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</option></select></div>
              {showReportModal !== "generate" && (
                <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700">
                  ğŸ’¡ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ{(reportTemplates.find(t => t.type === showReportModal) || {}).name}ã€ã‹ã‚‰è‡ªå‹•å…¥åŠ›ã—ã¾ã—ãŸ
                </div>
              )}
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">å¯¾è±¡æœŸé–“</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
                <div><label className="text-xs font-semibold text-slate-600">ã€œ</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
              </div>
              <div><label className="text-xs font-semibold text-slate-600">æ±ºæ¸ˆç¨®åˆ¥ãƒ•ã‚£ãƒ«ã‚¿</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ã¦</option><option>URLæ±ºæ¸ˆã®ã¿</option><option>URLæ±ºæ¸ˆã‚’é™¤å¤–</option><option>ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°ã®ã¿</option><option>é€šå¸¸æ±ºæ¸ˆã®ã¿</option></select></div>
              <div><label className="text-xs font-semibold text-slate-600">å‡ºåŠ›å½¢å¼</label><div className="flex gap-2 mt-1">{["PDF","CSV","Excel"].map(f => <label key={f} className="flex items-center gap-1 text-xs"><input type="radio" name="format" defaultChecked={f==="PDF"} />{f}</label>)}</div></div>
              <div className="flex items-center gap-2"><input type="checkbox" defaultChecked className="w-3 h-3" /><span className="text-xs text-slate-600">AIè¦ç´„ã‚’å«ã‚ã‚‹</span></div>
            </>)}
            {showReportModal === "schedule" && (<>
              <div><label className="text-xs font-semibold text-slate-600">ãƒ¬ãƒãƒ¼ãƒˆç¨®åˆ¥ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>æ—¥æ¬¡ã‚µãƒãƒªãƒ¼</option><option>é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</option><option>æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</option></select></div>
              <div><label className="text-xs font-semibold text-slate-600">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>æ¯æ—¥ 09:00</option><option>æ¯é€±æœˆæ›œ 09:00</option><option>æ¯æœˆ1æ—¥ 09:00</option></select></div>
              <div><label className="text-xs font-semibold text-slate-600">é€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="admin@company.jp" /></div>
              <div><label className="text-xs font-semibold text-slate-600">Slacké€šçŸ¥</label><div className="flex items-center gap-2 mt-1"><input type="checkbox" className="w-3 h-3" /><span className="text-xs text-slate-500">Slackã«ã‚‚é…ä¿¡ã™ã‚‹</span></div></div>
            </>)}
            {showReportModal === "custom" && (<>
              <div><label className="text-xs font-semibold text-slate-600">ãƒ¬ãƒãƒ¼ãƒˆå <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆå" /></div>
              <div><label className="text-xs font-semibold text-slate-600">å«ã‚ã‚‹é …ç›® <span className="text-rose-500">*</span></label>
                <div className="flex flex-wrap gap-2 mt-1">{["å–å¼•æ•°","æ±ºæ¸ˆé«˜","æ‰‹æ•°æ–™","CBä»¶æ•°","ä¸æ­£æ¤œçŸ¥","æ¥ç¶šå…ˆåˆ¥","åŠ ç›Ÿåº—åˆ¥","æ™‚é–“å¸¯åˆ¥"].map((c,i) => <label key={i} className="flex items-center gap-1 text-xs border rounded px-2 py-1 cursor-pointer hover:bg-blue-50"><input type="checkbox" defaultChecked={i<4} />{c}</label>)}</div>
              </div>
              <div><label className="text-xs font-semibold text-slate-600">ã‚°ãƒ©ãƒ•ç¨®åˆ¥</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•</option><option>æ£’ã‚°ãƒ©ãƒ•</option><option>å††ã‚°ãƒ©ãƒ•</option><option>è¡¨ã®ã¿</option></select></div>
            </>)}
          </div>
          <div className="p-4 border-t flex gap-2 justify-end">
            <button onClick={() => setShowReportModal(null)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={() => { const label = showReportModal === "schedule" ? "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç™»éŒ²" : showReportModal === "custom" ? "ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ" : "ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆé–‹å§‹"; setShowReportModal(null); toast(`${label}ã—ã¾ã—ãŸ`, "success"); }} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">{showReportModal === "schedule" ? "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²" : showReportModal === "custom" ? "ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ" : "ç”Ÿæˆã™ã‚‹"}</button>
          </div>
        </div>
      </div>
    )}
    </div>
  );
};

// â”€â”€â”€ æ–°è¦ã‚µã‚¤ãƒˆç”³è«‹ï¼ˆåŠ ç›Ÿåº—ç®¡ç†ç”»é¢ï¼‰ â”€â”€â”€
const MerchantSiteApplication = () => {
  const toast = useToast();
  const [submitted, setSubmitted] = useState(false);
  const siteHistory = [
    { id: "SITE-2026-003", name: "æ–°ECã‚µã‚¤ãƒˆ", url: "https://new-shop.example.jp", date: "2026-02-15", status: "å¯©æŸ»ä¸­", genre: "ç‰©è²©EC" },
    { id: "SITE-2026-002", name: "ä¼šå“¡é™å®šã‚·ãƒ§ãƒƒãƒ—", url: "https://members.abcmart-ec.jp", date: "2026-01-20", status: "æ‰¿èªæ¸ˆ", genre: "ç‰©è²©EC" },
    { id: "SITE-2026-001", name: "æœ¬åº—ECã‚µã‚¤ãƒˆ", url: "https://abcmart-ec.jp", date: "2025-06-01", status: "ç¨¼åƒä¸­", genre: "å®¶é›»ãƒ»ã‚¬ã‚¸ã‚§ãƒƒãƒˆEC" },
  ];
  return <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">æ–°è¦ã‚µã‚¤ãƒˆç”³è«‹</h2>
      <span className="text-xs text-slate-400">æ–°ã—ã„ã‚µã‚¤ãƒˆã‚’è¿½åŠ ã—ã€æ±ºæ¸ˆå¯©æŸ»ã‚’ç”³è«‹ã§ãã¾ã™</span>
    </div>

    {/* ç”³è«‹ãƒ•ã‚©ãƒ¼ãƒ  */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4">
      <p className="text-xs font-bold text-slate-700 mb-3 border-b pb-2">ğŸ“ æ–°è¦ã‚µã‚¤ãƒˆå¯©æŸ»ç”³è«‹</p>
      {submitted ? (
        <div className="text-center py-8">
          <div className="text-3xl mb-2">âœ…</div>
          <p className="text-sm font-bold text-emerald-600">ç”³è«‹ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸï¼</p>
          <p className="text-xs text-slate-500 mt-1">é‹å–¶ã«ã‚ˆã‚‹å¯©æŸ»ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚é€šå¸¸1ã€œ3å–¶æ¥­æ—¥ã§çµæœã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚</p>
          <button onClick={() => setSubmitted(false)} className="mt-3 px-4 py-1.5 bg-slate-100 text-slate-600 rounded text-xs hover:bg-slate-200">æ–°ã—ã„ç”³è«‹ã‚’ä½œæˆ</button>
        </div>
      ) : (
        <div className="space-y-3">
          <div className="grid grid-cols-2 gap-3">
            <div>
              <label className="text-xs text-slate-500 block mb-1">ã‚µã‚¤ãƒˆå *</label>
              <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: æ–°ECã‚µã‚¤ãƒˆ" />
            </div>
            <div>
              <label className="text-xs text-slate-500 block mb-1">ã‚µã‚¤ãƒˆURL <span className="text-slate-400 text-[10px]">(ä»»æ„)</span></label>
              <input className="w-full text-xs border rounded px-3 py-2" placeholder="ä¾‹: https://new-shop.example.jp" />
              <span className="text-xs text-slate-400">â€» æº–å‚™ä¸­ã®å ´åˆã¯ç©ºæ¬„ã§ã‚‚ç”³è«‹å¯èƒ½</span>
            </div>
            <div>
              <label className="text-xs text-slate-500 block mb-1">ã‚¸ãƒ£ãƒ³ãƒ« *</label>
              <select className="w-full text-xs border rounded px-3 py-2">
                <option>é¸æŠã—ã¦ãã ã•ã„</option>
                <option>ç‰©è²©ECï¼ˆè¡£æ–™ãƒ»é›‘è²¨ï¼‰</option>
                <option>ç‰©è²©ECï¼ˆå®¶é›»ãƒ»ã‚¬ã‚¸ã‚§ãƒƒãƒˆï¼‰</option>
                <option>ãƒ‡ã‚¸ã‚¿ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</option>
                <option>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</option>
                <option>æ—…è¡Œãƒ»å®¿æ³Š</option>
                <option>é£²é£Ÿãƒ»ãƒ‡ãƒªãƒãƒªãƒ¼</option>
                <option>æ•™è‚²ãƒ»ã‚¹ã‚¯ãƒ¼ãƒ«</option>
                <option>ç¾å®¹ãƒ»å¥åº·</option>
                <option>ãã®ä»–</option>
              </select>
            </div>
            <div>
              <label className="text-xs text-slate-500 block mb-1">æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜ *</label>
              <select className="w-full text-xs border rounded px-3 py-2">
                <option>é¸æŠã—ã¦ãã ã•ã„</option>
                <option>ã€œÂ¥500,000</option>
                <option>Â¥500,000ã€œÂ¥1,000,000</option>
                <option>Â¥1,000,000ã€œÂ¥5,000,000</option>
                <option>Â¥5,000,000ã€œÂ¥10,000,000</option>
                <option>Â¥10,000,000ä»¥ä¸Š</option>
              </select>
            </div>
          </div>
          <div>
            <label className="text-xs text-slate-500 block mb-1">å¸Œæœ›æ±ºæ¸ˆæ‰‹æ®µ</label>
            <div className="flex gap-3 mt-1">
              {["ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆVISA/MC/JCB/AMEXï¼‰", "WEBãƒãƒãƒ¼"].map((m, i) => (
                <label key={i} className="flex items-center gap-1.5 text-xs"><input type="checkbox" defaultChecked={i === 0} />{m}</label>
              ))}
            </div>
          </div>
          <div>
            <label className="text-xs text-slate-500 block mb-1">å–æ‰±å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®èª¬æ˜</label>
            <textarea className="w-full text-xs border rounded px-3 py-2 h-16 resize-none" placeholder="æ–°ã‚µã‚¤ãƒˆã§æ‰±ã†å•†å“ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚è¦ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„" />
          </div>
          <div className="bg-blue-50 rounded p-2 border border-blue-200">
            <p className="text-xs text-blue-700">ğŸ¤– <span className="font-semibold">AIå¯©æŸ»:</span> ç”³è«‹å¾Œã€ã‚µã‚¤ãƒˆURLãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯AIã«ã‚ˆã‚‹ã‚µã‚¤ãƒˆå†…å®¹ã®è‡ªå‹•è§£æãŒè¡Œã‚ã‚Œã¾ã™ã€‚å¯©æŸ»çµæœã¯é€šå¸¸1ã€œ3å–¶æ¥­æ—¥ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚</p>
          </div>
          <div className="flex justify-end gap-2 pt-2 border-t">
            <button onClick={() => setSubmitted(true)} className="px-6 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">ğŸš€ å¯©æŸ»ã‚’ç”³è«‹ã™ã‚‹</button>
          </div>
        </div>
      )}
    </div>

    {/* ç”³è«‹å±¥æ­´ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4">
      <p className="text-xs font-bold text-slate-700 mb-3">ğŸ“‹ ã‚µã‚¤ãƒˆç”³è«‹å±¥æ­´</p>
      <table className="w-full text-xs">
        <thead><tr className="border-b text-left text-slate-500">
          <th className="pb-2 px-2">ç”³è«‹ID</th><th className="pb-2 px-2">ã‚µã‚¤ãƒˆå</th><th className="pb-2 px-2">URL</th><th className="pb-2 px-2">ã‚¸ãƒ£ãƒ³ãƒ«</th><th className="pb-2 px-2">ç”³è«‹æ—¥</th><th className="pb-2 px-2">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
        </tr></thead>
        <tbody>
          {siteHistory.map((s, i) => (
            <tr key={i} className="border-b hover:bg-slate-50">
              <td className="py-2 px-2 text-blue-600 font-mono">{s.id}</td>
              <td className="py-2 px-2 font-semibold">{s.name}</td>
              <td className="py-2 px-2 text-slate-400">{s.url}</td>
              <td className="py-2 px-2">{s.genre}</td>
              <td className="py-2 px-2 text-slate-400">{s.date}</td>
              <td className="py-2 px-2"><Badge text={s.status} color={s.status === "ç¨¼åƒä¸­" ? "green" : s.status === "æ‰¿èªæ¸ˆ" ? "blue" : "amber"} /></td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>;
};

// â”€â”€â”€ S03: æ±ºæ¸ˆé«˜ãƒ¬ãƒãƒ¼ãƒˆ â”€â”€â”€
const MerchantSalesReport = () => {
  const [period, setPeriod] = useState("thisMonth");
  const [selectedTx, setSelectedTx] = useState(null);
  const [showExportModal, setShowExportModal] = useState(null);

  const txData = [
    { id: "TXN-14523", time: "02/11 14:52", card: "**** 1234", brand: "VISA", amount: "Â¥12,800", status: "æˆåŠŸ", sColor: "green", fee: "Â¥410", net: "Â¥12,390", tds: "èªè¨¼æ¸ˆã¿", ip: "203.0.113.45" },
    { id: "TXN-14521", time: "02/11 14:51", card: "**** 5678", brand: "JCB", amount: "Â¥89,000", status: "æˆåŠŸ", sColor: "green", fee: "Â¥2,848", net: "Â¥86,152", tds: "èªè¨¼æ¸ˆã¿", ip: "198.51.100.10" },
    { id: "TXN-14518", time: "02/11 14:50", card: "â€”", brand: "QR", amount: "Â¥1,500", status: "æˆåŠŸ", sColor: "green", fee: "Â¥30", net: "Â¥1,470", tds: "â€”", ip: "10.0.0.55" },
    { id: "TXN-13801", time: "02/11 11:20", card: "**** 9012", brand: "MC", amount: "Â¥3,200", status: "è¿”é‡‘æ¸ˆ", sColor: "yellow", fee: "Â¥0", net: "Â¥0", tds: "èªè¨¼æ¸ˆã¿", ip: "172.16.0.30" },
  ];

  return (
  <div className="p-5 space-y-4">
    <div className="flex justify-between items-center">
      <h2 className="text-sm font-bold text-slate-800">æ±ºæ¸ˆé«˜ãƒ¬ãƒãƒ¼ãƒˆ</h2>
      <div className="flex gap-2">
        <select className="text-xs border rounded px-2 py-1" value={period} onChange={e => setPeriod(e.target.value)}><option value="thisMonth">ä»Šæœˆï¼ˆ2026å¹´2æœˆï¼‰</option><option value="lastMonth">å…ˆæœˆï¼ˆ2026å¹´1æœˆï¼‰</option><option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option></select>
        {period === "custom" && <><input type="date" className="text-xs border rounded px-2 py-1" /><span className="text-xs text-slate-400">ã€œ</span><input type="date" className="text-xs border rounded px-2 py-1" /></>}
        <button onClick={() => setShowExportModal("csv")} className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSV</button>
        <button onClick={() => setShowExportModal("pdf")} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">ğŸ“„ PDFå‡ºåŠ›</button>
      </div>
    </div>

    {/* KPIs */}
    <div className="flex gap-3">
      <KPICard label="ä»Šæœˆã®æ±ºæ¸ˆé«˜" value="Â¥4.8M" sub="å‰æœˆæ¯”" trend={15} />
      <KPICard label="æ±ºæ¸ˆä»¶æ•°" value="342ä»¶" sub="å‰æœˆæ¯”" trend={8} />
      <KPICard label="å¹³å‡å˜ä¾¡" value="Â¥14,035" sub="å‰æœˆæ¯”" trend={6} />
      <KPICard label="æˆåŠŸç‡" value="98.5%" sub="" color="green" />
      <KPICard label="CBä»¶æ•°" value="2ä»¶" sub="CBç‡ 0.6%" color="green" />
    </div>

    {/* Daily Chart */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“Š æ—¥åˆ¥æ±ºæ¸ˆé«˜æ¨ç§»ï¼ˆ2026å¹´2æœˆï¼‰</p>
      <div className="flex items-end gap-1 h-32">
        {[320, 410, 380, 520, 480, 120, 90, 450, 510, 490, 560].map((v, i) => (
          <div key={i} className="flex-1 flex flex-col items-center">
            <span className="text-xs text-slate-400 mb-1" style={{fontSize: "8px"}}>Â¥{(v/100).toFixed(0)}ä¸‡</span>
            <div className="bg-blue-400 hover:bg-blue-500 rounded-t w-full cursor-pointer transition-colors" style={{ height: `${(v / 560) * 100}px` }} />
            <span className="text-xs text-slate-400 mt-1" style={{fontSize: "9px"}}>{i + 1}æ—¥</span>
          </div>
        ))}
      </div>
    </div>

    {/* Brand breakdown + Payout schedule */}
    <div className="grid grid-cols-2 gap-3">
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-700 mb-2">ğŸ’³ ãƒ–ãƒ©ãƒ³ãƒ‰åˆ¥å†…è¨³</p>
        <div className="space-y-2">
          {[
            { brand: "VISA", count: 152, amount: "Â¥2.14M", pct: 44.5, color: "bg-blue-500" },
            { brand: "Mastercard", count: 78, amount: "Â¥1.09M", pct: 22.8, color: "bg-rose-500" },
            { brand: "JCB", count: 65, amount: "Â¥0.92M", pct: 19.0, color: "bg-emerald-500" },
            { brand: "AMEX", count: 25, amount: "Â¥0.41M", pct: 8.5, color: "bg-purple-500" },
            { brand: "WEBãƒãƒãƒ¼", count: 22, amount: "Â¥0.24M", pct: 5.2, color: "bg-amber-500" },
          ].map((b, i) => (
            <div key={i} className="flex items-center gap-2 text-xs">
              <span className="w-20 text-slate-700 font-semibold">{b.brand}</span>
              <div className="flex-1 bg-slate-100 rounded h-3"><div className={`${b.color} rounded h-3`} style={{ width: `${b.pct}%` }} /></div>
              <span className="w-12 text-right text-slate-500">{b.count}ä»¶</span>
              <span className="w-16 text-right text-slate-600 font-semibold">{b.amount}</span>
            </div>
          ))}
        </div>
      </div>
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold text-slate-700 mb-2">ğŸ’° å…¥é‡‘äºˆå®š</p>
        <div className="space-y-2">
          <div className="bg-emerald-50 rounded border border-emerald-200 p-2">
            <div className="flex justify-between text-xs mb-0.5">
              <span className="text-emerald-700 font-semibold">æ¬¡å›å…¥é‡‘</span>
              <span className="text-emerald-800 font-bold">Â¥3,245,600</span>
            </div>
            <div className="flex justify-between text-xs text-emerald-600">
              <span>2026å¹´2æœˆ28æ—¥ï¼ˆé‡‘ï¼‰</span>
              <span>1æœˆåˆ†ç²¾ç®—</span>
            </div>
          </div>
          <div className="bg-slate-50 rounded-lg border border-slate-200 p-2.5">
            <div className="flex justify-between text-xs mb-0.5">
              <span className="text-slate-600">ç¿Œã€…å›å…¥é‡‘</span>
              <span className="text-slate-700 font-semibold">Â¥4,800,000ï¼ˆè¦‹è¾¼ï¼‰</span>
            </div>
            <div className="flex justify-between text-xs text-slate-500">
              <span>2026å¹´3æœˆ31æ—¥ï¼ˆç«ï¼‰</span>
              <span>2æœˆåˆ†ç²¾ç®—</span>
            </div>
          </div>
          <p className="text-xs text-slate-400">å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«: æœˆæœ«ç· ã‚ / ç¿Œæœˆæœ«æ‰•ã„</p>
        </div>
      </div>
    </div>

    {/* Transaction List (masked) */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <div className="flex justify-between items-center p-3 border-b">
        <p className="text-xs font-bold text-slate-700">å–å¼•æ˜ç´°</p>
        <div className="flex gap-2">
          <select className="text-xs border rounded px-2 py-1"><option>å…¨ãƒ–ãƒ©ãƒ³ãƒ‰</option><option>VISA</option><option>MC</option><option>JCB</option></select>
          <select className="text-xs border rounded px-2 py-1"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>æˆåŠŸ</option><option>å¤±æ•—</option><option>è¿”é‡‘</option></select>
        </div>
      </div>
      <TableHeader cols={[{ label: "å–å¼•ID", w: "w-36" }, { label: "æ—¥æ™‚", w: "w-32" }, { label: "ã‚«ãƒ¼ãƒ‰", w: "w-28" }, { label: "ãƒ–ãƒ©ãƒ³ãƒ‰", w: "w-16" }, { label: "é‡‘é¡", w: "w-24" }, { label: "çŠ¶æ…‹", w: "w-16" }, { label: "æ“ä½œ", w: "w-16" }]}>
      {txData.map((t, i) => (
        <tr key={i} className={`border-b cursor-pointer hover:bg-blue-50 ${i % 2 ? "bg-slate-50" : ""}`} onClick={() => setSelectedTx(t)}>
          <td className="px-4 py-2 whitespace-nowrap w-36 font-mono text-slate-500">{t.id}</td>
          <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-400">{t.time}</td>
          <td className="px-4 py-2 whitespace-nowrap w-28 font-mono text-slate-500">{t.card}</td>
          <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={t.brand} color="blue" /></td>
          <td className="px-4 py-2 whitespace-nowrap w-24 text-right font-semibold text-slate-800">{t.amount}</td>
          <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={t.status} color={t.sColor} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-16"><button onClick={e => { e.stopPropagation(); setSelectedTx(t); }} className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs hover:bg-slate-200">è©³ç´°</button></td>
        </tr>
      ))}
      </TableHeader>
    </div>

    {/* â”€â”€ Modal: å–å¼•è©³ç´° â”€â”€ */}
    {selectedTx && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setSelectedTx(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[480px]">
          <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
            <div>
              <h3 className="text-sm font-bold text-slate-800">ğŸ’³ å–å¼•è©³ç´°</h3>
              <p className="text-xs text-slate-400 mt-0.5">{selectedTx.id}</p>
            </div>
            <button onClick={() => setSelectedTx(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className="flex justify-between items-center">
              <span className="text-xl font-bold text-slate-800">{selectedTx.amount}</span>
              <Badge text={selectedTx.status} color={selectedTx.sColor} />
            </div>
            <div className="grid grid-cols-2 gap-3">
              {[
                { label: "æ—¥æ™‚", value: selectedTx.time },
                { label: "ãƒ–ãƒ©ãƒ³ãƒ‰", value: selectedTx.brand },
                { label: "ã‚«ãƒ¼ãƒ‰ç•ªå·", value: selectedTx.card },
                { label: "3DSèªè¨¼", value: selectedTx.tds },
                { label: "æ‰‹æ•°æ–™", value: selectedTx.fee },
                { label: "å…¥é‡‘é¡", value: selectedTx.net },
                { label: "IPã‚¢ãƒ‰ãƒ¬ã‚¹", value: selectedTx.ip },
                { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", value: selectedTx.status },
              ].map((item, i) => (
                <div key={i} className="bg-slate-50 rounded p-2">
                  <p className="text-xs text-slate-400">{item.label}</p>
                  <p className="text-xs font-bold text-slate-700">{item.value}</p>
                </div>
              ))}
            </div>
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</p>
              <div className="space-y-1.5">
                {[
                  { time: selectedTx.time, event: "æ±ºæ¸ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡", icon: "ğŸ”µ" },
                  { time: selectedTx.time, event: "3DSèªè¨¼å®Œäº†", icon: "ğŸŸ¢" },
                  { time: selectedTx.time, event: "ã‚ªãƒ¼ã‚½ãƒªæ‰¿èª", icon: "ğŸŸ¢" },
                  { time: selectedTx.time, event: "å£²ä¸Šç¢ºå®š", icon: "âœ…" },
                ].map((e, i) => (
                  <div key={i} className="flex items-center gap-2 text-xs">
                    <span>{e.icon}</span>
                    <span className="text-slate-400 w-24">{e.time}</span>
                    <span className="text-slate-700">{e.event}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
          <div className="p-4 border-t flex gap-2 justify-end">
            <button onClick={() => setSelectedTx(null)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">é–‰ã˜ã‚‹</button>
          </div>
        </div>
      </div>
    )}

    {/* â”€â”€ Modal: CSV/PDFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ â”€â”€ */}
    {showExportModal && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowExportModal(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
          <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
            <h3 className="text-sm font-bold text-slate-800">{showExportModal === "csv" ? "ğŸ“¥ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ" : "ğŸ“„ PDFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"}</h3>
            <button onClick={() => setShowExportModal(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs font-semibold text-slate-600">å¯¾è±¡æœŸé–“</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
              <div><label className="text-xs font-semibold text-slate-600">ã€œ</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
            </div>
            {showExportModal === "csv" && (
              <div>
                <label className="text-xs font-semibold text-slate-600">å‡ºåŠ›ã‚«ãƒ©ãƒ </label>
                <div className="flex gap-2 flex-wrap mt-1">
                  {["å–å¼•ID", "æ—¥æ™‚", "é‡‘é¡", "ãƒ–ãƒ©ãƒ³ãƒ‰", "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", "æ‰‹æ•°æ–™", "å…¥é‡‘é¡", "ã‚«ãƒ¼ãƒ‰ç•ªå·ï¼ˆãƒã‚¹ã‚¯ï¼‰"].map((c, i) => (
                    <label key={i} className="flex items-center gap-1 text-xs"><input type="checkbox" defaultChecked className="w-3 h-3" />{c}</label>
                  ))}
                </div>
              </div>
            )}
            <div><label className="text-xs font-semibold text-slate-600">ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ãƒ–ãƒ©ãƒ³ãƒ‰</option><option>VISA</option><option>Mastercard</option><option>JCB</option><option>AMEX</option></select></div>
          </div>
          <div className="p-4 border-t flex gap-2 justify-end">
            <button onClick={() => setShowExportModal(null)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={() => setShowExportModal(null)} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">{showExportModal === "csv" ? "CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" : "PDFç”Ÿæˆ"}</button>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ S08: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š â”€â”€â”€
const MerchantAccountSettings = () => {
  const toast = useToast();
  const [showInviteS08, setShowInviteS08] = useState(false);
  const [accTab, setAccTab] = useState("company");

  return (
    <div className="p-5 space-y-4">
      <h2 className="text-sm font-bold text-slate-800">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</h2>

      <div className="flex gap-1 border-b">
        {[{ id: "company", label: "ä¼šç¤¾æƒ…å ±" }, { id: "bank", label: "æŒ¯è¾¼å…ˆå£åº§" }, { id: "api", label: "APIã‚­ãƒ¼" }, { id: "security", label: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£" }, { id: "members", label: "ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†" }, { id: "notifications", label: "é€šçŸ¥è¨­å®š" }, { id: "contract", label: "å¥‘ç´„æƒ…å ±" }].map(tab => (
          <button key={tab.id} onClick={() => setAccTab(tab.id)} className={`text-xs px-3 py-2 border-b-2 ${accTab === tab.id ? "border-emerald-500 text-emerald-600 font-semibold" : "border-transparent text-slate-400"}`}>{tab.label}</button>
        ))}
      </div>

      {/* Tab: ä¼šç¤¾æƒ…å ± */}
      {accTab === "company" && (
        <div className="bg-white rounded-lg border p-4 max-w-2xl">
          <div className="bg-amber-50 rounded border border-amber-200 p-2 mb-3 text-xs text-amber-700">
            âš ï¸ ä¼šç¤¾æƒ…å ±ã®å¤‰æ›´ã¯<strong>é‹å–¶ã®æ‰¿èªãŒå¿…è¦</strong>ã§ã™ã€‚å¤‰æ›´å†…å®¹ã«ã‚ˆã£ã¦ã¯æ›¸é¡å†æå‡ºï¼ˆç™»è¨˜ç°¿ç­‰ï¼‰ã‚’ãŠé¡˜ã„ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
          </div>
          <div className="space-y-3">
            {[
              { label: "æ³•äººå", value: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", editable: false },
              { label: "ä»£è¡¨è€…", value: "å±±ç”° å¤ªéƒ", editable: true },
              { label: "ä½æ‰€", value: "æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰1-2-3 ABCãƒ“ãƒ«5F", editable: true },
              { label: "é›»è©±ç•ªå·", value: "03-1234-5678", editable: true },
              { label: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", value: "info@abcmart-ec.jp", editable: true },
              { label: "æ¥­ç¨®", value: "å®¶é›»ãƒ»ã‚¬ã‚¸ã‚§ãƒƒãƒˆEC", editable: false },
              { label: "ã‚µã‚¤ãƒˆURL", value: "https://abcmart-ec.jp", editable: true },
            ].map((f, i) => (
              <div key={i} className="flex items-center gap-3">
                <label className="w-28 text-xs text-slate-500 text-right">{f.label}</label>
                <input className={`flex-1 border rounded px-3 py-1.5 text-xs ${f.editable ? "" : "bg-slate-50 text-slate-400"}`} defaultValue={f.value} readOnly={!f.editable} />
                {!f.editable && <span className="text-xs text-slate-400">å¤‰æ›´ä¸å¯</span>}
              </div>
            ))}
            <div className="flex justify-end mt-3">
              <button onClick={() => toast("å¤‰æ›´ç”³è«‹ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "success")} className="px-4 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">å¤‰æ›´ç”³è«‹ã‚’é€ä¿¡</button>
            </div>
          </div>
        </div>
      )}

      {/* Tab: æŒ¯è¾¼å…ˆå£åº§ */}
      {accTab === "bank" && (
        <div className="space-y-3 max-w-2xl">
          <div className="bg-amber-50 rounded-lg border border-amber-300 p-2">
            <p className="text-xs text-amber-700">âš ï¸ å£åº§æƒ…å ±ã®å¤‰æ›´ã«ã¯æœ¬äººç¢ºèªãŒå¿…è¦ã§ã™ã€‚å¤‰æ›´ç”³è«‹å¾Œã€å¯©æŸ»å®Œäº†ã¾ã§1ã€œ3å–¶æ¥­æ—¥ã‹ã‹ã‚Šã¾ã™ã€‚</p>
          </div>
          <div className="bg-white rounded-lg border p-4">
            <p className="text-xs font-bold text-slate-700 mb-3">ç¾åœ¨ã®æŒ¯è¾¼å…ˆå£åº§</p>
            <div className="space-y-2">
              {[
                { label: "éŠ€è¡Œå", value: "ä¸‰è±UFJéŠ€è¡Œ" },
                { label: "æ”¯åº—å", value: "æ¸‹è°·æ”¯åº—ï¼ˆ150ï¼‰" },
                { label: "å£åº§ç¨®åˆ¥", value: "æ™®é€š" },
                { label: "å£åº§ç•ªå·", value: "****567" },
                { label: "å£åº§åç¾©", value: "ã‚«ï¼‰ã‚¨ãƒ¼ãƒ“ãƒ¼ã‚·ãƒ¼ãƒãƒ¼ãƒˆ" },
              ].map((f, i) => (
                <div key={i} className="flex items-center gap-3 text-xs">
                  <span className="w-24 text-slate-500 text-right">{f.label}</span>
                  <span className="font-semibold text-slate-700">{f.value}</span>
                </div>
              ))}
            </div>
            <button onClick={() => toast("å£åº§å¤‰æ›´ç”³è«‹ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚å¯©æŸ»ã¾ã§1ã€œ3å–¶æ¥­æ—¥ã‹ã‹ã‚Šã¾ã™", "info")} className="mt-3 px-3 py-1.5 bg-amber-100 text-amber-700 rounded text-xs font-semibold border border-amber-300">ğŸ”„ å£åº§å¤‰æ›´ã‚’ç”³è«‹</button>
          </div>
        </div>
      )}

      {/* Tab: APIã‚­ãƒ¼ */}
      {accTab === "api" && (
        <div className="space-y-3 max-w-2xl">
          <div className="bg-white rounded-lg border p-4">
            <p className="text-xs font-bold text-slate-700 mb-3">APIã‚­ãƒ¼</p>
            <div className="space-y-3">
              <div className="border rounded p-3">
                <div className="flex justify-between items-center mb-1">
                  <span className="text-xs font-semibold text-slate-700">ãƒ†ã‚¹ãƒˆç’°å¢ƒ</span>
                  <Badge text="ãƒ†ã‚¹ãƒˆ" color="yellow" />
                </div>
                <div className="flex items-center gap-2">
                  <input className="flex-1 border rounded px-3 py-1.5 text-xs font-mono bg-slate-50" value="sk_test_4eC39HqLyjWDarjtT1zdp7dc" readOnly />
                  <button onClick={() => toast("APIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="px-2 py-1.5 bg-slate-100 text-slate-600 rounded text-xs border">ã‚³ãƒ”ãƒ¼</button>
                  <button onClick={() => toast("ãƒ†ã‚¹ãƒˆç’°å¢ƒã®APIã‚­ãƒ¼ã‚’å†ç™ºè¡Œã—ã¾ã—ãŸ", "warning")} className="px-2 py-1.5 bg-rose-100 text-rose-600 rounded text-xs border border-rose-200">å†ç™ºè¡Œ</button>
                </div>
              </div>
              <div className="border rounded p-3">
                <div className="flex justify-between items-center mb-1">
                  <span className="text-xs font-semibold text-slate-700">æœ¬ç•ªç’°å¢ƒ</span>
                  <Badge text="æœ¬ç•ª" color="green" />
                </div>
                <div className="flex items-center gap-2">
                  <input className="flex-1 border rounded px-3 py-1.5 text-xs font-mono bg-slate-50" value="sk_live_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢dc" readOnly />
                  <button onClick={() => toast("æœ¬ç•ªAPIã‚­ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã—ãŸï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„ï¼‰", "warning")} className="px-2 py-1.5 bg-slate-100 text-slate-600 rounded text-xs border">è¡¨ç¤º</button>
                  <button onClick={() => toast("æœ¬ç•ªç’°å¢ƒã®APIã‚­ãƒ¼ã‚’å†ç™ºè¡Œã—ã¾ã—ãŸ", "warning")} className="px-2 py-1.5 bg-rose-100 text-rose-600 rounded text-xs border border-rose-200">å†ç™ºè¡Œ</button>
                </div>
              </div>
              <div className="border rounded p-3">
                <p className="text-xs font-semibold text-slate-700 mb-1">Webhook URL</p>
                <div className="flex items-center gap-2">
                  <input className="flex-1 border rounded px-3 py-1.5 text-xs" defaultValue="https://abcmart-ec.jp/webhook/payment" />
                  <button onClick={() => toast("Webhook URLã‚’ä¿å­˜ã—ã¾ã—ãŸ", "success")} className="px-2 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold">ä¿å­˜</button>
                  <button onClick={() => { toast("Webhookãƒ†ã‚¹ãƒˆé€ä¿¡ä¸­...", "info"); setTimeout(() => toast("ãƒ†ã‚¹ãƒˆé€ä¿¡æˆåŠŸ", "success"), 1500); }} className="px-2 py-1.5 bg-slate-100 text-slate-600 rounded text-xs border">ãƒ†ã‚¹ãƒˆé€ä¿¡</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Tab: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ */}
      {accTab === "security" && (
        <div className="space-y-3 max-w-2xl">
          <div className="bg-white rounded-lg border p-4">
            <p className="text-xs font-bold text-slate-700 mb-3">ğŸ” 2æ®µéšèªè¨¼ï¼ˆMFAï¼‰</p>
            <div className="flex items-center justify-between p-3 bg-emerald-50 rounded border border-emerald-200">
              <div>
                <p className="text-xs font-semibold text-emerald-700">æœ‰åŠ¹ï¼ˆèªè¨¼ã‚¢ãƒ—ãƒªé€£æºæ¸ˆã¿ï¼‰</p>
                <p className="text-xs text-emerald-600 mt-0.5">Google Authenticator ã§è¨­å®šæ¸ˆã¿</p>
              </div>
              <button onClick={() => toast("MFAè¨­å®šã‚’å¤‰æ›´ä¸­", "info")} className="px-3 py-1 bg-white text-slate-600 rounded text-xs border">è¨­å®šå¤‰æ›´</button>
            </div>
          </div>
          <div className="bg-white rounded-lg border p-4">
            <p className="text-xs font-bold text-slate-700 mb-3">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</p>
            <div className="space-y-2">
              <input className="w-full border rounded px-3 py-1.5 text-xs" type="password" placeholder="ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" />
              <input className="w-full border rounded px-3 py-1.5 text-xs" type="password" placeholder="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" />
              <input className="w-full border rounded px-3 py-1.5 text-xs" type="password" placeholder="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰" />
              <button onClick={() => toast("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ", "success")} className="px-4 py-2 bg-blue-600 text-white rounded text-xs font-semibold">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´</button>
            </div>
          </div>
          <div className="bg-white rounded-lg border p-4">
            <p className="text-xs font-bold text-slate-700 mb-2">ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´</p>
            <div className="space-y-1">
              {[
                { time: "02/11 09:15", ip: "203.0.113.xxx", device: "Chrome / Mac OS", status: "æˆåŠŸ" },
                { time: "02/10 18:30", ip: "203.0.113.xxx", device: "Safari / iPhone", status: "æˆåŠŸ" },
                { time: "02/10 08:45", ip: "198.51.100.xxx", device: "Chrome / Windows", status: "å¤±æ•—ï¼ˆMFAï¼‰" },
              ].map((l, i) => (
                <div key={i} className="flex items-center text-xs gap-3 py-1 border-b last:border-0">
                  <span className="w-28 text-slate-400">{l.time}</span>
                  <span className="w-28 font-mono text-slate-500">{l.ip}</span>
                  <span className="flex-1 text-slate-600">{l.device}</span>
                  <Badge text={l.status} color={l.status === "æˆåŠŸ" ? "green" : "red"} />
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* Tab: ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç† */}
      {accTab === "members" && (
        <div className="space-y-3">
          <div className="flex justify-end">
            <button onClick={() => setShowInviteS08(true)} className="text-xs bg-blue-600 text-white px-3 py-1 rounded font-semibold">+ ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…</button>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "åå‰", w: "flex-1" }, { label: "ãƒ¡ãƒ¼ãƒ«", w: "w-48" }, { label: "æ¨©é™", w: "w-20" }, { label: "MFA", w: "w-14" }, { label: "æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³", w: "w-28" }, { label: "æ“ä½œ", w: "w-20" }]}>
            {[
              { name: "å±±ç”° å¤ªéƒ", email: "yamada@abcmart-ec.jp", role: "ç®¡ç†è€…", mfa: true, last: "02/11 09:15" },
              { name: "éˆ´æœ¨ èŠ±å­", email: "suzuki@abcmart-ec.jp", role: "ä¸€èˆ¬", mfa: true, last: "02/10 14:20" },
              { name: "ä½è—¤ æ¬¡éƒ", email: "sato@abcmart-ec.jp", role: "ä¸€èˆ¬", mfa: false, last: "02/08 11:30" },
            ].map((m, i) => (
              <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
                <td className="px-4 py-2 whitespace-nowrap font-semibold text-slate-700">{m.name}</td>
                <td className="px-4 py-2 whitespace-nowrap w-48 text-slate-500">{m.email}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={m.role} color={m.role === "ç®¡ç†è€…" ? "blue" : "gray"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-14 text-center">{m.mfa ? <span className="text-emerald-500">â—</span> : <span className="text-rose-400">â—‹</span>}</td>
                <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-400">{m.last}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><button onClick={() => toast(`${m.name}ã®æ¨©é™ã‚’ç·¨é›†ä¸­`, "info")} className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs">ç·¨é›†</button></td>
              </tr>
            ))}
            </TableHeader>
          </div>
        </div>
      )}

      {/* Tab: é€šçŸ¥è¨­å®š */}
      {accTab === "notifications" && (
        <div className="bg-white rounded-lg border p-4 max-w-2xl">
          <p className="text-xs font-bold text-slate-700 mb-3">ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®š</p>
          <div className="space-y-2">
            {[
              { label: "æ±ºæ¸ˆæˆåŠŸé€šçŸ¥", desc: "æ±ºæ¸ˆãŒæˆåŠŸã™ã‚‹ãŸã³ã«é€šçŸ¥", enabled: false },
              { label: "æ±ºæ¸ˆå¤±æ•—é€šçŸ¥", desc: "æ±ºæ¸ˆãŒå¤±æ•—ã—ãŸå ´åˆã«é€šçŸ¥", enabled: true },
              { label: "å…¥é‡‘å®Œäº†é€šçŸ¥", desc: "å£åº§ã¸ã®å…¥é‡‘ãŒå®Œäº†ã—ãŸå ´åˆã«é€šçŸ¥", enabled: true },
              { label: "ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯é€šçŸ¥", desc: "ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ãŒç™ºç”Ÿã—ãŸå ´åˆã«é€šçŸ¥", enabled: true },
              { label: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆ", desc: "ä¸å¯©ãªãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œã‚„è¨­å®šå¤‰æ›´ãŒã‚ã£ãŸå ´åˆ", enabled: true },
              { label: "æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ", desc: "æ¯æœˆã®å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ä¿¡", enabled: true },
            ].map((n, i) => (
              <div key={i} className="flex items-center justify-between p-2 border rounded">
                <div>
                  <p className="text-xs font-semibold text-slate-700">{n.label}</p>
                  <p className="text-xs text-slate-400">{n.desc}</p>
                </div>
                <div className={`w-10 h-5 rounded-full cursor-pointer flex items-center px-0.5 ${n.enabled ? "bg-blue-500 justify-end" : "bg-slate-300 justify-start"}`}>
                  <div className="w-4 h-4 bg-white rounded-full shadow" />
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Tab: å¥‘ç´„æƒ…å ± */}
      {accTab === "contract" && (
        <div className="space-y-3 max-w-2xl">
          <div className="bg-white rounded-lg border p-4">
            <p className="text-xs font-bold text-slate-700 mb-3">ç¾åœ¨ã®å¥‘ç´„æƒ…å ±</p>
            <div className="space-y-2 text-xs">
              {[
                { label: "å¥‘ç´„æ—¥", value: "2025-04-12" },
                { label: "å¥‘ç´„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", value: "æœ‰åŠ¹", badge: true, bColor: "green" },
                { label: "åˆ©ç”¨å¯èƒ½ãƒ–ãƒ©ãƒ³ãƒ‰", value: "VISA / MC / JCB / WEBãƒãƒãƒ¼" },
                { label: "æ¥ç¶šå…ˆï¼ˆæ‰¿èªæ¸ˆã¿ï¼‰", value: "Univa Pay cast, TCMS, ãƒ“ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥" },
              ].map((c, i) => (
                <div key={i} className="flex items-center gap-3">
                  <span className="w-36 text-slate-500 text-right">{c.label}</span>
                  {c.badge ? <Badge text={c.value} color={c.bColor} /> : <span className="font-semibold text-slate-700">{c.value}</span>}
                </div>
              ))}
            </div>
            <div className="mt-3 p-2 bg-slate-50 rounded-lg border border-slate-200">
              <p className="text-xs text-slate-400">ğŸ’¡ æ‰‹æ•°æ–™ç‡ãƒ»å…¥é‡‘ã‚µã‚¤ã‚¯ãƒ«ç­‰ã®å¥‘ç´„æ¡ä»¶ã®è©³ç´°ã¯ã€å¥‘ç´„æ›¸PDFã‚’ã”ç¢ºèªãã ã•ã„ã€‚æ¡ä»¶å¤‰æ›´ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
            </div>
            <button onClick={() => toast("å¥‘ç´„æ›¸PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="mt-2 px-3 py-1 bg-slate-100 text-slate-600 rounded text-xs border">ğŸ“„ å¥‘ç´„æ›¸PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            <div className="mt-4 pt-3 border-t">
              <p className="text-xs font-bold text-rose-600 mb-1">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè§£ç´„</p>
              <p className="text-xs text-slate-500 mb-2">è§£ç´„ç”³è«‹å¾Œã€é‹å–¶ã«ã¦å¯¾å¿œã„ãŸã—ã¾ã™ã€‚æœªç²¾ç®—ã®å‡¦ç†å®Œäº†å¾Œã«è§£ç´„ãŒç¢ºå®šã—ã¾ã™ã€‚</p>
              <button onClick={() => toast("è§£ç´„ç”³è«‹ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚é‹å–¶ã«ã¦å¯¾å¿œã„ãŸã—ã¾ã™", "warning")} className="px-3 py-1.5 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200 hover:bg-rose-100">è§£ç´„ç”³è«‹ã‚’é€ä¿¡</button>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾… â”€â”€ */}
      {showInviteS08 && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowInviteS08(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">ğŸ“§ ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…</h3>
              <button onClick={() => setShowInviteS08(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div><label className="text-xs font-semibold text-slate-600">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: member@company.jp" /></div>
              <div><label className="text-xs font-semibold text-slate-600">æ¨©é™ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ç®¡ç†è€…</option><option>ã‚¹ã‚¿ãƒƒãƒ•</option><option>é–²è¦§ã®ã¿</option></select></div>
              <div><label className="text-xs font-semibold text-slate-600">MFAè¨­å®š</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å¿…é ˆï¼ˆæ¨å¥¨ï¼‰</option><option>ä»»æ„</option></select></div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowInviteS08(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setShowInviteS08(false)} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">æ‹›å¾…ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ S09: æ±ºæ¸ˆãƒªãƒ³ã‚¯ç®¡ç† â”€â”€â”€
const MerchantPaymentLinks = () => {
  const toast = useToast();
  const [showPreview, setShowPreview] = useState(false);
  const [showGenerated, setShowGenerated] = useState(false);
  const [tab, setTab] = useState("create");
  const [selectedLink, setSelectedLink] = useState(null);
  const tabs = [
    { id: "create", label: "æ–°è¦ä½œæˆ" },
    { id: "list", label: "ãƒªãƒ³ã‚¯ä¸€è¦§" },
    { id: "stats", label: "åˆ©ç”¨çŠ¶æ³" },
  ];
  return (
    <div className="p-5 space-y-4">
      <div className="flex items-center justify-between">
        <h2 className="text-sm font-bold text-slate-800">æ±ºæ¸ˆãƒªãƒ³ã‚¯ç®¡ç†</h2>
      </div>
      <div className="flex gap-1">{tabs.map(t => (
        <button key={t.id} onClick={() => setTab(t.id)} className={`px-3 py-1.5 text-xs rounded-t border-b-2 ${tab === t.id ? "border-emerald-500 text-emerald-700 bg-emerald-50 font-bold" : "border-transparent text-slate-400"}`}>{t.label}</button>
      ))}</div>
      {tab === "create" && (
        <div className="bg-white rounded-lg border p-4 space-y-4">
          <p className="text-xs font-bold text-slate-600">æ±ºæ¸ˆã‚¿ã‚¤ãƒ—ã‚’é¸æŠ</p>
          <div className="grid grid-cols-3 gap-3">
            {[{ icon: "ğŸ’´", name: "å›ºå®šé‡‘é¡", desc: "æŒ‡å®šã—ãŸé‡‘é¡ã§æ±ºæ¸ˆ" }, { icon: "âœï¸", name: "é‡‘é¡å…¥åŠ›å‹", desc: "é¡§å®¢ãŒé‡‘é¡ã‚’å…¥åŠ›" }, { icon: "ğŸ“‹", name: "é‡‘é¡é¸æŠå‹", desc: "é¸æŠè‚¢ã‹ã‚‰é¸ã¶" }].map((t, i) => (
              <div key={i} className={`border-2 rounded-lg p-3 text-center cursor-pointer hover:border-emerald-400 ${i === 0 ? "border-emerald-500 bg-emerald-50" : "border-slate-200"}`}>
                <p className="text-xl">{t.icon}</p>
                <p className="text-xs font-bold mt-1">{t.name}</p>
                <p className="text-xs text-slate-400 mt-0.5">{t.desc}</p>
              </div>
            ))}
          </div>
          <div className="grid grid-cols-2 gap-3 mt-3">
            {["å•†å“å *", "æ±ºæ¸ˆé‡‘é¡ *", "æ³¨æ–‡IDãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹", "æœ‰åŠ¹æœŸé™"].map(f => (
              <div key={f}><label className="text-xs text-slate-500">{f}</label><input className="w-full border rounded px-2 py-1.5 text-xs mt-0.5" placeholder={f.replace(" *", "")} /></div>
            ))}
          </div>
          <div className="flex items-center gap-2 text-xs text-slate-500">
            <input type="checkbox" /> <span>ãƒ¦ãƒ¼ã‚¶ãƒ¼IDå…¥åŠ›ã‚’æ±‚ã‚ã‚‹</span>
            <span className="ml-4">åˆ©ç”¨å¯èƒ½å›æ•°:</span><input className="border rounded px-2 py-1 w-16 text-xs" placeholder="ç„¡åˆ¶é™" />
          </div>
          <div className="flex gap-2">
            <button onClick={() => setShowPreview(!showPreview)} className="flex-1 py-2 bg-slate-100 text-slate-600 rounded text-xs font-bold border hover:bg-slate-200">ğŸ‘ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
            <button onClick={() => setShowGenerated(true)} className="flex-1 py-2 bg-emerald-600 text-white rounded text-xs font-bold hover:bg-emerald-700">ğŸ”— æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ</button>
          </div>
          <div className="bg-emerald-50 border border-emerald-200 rounded p-3 text-xs">
            <p className="font-bold text-emerald-700">âœ… æ±ºæ¸ˆãƒªãƒ³ã‚¯ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼</p>
            <div className="flex items-center gap-2 mt-2">
              <input className="flex-1 border rounded px-2 py-1 bg-white text-xs" value="https://pay.aipayment.jp/l/abc123xyz" readOnly />
              <button onClick={() => toast("æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="px-2 py-1 bg-emerald-600 text-white rounded text-xs">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
              <button onClick={() => toast("ãƒ¡ãƒ¼ãƒ«ã§æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "success")} className="px-2 py-1 bg-slate-100 rounded text-xs border">ğŸ“§ ãƒ¡ãƒ¼ãƒ«</button>
              <button onClick={() => toast("QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ", "success")} className="px-2 py-1 bg-slate-100 rounded text-xs border">QR</button>
            </div>
          </div>
        </div>
      )}
      {tab === "list" && (<>
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
          <div className="p-3 border-b flex gap-2">
            <input className="border rounded px-2 py-1 text-xs flex-1" placeholder="å•†å“å / ãƒªãƒ³ã‚¯IDã§æ¤œç´¢" />
            <select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>æœ‰åŠ¹</option><option>ç„¡åŠ¹</option><option>æœŸé™åˆ‡ã‚Œ</option></select>
          </div>
          <TableHeader cols={[{ label: "ãƒªãƒ³ã‚¯ID", w: "w-24" }, { label: "å•†å“å", w: "flex-1" }, { label: "ã‚¿ã‚¤ãƒ—", w: "w-16" }, { label: "é‡‘é¡", w: "w-20" }, { label: "åˆ©ç”¨å›æ•°", w: "w-16" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "æ“ä½œ", w: "w-24" }]}>
          {[{ id: "LNK-001", name: "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³", type: "å›ºå®š", amt: "Â¥9,800", uses: "12/âˆ", st: "æœ‰åŠ¹", stc: "green", url: "https://pay.aipayment.jp/l/prem001", created: "2026-01-10", expires: "ç„¡æœŸé™", successRate: "98.2%", totalSales: "Â¥117,600", recentTx: [{ date: "02/11 14:20", amount: "Â¥9,800", status: "æˆåŠŸ" }, { date: "02/10 09:45", amount: "Â¥9,800", status: "æˆåŠŸ" }] },
            { id: "LNK-002", name: "å¯„ä»˜é‡‘", type: "å…¥åŠ›", amt: "â€”", uses: "45/100", st: "æœ‰åŠ¹", stc: "green", url: "https://pay.aipayment.jp/l/donate02", created: "2026-01-15", expires: "2026-06-30", successRate: "96.7%", totalSales: "Â¥1,230,000", recentTx: [{ date: "02/11 12:00", amount: "Â¥50,000", status: "æˆåŠŸ" }, { date: "02/10 16:30", amount: "Â¥10,000", status: "æˆåŠŸ" }] },
            { id: "LNK-003", name: "ã‚³ãƒ¼ã‚¹é¸æŠ", type: "é¸æŠ", amt: "é¸æŠå¼", uses: "3/10", st: "æœ‰åŠ¹", stc: "green", url: "https://pay.aipayment.jp/l/course03", created: "2026-02-01", expires: "2026-03-31", successRate: "100%", totalSales: "Â¥29,400", recentTx: [{ date: "02/09 10:00", amount: "Â¥9,800", status: "æˆåŠŸ" }] },
            { id: "LNK-004", name: "ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³", type: "å›ºå®š", amt: "Â¥1,980", uses: "100/100", st: "ä¸Šé™åˆ°é”", stc: "yellow", url: "https://pay.aipayment.jp/l/camp04", created: "2026-01-20", expires: "2026-02-28", successRate: "97.0%", totalSales: "Â¥198,000", recentTx: [{ date: "02/08 11:00", amount: "Â¥1,980", status: "æˆåŠŸ" }] }
          ].map((r, i) => (
            <tr key={i} className="border-b hover:bg-blue-50 cursor-pointer" onClick={() => setSelectedLink(r)}>
              <td className="px-4 py-2 whitespace-nowrap w-24 text-blue-600 font-mono">{r.id}</td>
              <td className="px-4 py-2 whitespace-nowrap">{r.name}</td>
              <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.type} color="blue" /></td>
              <td className="px-4 py-2 whitespace-nowrap w-20">{r.amt}</td>
              <td className="px-4 py-2 whitespace-nowrap w-16">{r.uses}</td>
              <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.st} color={r.stc} /></td>
              <td className="px-4 py-2 whitespace-nowrap w-24" onClick={e => e.stopPropagation()}><div className="flex gap-1">
                <button onClick={() => toast(`${r.url}ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ`, "success")} className="px-1.5 py-0.5 bg-slate-100 rounded text-xs border hover:bg-slate-200">ğŸ“‹</button>
                <button onClick={() => toast("QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ", "info")} className="px-1.5 py-0.5 bg-slate-100 rounded text-xs border hover:bg-slate-200">QR</button>
                <button onClick={() => toast(`${r.name}ã®ãƒªãƒ³ã‚¯ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ`, "warning")} className="px-1.5 py-0.5 bg-slate-100 rounded text-xs border hover:bg-slate-200">â¸</button>
              </div></td>
            </tr>
          ))}
          </TableHeader>
        </div>
      </>)}
      {tab === "stats" && (
        <div className="space-y-3">
          <div className="grid grid-cols-4 gap-3">
            <KPICard label="ç·ãƒªãƒ³ã‚¯æ•°" value="24" color="green" />
            <KPICard label="ã‚¢ã‚¯ãƒ†ã‚£ãƒ–" value="18" color="blue" />
            <KPICard label="ç·åˆ©ç”¨å›æ•°" value="1,247" color="green" />
            <KPICard label="ç·æ±ºæ¸ˆé«˜" value="Â¥4,823,600" color="green" />
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3 overflow-x-auto">
            <p className="text-xs font-bold mb-2">ãƒªãƒ³ã‚¯åˆ¥å®Ÿç¸¾</p>
            <TableHeader cols={[{ label: "å•†å“å", w: "flex-1" }, { label: "åˆ©ç”¨å›æ•°", w: "w-20" }, { label: "æ±ºæ¸ˆé«˜", w: "w-24" }, { label: "æˆåŠŸç‡", w: "w-16" }, { label: "æœ€çµ‚åˆ©ç”¨æ—¥", w: "w-24" }]}>
            {[["ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³", "842", "Â¥8,251,600", "98.2%", "2026-02-13"], ["å¯„ä»˜é‡‘", "245", "Â¥1,230,000", "96.7%", "2026-02-12"], ["ã‚³ãƒ¼ã‚¹é¸æŠ", "160", "Â¥960,000", "97.5%", "2026-02-11"]].map((r, i) => (
              <tr key={i} className="border-b">
                <td className="px-4 py-2 whitespace-nowrap">{r[0]}</td><td className="px-4 py-2 whitespace-nowrap w-20">{r[1]}</td><td className="px-4 py-2 whitespace-nowrap w-24 font-bold">{r[2]}</td><td className="px-4 py-2 whitespace-nowrap w-16 text-emerald-600">{r[3]}</td><td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400">{r[4]}</td>
              </tr>
            ))}
            </TableHeader>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: æ±ºæ¸ˆãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â”€â”€ */}
      {showPreview && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowPreview(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[380px]">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">ğŸ‘ æ±ºæ¸ˆãƒšãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
              <button onClick={() => setShowPreview(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-4">
              <div className="bg-white border-2 border-dashed rounded-lg p-4 text-center space-y-3">
                <div className="w-12 h-12 bg-emerald-100 rounded-full mx-auto flex items-center justify-center text-2xl">ğŸ’³</div>
                <p className="text-sm font-bold text-slate-800">ã‚µãƒ³ãƒ—ãƒ«ã‚·ãƒ§ãƒƒãƒ—</p>
                <p className="text-xs text-slate-500">å•†å“A Ã— 1ç‚¹</p>
                <p className="text-lg font-bold text-slate-800">Â¥3,980</p>
                <div className="space-y-2">
                  <input className="w-full text-xs border rounded px-3 py-2" placeholder="ã‚«ãƒ¼ãƒ‰ç•ªå·" disabled />
                  <div className="flex gap-2"><input className="flex-1 text-xs border rounded px-3 py-2" placeholder="æœ‰åŠ¹æœŸé™" disabled /><input className="flex-1 text-xs border rounded px-3 py-2" placeholder="CVC" disabled /></div>
                  <button className="w-full py-2 bg-emerald-600 text-white rounded text-xs font-bold" disabled>ãŠæ”¯æ‰•ã„</button>
                </div>
                <p className="text-xs text-slate-300">Powered by AQUAGATES</p>
              </div>
            </div>
            <div className="p-4 border-t"><button onClick={() => setShowPreview(false)} className="w-full py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">é–‰ã˜ã‚‹</button></div>
          </div>
        </div>
      )}

      {/* â”€â”€ Slide Panel: ãƒªãƒ³ã‚¯è©³ç´° â”€â”€ */}
      {selectedLink && (
        <div className="fixed inset-0 z-50 flex">
          <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedLink(null)} />
          <div className="w-[440px] bg-white shadow-xl border-l overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 flex justify-between items-center sticky top-0 z-10">
              <h3 className="text-sm font-bold text-slate-800">ğŸ”— ãƒªãƒ³ã‚¯è©³ç´°</h3>
              <button onClick={() => setSelectedLink(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              {/* Link Info */}
              <div className="text-center">
                <p className="text-xs text-slate-400">{selectedLink.id}</p>
                <p className="text-base font-bold text-slate-800 mt-1">{selectedLink.name}</p>
                <div className="flex items-center justify-center gap-2 mt-1">
                  <Badge text={selectedLink.type} color="blue" />
                  <Badge text={selectedLink.st} color={selectedLink.stc} />
                </div>
              </div>

              {/* URL & QR */}
              <div className="bg-slate-50 rounded-lg border p-3">
                <p className="text-xs font-bold text-slate-700 mb-1">æ±ºæ¸ˆãƒªãƒ³ã‚¯URL</p>
                <div className="flex items-center gap-2">
                  <input className="flex-1 text-xs border rounded px-2 py-1 bg-white" value={selectedLink.url} readOnly />
                  <button onClick={() => toast("æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="px-2 py-1 bg-emerald-600 text-white rounded text-xs">ğŸ“‹</button>
                </div>
                <div className="mt-3 text-center">
                  <div className="w-24 h-24 bg-white border-2 border-slate-300 rounded mx-auto flex items-center justify-center">
                    <span className="text-3xl">ğŸ“±</span>
                  </div>
                  <p className="text-xs text-slate-400 mt-1">QRã‚³ãƒ¼ãƒ‰</p>
                </div>
              </div>

              {/* Stats Grid */}
              <div className="grid grid-cols-2 gap-3">
                {[
                  { label: "é‡‘é¡", value: selectedLink.amt },
                  { label: "åˆ©ç”¨å›æ•°", value: selectedLink.uses },
                  { label: "æˆåŠŸç‡", value: selectedLink.successRate },
                  { label: "ç·æ±ºæ¸ˆé«˜", value: selectedLink.totalSales },
                  { label: "ä½œæˆæ—¥", value: selectedLink.created },
                  { label: "æœ‰åŠ¹æœŸé™", value: selectedLink.expires },
                ].map((s, i) => (
                  <div key={i} className="bg-slate-50 rounded p-2">
                    <p className="text-xs text-slate-400">{s.label}</p>
                    <p className="text-xs font-bold text-slate-700">{s.value}</p>
                  </div>
                ))}
              </div>

              {/* Recent Transactions */}
              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">ğŸ’³ ç›´è¿‘ã®å–å¼•</p>
                <div className="space-y-1">
                  {selectedLink.recentTx.map((tx, i) => (
                    <div key={i} className="flex items-center justify-between text-xs p-2 bg-slate-50 rounded border">
                      <span className="text-slate-400">{tx.date}</span>
                      <span className="font-semibold text-slate-700">{tx.amount}</span>
                      <Badge text={tx.status} color="green" />
                    </div>
                  ))}
                </div>
              </div>

              {/* Actions */}
              <div className="flex gap-2 pt-2 border-t">
                <button onClick={() => toast(`${selectedLink.name}ã‚’ç·¨é›†ä¸­`, "info")} className="flex-1 px-3 py-2 bg-slate-100 text-slate-600 rounded text-xs border hover:bg-slate-200">âœï¸ ç·¨é›†</button>
                <button onClick={() => toast(`${selectedLink.name}ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ`, "warning")} className="flex-1 px-3 py-2 bg-amber-50 text-amber-700 rounded text-xs border border-amber-200 hover:bg-amber-100">â¸ ä¸€æ™‚åœæ­¢</button>
                <button onClick={() => { toast(`${selectedLink.name}ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "error"); setSelectedLink(null); }} className="px-3 py-2 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200 hover:bg-rose-100">ğŸ—‘</button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: ãƒªãƒ³ã‚¯ç”Ÿæˆå®Œäº† â”€â”€ */}
      {showGenerated && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowGenerated(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
            <div className="p-4 border-b bg-emerald-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-emerald-700">âœ… æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆã—ã¾ã—ãŸ</h3>
              <button onClick={() => setShowGenerated(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div className="bg-slate-50 rounded-lg border border-slate-200 p-3"><p className="text-xs text-slate-400 mb-1">æ±ºæ¸ˆãƒªãƒ³ã‚¯URL</p><p className="text-xs font-mono text-blue-600 break-all">https://pay.aquagates.com/link/PL-20260216-001</p></div>
              <div className="flex gap-2">
                <button onClick={() => toast("æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", "success")} className="flex-1 py-2 bg-emerald-600 text-white rounded text-xs font-bold">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                <button onClick={() => toast("ãƒ¡ãƒ¼ãƒ«ã§æ±ºæ¸ˆãƒªãƒ³ã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "success")} className="flex-1 py-2 bg-slate-100 text-slate-600 rounded text-xs border">ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
                <button onClick={() => toast("QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ", "info")} className="flex-1 py-2 bg-slate-100 text-slate-600 rounded text-xs border">QRã‚³ãƒ¼ãƒ‰</button>
              </div>
              <div className="text-xs text-slate-400 text-center">æœ‰åŠ¹æœŸé™: 2026-03-16 23:59</div>
            </div>
            <div className="p-4 border-t"><button onClick={() => setShowGenerated(false)} className="w-full py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">é–‰ã˜ã‚‹</button></div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ S10: æ±ºæ¸ˆç®¡ç† â”€â”€â”€
const MerchantSubscriptions = () => {
  const toast = useToast();
  const [showCreatePlan, setShowCreatePlan] = useState(false);
  const [tab, setTab] = useState("plans");
  const [selectedSubUser, setSelectedSubUser] = useState(null);
  const [selectedSubPlan, setSelectedSubPlan] = useState(null);
  const [csvTab, setCsvTab] = useState("upload");
  const [showCsvPreview, setShowCsvPreview] = useState(false);
  const [selectedCsvBatch, setSelectedCsvBatch] = useState(null);
  const tabs = [{ id: "plans", label: "å•†å“è¨­å®š" }, { id: "users", label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†" }, { id: "history", label: "æ±ºæ¸ˆå±¥æ­´" }, { id: "csv", label: "CSVæ±ºæ¸ˆ" }];
  return (
    <div className="p-5 space-y-4">
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-3">
          <h2 className="text-sm font-bold text-slate-800">æ±ºæ¸ˆç®¡ç†</h2>
          <div className="flex items-center gap-1 text-xs text-slate-400">
            <span className="bg-slate-100 px-1.5 py-0.5 rounded">ğŸ¢ åŠ ç›Ÿåº—</span>
            <span>â†’</span>
            <select className="border rounded px-2 py-1 text-xs font-semibold text-emerald-700 bg-emerald-50">
              <option>ğŸŒ ECã‚µã‚¤ãƒˆA</option>
              <option>ğŸŒ ã‚µãƒ–ã‚¹ã‚¯ã‚µã‚¤ãƒˆB</option>
              <option>ğŸŒ æ•™è‚²ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ C</option>
            </select>
            <span>â†’</span>
            <span className="bg-emerald-100 text-emerald-700 px-1.5 py-0.5 rounded font-semibold">ğŸ“¦ ãƒ—ãƒ©ãƒ³ï¼ˆè¤‡æ•°ï¼‰</span>
          </div>
        </div>
      </div>
      <div className="bg-blue-50 border border-blue-200 rounded p-2 text-xs text-blue-700 flex items-center gap-2">
        <span>ğŸ’¡</span>
        <span>æ±ºæ¸ˆç®¡ç†ã¯ã‚µã‚¤ãƒˆå˜ä½ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚å„ã‚µã‚¤ãƒˆã«è¤‡æ•°ã®ãƒ—ãƒ©ãƒ³ï¼ˆæœˆé¡ãƒ»å¹´é¡ãƒ»åˆ†å‰²ç­‰ï¼‰ã‚’è¨­å®šã§ãã¾ã™ã€‚ã‚µã‚¤ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¦ãƒ—ãƒ©ãƒ³ã‚’ç®¡ç†ã—ã¦ãã ã•ã„ã€‚</span>
      </div>
      <div className="flex gap-1">{tabs.map(t => (
        <button key={t.id} onClick={() => setTab(t.id)} className={`px-3 py-1.5 text-xs rounded-t border-b-2 ${tab === t.id ? "border-emerald-500 text-emerald-700 bg-emerald-50 font-bold" : "border-transparent text-slate-400"}`}>{t.label}</button>
      ))}</div>
      {tab === "plans" && (
        <div className="space-y-3">
          <div className="flex items-center justify-between">
            <button onClick={() => setShowCreatePlan(!showCreatePlan)} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-bold">+ ãƒ—ãƒ©ãƒ³ä½œæˆ</button>
            <span className="text-xs text-slate-400">ã“ã®ã‚µã‚¤ãƒˆã®ãƒ—ãƒ©ãƒ³: 4ä»¶ï¼ˆæœ‰åŠ¹3 / ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–1ï¼‰</span>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "ãƒ—ãƒ©ãƒ³å", w: "flex-1" }, { label: "ã‚¿ã‚¤ãƒ—", w: "w-16" }, { label: "é‡‘é¡", w: "w-24" }, { label: "ã‚µã‚¤ã‚¯ãƒ«", w: "w-20" }, { label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°", w: "w-16" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "æ“ä½œ", w: "w-16" }]}>
            {[{ name: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", type: "ç¶™ç¶š", amt: "Â¥2,980/æœˆ", cycle: "æ¯æœˆ1æ—¥", users: "342", st: "active", created: "2025-06-01", mrr: "Â¥1,019,160", churn: "2.1%", trial: "7æ—¥é–“" },
              { name: "å¹´é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ", type: "ç¶™ç¶š", amt: "Â¥29,800/å¹´", cycle: "365æ—¥", users: "89", st: "active", created: "2025-06-01", mrr: "Â¥221,017", churn: "0.5%", trial: "14æ—¥é–“" },
              { name: "3å›åˆ†å‰²æ‰•ã„", type: "åˆ†å‰²", amt: "Â¥15,000(3å›)", cycle: "æ¯æœˆ15æ—¥", users: "56", st: "active", created: "2025-09-15", mrr: "Â¥280,000", churn: "â€”", trial: "ãªã—" },
              { name: "æ—§ãƒ—ãƒ©ãƒ³", type: "ç¶™ç¶š", amt: "Â¥1,980/æœˆ", cycle: "æ¯æœˆ1æ—¥", users: "12", st: "archived", created: "2024-01-01", mrr: "Â¥23,760", churn: "8.3%", trial: "ãªã—" }
            ].map((r, i) => (
              <tr key={i} className="border-b hover:bg-blue-50 cursor-pointer" onClick={() => setSelectedSubPlan(r)}>
                <td className="px-4 py-2 whitespace-nowrap font-bold">{r.name}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.type} color={r.type === "ç¶™ç¶š" ? "blue" : "purple"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-24">{r.amt}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20 text-slate-500">{r.cycle}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-center">{r.users}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.st === "active" ? "æœ‰åŠ¹" : "ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"} color={r.st === "active" ? "green" : "gray"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-16" onClick={e => e.stopPropagation()}><button onClick={() => setSelectedSubPlan(r)} className="text-blue-600 text-xs hover:underline">ç·¨é›†</button></td>
              </tr>
            ))}
            </TableHeader>
          </div>
        </div>
      )}
      {tab === "users" && (
        <div className="space-y-3">
          <div className="flex gap-2">
            <input className="border rounded px-2 py-1 text-xs flex-1" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ID / ãƒ¡ãƒ¼ãƒ«ã§æ¤œç´¢" />
            <select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>ğŸŸ¢ èª²é‡‘ä¸­</option><option>ğŸ”´ è‡ªå‹•åœæ­¢</option><option>ğŸ”µ å®Œäº†</option></select>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", w: "w-24" }, { label: "ãƒ¡ãƒ¼ãƒ«", w: "flex-1" }, { label: "ãƒ—ãƒ©ãƒ³", w: "w-28" }, { label: "ã‚«ãƒ¼ãƒ‰", w: "w-16" }, { label: "æ¬¡å›æ±ºæ¸ˆ", w: "w-20" }, { label: "å¤±æ•—", w: "w-10" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "æ“ä½œ", w: "w-28" }]}>
            {[{ uid: "USR-001", email: "user1@example.com", plan: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", card: "*4242", next: "03/01", fails: "0", st: "èª²é‡‘ä¸­", stc: "green", joined: "2025-08-10", total: "Â¥20,860", payments: [{ date: "02/01", amount: "Â¥2,980", status: "æˆåŠŸ" }, { date: "01/01", amount: "Â¥2,980", status: "æˆåŠŸ" }, { date: "12/01", amount: "Â¥2,980", status: "æˆåŠŸ" }] },
              { uid: "USR-002", email: "user2@example.com", plan: "3å›åˆ†å‰²æ‰•ã„", card: "*1234", next: "03/15", fails: "0", st: "èª²é‡‘ä¸­", stc: "green", joined: "2026-01-15", total: "Â¥10,000", payments: [{ date: "02/15", amount: "Â¥5,000", status: "æˆåŠŸ" }, { date: "01/15", amount: "Â¥5,000", status: "æˆåŠŸ" }] },
              { uid: "USR-003", email: "user3@example.com", plan: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", card: "*5678", next: "02/23", fails: "2", st: "ãƒªãƒˆãƒ©ã‚¤ä¸­", stc: "yellow", joined: "2025-10-01", total: "Â¥11,920", payments: [{ date: "02/01", amount: "Â¥2,980", status: "å¤±æ•—" }, { date: "02/11", amount: "Â¥2,980", status: "å¤±æ•—" }, { date: "01/01", amount: "Â¥2,980", status: "æˆåŠŸ" }] },
              { uid: "USR-004", email: "user4@example.com", plan: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", card: "*9999", next: "â€”", fails: "3", st: "è‡ªå‹•åœæ­¢", stc: "red", joined: "2025-11-15", total: "Â¥5,960", payments: [{ date: "02/01", amount: "Â¥2,980", status: "å¤±æ•—" }, { date: "01/01", amount: "Â¥2,980", status: "æˆåŠŸ" }, { date: "12/01", amount: "Â¥2,980", status: "æˆåŠŸ" }] }
            ].map((r, i) => (
              <tr key={i} className="border-b hover:bg-blue-50 cursor-pointer" onClick={() => setSelectedSubUser(r)}>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-blue-600">{r.uid}</td>
                <td className="px-4 py-2 whitespace-nowrap">{r.email}</td>
                <td className="px-4 py-2 whitespace-nowrap w-28">{r.plan}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 font-mono">{r.card}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20">{r.next}</td>
                <td className="px-4 py-2 whitespace-nowrap w-10 text-center">{r.fails !== "0" && <span className="text-rose-600 font-bold">{r.fails}</span>}{r.fails === "0" && "â€”"}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.st} color={r.stc} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-28" onClick={e => e.stopPropagation()}><div className="flex gap-1">{r.st === "èª²é‡‘ä¸­" && <><button onClick={() => toast(`${r.uid}ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ`, "warning")} className="px-1.5 py-0.5 bg-amber-50 text-amber-700 rounded text-xs border border-amber-200">ä¸€æ™‚åœæ­¢</button><button onClick={() => toast("ã‚«ãƒ¼ãƒ‰å¤‰æ›´URLã‚’ç™ºè¡Œã—ã¾ã—ãŸ", "success")} className="px-1.5 py-0.5 bg-blue-50 text-blue-600 rounded text-xs border border-blue-200">ã‚«ãƒ¼ãƒ‰å¤‰æ›´URL</button></>}{r.st === "ä¸€æ™‚åœæ­¢" && <button onClick={() => toast(`${r.uid}ã®èª²é‡‘ã‚’å†é–‹ã—ã¾ã—ãŸ`, "success")} className="px-1.5 py-0.5 bg-emerald-50 text-emerald-600 rounded text-xs border border-emerald-200">å†é–‹</button>}{r.st === "ãƒªãƒˆãƒ©ã‚¤ä¸­" && <button onClick={() => toast(`${r.uid}ã‚’æ°¸ä¹…åœæ­¢ã—ã¾ã—ãŸ`, "error")} className="px-1.5 py-0.5 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200">æ°¸ä¹…åœæ­¢</button>}</div></td>
              </tr>
            ))}
            </TableHeader>
          </div>
          <div className="bg-amber-50 border border-amber-200 rounded p-2 text-xs text-amber-700">âš ï¸ ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯: å¤±æ•—â†’10æ—¥å¾Œå†ãƒˆãƒ©ã‚¤â†’3å›é€£ç¶šå¤±æ•—ã§è‡ªå‹•åœæ­¢ï¼ˆå†é–‹ä¸å¯ï¼‰</div>
        </div>
      )}
      {tab === "history" && (
        <div className="space-y-3">
          <div className="grid grid-cols-3 gap-3">
            <KPICard label="ä»Šæœˆ æˆåŠŸ" value="487ä»¶" sub="Â¥1,452,260" color="green" />
            <KPICard label="ä»Šæœˆ å¤±æ•—" value="12ä»¶" color="red" />
            <KPICard label="ãƒªãƒˆãƒ©ã‚¤ä¸­" value="3ä»¶" color="yellow" />
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "å®Ÿè¡Œæ—¥", w: "w-24" }, { label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", w: "w-24" }, { label: "ãƒ—ãƒ©ãƒ³", w: "flex-1" }, { label: "é‡‘é¡", w: "w-20" }, { label: "çµæœ", w: "w-14" }, { label: "ãƒªãƒˆãƒ©ã‚¤", w: "w-14" }, { label: "ã‚¨ãƒ©ãƒ¼", w: "w-20" }]}>
            {[["02/13 02:00", "USR-001", "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", "Â¥2,980", "æˆåŠŸ", "â€”", "â€”"], ["02/13 02:00", "USR-003", "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", "Â¥2,980", "å¤±æ•—", "2å›ç›®", "E-Card01"], ["02/13 02:00", "USR-004", "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", "Â¥2,980", "å¤±æ•—", "3å›ç›®", "E-Card01"]].map((r, i) => (
              <tr key={i} className="border-b">
                <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400">{r[0]}</td><td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-blue-600">{r[1]}</td><td className="px-4 py-2 whitespace-nowrap">{r[2]}</td><td className="px-4 py-2 whitespace-nowrap w-20">{r[3]}</td>
                <td className="px-4 py-2 whitespace-nowrap w-14"><Badge text={r[4]} color={r[4] === "æˆåŠŸ" ? "green" : "red"} /></td><td className="px-4 py-2 whitespace-nowrap w-14 text-slate-500">{r[5]}</td><td className="px-4 py-2 whitespace-nowrap w-20 text-rose-500 font-mono">{r[6]}</td>
              </tr>
            ))}
            </TableHeader>
          </div>
        </div>
      )}

      {/* ===== CSVæ±ºæ¸ˆã‚¿ãƒ– ===== */}
      {tab === "csv" && (
        <div className="space-y-3">
          <div className="flex gap-1 border-b">
            {[{ id: "upload", label: "CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰" }, { id: "batches", label: "æ±ºæ¸ˆãƒãƒƒãƒä¸€è¦§" }, { id: "format", label: "ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¬æ˜" }].map(t => (
              <button key={t.id} onClick={() => setCsvTab(t.id)} className={`px-3 py-1.5 text-xs border-b-2 ${csvTab === t.id ? "border-emerald-500 text-emerald-700 font-bold" : "border-transparent text-slate-400"}`}>{t.label}</button>
            ))}
          </div>

          {csvTab === "upload" && (
            <div className="space-y-3">
              <div className="bg-emerald-50 border border-emerald-200 rounded-lg p-3 text-xs text-emerald-700">
                <p className="font-bold mb-1">ğŸ“‹ CSVæ±ºæ¸ˆã®æµã‚Œ</p>
                <div className="flex gap-4 items-center text-slate-600">
                  <div className="flex items-center gap-1"><span className="w-5 h-5 bg-emerald-600 text-white rounded-full flex items-center justify-center text-xs font-bold">1</span><span>CSVä½œæˆãƒ»UP</span></div>
                  <span className="text-slate-300">â†’</span>
                  <div className="flex items-center gap-1"><span className="w-5 h-5 bg-slate-300 text-white rounded-full flex items-center justify-center text-xs font-bold">2</span><span>é‹å–¶å´æ‰¿èª</span></div>
                  <span className="text-slate-300">â†’</span>
                  <div className="flex items-center gap-1"><span className="w-5 h-5 bg-slate-300 text-white rounded-full flex items-center justify-center text-xs font-bold">3</span><span>ãƒãƒƒãƒæ±ºæ¸ˆå®Ÿè¡Œ</span></div>
                </div>
              </div>

              <div className="bg-white rounded-lg border-2 border-dashed border-slate-300 p-6 text-center hover:border-emerald-400 transition-colors cursor-pointer">
                <div className="text-3xl mb-2">ğŸ“</div>
                <p className="text-xs font-bold text-slate-700">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p className="text-xs text-slate-400 mt-1">ã¾ãŸã¯<button className="text-emerald-600 font-semibold underline ml-1">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button></p>
                <p className="text-xs text-slate-300 mt-2">å¯¾å¿œå½¢å¼: CSV (UTF-8) / æœ€å¤§: 10MB / æœ€å¤§è¡Œæ•°: 10,000ä»¶</p>
              </div>

              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="text-xs font-semibold text-slate-600">æ±ºæ¸ˆäºˆå®šæ—¥ <span className="text-rose-500">*</span></label>
                  <input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="2026-02-20" />
                </div>
                <div>
                  <label className="text-xs font-semibold text-slate-600">ãƒãƒƒãƒåï¼ˆä»»æ„ï¼‰</label>
                  <input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: 2æœˆæœˆè¬æ±ºæ¸ˆ" />
                </div>
              </div>

              {/* CSV Preview */}
              <div className="bg-white rounded-lg border border-slate-200 shadow-sm">
                <div className="p-3 border-b flex justify-between items-center bg-slate-50">
                  <div className="flex items-center gap-2">
                    <span className="text-xs font-bold text-slate-700">ğŸ“„ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼: 202602_monthly.csv</span>
                    <Badge text="5ä»¶" color="blue" />
                  </div>
                  <div className="flex gap-2">
                    <Badge text="ã‚¨ãƒ©ãƒ¼ 0ä»¶" color="green" />
                    <Badge text="è­¦å‘Š 1ä»¶" color="yellow" />
                  </div>
                </div>
                <div className="overflow-x-auto">
                  <table className="w-full text-xs">
                    <thead><tr className="bg-slate-50 border-b">
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">#</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">paymentid</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">price</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">email</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">tel</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">productName</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">orderid</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">free1</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 font-semibold">æ¤œè¨¼</th>
                    </tr></thead>
                    <tbody>
                      {[
                        { no: 1, pid: "PAY-20260115-001", price: "9800", email: "tanaka@example.com", tel: "090-1234-5678", product: "æœˆé¡ä¼šè²»2æœˆåˆ†", oid: "ORD-2026-0201", free1: "ç”°ä¸­å¤ªéƒ", ok: true },
                        { no: 2, pid: "PAY-20260115-002", price: "9800", email: "sato@example.com", tel: "080-9876-5432", product: "æœˆé¡ä¼šè²»2æœˆåˆ†", oid: "ORD-2026-0202", free1: "ä½è—¤èŠ±å­", ok: true },
                        { no: 3, pid: "PAY-20260115-003", price: "5000", email: "suzuki@example.com", tel: "070-1111-2222", product: "æœˆé¡ä¼šè²»2æœˆåˆ†ï¼ˆå‰²å¼•ï¼‰", oid: "ORD-2026-0203", free1: "éˆ´æœ¨ä¸€éƒ", ok: true },
                        { no: 4, pid: "", price: "9800", email: "yamada@example.com", tel: "090-3333-4444", product: "æœˆé¡ä¼šè²»2æœˆåˆ†", oid: "ORD-2026-0204", free1: "å±±ç”°æ˜", ok: true, warn: "æ–°è¦: paymentidãªã—â†’æ–°è¦æ±ºæ¸ˆã¨ã—ã¦å‡¦ç†" },
                        { no: 5, pid: "PAY-20260115-005", price: "12000", email: "ito@example.com", tel: "080-5555-6666", product: "æœˆé¡ä¼šè²»2æœˆåˆ†ï¼ˆä¸Šç´šï¼‰", oid: "ORD-2026-0205", free1: "ä¼Šè—¤æ¶¼", ok: true },
                      ].map((r, i) => (
                        <tr key={i} className={`border-b ${r.warn ? "bg-amber-50" : i % 2 ? "bg-slate-50" : ""}`}>
                          <td className="px-3 py-1.5 text-slate-400">{r.no}</td>
                          <td className="px-3 py-1.5 font-mono text-blue-600">{r.pid || <span className="text-amber-500 italic">â€”ï¼ˆæ–°è¦ï¼‰</span>}</td>
                          <td className="px-3 py-1.5 font-semibold">Â¥{Number(r.price).toLocaleString()}</td>
                          <td className="px-3 py-1.5 text-slate-500">{r.email}</td>
                          <td className="px-3 py-1.5 text-slate-500">{r.tel}</td>
                          <td className="px-3 py-1.5">{r.product}</td>
                          <td className="px-3 py-1.5 font-mono text-slate-400">{r.oid}</td>
                          <td className="px-3 py-1.5 text-slate-500">{r.free1}</td>
                          <td className="px-3 py-1.5">{r.ok ? <Badge text={r.warn ? "è­¦å‘Š" : "OK"} color={r.warn ? "yellow" : "green"} /> : <Badge text="ã‚¨ãƒ©ãƒ¼" color="red" />}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
                {/* Warning detail */}
                <div className="px-3 py-2 bg-amber-50 border-t border-amber-200 text-xs text-amber-700 flex items-center gap-1">
                  <span>âš ï¸</span> è¡Œ4: paymentidãŒç©ºã®ãŸã‚ã€æ–°è¦æ±ºæ¸ˆã¨ã—ã¦å‡¦ç†ã•ã‚Œã¾ã™ã€‚éå»ã®æ±ºæ¸ˆIDãŒã‚ã‚‹å ´åˆã¯å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                </div>
              </div>

              <div className="flex justify-between items-center">
                <p className="text-xs text-slate-400">åˆè¨ˆé‡‘é¡: <span className="font-bold text-slate-700">Â¥46,400</span>ï¼ˆ5ä»¶ï¼‰</p>
                <div className="flex gap-2">
                  <button onClick={() => toast("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆCSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="px-3 py-1.5 text-xs text-slate-500 border rounded hover:bg-slate-50">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆCSVã‚’DL</button>
                  <button onClick={() => setShowCsvPreview(true)} className="px-4 py-1.5 text-xs bg-emerald-600 text-white rounded font-bold hover:bg-emerald-700">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦æ‰¿èªä¾é ¼</button>
                </div>
              </div>
            </div>
          )}

          {csvTab === "batches" && (
            <div className="space-y-3">
              <div className="grid grid-cols-4 gap-3">
                <KPICard label="æ‰¿èªå¾…ã¡" value="1ä»¶" color="yellow" />
                <KPICard label="æ‰¿èªæ¸ˆã¿ï¼ˆå®Ÿè¡Œå¾…ã¡ï¼‰" value="1ä»¶" color="blue" />
                <KPICard label="ä»Šæœˆå®Ÿè¡Œæ¸ˆã¿" value="3ä»¶" color="green" />
                <KPICard label="ä»Šæœˆæ±ºæ¸ˆç·é¡" value="Â¥284,600" color="green" />
              </div>
              <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
                <TableHeader cols={[{ label: "ãƒãƒƒãƒID", w: "w-24" }, { label: "ãƒãƒƒãƒå", w: "flex-1" }, { label: "ä»¶æ•°", w: "w-14" }, { label: "åˆè¨ˆé‡‘é¡", w: "w-24" }, { label: "æ±ºæ¸ˆäºˆå®šæ—¥", w: "w-24" }, { label: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥", w: "w-28" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-20" }]}>
                {[
                  { id: "CSV-0045", name: "2æœˆæœˆè¬æ±ºæ¸ˆ", count: "42", total: "Â¥411,600", schedule: "2026-02-20", uploaded: "2026-02-14 10:30", st: "æ‰¿èªå¾…ã¡", stc: "yellow", results: null },
                  { id: "CSV-0044", name: "2æœˆè¿½åŠ åˆ†", count: "8", total: "Â¥78,400", schedule: "2026-02-18", uploaded: "2026-02-12 14:15", st: "æ‰¿èªæ¸ˆ", stc: "blue", results: null },
                  { id: "CSV-0043", name: "1æœˆæœˆè¬æ±ºæ¸ˆ", count: "38", total: "Â¥372,400", schedule: "2026-01-20", uploaded: "2026-01-14 09:45", st: "å®Œäº†", stc: "green", results: { success: 36, fail: 2, total: "Â¥352,800" } },
                  { id: "CSV-0042", name: "1æœˆè¿½åŠ åˆ†", count: "5", total: "Â¥49,000", schedule: "2026-01-15", uploaded: "2026-01-10 11:20", st: "å®Œäº†", stc: "green", results: { success: 5, fail: 0, total: "Â¥49,000" } },
                  { id: "CSV-0041", name: "12æœˆæœˆè¬æ±ºæ¸ˆ", count: "35", total: "Â¥343,000", schedule: "2025-12-20", uploaded: "2025-12-14 10:00", st: "å®Œäº†", stc: "green", results: { success: 34, fail: 1, total: "Â¥333,200" } },
                ].map((r, i) => (
                  <tr key={i} className="border-b hover:bg-blue-50 cursor-pointer" onClick={() => setSelectedCsvBatch(r)}>
                    <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-blue-600">{r.id}</td>
                    <td className="px-4 py-2 whitespace-nowrap font-semibold">{r.name}</td>
                    <td className="px-4 py-2 whitespace-nowrap w-14 text-center">{r.count}</td>
                    <td className="px-4 py-2 whitespace-nowrap w-24 font-semibold">{r.total}</td>
                    <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-500">{r.schedule}</td>
                    <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-400">{r.uploaded}</td>
                    <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={r.st} color={r.stc} /></td>
                  </tr>
                ))}
                </TableHeader>
              </div>
            </div>
          )}

          {csvTab === "format" && (
            <div className="space-y-3">
              <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4 space-y-3">
                <p className="text-xs font-bold text-slate-800">ğŸ“‹ CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä»•æ§˜</p>
                <div className="bg-slate-800 rounded-lg p-3 font-mono text-xs text-emerald-400 overflow-x-auto">
                  paymentid,price,email,tel,productName,orderid,free1,free2,free3
                </div>
                <div className="overflow-x-auto">
                  <table className="w-full text-xs">
                    <thead><tr className="bg-slate-50 border-b">
                      <th className="px-3 py-1.5 text-left text-slate-500 w-28">ã‚«ãƒ©ãƒ å</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 w-14">å¿…é ˆ</th>
                      <th className="px-3 py-1.5 text-left text-slate-500 w-16">å‹</th>
                      <th className="px-3 py-1.5 text-left text-slate-500">èª¬æ˜</th>
                    </tr></thead>
                    <tbody>
                      {[
                        { col: "paymentid", req: "æ¡ä»¶ä»˜", type: "æ–‡å­—åˆ—", desc: "éå»ã®æ±ºæ¸ˆIDã€‚ç¶™ç¶šæ±ºæ¸ˆæ™‚ã¯å‰å›ã®IDã‚’æŒ‡å®šã€‚ç©ºã®å ´åˆã¯æ–°è¦æ±ºæ¸ˆã¨ã—ã¦å‡¦ç†ã•ã‚Œã€æ–°ã—ã„IDãŒæŒ¯ã‚‰ã‚Œã‚‹" },
                        { col: "price", req: "å¿…é ˆ", type: "æ•°å€¤", desc: "æ±ºæ¸ˆé‡‘é¡ï¼ˆç¨è¾¼ï¼‰ã€‚æ•´æ•°ã®ã¿ã€å°æ•°ç‚¹ä¸å¯" },
                        { col: "email", req: "å¿…é ˆ", type: "æ–‡å­—åˆ—", desc: "è³¼å…¥è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚æ±ºæ¸ˆé€šçŸ¥ã®é€ä¿¡å…ˆ" },
                        { col: "tel", req: "ä»»æ„", type: "æ–‡å­—åˆ—", desc: "è³¼å…¥è€…é›»è©±ç•ªå·ã€‚ãƒã‚¤ãƒ•ãƒ³æœ‰ç„¡ã©ã¡ã‚‰ã‚‚å¯" },
                        { col: "productName", req: "å¿…é ˆ", type: "æ–‡å­—åˆ—", desc: "å•†å“åã€‚æ±ºæ¸ˆæ˜ç´°ãƒ»é€šçŸ¥ã«è¡¨ç¤ºã•ã‚Œã‚‹" },
                        { col: "orderid", req: "ä»»æ„", type: "æ–‡å­—åˆ—", desc: "åŠ ç›Ÿåº—å´ã®æ³¨æ–‡IDã€‚ç®¡ç†ç”¨ã®ä»»æ„æ–‡å­—åˆ—" },
                        { col: "free1", req: "ä»»æ„", type: "æ–‡å­—åˆ—", desc: "è‡ªç”±é …ç›®1ï¼ˆä¾‹: ä¼šå“¡åï¼‰" },
                        { col: "free2", req: "ä»»æ„", type: "æ–‡å­—åˆ—", desc: "è‡ªç”±é …ç›®2ï¼ˆä¾‹: ä¼šå“¡ç•ªå·ï¼‰" },
                        { col: "free3", req: "ä»»æ„", type: "æ–‡å­—åˆ—", desc: "è‡ªç”±é …ç›®3ï¼ˆä¾‹: å‚™è€ƒï¼‰" },
                      ].map((r, i) => (
                        <tr key={i} className="border-b">
                          <td className="px-3 py-1.5 font-mono font-bold text-blue-700">{r.col}</td>
                          <td className="px-3 py-1.5"><Badge text={r.req} color={r.req === "å¿…é ˆ" ? "red" : r.req === "æ¡ä»¶ä»˜" ? "yellow" : "gray"} /></td>
                          <td className="px-3 py-1.5 text-slate-500">{r.type}</td>
                          <td className="px-3 py-1.5 text-slate-600">{r.desc}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs space-y-2">
                <p className="font-bold text-blue-700">ğŸ’¡ CSVæ±ºæ¸ˆã®ä»•çµ„ã¿</p>
                <ul className="space-y-1 text-blue-600">
                  <li>â€¢ <span className="font-semibold">paymentid</span>ã«éå»ã®æ±ºæ¸ˆIDã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ãã®ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’åˆ©ç”¨ã—ã¦ç¶™ç¶šæ±ºæ¸ˆã‚’è¡Œã„ã¾ã™</li>
                  <li>â€¢ CSVæ±ºæ¸ˆã§æ–°ã—ã„æ±ºæ¸ˆãŒæˆåŠŸã™ã‚‹ã¨ã€<span className="font-semibold">æ–°ã—ã„æ±ºæ¸ˆID</span>ãŒæŒ¯ã‚‰ã‚Œã¾ã™</li>
                  <li>â€¢ CSVã«å«ã‚ãªã‘ã‚Œã°æ±ºæ¸ˆã•ã‚Œãªã„ãŸã‚ã€<span className="font-semibold">ä¼‘ä¼šå¯¾å¿œ</span>ãŒç°¡å˜ã«ã§ãã¾ã™</li>
                  <li>â€¢ é‡‘é¡ã‚’å¤‰æ›´ã™ã‚Œã°<span className="font-semibold">å¤‰å‹•ã™ã‚‹æœˆè¬</span>ã«ã‚‚å¯¾å¿œå¯èƒ½ã§ã™</li>
                  <li>â€¢ æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯<span className="font-semibold">UTF-8</span>ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„</li>
                </ul>
              </div>
              <div className="flex gap-2">
                <button onClick={() => toast("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆCSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="px-3 py-1.5 text-xs bg-slate-100 text-slate-600 rounded border hover:bg-slate-200">ğŸ“¥ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆCSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button onClick={() => toast("ã‚µãƒ³ãƒ—ãƒ«CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="px-3 py-1.5 text-xs bg-slate-100 text-slate-600 rounded border hover:bg-slate-200">ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«CSVï¼ˆè¨˜å…¥ä¾‹ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
              </div>
            </div>
          )}
        </div>
      )}

      {/* â”€â”€ CSV ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */}
      {showCsvPreview && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowCsvPreview(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[480px]">
            <div className="p-4 border-b bg-emerald-50 rounded-t-xl">
              <h3 className="text-sm font-bold text-slate-800">ğŸ“¤ CSVæ±ºæ¸ˆ æ‰¿èªä¾é ¼ã®ç¢ºèª</h3>
            </div>
            <div className="p-5 space-y-4">
              <div className="bg-slate-50 rounded-lg border p-3 space-y-1.5 text-xs">
                <div className="flex justify-between"><span className="text-slate-400">ãƒ•ã‚¡ã‚¤ãƒ«å</span><span className="font-mono">202602_monthly.csv</span></div>
                <div className="flex justify-between"><span className="text-slate-400">æ±ºæ¸ˆä»¶æ•°</span><span className="font-bold">5ä»¶</span></div>
                <div className="flex justify-between"><span className="text-slate-400">åˆè¨ˆé‡‘é¡</span><span className="font-bold text-emerald-600">Â¥46,400</span></div>
                <div className="flex justify-between"><span className="text-slate-400">æ±ºæ¸ˆäºˆå®šæ—¥</span><span>2026-02-20</span></div>
                <div className="flex justify-between"><span className="text-slate-400">ãƒãƒƒãƒå</span><span>2æœˆæœˆè¬æ±ºæ¸ˆ</span></div>
              </div>
              <div className="bg-amber-50 border border-amber-200 rounded p-2 text-xs text-amber-700">
                <p className="font-bold">âš ï¸ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã®æµã‚Œ</p>
                <p className="mt-1">CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€é‹å–¶å´ã®<span className="font-bold">ä¾‹å¤–ã‚­ãƒ¥ãƒ¼</span>ã«ã€ŒCSVæ±ºæ¸ˆæ‰¿èªå¾…ã¡ã€ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™ã€‚é‹å–¶å´ã§å†…å®¹ã‚’ç¢ºèªãƒ»æ‰¿èªã—ãŸå¾Œã€æ±ºæ¸ˆäºˆå®šæ—¥ã«ãƒãƒƒãƒå‡¦ç†ã§è‡ªå‹•æ±ºæ¸ˆã•ã‚Œã¾ã™ã€‚</p>
              </div>
              <div className="bg-blue-50 border border-blue-200 rounded p-2 text-xs text-blue-700">
                <p className="font-bold">ğŸ“‹ ä¾‹å¤–ã‚­ãƒ¥ãƒ¼ã«ç™»éŒ²ã•ã‚Œã‚‹æƒ…å ±</p>
                <div className="grid grid-cols-2 gap-1 mt-1 text-slate-600">
                  <div>â€¢ ã‚­ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ—: <span className="font-semibold">CSVæ±ºæ¸ˆæ‰¿èª</span></div>
                  <div>â€¢ åŠ ç›Ÿåº—åãƒ»ã‚µã‚¤ãƒˆå</div>
                  <div>â€¢ æ±ºæ¸ˆä»¶æ•°ãƒ»åˆè¨ˆé‡‘é¡</div>
                  <div>â€¢ æ±ºæ¸ˆäºˆå®šæ—¥</div>
                  <div>â€¢ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚ãƒ»æ‹…å½“è€…</div>
                  <div>â€¢ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼ˆã‚¨ãƒ©ãƒ¼/è­¦å‘Šï¼‰</div>
                  <div>â€¢ CSVãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
                  <div>â€¢ å„ªå…ˆåº¦: æ±ºæ¸ˆäºˆå®šæ—¥ã¾ã§ã®æ—¥æ•°ã§è‡ªå‹•è¨­å®š</div>
                </div>
              </div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowCsvPreview(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowCsvPreview(false); setCsvTab("batches"); toast("CSVæ±ºæ¸ˆã®æ‰¿èªä¾é ¼ã‚’é€ä¿¡ã—ã¾ã—ãŸ", "success"); }} className="px-4 py-2 text-xs bg-emerald-600 text-white rounded font-semibold hover:bg-emerald-700">æ‰¿èªä¾é ¼ã‚’é€ä¿¡</button>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ CSV ãƒãƒƒãƒè©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« â”€â”€ */}
      {selectedCsvBatch && (
        <div className="fixed inset-0 z-50 flex">
          <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedCsvBatch(null)} />
          <div className="w-[440px] bg-white shadow-xl border-l overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 flex justify-between items-center sticky top-0 z-10">
              <h3 className="text-sm font-bold text-slate-800">ğŸ“¦ CSVãƒãƒƒãƒè©³ç´°</h3>
              <button onClick={() => setSelectedCsvBatch(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div className="flex items-center gap-2 justify-center">
                <span className="font-mono text-sm font-bold text-slate-800">{selectedCsvBatch.id}</span>
                <Badge text={selectedCsvBatch.st} color={selectedCsvBatch.stc} />
              </div>
              <div className="grid grid-cols-2 gap-3">
                {[
                  { label: "ãƒãƒƒãƒå", value: selectedCsvBatch.name },
                  { label: "æ±ºæ¸ˆä»¶æ•°", value: `${selectedCsvBatch.count}ä»¶` },
                  { label: "åˆè¨ˆé‡‘é¡", value: selectedCsvBatch.total },
                  { label: "æ±ºæ¸ˆäºˆå®šæ—¥", value: selectedCsvBatch.schedule },
                  { label: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥", value: selectedCsvBatch.uploaded },
                  { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", value: selectedCsvBatch.st },
                ].map((s, i) => (
                  <div key={i} className="bg-slate-50 rounded p-2">
                    <p className="text-xs text-slate-400">{s.label}</p>
                    <p className="text-xs font-bold text-slate-700">{s.value}</p>
                  </div>
                ))}
              </div>
              {selectedCsvBatch.results && (
                <div className="bg-emerald-50 rounded border border-emerald-200 p-3">
                  <p className="text-xs font-bold text-emerald-700 mb-2">ğŸ“Š å®Ÿè¡Œçµæœ</p>
                  <div className="grid grid-cols-3 gap-2 text-xs">
                    <div className="text-center"><p className="text-slate-400">æˆåŠŸ</p><p className="text-lg font-bold text-emerald-600">{selectedCsvBatch.results.success}</p></div>
                    <div className="text-center"><p className="text-slate-400">å¤±æ•—</p><p className="text-lg font-bold text-rose-600">{selectedCsvBatch.results.fail}</p></div>
                    <div className="text-center"><p className="text-slate-400">æ±ºæ¸ˆé¡</p><p className="text-lg font-bold text-slate-700">{selectedCsvBatch.results.total}</p></div>
                  </div>
                </div>
              )}
              {/* Timeline */}
              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“‹ å‡¦ç†ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</p>
                <div className="space-y-2">
                  {[
                    { date: selectedCsvBatch.uploaded, event: "CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", icon: "ğŸ“¤" },
                    ...(selectedCsvBatch.st !== "æ‰¿èªå¾…ã¡" ? [{ date: selectedCsvBatch.uploaded.split(" ")[0] + " 15:00", event: "é‹å–¶å´æ‰¿èª", icon: "âœ…" }] : []),
                    ...(selectedCsvBatch.st === "å®Œäº†" ? [{ date: selectedCsvBatch.schedule + " 02:00", event: "ãƒãƒƒãƒæ±ºæ¸ˆå®Ÿè¡Œãƒ»å®Œäº†", icon: "ğŸ’³" }] : []),
                  ].map((e, i) => (
                    <div key={i} className="flex items-center gap-2 text-xs">
                      <span>{e.icon}</span>
                      <span className="w-28 text-slate-400">{e.date}</span>
                      <span className="text-slate-700">{e.event}</span>
                    </div>
                  ))}
                  {selectedCsvBatch.st === "æ‰¿èªå¾…ã¡" && (
                    <div className="flex items-center gap-2 text-xs text-amber-600">
                      <span>â³</span><span className="w-28">â€”</span><span>æ‰¿èªå¾…ã¡ä¸­...</span>
                    </div>
                  )}
                </div>
              </div>
              <div className="flex gap-2 pt-2 border-t">
                <button onClick={() => toast(`${selectedCsvBatch.id}ã®CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`, "success")} className="flex-1 px-3 py-2 bg-slate-50 text-slate-600 rounded text-xs border hover:bg-slate-100">ğŸ“¥ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                {selectedCsvBatch.results && <button onClick={() => toast(`${selectedCsvBatch.id}ã®çµæœCSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`, "success")} className="flex-1 px-3 py-2 bg-blue-50 text-blue-600 rounded text-xs border border-blue-200 hover:bg-blue-100">ğŸ“Š çµæœCSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>}
                {selectedCsvBatch.st === "æ‰¿èªå¾…ã¡" && <button onClick={() => { toast(`${selectedCsvBatch.id}ã®æ‰¿èªä¾é ¼ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ`, "warning"); setSelectedCsvBatch(null); }} className="flex-1 px-3 py-2 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200 hover:bg-rose-100">å–ã‚Šæ¶ˆã—</button>}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Slide Panel: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´° â”€â”€ */}
      {selectedSubUser && (
        <div className="fixed inset-0 z-50 flex">
          <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedSubUser(null)} />
          <div className="w-[420px] bg-white shadow-xl border-l overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 flex justify-between items-center sticky top-0 z-10">
              <h3 className="text-sm font-bold text-slate-800">ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°</h3>
              <button onClick={() => setSelectedSubUser(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div className="text-center">
                <p className="text-xs text-slate-400">{selectedSubUser.uid}</p>
                <p className="text-sm font-bold text-slate-800 mt-1">{selectedSubUser.email}</p>
                <div className="flex items-center justify-center gap-2 mt-1">
                  <Badge text={selectedSubUser.plan} color="blue" />
                  <Badge text={selectedSubUser.st} color={selectedSubUser.stc} />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-3">
                {[
                  { label: "ç™»éŒ²æ—¥", value: selectedSubUser.joined },
                  { label: "ã‚«ãƒ¼ãƒ‰", value: selectedSubUser.card },
                  { label: "æ¬¡å›æ±ºæ¸ˆ", value: selectedSubUser.next },
                  { label: "å¤±æ•—å›æ•°", value: selectedSubUser.fails },
                  { label: "ç´¯è¨ˆæ”¯æ‰•é¡", value: selectedSubUser.total },
                  { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", value: selectedSubUser.st },
                ].map((s, i) => (
                  <div key={i} className="bg-slate-50 rounded p-2">
                    <p className="text-xs text-slate-400">{s.label}</p>
                    <p className="text-xs font-bold text-slate-700">{s.value}</p>
                  </div>
                ))}
              </div>

              {/* Lifecycle Timeline */}
              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“‹ ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«</p>
                <div className="space-y-2">
                  {[
                    { date: selectedSubUser.joined, event: "ãƒ—ãƒ©ãƒ³ç™»éŒ²", icon: "ğŸŸ¢" },
                    ...selectedSubUser.payments.map(p => ({
                      date: p.date, event: `æ±ºæ¸ˆ ${p.amount} ${p.status}`, icon: p.status === "æˆåŠŸ" ? "âœ…" : "âŒ"
                    })),
                  ].map((e, i) => (
                    <div key={i} className="flex items-center gap-2 text-xs">
                      <span>{e.icon}</span>
                      <span className="w-20 text-slate-400">{e.date}</span>
                      <span className="text-slate-700">{e.event}</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="flex gap-2 pt-2 border-t">
                {selectedSubUser.st === "èª²é‡‘ä¸­" && <button onClick={() => toast(`${selectedSubUser.uid}ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ`, "warning")} className="flex-1 px-3 py-2 bg-amber-50 text-amber-700 rounded text-xs border border-amber-200 font-semibold hover:bg-amber-100">â¸ ä¸€æ™‚åœæ­¢</button>}
                {selectedSubUser.st === "ãƒªãƒˆãƒ©ã‚¤ä¸­" && <button onClick={() => { toast(`${selectedSubUser.uid}ã®æ‰‹å‹•ãƒªãƒˆãƒ©ã‚¤ã‚’å®Ÿè¡Œä¸­...`, "info"); setTimeout(() => toast("ãƒªãƒˆãƒ©ã‚¤ãŒå®Œäº†ã—ã¾ã—ãŸ", "success"), 1500); }} className="flex-1 px-3 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">ğŸ”„ æ‰‹å‹•ãƒªãƒˆãƒ©ã‚¤</button>}
                {selectedSubUser.st === "è‡ªå‹•åœæ­¢" && <button onClick={() => toast(`${selectedSubUser.uid}ã®èª²é‡‘ã‚’å†é–‹ã—ã¾ã—ãŸ`, "success")} className="flex-1 px-3 py-2 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700">â™»ï¸ å†é–‹</button>}
                <button onClick={() => toast("ã‚«ãƒ¼ãƒ‰å¤‰æ›´URLã‚’ç™ºè¡Œã—ã¾ã—ãŸ", "success")} className="px-3 py-2 bg-blue-50 text-blue-600 rounded text-xs border border-blue-200 hover:bg-blue-100">ğŸ’³ ã‚«ãƒ¼ãƒ‰å¤‰æ›´URLç™ºè¡Œ</button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Slide Panel: ãƒ—ãƒ©ãƒ³è©³ç´° â”€â”€ */}
      {selectedSubPlan && (
        <div className="fixed inset-0 z-50 flex">
          <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedSubPlan(null)} />
          <div className="w-[420px] bg-white shadow-xl border-l overflow-y-auto">
            <div className="p-4 border-b bg-slate-50 flex justify-between items-center sticky top-0 z-10">
              <h3 className="text-sm font-bold text-slate-800">ğŸ“¦ ãƒ—ãƒ©ãƒ³è©³ç´°</h3>
              <button onClick={() => setSelectedSubPlan(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div className="text-center">
                <p className="text-base font-bold text-slate-800">{selectedSubPlan.name}</p>
                <div className="flex items-center justify-center gap-2 mt-1">
                  <Badge text={selectedSubPlan.type} color={selectedSubPlan.type === "ç¶™ç¶š" ? "blue" : "purple"} />
                  <Badge text={selectedSubPlan.st === "active" ? "æœ‰åŠ¹" : "ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"} color={selectedSubPlan.st === "active" ? "green" : "gray"} />
                </div>
                <p className="text-xl font-bold text-emerald-600 mt-2">{selectedSubPlan.amt}</p>
              </div>

              <div className="grid grid-cols-2 gap-3">
                {[
                  { label: "èª²é‡‘ã‚µã‚¤ã‚¯ãƒ«", value: selectedSubPlan.cycle },
                  { label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°", value: `${selectedSubPlan.users}å` },
                  { label: "MRR", value: selectedSubPlan.mrr },
                  { label: "è§£ç´„ç‡", value: selectedSubPlan.churn },
                  { label: "ãƒˆãƒ©ã‚¤ã‚¢ãƒ«", value: selectedSubPlan.trial },
                  { label: "ä½œæˆæ—¥", value: selectedSubPlan.created },
                ].map((s, i) => (
                  <div key={i} className="bg-slate-50 rounded p-2">
                    <p className="text-xs text-slate-400">{s.label}</p>
                    <p className="text-xs font-bold text-slate-700">{s.value}</p>
                  </div>
                ))}
              </div>

              {/* User Count Chart */}
              <div>
                <p className="text-xs font-bold text-slate-700 mb-2">ğŸ“ˆ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°æ¨ç§»</p>
                <div className="flex items-end gap-1 h-16 bg-slate-50 rounded p-2">
                  {[280, 295, 305, 310, 318, 325, 330, 335, 338, 340, 342, 342].map((v, i) => (
                    <div key={i} className="flex-1 bg-emerald-400 rounded-t" style={{ height: `${((v - 270) / 72) * 100}%` }} />
                  ))}
                </div>
                <p className="text-xs text-slate-400 text-center mt-1">ç›´è¿‘12ãƒ¶æœˆ</p>
              </div>

              {/* Revenue */}
              <div className="bg-emerald-50 rounded border border-emerald-200 p-3">
                <p className="text-xs font-bold text-emerald-700 mb-1">ğŸ’° åç›Šã‚µãƒãƒªãƒ¼</p>
                <div className="grid grid-cols-2 gap-2 text-xs">
                  <div><span className="text-slate-500">æœˆé–“åç›Š: </span><span className="font-bold text-slate-700">{selectedSubPlan.mrr}</span></div>
                  <div><span className="text-slate-500">å¹´é–“è¦‹è¾¼: </span><span className="font-bold text-slate-700">Â¥{(parseInt(selectedSubPlan.mrr.replace(/[^0-9]/g, '')) * 12 / 1000).toFixed(0)}K</span></div>
                </div>
              </div>

              <div className="flex gap-2 pt-2 border-t">
                <button onClick={() => toast(`${selectedSubPlan.name}ã‚’ç·¨é›†ä¸­`, "info")} className="flex-1 px-3 py-2 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700">âœï¸ ãƒ—ãƒ©ãƒ³ç·¨é›†</button>
                {selectedSubPlan.st === "active" && <button onClick={() => toast(`${selectedSubPlan.name}ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¾ã—ãŸ`, "warning")} className="px-3 py-2 bg-amber-50 text-amber-700 rounded text-xs border border-amber-200 hover:bg-amber-100">ğŸ“¦ ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</button>}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: ãƒ—ãƒ©ãƒ³ä½œæˆ â”€â”€ */}
      {showCreatePlan && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowCreatePlan(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[480px]">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">+ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ä½œæˆ</h3>
              <button onClick={() => setShowCreatePlan(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div><label className="text-xs font-semibold text-slate-600">ãƒ—ãƒ©ãƒ³å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒ³" /></div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">é‡‘é¡ <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="Â¥2,980" /></div>
                <div><label className="text-xs font-semibold text-slate-600">èª²é‡‘ã‚µã‚¤ã‚¯ãƒ« <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>æœˆé¡</option><option>å¹´é¡</option><option>é€±é¡</option></select></div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ãªã—</option><option>7æ—¥é–“</option><option>14æ—¥é–“</option><option>30æ—¥é–“</option></select></div>
                <div><label className="text-xs font-semibold text-slate-600">ãƒªãƒˆãƒ©ã‚¤å›æ•°</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>3å›ï¼ˆæ¨å¥¨ï¼‰</option><option>1å›</option><option>5å›</option></select></div>
              </div>
              <div><label className="text-xs font-semibold text-slate-600">èª¬æ˜</label><textarea className="w-full text-xs border rounded p-2 h-12 mt-0.5" placeholder="ãƒ—ãƒ©ãƒ³ã®èª¬æ˜..." /></div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowCreatePlan(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowCreatePlan(false); toast("æ–°ã—ã„ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸ", "success"); }} className="px-4 py-2 text-xs bg-emerald-600 text-white rounded font-semibold hover:bg-emerald-700">ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆ</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ M14: ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°ç®¡ç† â”€â”€â”€
const MasterRecurring = () => {
  const toast = useToast();
  const [tab, setTab] = useState("overview");
  const [selectedPlan, setSelectedPlan] = useState(null);
  const [expandedPlanId, setExpandedPlanId] = useState(null);
  const [selectedUser, setSelectedUser] = useState(null);
  const [expandedUserId, setExpandedUserId] = useState(null);
  const [showForceStop, setShowForceStop] = useState(null);
  const [csvApprovalTab, setCsvApprovalTab] = useState("pending");
  const [selectedCsvApproval, setSelectedCsvApproval] = useState(null);
  const [expandedCsvId, setExpandedCsvId] = useState(null);
  const [showApprovalConfirm, setShowApprovalConfirm] = useState(null);
  const tabs = [
    { id: "overview", label: "æ¦‚æ³" },
    { id: "plans", label: "ãƒ—ãƒ©ãƒ³æ¤œç´¢" },
    { id: "users", label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢" },
    { id: "csv", label: "CSVæ±ºæ¸ˆç®¡ç†" },
    { id: "logs", label: "ãƒãƒƒãƒãƒ­ã‚°" },
  ];
  const planDetails = [
    { id: "PLN-001", m: "ABCå•†äº‹", s: "ECã‚µã‚¤ãƒˆA", name: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", type: "ç¶™ç¶š", amt: "Â¥0â†’Â¥2,980/æœˆ", users: "342/400", st: "æœ‰åŠ¹", created: "2025-06-01", trial: "14æ—¥", retry: 3, revenue: "Â¥1,019,160/æœˆ", churn: "3.2%", chart: [310, 318, 325, 330, 335, 342] },
    { id: "PLN-002", m: "XYZç‰©ç”£", s: "ã‚¹ãƒˆã‚¢", name: "å¹´é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ", type: "ç¶™ç¶š", amt: "Â¥29,800/å¹´", users: "89/120", st: "æœ‰åŠ¹", created: "2025-09-15", trial: "30æ—¥", retry: 5, revenue: "Â¥2,652,200/å¹´", churn: "1.8%", chart: [72, 76, 80, 84, 87, 89] },
    { id: "PLN-003", m: "ABCå•†äº‹", s: "ECã‚µã‚¤ãƒˆA", name: "3å›åˆ†å‰²æ‰•ã„", type: "åˆ†å‰²", amt: "Â¥15,000(3å›)", users: "56/â€”", st: "æœ‰åŠ¹", created: "2025-11-01", trial: "-", retry: 3, revenue: "Â¥840,000", churn: "-", chart: [30, 35, 40, 45, 50, 56] },
  ];
  const userData = [
    { id: "U-5521", email: "t***@gmail.com", m: "ABCå•†äº‹", plan: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", st: "èª²é‡‘ä¸­", stc: "green", next: "2026-03-01", fail: "0", created: "2025-08-15", total: "Â¥20,860", txCount: 7, history: [{ date: "2026-02-01", amt: "Â¥2,980", st: "æˆåŠŸ" }, { date: "2026-01-01", amt: "Â¥2,980", st: "æˆåŠŸ" }, { date: "2025-12-01", amt: "Â¥2,980", st: "æˆåŠŸ" }] },
    { id: "U-3302", email: "s***@yahoo.co.jp", m: "XYZç‰©ç”£", plan: "å¹´é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ", st: "ãƒªãƒˆãƒ©ã‚¤ä¸­", stc: "yellow", next: "2026-02-23", fail: "1", created: "2025-09-20", total: "Â¥29,800", txCount: 1, history: [{ date: "2026-02-15", amt: "Â¥29,800", st: "å¤±æ•—" }, { date: "2025-09-20", amt: "Â¥29,800", st: "æˆåŠŸ" }] },
    { id: "U-1108", email: "k***@icloud.com", m: "ABCå•†äº‹", plan: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", st: "è‡ªå‹•åœæ­¢", stc: "red", next: "â€”", fail: "3", created: "2025-06-10", total: "Â¥23,840", txCount: 8, history: [{ date: "2026-02-01", amt: "Â¥2,980", st: "å¤±æ•—" }, { date: "2026-01-15", amt: "Â¥2,980", st: "å¤±æ•—" }, { date: "2026-01-01", amt: "Â¥2,980", st: "å¤±æ•—" }] },
  ];
  return (
    <div className="p-5 space-y-4">
      <div className="flex items-center justify-between">
        <h2 className="text-sm font-bold text-slate-800">ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°ç®¡ç†</h2>
      </div>
      <div className="flex gap-1">{tabs.map(t => (
        <button key={t.id} onClick={() => setTab(t.id)} className={`px-3 py-1.5 text-xs rounded-t border-b-2 ${tab === t.id ? "border-blue-500 text-blue-700 bg-blue-50 font-bold" : "border-transparent text-slate-400"}`}>{t.label}</button>
      ))}</div>
      {tab === "overview" && (
        <div className="space-y-3">
          <div className="grid grid-cols-4 gap-3">
            <KPICard label="ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ©ãƒ³" value="156" color="blue" />
            <KPICard label="èª²é‡‘ä¸­ãƒ¦ãƒ¼ã‚¶ãƒ¼" value="12,847" color="blue" />
            <KPICard label="æœ¬æ—¥ã®å‡¦ç†äºˆå®š" value="423ä»¶" color="blue" />
            <KPICard label="ãƒªãƒˆãƒ©ã‚¤ä¸­" value="18ä»¶" sub="è¦æ³¨æ„" color="red" />
          </div>
          <div className="bg-rose-50 border border-rose-200 rounded-lg p-3 flex items-center gap-2">
            <span className="text-lg">ğŸ”´</span>
            <div className="text-xs"><span className="font-bold text-rose-700">è‡ªå‹•åœæ­¢æ€¥å¢—ã‚¢ãƒ©ãƒ¼ãƒˆï¼š</span><span className="text-rose-600">ç›´è¿‘24hã®è‡ªå‹•åœæ­¢ãŒå‰æ—¥æ¯”250%ï¼ˆ5ä»¶ â†’ 12ä»¶ï¼‰ã€‚æ¥ç¶šå…ˆã®éšœå®³ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</span></div>
          </div>
          <div className="grid grid-cols-2 gap-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3 overflow-x-auto">
              <p className="text-xs font-bold mb-2">æœ¬æ—¥ã®å®Ÿè¡Œäºˆå®š</p>
              <TableHeader cols={[{ label: "æ™‚åˆ»", w: "w-14" }, { label: "åŠ ç›Ÿåº—", w: "w-24" }, { label: "ãƒ—ãƒ©ãƒ³", w: "flex-1" }, { label: "å¯¾è±¡æ•°", w: "w-14" }, { label: "çŠ¶æ…‹", w: "w-14" }]}>
              {[["02:00", "ABCå•†äº‹", "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", "342", "å®Œäº†"], ["02:00", "XYZç‰©ç”£", "å¹´é–“ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ", "89", "å®Œäº†"], ["14:00", "DEF Inc", "æœˆé¡ãƒ©ã‚¤ãƒˆ", "56", "å¾…æ©Ÿä¸­"]].map((r, i) => (
                <tr key={i} className="border-b">
                  <td className="px-4 py-1.5 whitespace-nowrap w-14 text-slate-400">{r[0]}</td><td className="px-4 py-1.5 whitespace-nowrap w-24">{r[1]}</td><td className="px-4 py-1.5 whitespace-nowrap">{r[2]}</td><td className="px-4 py-1.5 whitespace-nowrap w-14 text-center">{r[3]}</td><td className="px-4 py-1.5 whitespace-nowrap w-14"><Badge text={r[4]} color={r[4] === "å®Œäº†" ? "green" : "yellow"} /></td>
                </tr>
              ))}
              </TableHeader>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3 overflow-x-auto">
              <p className="text-xs font-bold mb-2">ç›´è¿‘ãƒãƒƒãƒå®Ÿè¡Œçµæœ</p>
              <TableHeader cols={[{ label: "å®Ÿè¡Œæ—¥æ™‚", w: "w-28" }, { label: "å‡¦ç†", w: "w-12" }, { label: "æˆåŠŸ", w: "w-12" }, { label: "å¤±æ•—", w: "w-12" }, { label: "çŠ¶æ…‹", w: "w-14" }]}>
              {[["2026-02-13 02:00", "423", "411", "12", "å®Œäº†"], ["2026-02-12 02:00", "398", "391", "7", "å®Œäº†"], ["2026-02-11 02:00", "412", "406", "6", "å®Œäº†"]].map((r, i) => (
                <tr key={i} className="border-b">
                  <td className="px-4 py-1.5 whitespace-nowrap w-28 text-slate-400">{r[0]}</td><td className="px-4 py-1.5 whitespace-nowrap w-12">{r[1]}</td><td className="px-4 py-1.5 whitespace-nowrap w-12 text-emerald-600">{r[2]}</td><td className="px-4 py-1.5 whitespace-nowrap w-12 text-rose-600">{r[3]}</td><td className="px-4 py-1.5 whitespace-nowrap w-14"><Badge text={r[4]} color="green" /></td>
                </tr>
              ))}
              </TableHeader>
            </div>
          </div>
        </div>
      )}
      {tab === "plans" && (
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
          <div className="p-3 border-b flex gap-2">
            <input className="border rounded px-2 py-1 text-xs flex-1" placeholder="åŠ ç›Ÿåº—å / ãƒ—ãƒ©ãƒ³åã§æ¤œç´¢" />
            <select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚¿ã‚¤ãƒ—</option><option>ç¶™ç¶š</option><option>åˆ†å‰²</option></select>
            <select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>æœ‰åŠ¹</option><option>ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</option></select>
            <button onClick={() => toast("ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°ãƒ—ãƒ©ãƒ³ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="px-3 py-1 bg-blue-600 text-white rounded text-xs">æ¤œç´¢</button>
          </div>
          <TableHeader cols={[{ label: "ãƒ—ãƒ©ãƒ³ID", w: "w-24" }, { label: "åŠ ç›Ÿåº—", w: "w-24" }, { label: "ã‚µã‚¤ãƒˆ", w: "w-20" }, { label: "ãƒ—ãƒ©ãƒ³å", w: "flex-1" }, { label: "ã‚¿ã‚¤ãƒ—", w: "w-14" }, { label: "é‡‘é¡", w: "w-24" }, { label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼", w: "w-16" }, { label: "çŠ¶æ…‹", w: "w-14" }]}>
          {planDetails.map((r, i) => (
            <React.Fragment key={i}>
            <tr onClick={() => setExpandedPlanId(expandedPlanId === r.id ? null : r.id)} className={`border-b cursor-pointer transition-colors ${expandedPlanId === r.id ? "bg-blue-100 border-l-2 border-l-blue-500" : "hover:bg-blue-50"}`}>
              <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-blue-600">{r.id}</td><td className="px-4 py-2 whitespace-nowrap w-24">{r.m}</td><td className="px-4 py-2 whitespace-nowrap w-20 text-slate-500">{r.s}</td><td className="px-4 py-2 whitespace-nowrap font-bold">{r.name}</td><td className="px-4 py-2 whitespace-nowrap w-14"><Badge text={r.type} color={r.type === "ç¶™ç¶š" ? "blue" : "purple"} /></td><td className="px-4 py-2 whitespace-nowrap w-24 text-xs">{r.amt}</td><td className="px-4 py-2 whitespace-nowrap w-16">{r.users}</td><td className="px-4 py-2 whitespace-nowrap w-14"><Badge text={r.st} color="green" /></td>
            </tr>
            {expandedPlanId === r.id && (
              <tr><td colSpan={8} className="p-0">
                <div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                  <div className="flex items-center gap-2 mb-2">
                    <p className="text-xs font-bold text-slate-700">ğŸ“‹ ãƒ—ãƒ©ãƒ³è©³ç´° â€” {r.name}</p>
                    <Badge text={r.type} color={r.type === "ç¶™ç¶š" ? "blue" : "purple"} />
                    <Badge text={r.st} color="green" />
                    <span className="text-xs text-slate-400 ml-auto">{r.id}</span>
                  </div>
                  <div className="grid grid-cols-4 gap-3 text-xs">
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                      <p className="font-semibold text-slate-600 mb-1">åŸºæœ¬æƒ…å ±</p>
                      <div className="space-y-0.5 text-slate-500">
                        <div>åŠ ç›Ÿåº—: <span className="font-semibold text-slate-700">{r.m}</span></div>
                        <div>ã‚µã‚¤ãƒˆ: {r.s}</div>
                        <div>é‡‘é¡: <span className="font-semibold text-slate-700">{r.amt}</span></div>
                        <div>ä½œæˆæ—¥: {r.created}</div>
                        <div>ãƒˆãƒ©ã‚¤ã‚¢ãƒ«: {r.trial}</div>
                        <div>ãƒªãƒˆãƒ©ã‚¤å›æ•°: {r.retry}å›</div>
                      </div>
                    </div>
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                      <p className="font-semibold text-slate-600 mb-1">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</p>
                      <div className="space-y-1">
                        <div className="bg-blue-50 rounded p-1.5 text-center border border-blue-200">
                          <p className="text-xs text-slate-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</p>
                          <p className="text-sm font-bold text-blue-600">{r.users}</p>
                        </div>
                        <div className="bg-emerald-50 rounded p-1.5 text-center border border-emerald-200">
                          <p className="text-xs text-slate-400">åç›Š</p>
                          <p className="text-sm font-bold text-emerald-600">{r.revenue}</p>
                        </div>
                        {r.churn !== "-" && <div className="text-xs"><span className="text-slate-400">è§£ç´„ç‡:</span> <span className="font-bold text-amber-600">{r.churn}</span></div>}
                      </div>
                    </div>
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5 col-span-2">
                      <p className="font-semibold text-slate-600 mb-1">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°æ¨ç§»ï¼ˆ6ãƒ¶æœˆï¼‰</p>
                      <div className="flex items-end gap-2 h-16 px-2">
                        {r.chart.map((v, ci) => {
                          const max = Math.max(...r.chart);
                          return (<div key={ci} className="flex-1 flex flex-col items-center"><div className={`w-full rounded-t ${ci === 5 ? "bg-blue-500" : "bg-blue-200"}`} style={{ height: `${(v / max) * 100}%` }} /><p className="text-xs text-slate-400 mt-1">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][ci]}</p></div>);
                        })}
                      </div>
                    </div>
                  </div>
                </div>
              </td></tr>
            )}
            </React.Fragment>
          ))}
          </TableHeader>
        </div>
      )}
      {tab === "users" && (
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
          <div className="p-3 border-b flex gap-2">
            <input className="border rounded px-2 py-1 text-xs flex-1" placeholder="ãƒ¡ãƒ¼ãƒ« / ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§æ¤œç´¢" />
            <select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>èª²é‡‘ä¸­</option><option>ä¸€æ™‚åœæ­¢</option><option>è‡ªå‹•åœæ­¢</option></select>
            <button onClick={() => toast("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="px-3 py-1 bg-blue-600 text-white rounded text-xs">æ¤œç´¢</button>
          </div>
          <TableHeader cols={[{ label: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", w: "w-20" }, { label: "ãƒ¡ãƒ¼ãƒ«", w: "w-32" }, { label: "åŠ ç›Ÿåº—", w: "w-24" }, { label: "ãƒ—ãƒ©ãƒ³", w: "flex-1" }, { label: "çŠ¶æ…‹", w: "w-16" }, { label: "æ¬¡å›æ±ºæ¸ˆ", w: "w-20" }, { label: "å¤±æ•—", w: "w-10" }, { label: "æ“ä½œ", w: "w-20" }]}>
          {userData.map((r, i) => (
            <React.Fragment key={i}>
            <tr onClick={() => setExpandedUserId(expandedUserId === r.id ? null : r.id)} className={`border-b cursor-pointer transition-colors ${expandedUserId === r.id ? "bg-blue-100 border-l-2 border-l-blue-500" : "hover:bg-blue-50"}`}>
              <td className="px-4 py-2 whitespace-nowrap w-20 font-mono text-blue-600">{r.id}</td><td className="px-4 py-2 whitespace-nowrap w-32 text-slate-500">{r.email}</td><td className="px-4 py-2 whitespace-nowrap w-24">{r.m}</td><td className="px-4 py-2 whitespace-nowrap">{r.plan}</td><td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.st} color={r.stc} /></td><td className="px-4 py-2 whitespace-nowrap w-20 text-slate-400">{r.next}</td><td className="px-4 py-2 whitespace-nowrap w-10 text-center">{r.fail !== "0" ? <span className="text-rose-600 font-bold">{r.fail}</span> : "0"}</td>
              <td className="px-4 py-2 whitespace-nowrap w-20" onClick={e => e.stopPropagation()}><div className="flex gap-1">{r.st !== "è‡ªå‹•åœæ­¢" && <button onClick={() => setShowForceStop(r)} className="text-rose-500 text-xs">å¼·åˆ¶åœæ­¢</button>}</div></td>
            </tr>
            {expandedUserId === r.id && (
              <tr><td colSpan={8} className="p-0">
                <div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                  <div className="flex items-center gap-2 mb-2">
                    <p className="text-xs font-bold text-slate-700">ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´° â€” {r.id}</p>
                    <Badge text={r.st} color={r.stc} />
                  </div>
                  <div className="grid grid-cols-3 gap-3 text-xs">
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                      <p className="font-semibold text-slate-600 mb-1">åŸºæœ¬æƒ…å ±</p>
                      <div className="space-y-0.5 text-slate-500">
                        {[["ãƒ¡ãƒ¼ãƒ«", r.email], ["åŠ ç›Ÿåº—", r.m], ["ãƒ—ãƒ©ãƒ³", r.plan], ["ç™»éŒ²æ—¥", r.created], ["ç´¯è¨ˆèª²é‡‘é¡", r.total], ["èª²é‡‘å›æ•°", `${r.txCount}å›`], ["æ¬¡å›æ±ºæ¸ˆ", r.next], ["å¤±æ•—å›æ•°", r.fail]].map(([l, v], di) => (
                          <div key={di} className="flex justify-between"><span className="text-slate-400">{l}:</span><span className="font-semibold text-slate-700">{v}</span></div>
                        ))}
                      </div>
                    </div>
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                      <p className="font-semibold text-slate-600 mb-1">æ±ºæ¸ˆå±¥æ­´</p>
                      <div className="space-y-1">
                        {r.history.map((h, hi) => (
                          <div key={hi} className="flex items-center gap-2 py-1 border-b last:border-0">
                            <span className={`w-1.5 h-1.5 rounded-full shrink-0 ${h.st === "æˆåŠŸ" ? "bg-emerald-500" : "bg-rose-500"}`} />
                            <span className="text-slate-400 w-20">{h.date}</span>
                            <span className="font-semibold">{h.amt}</span>
                            <Badge text={h.st} color={h.st === "æˆåŠŸ" ? "green" : "red"} />
                          </div>
                        ))}
                      </div>
                    </div>
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                      <p className="font-semibold text-slate-600 mb-1">æ“ä½œ</p>
                      <div className="space-y-2">
                        {r.st === "ãƒªãƒˆãƒ©ã‚¤ä¸­" && <button className="w-full py-1.5 bg-blue-50 text-blue-600 rounded text-xs font-bold border border-blue-200 hover:bg-blue-100">ğŸ”„ æ‰‹å‹•ãƒªãƒˆãƒ©ã‚¤</button>}
                        {r.st === "èª²é‡‘ä¸­" && <button className="w-full py-1.5 bg-amber-50 text-amber-600 rounded text-xs font-bold border border-amber-200 hover:bg-amber-100">â¸ ä¸€æ™‚åœæ­¢</button>}
                        {r.st !== "è‡ªå‹•åœæ­¢" && <button onClick={(e) => { e.stopPropagation(); setShowForceStop(r); }} className="w-full py-1.5 bg-red-50 text-red-600 rounded text-xs font-bold border border-red-200 hover:bg-red-100">â›” å¼·åˆ¶åœæ­¢</button>}
                        {r.st === "è‡ªå‹•åœæ­¢" && <div className="text-xs text-slate-400 text-center py-2">ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªå‹•åœæ­¢æ¸ˆã¿ã§ã™</div>}
                      </div>
                    </div>
                  </div>
                </div>
              </td></tr>
            )}
            </React.Fragment>
          ))}
          </TableHeader>
        </div>
      )}
      {/* ===== CSVæ±ºæ¸ˆç®¡ç†ã‚¿ãƒ– ===== */}
      {tab === "csv" && (
        <div className="space-y-3">
          <div className="flex gap-1 border-b">
            {[{ id: "pending", label: "æ‰¿èªå¾…ã¡", count: 2 }, { id: "approved", label: "æ‰¿èªæ¸ˆï¼ˆå®Ÿè¡Œå¾…ã¡ï¼‰", count: 1 }, { id: "completed", label: "å®Ÿè¡Œå®Œäº†", count: null }, { id: "all", label: "å…¨ã¦", count: null }].map(t => (
              <button key={t.id} onClick={() => setCsvApprovalTab(t.id)} className={`px-3 py-1.5 text-xs border-b-2 ${csvApprovalTab === t.id ? "border-blue-500 text-blue-700 font-bold" : "border-transparent text-slate-400"}`}>
                {t.label}{t.count !== null && <span className={`ml-1 px-1.5 py-0.5 rounded-full text-xs ${csvApprovalTab === t.id ? "bg-blue-100 text-blue-600" : "bg-slate-100 text-slate-400"}`}>{t.count}</span>}
              </button>
            ))}
          </div>

          {/* KPIs */}
          <div className="grid grid-cols-5 gap-3">
            <KPICard label="æ‰¿èªå¾…ã¡" value="2ä»¶" sub="Â¥490,000" color="yellow" />
            <KPICard label="æ‰¿èªæ¸ˆã¿" value="1ä»¶" sub="Â¥78,400" color="blue" />
            <KPICard label="ä»Šæœˆå®Ÿè¡Œ" value="3ä»¶" sub="Â¥735,200" color="green" />
            <KPICard label="ä»ŠæœˆæˆåŠŸç‡" value="97.4%" sub="75/77ä»¶" color="green" />
            <KPICard label="ä»Šæœˆå¤±æ•—" value="2ä»¶" sub="è¦ç¢ºèª" color="red" />
          </div>

          {/* CSV Batch Table */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <div className="p-3 border-b flex gap-2">
              <input className="border rounded px-2 py-1 text-xs flex-1" placeholder="åŠ ç›Ÿåº—å / ãƒãƒƒãƒIDã§æ¤œç´¢" />
              <input type="date" className="border rounded px-2 py-1 text-xs" defaultValue="2026-02-01" />
              <span className="text-xs text-slate-400 self-center">ã€œ</span>
              <input type="date" className="border rounded px-2 py-1 text-xs" defaultValue="2026-02-28" />
              <button onClick={() => toast("CSVãƒãƒƒãƒã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="px-3 py-1 bg-blue-600 text-white rounded text-xs">æ¤œç´¢</button>
            </div>
            <TableHeader cols={[{ label: "ãƒãƒƒãƒID", w: "w-24" }, { label: "åŠ ç›Ÿåº—", w: "w-28" }, { label: "ãƒãƒƒãƒå", w: "flex-1" }, { label: "ä»¶æ•°", w: "w-14" }, { label: "åˆè¨ˆé‡‘é¡", w: "w-24" }, { label: "æ±ºæ¸ˆäºˆå®šæ—¥", w: "w-24" }, { label: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥", w: "w-28" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-20" }, { label: "æ“ä½œ", w: "w-28" }]}>
            {[
              { id: "CSV-0045", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", name: "2æœˆæœˆè¬æ±ºæ¸ˆ", count: "42", total: "Â¥411,600", schedule: "2026-02-20", uploaded: "2026-02-14 10:30", st: "æ‰¿èªå¾…ã¡", stc: "yellow" },
              { id: "CSV-0046", merchant: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", name: "2æœˆä¼šè²»ä¸€æ‹¬", count: "8", total: "Â¥78,400", schedule: "2026-02-22", uploaded: "2026-02-15 09:00", st: "æ‰¿èªå¾…ã¡", stc: "yellow" },
              { id: "CSV-0044", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", name: "2æœˆè¿½åŠ åˆ†", count: "8", total: "Â¥78,400", schedule: "2026-02-18", uploaded: "2026-02-12 14:15", st: "æ‰¿èªæ¸ˆ", stc: "blue" },
              { id: "CSV-0043", merchant: "æ ªå¼ä¼šç¤¾ABCãƒãƒ¼ãƒˆ", name: "1æœˆæœˆè¬æ±ºæ¸ˆ", count: "38", total: "Â¥372,400", schedule: "2026-01-20", uploaded: "2026-01-14 09:45", st: "å®Œäº†", stc: "green" },
              { id: "CSV-0042", merchant: "åˆåŒä¼šç¤¾XYZã‚·ãƒ§ãƒƒãƒ—", name: "1æœˆä¼šè²»ä¸€æ‹¬", count: "5", total: "Â¥49,000", schedule: "2026-01-15", uploaded: "2026-01-10 11:20", st: "å®Œäº†", stc: "green" },
            ].filter(r => csvApprovalTab === "all" || (csvApprovalTab === "pending" && r.st === "æ‰¿èªå¾…ã¡") || (csvApprovalTab === "approved" && r.st === "æ‰¿èªæ¸ˆ") || (csvApprovalTab === "completed" && r.st === "å®Œäº†")).map((r, i) => (
              <React.Fragment key={i}>
              <tr className={`border-b cursor-pointer transition-colors ${expandedCsvId === r.id ? "bg-blue-100 border-l-2 border-l-blue-500" : r.st === "æ‰¿èªå¾…ã¡" ? "bg-amber-50 hover:bg-amber-100" : "hover:bg-blue-50"}`} onClick={() => setExpandedCsvId(expandedCsvId === r.id ? null : r.id)}>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-blue-600">{r.id}</td>
                <td className="px-4 py-2 whitespace-nowrap w-28">{r.merchant}</td>
                <td className="px-4 py-2 whitespace-nowrap font-semibold">{r.name}</td>
                <td className="px-4 py-2 whitespace-nowrap w-14 text-center">{r.count}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-semibold">{r.total}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-500">{r.schedule}</td>
                <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-400">{r.uploaded}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><Badge text={r.st} color={r.stc} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-28" onClick={e => e.stopPropagation()}>
                  {r.st === "æ‰¿èªå¾…ã¡" && (
                    <div className="flex gap-1">
                      <button onClick={() => setShowApprovalConfirm({ ...r, action: "approve" })} className="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs border border-emerald-200 hover:bg-emerald-200">æ‰¿èª</button>
                      <button onClick={() => setShowApprovalConfirm({ ...r, action: "reject" })} className="px-2 py-1 bg-rose-100 text-rose-700 rounded text-xs border border-rose-200 hover:bg-rose-200">å´ä¸‹</button>
                    </div>
                  )}
                  {r.st === "æ‰¿èªæ¸ˆ" && <span className="text-xs text-blue-500">å®Ÿè¡Œå¾…ã¡</span>}
                  {r.st === "å®Œäº†" && <button onClick={() => toast(`${r.name}ã®å®Ÿè¡Œçµæœã‚’è¡¨ç¤º`, "info")} className="text-xs text-blue-600 hover:underline">çµæœ</button>}
                </td>
              </tr>
              {expandedCsvId === r.id && (
                <tr><td colSpan={9} className="p-0">
                  <div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                    <div className="flex items-center gap-2 mb-2">
                      <p className="text-xs font-bold text-slate-700">ğŸ“¦ CSVæ±ºæ¸ˆãƒãƒƒãƒè©³ç´° â€” {r.id}</p>
                      <Badge text={r.st} color={r.stc} />
                    </div>
                    <div className="grid grid-cols-3 gap-3 text-xs">
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                        <p className="font-semibold text-slate-600 mb-1">ãƒãƒƒãƒæƒ…å ±</p>
                        <div className="space-y-0.5 text-slate-500">
                          {[["åŠ ç›Ÿåº—", r.merchant], ["ãƒãƒƒãƒå", r.name], ["æ±ºæ¸ˆä»¶æ•°", `${r.count}ä»¶`], ["åˆè¨ˆé‡‘é¡", r.total], ["æ±ºæ¸ˆäºˆå®šæ—¥", r.schedule], ["ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥", r.uploaded]].map(([l, v], di) => (
                            <div key={di} className="flex justify-between"><span className="text-slate-400">{l}:</span><span className="font-semibold text-slate-700">{v}</span></div>
                          ))}
                        </div>
                      </div>
                      <div className="bg-white rounded-lg border border-slate-200 p-2.5 col-span-2">
                        <p className="font-semibold text-slate-600 mb-1">ğŸ“„ CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå…ˆé ­5ä»¶ï¼‰</p>
                        <div className="overflow-x-auto border rounded">
                          <table className="w-full text-xs">
                            <thead><tr className="bg-slate-50 border-b">
                              <th className="px-2 py-1 text-left text-slate-500">paymentid</th>
                              <th className="px-2 py-1 text-left text-slate-500">price</th>
                              <th className="px-2 py-1 text-left text-slate-500">email</th>
                              <th className="px-2 py-1 text-left text-slate-500">productName</th>
                              <th className="px-2 py-1 text-left text-slate-500">free1</th>
                            </tr></thead>
                            <tbody>
                              {[["PAY-001", "9,800", "tanaka@ex...", "æœˆé¡ä¼šè²»", "ç”°ä¸­å¤ªéƒ"], ["PAY-002", "9,800", "sato@ex...", "æœˆé¡ä¼šè²»", "ä½è—¤èŠ±å­"], ["PAY-003", "5,000", "suzuki@ex...", "æœˆé¡ä¼šè²»(å‰²å¼•)", "éˆ´æœ¨ä¸€éƒ"], ["", "9,800", "yamada@ex...", "æœˆé¡ä¼šè²»", "å±±ç”°æ˜"], ["PAY-005", "12,000", "ito@ex...", "æœˆé¡ä¼šè²»(ä¸Šç´š)", "ä¼Šè—¤æ¶¼"]].map((csvr, ci) => (
                                <tr key={ci} className={`border-b ${!csvr[0] ? "bg-amber-50" : ""}`}>
                                  <td className="px-2 py-1 font-mono text-blue-600">{csvr[0] || <span className="text-amber-500">æ–°è¦</span>}</td>
                                  <td className="px-2 py-1">Â¥{csvr[1]}</td>
                                  <td className="px-2 py-1 text-slate-500">{csvr[2]}</td>
                                  <td className="px-2 py-1">{csvr[3]}</td>
                                  <td className="px-2 py-1 text-slate-500">{csvr[4]}</td>
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>
                        <p className="text-xs text-slate-400 mt-1">å…¨{r.count}ä»¶ä¸­ 5ä»¶ã‚’è¡¨ç¤º</p>
                      </div>
                    </div>
                    <div className="flex gap-2 mt-2">
                      {r.st === "æ‰¿èªå¾…ã¡" && (<>
                        <button onClick={(e) => { e.stopPropagation(); setShowApprovalConfirm({ ...r, action: "approve" }); }} className="px-3 py-1.5 bg-emerald-600 text-white rounded text-xs font-semibold hover:bg-emerald-700">âœ… æ‰¿èªã™ã‚‹</button>
                        <button onClick={(e) => { e.stopPropagation(); setShowApprovalConfirm({ ...r, action: "reject" }); }} className="px-3 py-1.5 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200 hover:bg-rose-100">âŒ å´ä¸‹ã™ã‚‹</button>
                      </>)}
                      <button className="px-3 py-1.5 bg-slate-50 text-slate-600 rounded text-xs border hover:bg-slate-100 ml-auto">ğŸ“¥ å…ƒCSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                  </div>
                </td></tr>
              )}
              </React.Fragment>
            ))}
            </TableHeader>
          </div>
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-2.5 text-xs text-blue-700 flex items-center gap-2">
            <span>ğŸ’¡</span>
            <span>CSVæ±ºæ¸ˆã®æµã‚Œ: åŠ ç›Ÿåº—ãŒCSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ <span className="font-bold">ãƒã‚¹ã‚¿ãƒ¼å´ã§æ‰¿èª</span> â†’ æ±ºæ¸ˆäºˆå®šæ—¥ã«ãƒãƒƒãƒã§è‡ªå‹•æ±ºæ¸ˆå‡¦ç†</span>
          </div>
        </div>
      )}

      {/* CSVæ‰¿èª/å´ä¸‹ ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
      {showApprovalConfirm && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowApprovalConfirm(null)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[480px]">
            <div className={`p-4 border-b rounded-t-xl ${showApprovalConfirm.action === "approve" ? "bg-emerald-50" : "bg-rose-50"}`}>
              <h3 className="text-sm font-bold text-slate-800">{showApprovalConfirm.action === "approve" ? "âœ… CSVæ±ºæ¸ˆãƒãƒƒãƒã®æ‰¿èª" : "âŒ CSVæ±ºæ¸ˆãƒãƒƒãƒã®å´ä¸‹"}</h3>
            </div>
            <div className="p-5 space-y-4">
              <div className="bg-slate-50 rounded-lg border p-3 space-y-1.5 text-xs">
                <div className="flex justify-between"><span className="text-slate-400">ãƒãƒƒãƒID</span><span className="font-mono">{showApprovalConfirm.id}</span></div>
                <div className="flex justify-between"><span className="text-slate-400">åŠ ç›Ÿåº—</span><span className="font-semibold">{showApprovalConfirm.merchant}</span></div>
                <div className="flex justify-between"><span className="text-slate-400">ãƒãƒƒãƒå</span><span>{showApprovalConfirm.name}</span></div>
                <div className="flex justify-between"><span className="text-slate-400">æ±ºæ¸ˆä»¶æ•°</span><span className="font-bold">{showApprovalConfirm.count}ä»¶</span></div>
                <div className="flex justify-between"><span className="text-slate-400">åˆè¨ˆé‡‘é¡</span><span className="font-bold text-emerald-600">{showApprovalConfirm.total}</span></div>
                <div className="flex justify-between"><span className="text-slate-400">æ±ºæ¸ˆäºˆå®šæ—¥</span><span>{showApprovalConfirm.schedule}</span></div>
              </div>
              {showApprovalConfirm.action === "approve" ? (
                <div className="bg-emerald-50 border border-emerald-200 rounded p-2 text-xs text-emerald-700">
                  <p className="font-bold">æ‰¿èªã™ã‚‹ã¨:</p>
                  <p className="mt-1">æ±ºæ¸ˆäºˆå®šæ—¥ï¼ˆ{showApprovalConfirm.schedule}ï¼‰ã«ãƒãƒƒãƒå‡¦ç†ã§è‡ªå‹•çš„ã«{showApprovalConfirm.count}ä»¶ã®æ±ºæ¸ˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
                </div>
              ) : (
                <div>
                  <label className="text-xs font-semibold text-slate-600">å´ä¸‹ç†ç”± <span className="text-rose-500">*</span></label>
                  <select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5">
                    <option>CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼</option>
                    <option>é‡‘é¡ã«ä¸æ•´åˆã‚ã‚Š</option>
                    <option>å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å•é¡Œã‚ã‚Š</option>
                    <option>åŠ ç›Ÿåº—å´ã®ç¢ºèªãŒå¿…è¦</option>
                    <option>ãã®ä»–</option>
                  </select>
                  <textarea className="w-full text-xs border rounded p-2 h-16 mt-2" placeholder="è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆåŠ ç›Ÿåº—ã«é€šçŸ¥ã•ã‚Œã¾ã™ï¼‰" />
                </div>
              )}
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowApprovalConfirm(null)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setShowApprovalConfirm(null)} className={`px-4 py-2 text-xs text-white rounded font-semibold ${showApprovalConfirm.action === "approve" ? "bg-emerald-600 hover:bg-emerald-700" : "bg-rose-600 hover:bg-rose-700"}`}>
                {showApprovalConfirm.action === "approve" ? "æ‰¿èªã™ã‚‹" : "å´ä¸‹ã™ã‚‹"}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* (CSVè©³ç´°ã¯ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å±•é–‹ã«ç§»è¡Œ) */}

      {tab === "logs" && (
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
          <TableHeader cols={[{ label: "å®Ÿè¡Œæ—¥æ™‚", w: "w-32" }, { label: "ãƒãƒƒãƒID", w: "w-20" }, { label: "ç¨®åˆ¥", w: "w-16" }, { label: "å‡¦ç†ä»¶æ•°", w: "w-16" }, { label: "æˆåŠŸ", w: "w-14" }, { label: "å¤±æ•—", w: "w-14" }, { label: "ãƒªãƒˆãƒ©ã‚¤", w: "w-14" }, { label: "å‡¦ç†æ™‚é–“", w: "w-14" }, { label: "çŠ¶æ…‹", w: "w-16" }, { label: "", w: "w-10" }]}>
          {[["2026-02-13 02:00:05", "B-4521", "ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°", "423", "411", "12", "8", "4.2s", "å®Œäº†"],
            ["2026-02-12 02:00:03", "B-4520", "ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°", "398", "391", "7", "5", "3.8s", "å®Œäº†"],
            ["2026-02-11 14:00:02", "CSV-0043", "CSVæ±ºæ¸ˆ", "38", "36", "2", "0", "2.1s", "å®Œäº†"],
            ["2026-02-11 02:00:04", "B-4519", "ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°", "412", "406", "6", "4", "3.9s", "å®Œäº†"],
            ["2026-02-10 02:00:02", "B-4518", "ãƒªã‚«ãƒ¼ãƒªãƒ³ã‚°", "389", "385", "4", "3", "3.5s", "å®Œäº†"]
          ].map((r, i) => (
            <tr key={i} className="border-b hover:bg-slate-50">
              <td className="px-4 py-2 whitespace-nowrap w-32 text-slate-400">{r[0]}</td><td className="px-4 py-2 whitespace-nowrap w-20 font-mono">{r[1]}</td><td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r[2]} color={r[2] === "CSVæ±ºæ¸ˆ" ? "purple" : "blue"} /></td><td className="px-4 py-2 whitespace-nowrap w-16">{r[3]}</td><td className="px-4 py-2 whitespace-nowrap w-14 text-emerald-600">{r[4]}</td><td className="px-4 py-2 whitespace-nowrap w-14 text-rose-600">{r[5]}</td><td className="px-4 py-2 whitespace-nowrap w-14 text-amber-600">{r[6]}</td><td className="px-4 py-2 whitespace-nowrap w-14">{r[7]}</td><td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r[8]} color="green" /></td><td className="px-4 py-2 whitespace-nowrap w-10"><button onClick={() => toast(`ãƒãƒƒãƒ${r[1]}ã®è©³ç´°ã‚’è¡¨ç¤º`, "info")} className="text-blue-600 text-xs">è©³ç´°</button></td>
            </tr>
          ))}
          </TableHeader>
        </div>
      )}

      {/* (ãƒ—ãƒ©ãƒ³è©³ç´°ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ã¯ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å±•é–‹ã«ç§»è¡Œ) */}

      {/* å¼·åˆ¶åœæ­¢ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
      {showForceStop && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowForceStop(null)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[400px]">
            <div className="p-4 border-b"><p className="text-sm font-bold text-red-600">âš ï¸ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å¼·åˆ¶åœæ­¢</p></div>
            <div className="p-4 space-y-3">
              <div className="bg-red-50 border border-red-200 rounded p-3 text-xs text-red-700">
                <p className="font-bold">ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“</p>
                <p className="mt-1">ãƒ¦ãƒ¼ã‚¶ãƒ¼ {showForceStop.id} ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’å³åº§ã«åœæ­¢ã—ã¾ã™ã€‚æ¬¡å›ä»¥é™ã®èª²é‡‘ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã€‚</p>
              </div>
              <div className="space-y-1 text-xs">
                {[["ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", showForceStop.id], ["ãƒ¡ãƒ¼ãƒ«", showForceStop.email], ["ãƒ—ãƒ©ãƒ³", showForceStop.plan]].map(([l, v], i) => (
                  <div key={i} className="flex border-b pb-1"><span className="w-20 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
              <div><label className="text-xs text-slate-500">åœæ­¢ç†ç”±</label><select className="w-full border rounded px-2 py-1.5 text-xs mt-0.5"><option>é¡§å®¢ã®è¦æœ›</option><option>æ”¯æ‰•ã„ä¸èƒ½</option><option>ä¸æ­£åˆ©ç”¨ã®ç–‘ã„</option><option>ãã®ä»–</option></select></div>
              <div className="flex gap-2">
                <button onClick={() => setShowForceStop(null)} className="flex-1 py-2 border rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onClick={() => setShowForceStop(null)} className="flex-1 py-2 bg-red-500 text-white rounded text-xs font-bold">åœæ­¢ã™ã‚‹</button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ M15: ä»£ç†åº—ç®¡ç† â”€â”€â”€
const MasterAgents = () => {
  const toast = useToast();
  const [showAddAgent, setShowAddAgent] = useState(false);
  const [tab, setTab] = useState("list");
  const [selectedAgent, setSelectedAgent] = useState(null);
  const [expandedAgentCode, setExpandedAgentCode] = useState(null);
  const tabs = [{ id: "list", label: "ä»£ç†åº—ä¸€è¦§" }, { id: "register", label: "ä»£ç†åº—ç™»éŒ²" }, { id: "conditions", label: "ãƒ•ã‚£ãƒ¼è¨­å®š" }, { id: "commissions", label: "å ±é…¬ç®¡ç†" }];
  const agentData = [
    { code: "AG-001", name: "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º", rep: "ç”°ä¸­å¤ªéƒ", merchants: "23", rate: "5.0%", st: "active", email: "info@digital-partners.jp", tel: "03-1234-5678", created: "2024-06-01", totalRevenue: "Â¥25,680,000", monthlyRevenue: "Â¥2,260,000", topMerchants: ["ECã‚µã‚¤ãƒˆA (Â¥5.2M)", "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³EC (Â¥3.8M)", "ãƒ•ãƒ¼ãƒ‰é€šè²© (Â¥2.1M)"], chart: [1800, 1920, 2010, 2080, 2150, 2260] },
    { code: "AG-002", name: "ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚µãƒ«åˆåŒä¼šç¤¾", rep: "ä½è—¤èŠ±å­", merchants: "12", rate: "4.5%", st: "active", email: "info@webconsul.jp", tel: "03-9876-5432", created: "2025-01-15", totalRevenue: "Â¥8,120,000", monthlyRevenue: "Â¥832,500", topMerchants: ["é›‘è²¨ã‚¹ãƒˆã‚¢ (Â¥2.1M)", "ãƒ†ã‚¯ãƒã‚·ãƒ§ãƒƒãƒ— (Â¥1.5M)"], chart: [680, 720, 750, 790, 810, 832] },
    { code: "AG-003", name: "ITã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º", rep: "éˆ´æœ¨ä¸€éƒ", merchants: "8", rate: "5.0%", st: "active", email: "info@it-solutions.jp", tel: "03-5555-1234", created: "2025-06-01", totalRevenue: "Â¥3,650,000", monthlyRevenue: "Â¥415,000", topMerchants: ["SaaSãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ (Â¥1.8M)"], chart: [320, 350, 370, 390, 400, 415] },
  ];
  return (
    <div className="p-5 space-y-4">
      <div className="flex items-center justify-between">
        <h2 className="text-sm font-bold text-slate-800">ä»£ç†åº—ç®¡ç†</h2>
      </div>
      <div className="flex gap-1">{tabs.map(t => (
        <button key={t.id} onClick={() => setTab(t.id)} className={`px-3 py-1.5 text-xs rounded-t border-b-2 ${tab === t.id ? "border-blue-500 text-blue-700 bg-blue-50 font-bold" : "border-transparent text-slate-400"}`}>{t.label}</button>
      ))}</div>
      {tab === "list" && (
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
          <div className="p-3 border-b"><input className="border rounded px-2 py-1 text-xs w-full" placeholder="ä»£ç†åº—å / ã‚³ãƒ¼ãƒ‰ã§æ¤œç´¢" /></div>
          <TableHeader cols={[{ label: "ã‚³ãƒ¼ãƒ‰", w: "w-20" }, { label: "ä»£ç†åº—å", w: "flex-1" }, { label: "ä»£è¡¨è€…", w: "w-20" }, { label: "ç´¹ä»‹åŠ ç›Ÿåº—æ•°", w: "w-20" }, { label: "ç´¹ä»‹æ–™ç‡", w: "w-16" }, { label: "ä»Šæœˆå ±é…¬", w: "w-24" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }]}>
          {agentData.map((r, i) => {
            const agentSites = merchantData.flatMap(m => m.sites.filter(s => s.agentId === r.code).map(s => ({ ...s, merchantName: m.name, merchantId: m.id })));
            return (
            <React.Fragment key={i}>
            <tr onClick={() => setExpandedAgentCode(expandedAgentCode === r.code ? null : r.code)} className={`border-b cursor-pointer transition-colors ${expandedAgentCode === r.code ? "bg-blue-100 border-l-2 border-l-blue-500" : "hover:bg-blue-50"}`}>
              <td className="px-4 py-2 whitespace-nowrap w-20 font-mono">{r.code}</td>
              <td className="px-4 py-2 whitespace-nowrap font-bold">{r.name}</td>
              <td className="px-4 py-2 whitespace-nowrap w-20">{r.rep}</td>
              <td className="px-4 py-2 whitespace-nowrap w-20 text-center">{r.merchants}ç¤¾</td>
              <td className="px-4 py-2 whitespace-nowrap w-16">{r.rate}</td>
              <td className="px-4 py-2 whitespace-nowrap w-24 font-semibold text-emerald-700">{r.monthlyRevenue}</td>
              <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text="æœ‰åŠ¹" color="green" /></td>
            </tr>
            {expandedAgentCode === r.code && (
              <tr><td colSpan={7} className="p-0">
                <div className="px-4 py-3 bg-blue-50 border-b border-l-2 border-l-blue-500">
                  <div className="flex items-center gap-2 mb-2">
                    <p className="text-xs font-bold text-slate-700">ğŸ¤ ä»£ç†åº—è©³ç´° â€” {r.name}</p>
                    <Badge text="æœ‰åŠ¹" color="green" />
                    <span className="text-xs text-slate-400">{r.code}</span>
                  </div>
                  <div className="grid grid-cols-4 gap-3 text-xs mb-3">
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                      <p className="font-semibold text-slate-600 mb-1">åŸºæœ¬æƒ…å ±</p>
                      <div className="space-y-0.5 text-slate-500">
                        {[["ä»£è¡¨è€…", r.rep], ["ãƒ¡ãƒ¼ãƒ«", r.email], ["é›»è©±", r.tel], ["å¥‘ç´„æ—¥", r.created], ["æ–™ç‡", r.rate]].map(([l, v], di) => (
                          <div key={di} className="flex justify-between"><span className="text-slate-400">{l}:</span><span className="font-semibold text-slate-700">{v}</span></div>
                        ))}
                      </div>
                    </div>
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5">
                      <p className="font-semibold text-slate-600 mb-1">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</p>
                      <div className="space-y-1">
                        <div className="bg-orange-50 rounded p-1.5 text-center border border-orange-200">
                          <p className="text-xs text-slate-400">ç´¹ä»‹åŠ ç›Ÿåº—</p>
                          <p className="text-sm font-bold text-orange-600">{r.merchants}ç¤¾</p>
                        </div>
                        <div className="bg-emerald-50 rounded p-1.5 text-center border border-emerald-200">
                          <p className="text-xs text-slate-400">ä»Šæœˆã®å ±é…¬</p>
                          <p className="text-sm font-bold text-emerald-600">{r.monthlyRevenue}</p>
                        </div>
                        <div className="text-xs"><span className="text-slate-400">ç´¯è¨ˆ:</span> <span className="font-bold">{r.totalRevenue}</span></div>
                      </div>
                    </div>
                    <div className="bg-white rounded-lg border border-slate-200 p-2.5 col-span-2">
                      <p className="font-semibold text-slate-600 mb-1">æœˆæ¬¡å ±é…¬æ¨ç§»ï¼ˆ6ãƒ¶æœˆï¼‰</p>
                      <div className="flex items-end gap-2 h-16 px-2">
                        {r.chart.map((v, ci) => {
                          const max = Math.max(...r.chart);
                          return (<div key={ci} className="flex-1 flex flex-col items-center"><div className={`w-full rounded-t ${ci === 5 ? "bg-orange-500" : "bg-orange-200"}`} style={{ height: `${(v / max) * 100}%` }} /><p className="text-xs text-slate-400 mt-1">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][ci]}</p></div>);
                        })}
                      </div>
                    </div>
                  </div>

                  {/* ã‚µã‚¤ãƒˆã”ã¨ã®ç´ã¥ã‘ä¸€è¦§ */}
                  <div className="bg-white rounded-lg border border-slate-200 overflow-hidden">
                    <div className="px-3 py-2 bg-slate-50 border-b flex items-center gap-2">
                      <span className="text-xs font-bold text-slate-600">ğŸŒ ç´¹ä»‹ã‚µã‚¤ãƒˆä¸€è¦§</span>
                      <span className="text-xs text-slate-400">ï¼ˆ{agentSites.length}ã‚µã‚¤ãƒˆï¼‰</span>
                    </div>
                    {agentSites.length > 0 ? agentSites.map((site, si) => (
                      <div key={si} className="border-b last:border-0 px-3 py-2">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="text-xs font-mono text-slate-400">{site.siteId}</span>
                          <span className="text-xs font-bold text-slate-700">{site.siteName}</span>
                          <span className="text-xs text-slate-400">â€”</span>
                          <span className="text-xs text-slate-500">{site.merchantName}</span>
                          <span className="text-xs text-blue-500 truncate max-w-[180px] ml-auto">{site.url}</span>
                        </div>
                        <div className="flex gap-1 flex-wrap">
                          {site.processors.map((proc, pi) => {
                            const st = PROC_STATUS[proc.status] || { label: proc.status, color: "gray" };
                            return (
                              <div key={pi} className={`text-xs px-2 py-0.5 rounded border ${proc.status === "approved" ? "bg-emerald-50 border-emerald-200" : proc.status === "reviewing" ? "bg-blue-50 border-blue-200" : "bg-slate-50 border-slate-200"}`}>
                                <span className="font-semibold">{proc.name}</span>
                                <span className="text-slate-400 ml-1">{proc.brands}</span>
                                <span className="ml-1">{proc.status === "approved" ? "âœ…" : proc.status === "reviewing" ? "ğŸ”„" : "â³"}</span>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    )) : (
                      <div className="px-3 py-4 text-center text-xs text-slate-400">ç´ã¥ã‘ã‚µã‚¤ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
                    )}
                  </div>
                </div>
              </td></tr>
            )}
            </React.Fragment>
            );
          })}
          </TableHeader>
        </div>
      )}
      {tab === "register" && (
        <div className="bg-white rounded-lg border p-4 space-y-3 max-w-lg">
          <p className="text-xs font-bold">æ–°è¦ä»£ç†åº—ç™»éŒ²</p>
          {["ä»£ç†åº—å *", "ä»£è¡¨è€…å *", "ãƒ¡ãƒ¼ãƒ« *", "é›»è©±ç•ªå·", "ä½æ‰€", "åŸºæœ¬ç´¹ä»‹æ–™ç‡(%) *"].map(f => (
            <div key={f}><label className="text-xs text-slate-500">{f}</label><input className="w-full border rounded px-2 py-1.5 text-xs mt-0.5" placeholder={f.replace(" *", "")} /></div>
          ))}
          <div><label className="text-xs text-slate-500">å¥‘ç´„æ¡ä»¶ãƒ¡ãƒ¢</label><textarea className="w-full border rounded px-2 py-1.5 text-xs mt-0.5 h-16" /></div>
          <button onClick={() => setShowAddAgent(true)} className="w-full py-2 bg-blue-600 text-white rounded text-xs font-bold">ä»£ç†åº—ã‚’ç™»éŒ²ã™ã‚‹</button>
        </div>
      )}
      {tab === "commissions" && (
        <div className="space-y-3">
          <div className="flex items-center gap-2">
            <select className="border rounded px-2 py-1 text-xs"><option>2026å¹´2æœˆ</option><option>2026å¹´1æœˆ</option></select>
            <button onClick={() => toast("ä»Šæœˆã®å ±é…¬ã‚’è¨ˆç®—ã—ã¦ã„ã¾ã™...", "info")} className="px-3 py-1 bg-blue-600 text-white rounded text-xs">ä»Šæœˆã®å ±é…¬ã‚’è¨ˆç®—</button>
            <button onClick={() => toast("å ±é…¬ä¸€è¦§ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="px-3 py-1 bg-slate-100 text-slate-600 rounded text-xs border">ğŸ“¥ CSVå‡ºåŠ›</button>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "ä»£ç†åº—", w: "flex-1" }, { label: "å¯¾è±¡åŠ ç›Ÿåº—", w: "w-16" }, { label: "å–å¼•ç·é¡", w: "w-24" }, { label: "æ–™ç‡", w: "w-14" }, { label: "å ±é…¬é¡", w: "w-24" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "æ“ä½œ", w: "w-16" }]}>
            {[["ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º", "23", "Â¥45,200,000", "5.0%", "Â¥2,260,000", "pending"], ["ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚µãƒ«åˆåŒä¼šç¤¾", "12", "Â¥18,500,000", "4.5%", "Â¥832,500", "confirmed"], ["ITã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º", "8", "Â¥8,300,000", "5.0%", "Â¥415,000", "paid"]].map((r, i) => (
              <tr key={i} className="border-b">
                <td className="px-4 py-2 whitespace-nowrap font-bold">{r[0]}</td><td className="px-4 py-2 whitespace-nowrap w-16 text-center">{r[1]}ç¤¾</td><td className="px-4 py-2 whitespace-nowrap w-24">{r[2]}</td><td className="px-4 py-2 whitespace-nowrap w-14">{r[3]}</td><td className="px-4 py-2 whitespace-nowrap w-24 font-bold text-emerald-700">{r[4]}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r[5] === "pending" ? "æœªç¢ºèª" : r[5] === "confirmed" ? "ç¢ºèªæ¸ˆ" : "æ”¯æ‰•æ¸ˆ"} color={r[5] === "pending" ? "yellow" : r[5] === "confirmed" ? "blue" : "green"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-16">{r[5] === "pending" && <button onClick={() => toast(`${r[0]}ã®å ±é…¬ã‚’æ‰¿èªã—ã¾ã—ãŸ`, "success")} className="text-blue-600 text-xs">æ‰¿èª</button>}{r[5] === "confirmed" && <button onClick={() => toast(`${r[0]}ã¸ã®æ”¯æ‰•ã„ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ`, "success")} className="text-emerald-600 text-xs">æ”¯æ‰•</button>}</td>
              </tr>
            ))}
            </TableHeader>
          </div>
        </div>
      )}
      {tab === "conditions" && (() => {
        const selectedAgentCode = agentData[0].code;
        const ag = agentData.find(a => a.code === selectedAgentCode);
        const agSites = merchantData.flatMap(m => m.sites.filter(s => s.agentId === selectedAgentCode).map(s => ({ ...s, merchantName: m.name, merchantId: m.id })));
        // ã‚µã‚¤ãƒˆã”ã¨ã®ãƒ•ã‚£ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆä»£ç†åº—ãƒ•ã‚£ãƒ¼ã¯ã‚µã‚¤ãƒˆÃ—ãƒ–ãƒ©ãƒ³ãƒ‰ã”ã¨ã«è¨­å®šï¼‰
        const siteFeeData = {
          "S-001-01": { agentFees: { visa: "0.30%", master: "0.30%", jcb: "0.25%", webmoney: "0.20%" } },
          "S-001-02": { agentFees: { visa: "0.35%", master: "0.35%", amex: "0.40%", webmoney: "0.25%" } },
          "S-004-01": { agentFees: { visa: "0.25%", master: "0.25%", jcb: "0.20%" } },
          "S-002-01": { agentFees: { visa: "0.30%", master: "0.30%" } },
          "S-006-01": { agentFees: { visa: "0.35%", master: "0.35%", jcb: "0.30%", amex: "0.35%", webmoney: "0.25%" } },
          "S-006-02": { agentFees: { visa: "0.35%", master: "0.35%" } },
          "S-007-01": { agentFees: { visa: "0.40%", master: "0.40%", jcb: "0.35%" } },
        };
        return (
        <div className="space-y-3">
          <div className="bg-amber-50 border border-amber-200 rounded-lg p-2 flex items-start gap-2">
            <span className="text-xs">ğŸ’¡</span>
            <p className="text-xs text-amber-700">ä»£ç†åº—ãƒ•ã‚£ãƒ¼ã¯<span className="font-bold">ã‚µã‚¤ãƒˆã”ã¨ Ã— ãƒ–ãƒ©ãƒ³ãƒ‰ã”ã¨</span>ã«è¨­å®šã—ã¾ã™ã€‚å„ã‚µã‚¤ãƒˆã®æ¥ç¶šå…ˆãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ã«å¿œã˜ãŸæ±ºæ¸ˆæ‰‹æ•°æ–™ã‹ã‚‰ä»£ç†åº—ãƒ•ã‚£ãƒ¼ãŒå·®ã—å¼•ã‹ã‚Œã¾ã™ã€‚</p>
          </div>
          <div className="flex items-center gap-2 mb-1">
            <select className="border rounded px-2 py-1 text-xs"><option>AG-001 ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</option><option>AG-002 ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚µãƒ«åˆåŒä¼šç¤¾</option><option>AG-003 ITã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚º</option></select>
            <button onClick={() => toast("ãƒ•ã‚£ãƒ¼è¨­å®šã‚’ä¸€æ‹¬ä¿å­˜ã—ã¾ã—ãŸ", "success")} className="px-3 py-1 bg-blue-600 text-white rounded text-xs">ä¸€æ‹¬ä¿å­˜</button>
          </div>

          {/* ã‚µã‚¤ãƒˆã”ã¨ã®ãƒ•ã‚£ãƒ¼è¨­å®š */}
          {agSites.length === 0 ? (
            <div className="bg-slate-50 rounded-lg border p-6 text-center"><p className="text-xs text-slate-400">ç´ã¥ã‘ã‚µã‚¤ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p></div>
          ) : agSites.map((site, si) => {
            const sf = siteFeeData[site.siteId] || { agentFees: {} };
            const approvedProcs = site.processors.filter(p => p.status === "approved");
            // ãƒ–ãƒ©ãƒ³ãƒ‰ã”ã¨ã®è¡Œã‚’ç”Ÿæˆ
            const brandRows = [];
            approvedProcs.forEach(proc => {
              const pInfo = processorList.find(p => p.name === proc.name);
              const brands = proc.brands.includes("WEBãƒãƒãƒ¼") ? ["WEBãƒãƒãƒ¼"] : proc.brands.split("/");
              brands.forEach(brand => {
                const brandKey = brand === "VISA" ? "visa" : brand === "MC" ? "master" : brand === "JCB" ? "jcb" : brand === "AMEX" ? "amex" : brand === "Diners" ? "diners" : "webmoney";
                const defaultFee = pInfo?.fees?.[brandKey] || (pInfo?.fees?.webmoney) || "â€”";
                const overrideFee = proc.feeOverride?.[brandKey];
                const displayFee = overrideFee || defaultFee;
                const agentFee = sf.agentFees[brandKey] || "â€”";
                const feeNum = parseFloat(displayFee);
                const agentNum = parseFloat(agentFee);
                const net = (!isNaN(feeNum) && !isNaN(agentNum)) ? (feeNum - agentNum).toFixed(2) + "%" : "â€”";
                brandRows.push({ processor: proc.name, brand, displayFee, agentFee, net, brandKey, isOverride: !!overrideFee });
              });
            });
            return (
            <div key={si} className="bg-white rounded-lg border shadow-sm overflow-hidden">
              <div className="bg-gradient-to-r from-blue-50 to-slate-50 px-4 py-2 border-b flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <span className="text-xs font-mono bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded">{site.siteId}</span>
                  <span className="text-xs font-bold text-slate-700">{site.siteName}</span>
                  <span className="text-xs text-slate-400">({site.merchantName})</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="text-xs text-slate-400">{approvedProcs.length}æ¥ç¶šå…ˆ</span>
                  <button className="px-2 py-0.5 bg-blue-600 text-white rounded text-xs">ä¿å­˜</button>
                </div>
              </div>
              {brandRows.length === 0 ? (
                <div className="px-4 py-3"><p className="text-xs text-slate-400">æ‰¿èªæ¸ˆã¿ã®æ¥ç¶šå…ˆãŒã‚ã‚Šã¾ã›ã‚“</p></div>
              ) : (
                <TableHeader cols={[{ label: "æ¥ç¶šå…ˆ", w: "w-32" }, { label: "ãƒ–ãƒ©ãƒ³ãƒ‰", w: "w-24" }, { label: "æ±ºæ¸ˆæ‰‹æ•°æ–™", w: "w-24" }, { label: "ä»£ç†åº—ãƒ•ã‚£ãƒ¼", w: "w-28" }, { label: "é‹å–¶å–ã‚Šåˆ†", w: "w-24" }, { label: "æ“ä½œ", w: "w-14" }]}>
                {brandRows.map((row, ri) => (
                  <tr key={ri} className="border-b hover:bg-blue-50/30">
                    <td className="px-3 py-1.5 whitespace-nowrap w-32 text-xs">{row.processor}</td>
                    <td className="px-3 py-1.5 whitespace-nowrap w-24 text-xs font-semibold">{row.brand}</td>
                    <td className={`px-3 py-1.5 whitespace-nowrap w-24 text-xs ${row.isOverride ? "text-amber-700 font-semibold" : "text-slate-600"}`}>{row.displayFee}{row.isOverride && <span className="ml-1 text-amber-500">â˜…</span>}</td>
                    <td className="px-3 py-1.5 whitespace-nowrap w-28">
                      <input type="text" defaultValue={row.agentFee !== "â€”" ? row.agentFee : ""} placeholder="0.00%" className="border rounded px-2 py-0.5 text-xs w-16 text-orange-600 font-bold text-center" />
                    </td>
                    <td className="px-3 py-1.5 whitespace-nowrap w-24 text-xs text-slate-500">{row.net}</td>
                    <td className="px-3 py-1.5 whitespace-nowrap w-14"><button onClick={() => toast(`${row.brand}ã®ãƒ•ã‚£ãƒ¼ã‚’ç·¨é›†ä¸­`, "info")} className="text-blue-600 text-xs">ç·¨é›†</button></td>
                  </tr>
                ))}
                </TableHeader>
              )}
            </div>
            );
          })}

          {/* ã‚µãƒãƒªãƒ¼ */}
          <div className="bg-white rounded-lg border p-4">
            <div className="flex justify-between items-center mb-2">
              <p className="text-xs font-bold text-slate-700">ğŸ“Š ãƒ•ã‚£ãƒ¼è¨­å®šã‚µãƒãƒªãƒ¼</p>
            </div>
            <div className="grid grid-cols-4 gap-2">
              <div className="bg-blue-50 rounded p-2 text-center"><p className="text-xs text-slate-400">ç´ã¥ã‘ã‚µã‚¤ãƒˆæ•°</p><p className="text-sm font-bold text-blue-700">{agSites.length}</p></div>
              <div className="bg-orange-50 rounded p-2 text-center"><p className="text-xs text-slate-400">ãƒ•ã‚£ãƒ¼è¨­å®šæ¸ˆã¿</p><p className="text-sm font-bold text-orange-700">{Object.keys(siteFeeData).filter(k => agSites.some(s => s.siteId === k)).length}</p></div>
              <div className="bg-emerald-50 rounded p-2 text-center"><p className="text-xs text-slate-400">å¹³å‡ãƒ•ã‚£ãƒ¼ç‡</p><p className="text-sm font-bold text-emerald-700">0.31%</p></div>
              <div className="bg-slate-50 rounded p-2 text-center"><p className="text-xs text-slate-400">ä»Šæœˆå ±é…¬è¦‹è¾¼</p><p className="text-sm font-bold text-slate-700">{ag.monthlyRevenue}</p></div>
            </div>
          </div>
        </div>
        );
      })()}

      {/* â”€â”€ Modal: ä»£ç†åº—ç™»éŒ² â”€â”€ */}
      {showAddAgent && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowAddAgent(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[480px]">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">ä»£ç†åº—ã‚’ç™»éŒ²</h3>
              <button onClick={() => setShowAddAgent(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div><label className="text-xs font-semibold text-slate-600">æ³•äººå <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="æ ªå¼ä¼šç¤¾ã€‡ã€‡" /></div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">ä»£ç†åº—ã‚³ãƒ¼ãƒ‰ <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="AG-XXX" /></div>
                <div><label className="text-xs font-semibold text-slate-600">ç¨®åˆ¥ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>ç´¹ä»‹å‹</option><option>å–æ¬¡å‹</option></select></div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">æ‹…å½“è€…å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="å±±ç”° å¤ªéƒ" /></div>
                <div><label className="text-xs font-semibold text-slate-600">ãƒ¡ãƒ¼ãƒ« <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="agent@example.com" /></div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">å ±é…¬ç‡ï¼ˆ%ï¼‰<span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="0.1" /></div>
                <div><label className="text-xs font-semibold text-slate-600">å¥‘ç´„æœŸé–“</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>1å¹´</option><option>2å¹´</option><option>ç„¡æœŸé™</option></select></div>
              </div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowAddAgent(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setShowAddAgent(false)} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">ç™»éŒ²ã™ã‚‹</button>
            </div>
          </div>
        </div>
      )}

      {/* (ä»£ç†åº—è©³ç´°ã¯ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å±•é–‹ã«ç§»è¡Œ) */}
    </div>
  );
};

// â”€â”€â”€ D01: ä»£ç†åº—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â”€â”€â”€
const AgentDashboard = () => {
  const toast = useToast();
  const [period, setPeriod] = useState("ä»Šæœˆ");
  const [showDetail, setShowDetail] = useState(null);
  const [showAllNotices, setShowAllNotices] = useState(false);
  const kpiDetails = {
    "ç´¹ä»‹åŠ ç›Ÿåº—ï¼ˆç¨¼åƒä¸­ï¼‰": { value: "23ç¤¾", details: [{ label: "ECç‰©è²©", value: "12ç¤¾" }, { label: "ãƒ‡ã‚¸ã‚¿ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„", value: "5ç¤¾" }, { label: "ã‚µãƒ¼ãƒ“ã‚¹æ¥­", value: "4ç¤¾" }, { label: "ãã®ä»–", value: "2ç¤¾" }], chart: [18, 19, 20, 21, 22, 23] },
    "ä»Šæœˆã®å–å¼•ç·é¡": { value: "Â¥45.2M", details: [{ label: "VISA/MC", value: "Â¥32.1M" }, { label: "JCB", value: "Â¥8.5M" }, { label: "WEBãƒãƒãƒ¼", value: "Â¥4.6M" }], chart: [38, 40, 42, 41, 43, 45.2] },
    "ä»Šæœˆã®å ±é…¬è¦‹è¾¼ã¿": { value: "Â¥2,260,000", details: [{ label: "VISA/MCæ‰‹æ•°æ–™", value: "Â¥1,605,000" }, { label: "JCBæ‰‹æ•°æ–™", value: "Â¥425,000" }, { label: "ãã®ä»–", value: "Â¥230,000" }], chart: [1800, 1920, 2010, 2080, 2150, 2260] },
    "å…ˆæœˆã®å ±é…¬ç¢ºå®šé¡": { value: "Â¥2,105,000", details: [{ label: "åŸºæœ¬å ±é…¬", value: "Â¥1,950,000" }, { label: "ãƒœãƒ¼ãƒŠã‚¹", value: "Â¥155,000" }], chart: [1700, 1850, 1900, 1980, 2050, 2105] },
  };
  const notifications = [
    { type: "info", icon: "ğŸ“‹", text: "ã€Œå¤ªéƒåˆåŒä¼šç¤¾ã€ã®å¯©æŸ»ãŒå®Œäº†ã—ã€æ‰¿èªã•ã‚Œã¾ã—ãŸ", time: "2æ™‚é–“å‰" },
    { type: "alert", icon: "âš ï¸", text: "ã€ŒECã‚µã‚¤ãƒˆAã€ã®ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ç‡ãŒé–¾å€¤ã«è¿‘ã¥ã„ã¦ã„ã¾ã™", time: "5æ™‚é–“å‰" },
    { type: "success", icon: "ğŸ’°", text: "1æœˆåˆ†ã®å ±é…¬ãŒæŒ¯ã‚Šè¾¼ã¾ã‚Œã¾ã—ãŸï¼ˆÂ¥2,105,000ï¼‰", time: "1æ—¥å‰" },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex items-center justify-between">
      <h2 className="text-sm font-bold text-slate-800">ä»£ç†åº—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
      <div className="flex items-center gap-2">
        <div className="flex bg-slate-100 rounded-lg p-0.5">
          {["ä»Šæ—¥", "ä»Šé€±", "ä»Šæœˆ"].map(p => (
            <button key={p} onClick={() => setPeriod(p)} className={`text-xs px-3 py-1 rounded ${period === p ? "bg-white shadow-sm text-orange-600 font-semibold" : "text-slate-500"}`}>{p}</button>
          ))}
        </div>
        <span className="text-xs text-slate-400">ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º</span>
      </div>
    </div>

    {/* ãŠçŸ¥ã‚‰ã›æ¬„ */}
    {(() => {
      const aNotices = [
        { date: "02/17", title: "æ±ºæ¸ˆå‡¦ç†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›ï¼ˆ2/20 AM2:00-4:00ï¼‰", type: "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹", tColor: "yellow", icon: "ğŸ”§" },
        { date: "02/15", title: "æ–°æ©Ÿèƒ½: Apple Pay / Google Pay å¯¾å¿œé–‹å§‹", type: "ãƒªãƒªãƒ¼ã‚¹", tColor: "blue", icon: "ğŸš€" },
        { date: "02/14", title: "ã€å¾©æ—§æ¸ˆã€‘2/14 æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼å¢—åŠ ã«ã¤ã„ã¦", type: "éšœå®³", tColor: "red", icon: "âš ï¸" },
        { date: "02/10", title: "ä»£ç†åº—å‘ã‘å ±é…¬è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ã«ã¤ã„ã¦", type: "é‡è¦", tColor: "red", icon: "ğŸ¤" },
      ];
      const renderANotice = (n, i) => (
        <div key={i} className={`flex items-center gap-2 p-2 rounded border text-xs cursor-pointer hover:bg-orange-50 ${i === 0 ? "border-amber-300 bg-amber-50" : i === 3 ? "border-rose-200 bg-rose-50/50" : "border-slate-200"}`}>
          <span>{n.icon}</span>
          <span className="w-12 text-slate-400 shrink-0">{n.date}</span>
          <Badge text={n.type} color={n.tColor} />
          <span className={`flex-1 ${i === 0 ? "text-amber-800 font-semibold" : i === 3 ? "text-rose-700 font-semibold" : "text-slate-700"}`}>{n.title}</span>
        </div>
      );
      return (
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <div className="flex items-center justify-between mb-2">
          <div className="flex items-center gap-2">
            <span>ğŸ“¢</span>
            <p className="text-xs font-bold text-slate-600">ãŠçŸ¥ã‚‰ã›</p>
            {aNotices.length > 3 && <span className="text-xs text-slate-300">({aNotices.length}ä»¶)</span>}
          </div>
          {aNotices.length > 3 && (
            <button className="text-xs text-orange-600 cursor-pointer hover:underline" onClick={() => setShowAllNotices(!showAllNotices)}>
              {showAllNotices ? "é–‰ã˜ã‚‹ â–²" : `ã™ã¹ã¦è¦‹ã‚‹ (${aNotices.length - 3}ä»¶) â–¼`}
            </button>
          )}
        </div>
        <div className="space-y-1.5">
          {aNotices.slice(0, 3).map(renderANotice)}
          {showAllNotices && (
            <div className="space-y-1.5 pt-1 border-t border-dashed border-slate-200 mt-1">
              {aNotices.slice(3).map((n, i) => renderANotice(n, i + 3))}
            </div>
          )}
        </div>
      </div>
      );
    })()}

    {/* AIã‚¤ãƒ³ã‚µã‚¤ãƒˆ */}
    <div className="bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg border border-orange-200 p-3">
      <div className="flex items-center gap-2 mb-1">
        <span>ğŸ¤–</span><span className="text-xs font-bold text-orange-700">AI åˆ†æ</span><span className="text-xs text-slate-400">æ¯æ—¥æ›´æ–°</span>
      </div>
      <p className="text-xs text-slate-700">ä»Šæœˆã®ç´¹ä»‹åŠ ç›Ÿåº—ã®å–å¼•ç·é¡ã¯å‰æœˆæ¯”+8.3%ã®Â¥45.2Mã€‚ä¸Šä½3åŠ ç›Ÿåº—ã§å…¨ä½“ã®62%ã‚’å ã‚ã¦ã„ã¾ã™ã€‚æ–°è¦ç´¹ä»‹ã®ã€Œå¤ªéƒåˆåŒä¼šç¤¾ã€ãŒå¯©æŸ»é€šéã™ã‚Œã°ã€æ¥æœˆã®å ±é…¬ã¯+Â¥120,000ã®è¦‹è¾¼ã¿ã§ã™ã€‚</p>
    </div>

    <div className="grid grid-cols-4 gap-3">
      {Object.entries(kpiDetails).map(([label, d]) => (
        <div key={label} onClick={() => setShowDetail(label)} className="cursor-pointer hover:ring-2 hover:ring-orange-200 rounded-lg transition-all">
          <KPICard label={label} value={d.value} trend={label === "ä»Šæœˆã®å–å¼•ç·é¡" ? 8.3 : undefined} sub={label === "å…ˆæœˆã®å ±é…¬ç¢ºå®šé¡" ? "æ”¯æ‰•æ¸ˆ" : undefined} color={label === "å…ˆæœˆã®å ±é…¬ç¢ºå®šé¡" ? "blue" : "green"} />
        </div>
      ))}
    </div>

    <div className="grid grid-cols-2 gap-3">
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold mb-2">åŠ ç›Ÿåº—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</p>
        <div className="flex items-center gap-4 py-4 justify-center">
          <div className="text-center"><div className="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 font-bold">23</div><p className="text-xs text-slate-500 mt-1">ç¨¼åƒä¸­</p></div>
          <div className="text-center"><div className="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-amber-700 font-bold">3</div><p className="text-xs text-slate-500 mt-1">å¯©æŸ»ä¸­</p></div>
          <div className="text-center"><div className="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold">1</div><p className="text-xs text-slate-500 mt-1">åœæ­¢ä¸­</p></div>
        </div>
      </div>
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold mb-2">æœˆåˆ¥å ±é…¬æ¨ç§»ï¼ˆç›´è¿‘6ãƒ¶æœˆï¼‰</p>
        <div className="flex items-end gap-2 h-24 px-2">
          {[60, 72, 68, 85, 90, 95].map((h, i) => (
            <div key={i} className="flex-1 flex flex-col items-center">
              <p className="text-xs text-slate-500 mb-0.5">{["Â¥1.8M", "Â¥1.9M", "Â¥2.0M", "Â¥2.1M", "Â¥2.2M", "Â¥2.3M"][i]}</p>
              <div className={`w-full rounded-t ${i === 5 ? "bg-orange-500" : "bg-orange-300"}`} style={{ height: `${h}%` }} />
              <p className="text-xs text-slate-400 mt-1">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][i]}</p>
            </div>
          ))}
        </div>
      </div>
    </div>

    <div className="grid grid-cols-2 gap-3">
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold mb-2">æœ€æ–°ã®ç´¹ä»‹åŠ ç›Ÿåº—</p>
        {[["ãƒãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—å¤ªéƒ", "2026-02-10", "å¯©æŸ»ä¸­", "yellow"], ["ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³EC123", "2026-01-25", "ç¨¼åƒä¸­", "green"], ["ãƒ•ãƒ¼ãƒ‰é€šè²©ABC", "2026-01-15", "ç¨¼åƒä¸­", "green"], ["ãƒ†ã‚¯ãƒã‚¹ãƒˆã‚¢X", "2025-12-20", "ç¨¼åƒä¸­", "green"]].map((r, i) => (
          <div key={i} className="flex items-center py-2 border-b text-xs last:border-0">
            <div className="flex-1 font-bold">{r[0]}</div>
            <div className="w-24 text-slate-400">{r[1]}</div>
            <Badge text={r[2]} color={r[3]} />
          </div>
        ))}
      </div>
      <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
        <p className="text-xs font-bold mb-2">ğŸ”” é€šçŸ¥</p>
        {notifications.map((n, i) => (
          <div key={i} className={`flex items-start gap-2 py-2 border-b text-xs last:border-0 ${n.type === "alert" ? "bg-amber-50 -mx-3 px-3" : ""}`}>
            <span>{n.icon}</span>
            <div className="flex-1">
              <p className="text-slate-700">{n.text}</p>
              <p className="text-slate-400 mt-0.5">{n.time}</p>
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* å–æ¬¡ã‚µã‚¤ãƒˆä¸€è¦§ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm">
      <div className="p-3 border-b flex justify-between items-center">
        <p className="text-xs font-bold text-slate-700">å–æ¬¡ã‚µã‚¤ãƒˆä¸€è¦§</p>
        <span className="text-xs text-slate-400">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚µã‚¤ãƒˆæƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™</span>
      </div>
      <div className="overflow-x-auto">
        <TableHeader cols={[{ label: "åŠ ç›Ÿåº—å", w: "w-28" }, { label: "ã‚µã‚¤ãƒˆID", w: "w-20" }, { label: "ã‚µã‚¤ãƒˆå", w: "flex-1" }, { label: "ã‚µã‚¤ãƒˆURL", w: "w-40" }, { label: "æä¾›ã‚µãƒ¼ãƒ“ã‚¹", w: "w-28" }, { label: "ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³", w: "w-36" }]}>
        {[
          { merchant: "ABCå•†äº‹", siteId: "S-001", siteName: "ECã‚µã‚¤ãƒˆA", url: "https://ec-site-a.jp", service: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ/QR", token: "aip_tk_xxxx...xxxx" },
          { merchant: "ABCå•†äº‹", siteId: "S-002", siteName: "ECã‚µã‚¤ãƒˆA-SP", url: "https://sp.ec-site-a.jp", service: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", token: "aip_tk_yyyy...yyyy" },
          { merchant: "XYZç‰©ç”£", siteId: "S-010", siteName: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B", url: "https://store-b.xyz.jp", service: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ/WEBãƒãƒãƒ¼", token: "aip_tk_zzzz...zzzz" },
          { merchant: "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³EC", siteId: "S-015", siteName: "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆã‚¢", url: "https://fashion-ec.com", service: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ/WEBãƒãƒãƒ¼", token: "aip_tk_wwww...wwww" },
          { merchant: "ãƒ•ãƒ¼ãƒ‰é€šè²©ABC", siteId: "S-020", siteName: "ãƒ•ãƒ¼ãƒ‰é€šè²©", url: "https://food-abc.jp", service: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", token: "aip_tk_vvvv...vvvv" },
        ].map((s, i) => (
          <tr key={i} className="border-b hover:bg-blue-50">
            <td className="px-4 py-2 whitespace-nowrap w-28 font-semibold">{s.merchant}</td>
            <td className="px-4 py-2 whitespace-nowrap w-20 font-mono text-blue-600">{s.siteId}</td>
            <td className="px-4 py-2 whitespace-nowrap">{s.siteName}</td>
            <td className="px-4 py-2 whitespace-nowrap w-40 text-blue-500 text-xs">{s.url}</td>
            <td className="px-4 py-2 whitespace-nowrap w-28"><div className="flex gap-1 flex-wrap">{s.service.split("/").map((sv, j) => <Badge key={j} text={sv} color="blue" />)}</div></td>
            <td className="px-4 py-2 whitespace-nowrap w-36 font-mono text-slate-400 text-xs">{s.token}</td>
          </tr>
        ))}
        </TableHeader>
      </div>
    </div>

    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold mb-2">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</p>
      <div className="flex gap-2">
        {[["ğŸ“ æ–°è¦ç´¹ä»‹", "orange"], ["ğŸ’° å ±é…¬æ˜ç´°", "blue"], ["ğŸ‘¥ ç´¹ä»‹å…ˆä¸€è¦§", "emerald"], ["âš™ï¸ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š", "slate"]].map(([label, color], i) => (
          <button key={i} onClick={() => toast(`${label}ã‚’é–‹ãã¾ã™`, "info")} className={`flex-1 py-2 rounded-lg border text-xs font-bold bg-${color}-50 text-${color}-700 border-${color}-200 hover:bg-${color}-100`}>{label}</button>
        ))}
      </div>
    </div>

    {/* KPIãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showDetail && kpiDetails[showDetail] && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowDetail(null)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">{showDetail}</p>
            <button onClick={() => setShowDetail(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            <div className="text-center py-2">
              <p className="text-2xl font-bold text-slate-800">{kpiDetails[showDetail].value}</p>
            </div>
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">æœˆæ¬¡æ¨ç§»</p>
              <div className="flex items-end gap-2 h-16 px-2">
                {kpiDetails[showDetail].chart.map((v, i) => {
                  const max = Math.max(...kpiDetails[showDetail].chart);
                  return (
                    <div key={i} className="flex-1 flex flex-col items-center">
                      <div className={`w-full rounded-t ${i === 5 ? "bg-orange-500" : "bg-orange-200"}`} style={{ height: `${max > 0 ? (v / max) * 100 : 0}%` }} />
                      <p className="text-xs text-slate-400 mt-1">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][i]}</p>
                    </div>
                  );
                })}
              </div>
            </div>
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">å†…è¨³</p>
              {kpiDetails[showDetail].details.map((d, i) => (
                <div key={i} className="flex text-xs border-b py-1.5"><span className="flex-1 text-slate-600">{d.label}</span><span className="font-bold">{d.value}</span></div>
              ))}
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ D02: åŠ ç›Ÿåº—ä¸€è¦§ â”€â”€â”€
const AgentMerchants = () => {
  const [selectedMerchant, setSelectedMerchant] = useState(null);
  const [d02Tab, setD02Tab] = useState("merchants");
  const [showD02Search, setShowD02Search] = useState(true);
  const [selectedD02Tx, setSelectedD02Tx] = useState(null);
  const merchants = [
    { name: "ECã‚µã‚¤ãƒˆA", corp: "ABCå•†äº‹", status: "ç¨¼åƒä¸­", sc: "green", vol: "Â¥5,200,000", date: "2025-06-01", rate: "5.0%", txn: 1240, success: "98.2%", commission: "Â¥260,000", contact: "abc@example.com", siteId: "S-001", siteName: "ECã‚µã‚¤ãƒˆAæœ¬åº—" },
    { name: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B", corp: "XYZç‰©ç”£", status: "ç¨¼åƒä¸­", sc: "green", vol: "Â¥3,100,000", date: "2025-08-15", rate: "5.0%", txn: 780, success: "97.8%", commission: "Â¥155,000", contact: "xyz@example.com", siteId: "S-002", siteName: "XYZã‚ªãƒ³ãƒ©ã‚¤ãƒ³" },
    { name: "ãƒãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—å¤ªéƒ", corp: "å¤ªéƒåˆåŒä¼šç¤¾", status: "å¯©æŸ»ä¸­", sc: "yellow", vol: "â€”", date: "2026-02-10", rate: "5.0%", txn: 0, success: "â€”", commission: "â€”", contact: "taro@example.com", siteId: "S-003", siteName: "å¤ªéƒã‚·ãƒ§ãƒƒãƒ—" },
  ];
  const d02TxResults = [
    { txId: "TXN-20260215-001", orderId: "ORD-A-1234", date: "2026-02-15 14:23:15", merchant: "ECã‚µã‚¤ãƒˆA", site: "ECã‚µã‚¤ãƒˆAæœ¬åº—", amount: "Â¥12,800", currency: "JPY", status: "æˆåŠŸ", sc: "green", cardLast4: "4242", cardBrand: "VISA", customer: "å±±ç”°å¤ªéƒ", email: "yamada@example.com", method: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", threeds: "èªè¨¼æ¸ˆ" },
    { txId: "TXN-20260215-002", orderId: "ORD-A-1235", date: "2026-02-15 13:55:42", merchant: "ECã‚µã‚¤ãƒˆA", site: "ECã‚µã‚¤ãƒˆAæœ¬åº—", amount: "Â¥5,500", currency: "JPY", status: "æˆåŠŸ", sc: "green", cardLast4: "1234", cardBrand: "MC", customer: "ä½è—¤èŠ±å­", email: "sato@example.com", method: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", threeds: "èªè¨¼æ¸ˆ" },
    { txId: "TXN-20260214-003", orderId: "ORD-B-5678", date: "2026-02-14 19:12:08", merchant: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B", site: "XYZã‚ªãƒ³ãƒ©ã‚¤ãƒ³", amount: "Â¥8,900", currency: "JPY", status: "æˆåŠŸ", sc: "green", cardLast4: "5678", cardBrand: "JCB", customer: "éˆ´æœ¨ä¸€éƒ", email: "suzuki@example.com", method: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", threeds: "æœªå¯¾å¿œ" },
    { txId: "TXN-20260214-004", orderId: "ORD-A-1236", date: "2026-02-14 15:30:22", merchant: "ECã‚µã‚¤ãƒˆA", site: "ECã‚µã‚¤ãƒˆAæœ¬åº—", amount: "Â¥3,200", currency: "JPY", status: "è¿”é‡‘æ¸ˆ", sc: "yellow", cardLast4: "9012", cardBrand: "VISA", customer: "ç”°ä¸­æ¬¡éƒ", email: "tanaka@example.com", method: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", threeds: "èªè¨¼æ¸ˆ" },
    { txId: "TXN-20260213-005", orderId: "ORD-B-5679", date: "2026-02-13 11:45:33", merchant: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B", site: "XYZã‚ªãƒ³ãƒ©ã‚¤ãƒ³", amount: "Â¥22,000", currency: "JPY", status: "æˆåŠŸ", sc: "green", cardLast4: "3456", cardBrand: "AMEX", customer: "é«˜æ©‹ç¾å’²", email: "takahashi@example.com", method: "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ", threeds: "èªè¨¼æ¸ˆ" },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex items-center justify-between">
      <h2 className="text-sm font-bold text-slate-800">ç´¹ä»‹å…ˆä¸€è¦§</h2>
      <button onClick={() => toast("ç´¹ä»‹å…ˆä¸€è¦§ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSVå‡ºåŠ›</button>
    </div>
    {/* ã‚¿ãƒ– */}
    <div className="flex gap-1 border-b">
      {[["merchants", "åŠ ç›Ÿåº—ä¸€è¦§"], ["txSearch", "ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆæ±ºæ¸ˆæ¤œç´¢"]].map(([k, l]) => (
        <button key={k} onClick={() => setD02Tab(k)} className={`px-4 py-2 text-xs font-semibold border-b-2 ${d02Tab === k ? "border-orange-500 text-orange-700" : "border-transparent text-slate-400 hover:text-slate-600"}`}>{l}</button>
      ))}
    </div>

    {d02Tab === "merchants" && (<>
    <div className="grid grid-cols-3 gap-3">
      <KPICard label="ç´¹ä»‹åŠ ç›Ÿåº—æ•°" value="3ç¤¾" sub="ç¨¼åƒä¸­ 2ç¤¾" color="blue" />
      <KPICard label="æœˆé–“åˆè¨ˆå–å¼•é¡" value="Â¥8,300,000" trend={4.5} color="blue" />
      <KPICard label="ä»Šæœˆã®å ±é…¬è¦‹è¾¼" value="Â¥415,000" sub="" color="green" />
    </div>
    <div className="flex gap-2"><input className="border rounded px-2 py-1 text-xs flex-1" placeholder="åŠ ç›Ÿåº—åã§æ¤œç´¢" /><select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option><option>ç¨¼åƒä¸­</option><option>å¯©æŸ»ä¸­</option><option>åœæ­¢ä¸­</option></select></div>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "åŠ ç›Ÿåº—å", w: "flex-1" }, { label: "æ³•äººå", w: "w-28" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "æœˆé–“å–å¼•é¡", w: "w-24" }, { label: "å–å¼•æ•°", w: "w-16" }, { label: "ç´¹ä»‹æ—¥", w: "w-20" }, { label: "é©ç”¨æ–™ç‡", w: "w-16" }]}>
      {merchants.map((r, i) => (
        <tr key={i} onClick={() => setSelectedMerchant(r)} className="border-b hover:bg-blue-50 cursor-pointer">
          <td className="px-4 py-2 whitespace-nowrap font-bold text-blue-600">{r.name}</td>
          <td className="px-4 py-2 whitespace-nowrap w-28 text-slate-500">{r.corp}</td>
          <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={r.status} color={r.sc} /></td>
          <td className="px-4 py-2 whitespace-nowrap w-24">{r.vol}</td>
          <td className="px-4 py-2 whitespace-nowrap w-16 text-center">{r.txn > 0 ? `${r.txn}ä»¶` : "â€”"}</td>
          <td className="px-4 py-2 whitespace-nowrap w-20 text-slate-400">{r.date}</td>
          <td className="px-4 py-2 whitespace-nowrap w-16">{r.rate}</td>
        </tr>
      ))}
      </TableHeader>
    </div>
    </>)}

    {d02Tab === "txSearch" && (<>
    {/* AQUAGATESæº–æ‹ : ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆæ±ºæ¸ˆæ¤œç´¢ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm">
      <div className="p-3 border-b bg-slate-50 flex items-center justify-between cursor-pointer" onClick={() => setShowD02Search(!showD02Search)}>
        <p className="text-xs font-bold text-slate-700">ğŸ” æ¤œç´¢æ¡ä»¶</p>
        <span className="text-xs text-slate-400">{showD02Search ? "â–² é–‰ã˜ã‚‹" : "â–¼ é–‹ã"}</span>
      </div>
      {showD02Search && (
        <div className="p-4 space-y-3">
          <div className="grid grid-cols-4 gap-3">
            <div><label className="text-xs text-slate-500">æœŸé–“ï¼ˆé–‹å§‹ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="2026-02-01" /></div>
            <div><label className="text-xs text-slate-500">æœŸé–“ï¼ˆçµ‚äº†ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" defaultValue="2026-02-15" /></div>
            <div><label className="text-xs text-slate-500">æ±ºæ¸ˆID</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="TXN-" /></div>
            <div><label className="text-xs text-slate-500">ã‚ªãƒ¼ãƒ€ãƒ¼ID</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ORD-" /></div>
          </div>
          <div className="grid grid-cols-4 gap-3">
            <div><label className="text-xs text-slate-500">åŠ ç›Ÿåº—å</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ã¦</option><option>ECã‚µã‚¤ãƒˆA</option><option>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B</option></select></div>
            <div><label className="text-xs text-slate-500">ã‚µã‚¤ãƒˆå</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ã¦</option><option>ECã‚µã‚¤ãƒˆAæœ¬åº—</option><option>XYZã‚ªãƒ³ãƒ©ã‚¤ãƒ³</option></select></div>
            <div><label className="text-xs text-slate-500">é€šè²¨</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>JPY</option><option>USD</option></select></div>
            <div><label className="text-xs text-slate-500">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ã¦</option><option>æˆåŠŸ</option><option>å¤±æ•—</option><option>è¿”é‡‘æ¸ˆ</option><option>ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯</option><option>å‡¦ç†ä¸­</option></select></div>
          </div>
          <div className="grid grid-cols-4 gap-3">
            <div><label className="text-xs text-slate-500">é¡§å®¢å</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="é¡§å®¢å" /></div>
            <div><label className="text-xs text-slate-500">é¡§å®¢ãƒ¡ãƒ¼ãƒ«</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="email@example.com" /></div>
            <div><label className="text-xs text-slate-500">ã‚«ãƒ¼ãƒ‰ç•ªå·ï¼ˆä¸‹4æ¡ï¼‰</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="4242" maxLength={4} /></div>
            <div><label className="text-xs text-slate-500">é‡‘é¡</label><div className="flex gap-1 mt-0.5"><input className="w-1/2 text-xs border rounded px-2 py-1.5" placeholder="æœ€å°" /><input className="w-1/2 text-xs border rounded px-2 py-1.5" placeholder="æœ€å¤§" /></div></div>
          </div>
          <div className="flex justify-end gap-2">
            <button onClick={() => toast("æ¤œç´¢æ¡ä»¶ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ", "info")} className="text-xs px-3 py-1.5 border rounded text-slate-500 hover:bg-slate-50">æ¡ä»¶ãƒªã‚»ãƒƒãƒˆ</button>
            <button onClick={() => toast("æ±ºæ¸ˆã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="text-xs px-4 py-1.5 bg-orange-500 text-white rounded font-semibold hover:bg-orange-600">æ¤œç´¢</button>
          </div>
        </div>
      )}
    </div>
    <div className="flex items-center justify-between">
      <p className="text-xs text-slate-500">æ¤œç´¢çµæœ: <span className="font-bold text-slate-800">5ä»¶</span></p>
      <button onClick={() => toast("æ±ºæ¸ˆå±¥æ­´ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSVå‡ºåŠ›</button>
    </div>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "æ±ºæ¸ˆæ—¥æ™‚", w: "w-32" }, { label: "æ±ºæ¸ˆID", w: "w-36" }, { label: "ã‚ªãƒ¼ãƒ€ãƒ¼ID", w: "w-28" }, { label: "åŠ ç›Ÿåº—", w: "w-24" }, { label: "ã‚µã‚¤ãƒˆ", w: "w-28" }, { label: "é‡‘é¡", w: "w-20" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "ã‚«ãƒ¼ãƒ‰", w: "w-20" }, { label: "é¡§å®¢å", w: "w-20" }]}>
      {d02TxResults.map((tx, i) => (
        <tr key={i} onClick={() => setSelectedD02Tx(tx)} className="border-b hover:bg-orange-50 cursor-pointer">
          <td className="px-3 py-2 whitespace-nowrap text-xs w-32 text-slate-500">{tx.date}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-36 font-mono text-blue-600">{tx.txId}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-28 text-slate-500">{tx.orderId}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-24">{tx.merchant}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-28 text-slate-500">{tx.site}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20 font-bold">{tx.amount}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-16"><Badge text={tx.status} color={tx.sc} /></td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20"><span className="text-slate-400">{tx.cardBrand}</span> ****{tx.cardLast4}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20">{tx.customer}</td>
        </tr>
      ))}
      </TableHeader>
    </div>
    <div className="flex items-center justify-between text-xs text-slate-400">
      <span>1-5ä»¶ / 5ä»¶ä¸­</span>
      <div className="flex gap-1">
        <button onClick={() => toast("å‰ã®ãƒšãƒ¼ã‚¸ã¸", "info")} className="px-2 py-1 border rounded bg-white text-slate-300">â—€</button>
        <button className="px-2 py-1 border rounded bg-orange-500 text-white">1</button>
        <button onClick={() => toast("æ¬¡ã®ãƒšãƒ¼ã‚¸ã¸", "info")} className="px-2 py-1 border rounded bg-white text-slate-300">â–¶</button>
      </div>
    </div>
    </>)}

    {/* åŠ ç›Ÿåº—è©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedMerchant && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedMerchant(null)} />
        <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b bg-blue-50 flex justify-between items-center">
            <h3 className="text-sm font-bold text-slate-800">{selectedMerchant.name}</h3>
            <button onClick={() => setSelectedMerchant(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div>
              <p className="text-xs text-slate-400 mb-1">åŸºæœ¬æƒ…å ±</p>
              <div className="space-y-1.5">
                {[["æ³•äººå", selectedMerchant.corp], ["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", selectedMerchant.status], ["ç´¹ä»‹æ—¥", selectedMerchant.date], ["é©ç”¨æ–™ç‡", selectedMerchant.rate], ["é€£çµ¡å…ˆ", selectedMerchant.contact], ["ã‚µã‚¤ãƒˆID", selectedMerchant.siteId], ["ã‚µã‚¤ãƒˆå", selectedMerchant.siteName]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-20 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-1">æœˆæ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</p>
              <div className="grid grid-cols-2 gap-2">
                <div className="bg-blue-50 rounded p-2 text-center"><p className="text-xs text-slate-400">å–å¼•é¡</p><p className="text-sm font-bold text-blue-700">{selectedMerchant.vol}</p></div>
                <div className="bg-emerald-50 rounded p-2 text-center"><p className="text-xs text-slate-400">å ±é…¬</p><p className="text-sm font-bold text-emerald-700">{selectedMerchant.commission}</p></div>
                <div className="bg-slate-50 rounded p-2 text-center"><p className="text-xs text-slate-400">å–å¼•æ•°</p><p className="text-sm font-bold">{selectedMerchant.txn > 0 ? `${selectedMerchant.txn}ä»¶` : "â€”"}</p></div>
                <div className="bg-slate-50 rounded p-2 text-center"><p className="text-xs text-slate-400">æˆåŠŸç‡</p><p className="text-sm font-bold">{selectedMerchant.success}</p></div>
              </div>
            </div>
            {selectedMerchant.txn > 0 && (<div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-2">æœˆæ¬¡æ¨ç§»ï¼ˆ6ãƒ¶æœˆï¼‰</p>
              <div className="flex items-end gap-1 h-20 px-1">
                {[65, 72, 68, 80, 75, 85].map((h, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full bg-blue-400 rounded-t" style={{ height: `${h}%` }} />
                    <p className="text-xs text-slate-400 mt-0.5">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][i]}</p>
                  </div>
                ))}
              </div>
            </div>)}
            {selectedMerchant.txn > 0 && (<div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-2">ç›´è¿‘å–å¼•ï¼ˆ5ä»¶ï¼‰</p>
              {[
                { time: "02/11 14:23", amt: "Â¥12,800", st: "æˆåŠŸ", stc: "green" },
                { time: "02/11 13:55", amt: "Â¥5,500", st: "æˆåŠŸ", stc: "green" },
                { time: "02/10 19:12", amt: "Â¥8,900", st: "æˆåŠŸ", stc: "green" },
                { time: "02/10 15:30", amt: "Â¥3,200", st: "è¿”é‡‘æ¸ˆ", stc: "yellow" },
                { time: "02/09 11:45", amt: "Â¥22,000", st: "æˆåŠŸ", stc: "green" },
              ].map((t, i) => (
                <div key={i} className="flex items-center py-1 text-xs border-b last:border-0">
                  <span className="w-24 text-slate-400">{t.time}</span>
                  <span className="w-20 font-bold">{t.amt}</span>
                  <Badge text={t.st} color={t.stc} />
                </div>
              ))}
            </div>)}
          </div>
        </div>
      </div>
    )}

    {/* æ±ºæ¸ˆè©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedD02Tx && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedD02Tx(null)} />
        <div className="w-[480px] bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b bg-orange-50 flex justify-between items-center">
            <div><h3 className="text-sm font-bold text-slate-800">æ±ºæ¸ˆè©³ç´°</h3><p className="text-xs text-slate-400 font-mono">{selectedD02Tx.txId}</p></div>
            <button onClick={() => setSelectedD02Tx(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className="flex items-center gap-2 mb-2"><Badge text={selectedD02Tx.status} color={selectedD02Tx.sc} /><span className="text-lg font-bold">{selectedD02Tx.amount}</span><span className="text-xs text-slate-400">({selectedD02Tx.currency})</span></div>
            <div>
              <p className="text-xs text-slate-400 mb-1">æ±ºæ¸ˆæƒ…å ±</p>
              <div className="space-y-1.5">
                {[["æ±ºæ¸ˆID", selectedD02Tx.txId], ["ã‚ªãƒ¼ãƒ€ãƒ¼ID", selectedD02Tx.orderId], ["æ±ºæ¸ˆæ—¥æ™‚", selectedD02Tx.date], ["æ±ºæ¸ˆæ‰‹æ®µ", selectedD02Tx.method], ["3Dã‚»ã‚­ãƒ¥ã‚¢", selectedD02Tx.threeds]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-28 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-1">ã‚«ãƒ¼ãƒ‰æƒ…å ±</p>
              <div className="space-y-1.5">
                {[["ã‚«ãƒ¼ãƒ‰ãƒ–ãƒ©ãƒ³ãƒ‰", selectedD02Tx.cardBrand], ["ã‚«ãƒ¼ãƒ‰ç•ªå·", `**** **** **** ${selectedD02Tx.cardLast4}`]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-28 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-1">é¡§å®¢æƒ…å ±</p>
              <div className="space-y-1.5">
                {[["é¡§å®¢å", selectedD02Tx.customer], ["ãƒ¡ãƒ¼ãƒ«", selectedD02Tx.email]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-28 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-1">åŠ ç›Ÿåº—ãƒ»ã‚µã‚¤ãƒˆ</p>
              <div className="space-y-1.5">
                {[["åŠ ç›Ÿåº—", selectedD02Tx.merchant], ["ã‚µã‚¤ãƒˆ", selectedD02Tx.site]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-28 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ D03: å ±é…¬æ˜ç´°ï¼ˆAQUAGATESæº–æ‹ ï¼‰ â”€â”€â”€
const AgentReports = () => {
  const [selectedReport, setSelectedReport] = useState(null);
  const reports = [
    { reportId: "RPT-2026-02", reportNo: "AG001-202602", month: "2026å¹´2æœˆ", issueDate: "2026-02-28", payDate: "2026-03-15", merchants: "23ç¤¾", volume: "Â¥45,200,000", commission: "Â¥2,260,000", status: "pending", label: "æœªç¢ºå®š", breakdown: [{ name: "ECã‚µã‚¤ãƒˆA", siteId: "S-001", vol: "Â¥5,200,000", fee: "3.2%", com: "Â¥260,000", txn: 1240 }, { name: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B", siteId: "S-002", vol: "Â¥3,100,000", fee: "3.0%", com: "Â¥155,000", txn: 780 }, { name: "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³EC", siteId: "S-004", vol: "Â¥4,800,000", fee: "3.5%", com: "Â¥240,000", txn: 620 }] },
    { reportId: "RPT-2026-01", reportNo: "AG001-202601", month: "2026å¹´1æœˆ", issueDate: "2026-01-31", payDate: "2026-02-15", merchants: "22ç¤¾", volume: "Â¥42,100,000", commission: "Â¥2,105,000", status: "paid", label: "æ”¯æ‰•æ¸ˆ", breakdown: [{ name: "ECã‚µã‚¤ãƒˆA", siteId: "S-001", vol: "Â¥4,900,000", fee: "3.2%", com: "Â¥245,000", txn: 1180 }, { name: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B", siteId: "S-002", vol: "Â¥2,800,000", fee: "3.0%", com: "Â¥140,000", txn: 720 }, { name: "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³EC", siteId: "S-004", vol: "Â¥4,500,000", fee: "3.5%", com: "Â¥225,000", txn: 590 }] },
    { reportId: "RPT-2025-12", reportNo: "AG001-202512", month: "2025å¹´12æœˆ", issueDate: "2025-12-31", payDate: "2026-01-15", merchants: "21ç¤¾", volume: "Â¥38,500,000", commission: "Â¥1,925,000", status: "paid", label: "æ”¯æ‰•æ¸ˆ", breakdown: [{ name: "ECã‚µã‚¤ãƒˆA", siteId: "S-001", vol: "Â¥4,200,000", fee: "3.2%", com: "Â¥210,000", txn: 1020 }, { name: "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢B", siteId: "S-002", vol: "Â¥2,500,000", fee: "3.0%", com: "Â¥125,000", txn: 650 }, { name: "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³EC", siteId: "S-004", vol: "Â¥4,100,000", fee: "3.5%", com: "Â¥205,000", txn: 540 }] },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex items-center justify-between">
      <h2 className="text-sm font-bold text-slate-800">å ±é…¬æ˜ç´°</h2>
      <button onClick={() => toast("å ±é…¬æ˜ç´°ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSVå‡ºåŠ›</button>
    </div>
    <div className="grid grid-cols-3 gap-3">
      <KPICard label="å¹´é–“å ±é…¬åˆè¨ˆ" value="Â¥24,580,000" sub="2025å¹´åº¦" color="blue" />
      <KPICard label="æœˆå¹³å‡å ±é…¬" value="Â¥2,048,000" trend={6.2} color="green" />
      <KPICard label="ãƒˆãƒƒãƒ—åŠ ç›Ÿåº—" value="ECã‚µã‚¤ãƒˆA" sub="Â¥260,000/æœˆ" color="blue" />
    </div>
    {/* æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-700 mb-2">ğŸ” æ˜ç´°æ¤œç´¢</p>
      <div className="grid grid-cols-4 gap-3">
        <div><label className="text-xs text-slate-500">å ±å‘Šæ›¸ID</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="RPT-" /></div>
        <div><label className="text-xs text-slate-500">ãƒ¬ãƒãƒ¼ãƒˆãƒŠãƒ³ãƒãƒ¼</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="AG001-" /></div>
        <div><label className="text-xs text-slate-500">ç™ºè¡Œæ—¥ï¼ˆé–‹å§‹ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
        <div><label className="text-xs text-slate-500">ç™ºè¡Œæ—¥ï¼ˆçµ‚äº†ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
      </div>
      <div className="flex justify-end mt-2">
        <button onClick={() => toast("å ±é…¬æ˜ç´°ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="text-xs px-4 py-1.5 bg-orange-500 text-white rounded font-semibold hover:bg-orange-600">æ¤œç´¢</button>
      </div>
    </div>
    {/* æœˆæ¬¡å ±é…¬æ¨ç§» */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
      <p className="text-xs font-bold text-slate-700 mb-2">æœˆæ¬¡å ±é…¬æ¨ç§»</p>
      <div className="flex items-end gap-1 h-24 px-1">
        {[{ m: "9æœˆ", v: 1750 }, { m: "10æœˆ", v: 1820 }, { m: "11æœˆ", v: 1900 }, { m: "12æœˆ", v: 1925 }, { m: "1æœˆ", v: 2105 }, { m: "2æœˆ", v: 2260 }].map((d, i) => (
          <div key={i} className="flex-1 flex flex-col items-center">
            <p className="text-xs font-bold text-emerald-700 mb-0.5">Â¥{(d.v / 10).toFixed(0)}ä¸‡</p>
            <div className="w-full bg-emerald-400 rounded-t" style={{ height: `${(d.v / 2500) * 100}%` }} />
            <p className="text-xs text-slate-400 mt-1">{d.m}</p>
          </div>
        ))}
      </div>
    </div>
    {/* æ”¯æ‰•æ˜ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆAQUAGATESæº–æ‹ : å ±å‘Šæ›¸ID/ãƒ¬ãƒãƒ¼ãƒˆãƒŠãƒ³ãƒãƒ¼/ç™ºè¡Œæ—¥/ãŠæ”¯æ‰•é‡‘é¡/ãŠæ”¯æ‰•äºˆå®šæ—¥/å†…è¨³ï¼‰ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "å ±å‘Šæ›¸ID", w: "w-24" }, { label: "ãƒ¬ãƒãƒ¼ãƒˆNo.", w: "w-32" }, { label: "å¯¾è±¡æœˆ", w: "w-20" }, { label: "ç™ºè¡Œæ—¥", w: "w-20" }, { label: "ãŠæ”¯æ‰•é‡‘é¡", w: "w-24" }, { label: "ãŠæ”¯æ‰•äºˆå®šæ—¥", w: "w-24" }, { label: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", w: "w-16" }, { label: "å†…è¨³", w: "w-12" }]}>
      {reports.map((r, i) => (
        <tr key={i} className="border-b hover:bg-orange-50">
          <td className="px-3 py-2 whitespace-nowrap text-xs w-24 font-mono text-blue-600">{r.reportId}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-32 font-mono text-slate-500">{r.reportNo}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20 font-bold">{r.month}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20 text-slate-400">{r.issueDate}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-24 font-bold text-emerald-700">{r.commission}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-24 text-slate-500">{r.payDate}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-16"><Badge text={r.label} color={r.status === "paid" ? "green" : "yellow"} /></td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-12"><button onClick={() => setSelectedReport(r)} className="text-blue-600 hover:underline font-bold">å†…è¨³</button></td>
        </tr>
      ))}
      </TableHeader>
    </div>

    {/* æ”¯æ‰•æ˜ç´°è©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedReport && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedReport(null)} />
        <div className="w-[480px] bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b bg-orange-50 flex justify-between items-center">
            <div><h3 className="text-sm font-bold text-slate-800">å ±é…¬æ˜ç´° å†…è¨³</h3><p className="text-xs text-slate-400 font-mono">{selectedReport.reportNo}</p></div>
            <button onClick={() => setSelectedReport(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div>
              <p className="text-xs text-slate-400 mb-1">æ˜ç´°æƒ…å ±</p>
              <div className="space-y-1.5">
                {[["å ±å‘Šæ›¸ID", selectedReport.reportId], ["ãƒ¬ãƒãƒ¼ãƒˆNo.", selectedReport.reportNo], ["å¯¾è±¡æœˆ", selectedReport.month], ["ç™ºè¡Œæ—¥", selectedReport.issueDate], ["å¯¾è±¡åŠ ç›Ÿåº—", selectedReport.merchants], ["å–å¼•ç·é¡", selectedReport.volume], ["ãŠæ”¯æ‰•é‡‘é¡", selectedReport.commission], ["ãŠæ”¯æ‰•äºˆå®šæ—¥", selectedReport.payDate], ["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", selectedReport.label]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-28 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-2">åŠ ç›Ÿåº—åˆ¥å†…è¨³</p>
              <div className="bg-white rounded border overflow-x-auto">
                <table className="w-full text-xs">
                  <thead><tr className="bg-slate-50 text-slate-500">
                    <th className="px-3 py-1.5 text-left font-semibold">åŠ ç›Ÿåº—</th>
                    <th className="px-3 py-1.5 text-left font-semibold">ã‚µã‚¤ãƒˆID</th>
                    <th className="px-3 py-1.5 text-right font-semibold">å–å¼•é¡</th>
                    <th className="px-3 py-1.5 text-right font-semibold">æ–™ç‡</th>
                    <th className="px-3 py-1.5 text-right font-semibold">ä»¶æ•°</th>
                    <th className="px-3 py-1.5 text-right font-semibold">å ±é…¬</th>
                  </tr></thead>
                  <tbody>
                    {selectedReport.breakdown.map((b, i) => (
                      <tr key={i} className="border-b last:border-0">
                        <td className="px-3 py-1.5 font-bold">{b.name}</td>
                        <td className="px-3 py-1.5 text-slate-400 font-mono">{b.siteId}</td>
                        <td className="px-3 py-1.5 text-right">{b.vol}</td>
                        <td className="px-3 py-1.5 text-right text-slate-500">{b.fee}</td>
                        <td className="px-3 py-1.5 text-right text-slate-500">{b.txn}ä»¶</td>
                        <td className="px-3 py-1.5 text-right font-bold text-emerald-700">{b.com}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-1">å ±é…¬è¨ˆç®—ã‚µãƒãƒªãƒ¼</p>
              <div className="bg-slate-50 rounded p-3 text-xs space-y-1">
                <div className="flex justify-between"><span>å–å¼•ç·é¡</span><span className="font-bold">{selectedReport.volume}</span></div>
                <div className="flex justify-between"><span>å¯¾è±¡åŠ ç›Ÿåº—æ•°</span><span className="font-bold">{selectedReport.merchants}</span></div>
                <div className="flex justify-between border-t pt-1 mt-1"><span className="font-bold">ãŠæ”¯æ‰•é‡‘é¡</span><span className="font-bold text-emerald-700">{selectedReport.commission}</span></div>
                <div className="flex justify-between"><span>ãŠæ”¯æ‰•äºˆå®šæ—¥</span><span className="font-bold">{selectedReport.payDate}</span></div>
              </div>
            </div>
            <div className="flex gap-2">
              <button onClick={() => toast("å ±é…¬æ˜ç´°PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="flex-1 py-1.5 bg-slate-100 text-slate-600 rounded text-xs border font-bold">ğŸ“„ PDFå‡ºåŠ›</button>
              <button onClick={() => toast("å ±é…¬æ˜ç´°CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="flex-1 py-1.5 bg-slate-100 text-slate-600 rounded text-xs border font-bold">ğŸ“¥ CSVå‡ºåŠ›</button>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ D04: ç”³è¾¼ç´¹ä»‹ â”€â”€â”€
const AgentReferral = () => {
  const toast = useToast();
  const [showConfirm, setShowConfirm] = useState(false);
  const [selectedReferral, setSelectedReferral] = useState(null);
  const referralHistory = [
    { name: "å¤ªéƒåˆåŒä¼šç¤¾", date: "2026-02-10", status: "å¯©æŸ»ä¸­", sc: "yellow", corp: "å¤ªéƒåˆåŒä¼šç¤¾", rep: "å¤ªéƒä¸€éƒ", email: "taro@example.com", tel: "03-1111-2222", url: "https://taro-shop.jp", sales: "Â¥5,000,000", industry: "ECç‰©è²©", steps: [
      { label: "ç´¹ä»‹ç”³è«‹", date: "2026-02-10", done: true },
      { label: "é‹å–¶ç¢ºèª", date: "2026-02-11", done: true },
      { label: "URLé€ä»˜", date: "2026-02-12", done: true },
      { label: "æœ¬ç”³è¾¼", date: "2026-02-13", done: false },
      { label: "å¯©æŸ»", date: "-", done: false },
      { label: "æ‰¿èª", date: "-", done: false }
    ]},
    { name: "DEFã‚µãƒ¼ãƒ“ã‚¹", date: "2026-01-20", status: "æ‰¿èªæ¸ˆ", sc: "green", corp: "DEFã‚µãƒ¼ãƒ“ã‚¹æ ªå¼ä¼šç¤¾", rep: "ä½è—¤èŠ±å­", email: "def@example.com", tel: "03-3333-4444", url: "https://def-service.jp", sales: "Â¥8,000,000", industry: "ã‚µãƒ¼ãƒ“ã‚¹æ¥­", steps: [
      { label: "ç´¹ä»‹ç”³è«‹", date: "2026-01-20", done: true },
      { label: "é‹å–¶ç¢ºèª", date: "2026-01-21", done: true },
      { label: "URLé€ä»˜", date: "2026-01-22", done: true },
      { label: "æœ¬ç”³è¾¼", date: "2026-01-25", done: true },
      { label: "å¯©æŸ»", date: "2026-01-28", done: true },
      { label: "æ‰¿èª", date: "2026-02-01", done: true }
    ]},
    { name: "GHIãƒãƒ¼ã‚±ãƒƒãƒˆ", date: "2025-12-05", status: "å¦èª", sc: "red", corp: "GHIæ ªå¼ä¼šç¤¾", rep: "éˆ´æœ¨å¤ªéƒ", email: "ghi@example.com", tel: "03-5555-6666", url: "https://ghi-market.jp", sales: "Â¥2,000,000", industry: "ãƒ‡ã‚¸ã‚¿ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„", steps: [
      { label: "ç´¹ä»‹ç”³è«‹", date: "2025-12-05", done: true },
      { label: "é‹å–¶ç¢ºèª", date: "2025-12-06", done: true },
      { label: "URLé€ä»˜", date: "2025-12-07", done: true },
      { label: "æœ¬ç”³è¾¼", date: "2025-12-10", done: true },
      { label: "å¯©æŸ»", date: "2025-12-15", done: true },
      { label: "å¦æ±º", date: "2025-12-18", done: true }
    ]}
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex items-center justify-between">
      <h2 className="text-sm font-bold text-slate-800">ç”³è¾¼ç´¹ä»‹</h2>
      <div className="flex items-center gap-2 text-xs text-slate-400">
        <span>ç´¹ä»‹ç·æ•°: <span className="font-bold text-slate-700">12ä»¶</span></span>
        <span>æ‰¿èªç‡: <span className="font-bold text-emerald-600">75%</span></span>
      </div>
    </div>
    <div className="grid grid-cols-3 gap-3">
      <KPICard label="ç´¯è¨ˆç´¹ä»‹æ•°" value="12ä»¶" sub="ä»Šæœˆ2ä»¶" color="orange" />
      <KPICard label="æ‰¿èªæ¸ˆã¿" value="9ä»¶" sub="æ‰¿èªç‡ 75%" color="green" />
      <KPICard label="è¦‹è¾¼ã¿å ±é…¬" value="Â¥180,000/æœˆ" sub="æ‰¿èªå¾Œã®æœˆé¡å ±é…¬" color="blue" />
    </div>
    <div className="grid grid-cols-2 gap-4">
      <div className="bg-white rounded-lg border p-4 space-y-3">
        <p className="text-xs font-bold">æ–°è¦åŠ ç›Ÿåº— ç´¹ä»‹ç”³è«‹</p>
        {["æ³•äººå *", "ä»£è¡¨è€…å *", "æ‹…å½“è€…å *", "æ‹…å½“è€…ãƒ¡ãƒ¼ãƒ« *", "æ‹…å½“è€…é›»è©± *", "ã‚µã‚¤ãƒˆURL *", "æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜ *"].map(f => (
          <div key={f}><label className="text-xs text-slate-500">{f}</label><input className="w-full border rounded px-2 py-1.5 text-xs mt-0.5" /></div>
        ))}
        <div><label className="text-xs text-slate-500">æ¥­ç¨®</label><select className="w-full border rounded px-2 py-1.5 text-xs mt-0.5"><option>é¸æŠã—ã¦ãã ã•ã„</option><option>ECç‰©è²©</option><option>ãƒ‡ã‚¸ã‚¿ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</option><option>ã‚µãƒ¼ãƒ“ã‚¹æ¥­</option></select></div>
        <div><label className="text-xs text-slate-500">å‚™è€ƒ</label><textarea className="w-full border rounded px-2 py-1.5 text-xs mt-0.5 h-12" /></div>
        <button onClick={() => setShowConfirm(true)} className="w-full py-2 bg-orange-500 text-white rounded text-xs font-bold hover:bg-orange-600">ç´¹ä»‹ç”³è«‹ã‚’é€ä¿¡</button>
      </div>
      <div className="space-y-3">
        <p className="text-xs font-bold">ç”³è«‹å±¥æ­´</p>
        <div className="bg-white rounded-lg border border-slate-200 shadow-sm">
          {referralHistory.map((r, i) => (
            <div key={i} onClick={() => setSelectedReferral(r)} className="flex items-center px-4 py-2.5 text-xs border-b whitespace-nowrap cursor-pointer hover:bg-slate-50">
              <div className="flex-1 font-bold">{r.name}</div>
              <div className="w-20 text-slate-400">{r.date}</div>
              <Badge text={r.status} color={r.sc} />
              <span className="ml-2 text-slate-300">â€º</span>
            </div>
          ))}
        </div>
        <div className="bg-blue-50 border border-blue-200 rounded p-3 text-xs text-blue-700">
          <p className="font-bold">ç´¹ä»‹ãƒ•ãƒ­ãƒ¼</p>
          <p className="mt-1">â‘  ç´¹ä»‹ç”³è«‹ â†’ â‘¡ é‹å–¶ç¢ºèª â†’ â‘¢ åŠ ç›Ÿåº—ã«P01 URLã‚’é€ä¿¡ â†’ â‘£ æ­£å¼ç”³è¾¼ â†’ â‘¤ å¯©æŸ» â†’ â‘¥ æ‰¿èªå¾Œè‡ªå‹•ç´ä»˜ã‘</p>
        </div>
        <div className="bg-orange-50 border border-orange-200 rounded p-3 text-xs text-orange-700">
          <p className="font-bold">ğŸ“Š ç´¹ä»‹ã®ãƒã‚¤ãƒ³ãƒˆ</p>
          <p className="mt-1">æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜ãŒé«˜ã„åŠ ç›Ÿåº—ã»ã©å¯©æŸ»ãŒé€šã‚Šã‚„ã™ã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚ã‚µã‚¤ãƒˆURLã¯æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
      </div>
    </div>

    {/* é€ä¿¡ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showConfirm && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowConfirm(false)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[420px] max-h-[80vh] overflow-y-auto">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">ç´¹ä»‹ç”³è«‹ã®ç¢ºèª</p>
            <button onClick={() => setShowConfirm(false)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-3">
            <div className="bg-amber-50 border border-amber-200 rounded p-3 text-xs text-amber-700">
              <p className="font-bold">âš ï¸ é€ä¿¡å‰ã«ã”ç¢ºèªãã ã•ã„</p>
              <p className="mt-1">ç´¹ä»‹ç”³è«‹ã¯é€ä¿¡å¾Œã®å–ã‚Šæ¶ˆã—ã¯ã§ãã¾ã›ã‚“ã€‚å…¥åŠ›å†…å®¹ã‚’å†åº¦ã”ç¢ºèªãã ã•ã„ã€‚</p>
            </div>
            <div className="space-y-2">
              <p className="text-xs font-bold text-slate-700">å…¥åŠ›å†…å®¹ã‚µãƒãƒªãƒ¼</p>
              {[["æ³•äººå", "ï¼ˆå…¥åŠ›å€¤ï¼‰"], ["ä»£è¡¨è€…å", "ï¼ˆå…¥åŠ›å€¤ï¼‰"], ["æ‹…å½“è€…ãƒ¡ãƒ¼ãƒ«", "ï¼ˆå…¥åŠ›å€¤ï¼‰"], ["ã‚µã‚¤ãƒˆURL", "ï¼ˆå…¥åŠ›å€¤ï¼‰"], ["æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜", "ï¼ˆå…¥åŠ›å€¤ï¼‰"], ["æ¥­ç¨®", "ï¼ˆé¸æŠå€¤ï¼‰"]].map(([l, v], i) => (
                <div key={i} className="flex text-xs border-b pb-1"><span className="w-28 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
              ))}
            </div>
            <div className="flex gap-2">
              <button onClick={() => setShowConfirm(false)} className="flex-1 py-2 border rounded text-xs">æˆ»ã£ã¦ä¿®æ­£</button>
              <button onClick={() => setShowConfirm(false)} className="flex-1 py-2 bg-orange-500 text-white rounded text-xs font-bold hover:bg-orange-600">ç”³è«‹ã‚’é€ä¿¡</button>
            </div>
          </div>
        </div>
      </div>
    )}

    {/* ç´¹ä»‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedReferral && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedReferral(null)} />
        <div className="w-96 bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b flex items-center justify-between sticky top-0 bg-white z-10">
            <p className="text-sm font-bold">{selectedReferral.name}</p>
            <button onClick={() => setSelectedReferral(null)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            {/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */}
            <div className="flex items-center gap-2">
              <Badge text={selectedReferral.status} color={selectedReferral.sc} />
              <span className="text-xs text-slate-400">ç”³è«‹æ—¥: {selectedReferral.date}</span>
            </div>

            {/* åŸºæœ¬æƒ…å ± */}
            <div>
              <p className="text-xs font-bold text-slate-700 mb-2">åŸºæœ¬æƒ…å ±</p>
              <div className="space-y-1.5">
                {[["æ³•äººå", selectedReferral.corp], ["ä»£è¡¨è€…", selectedReferral.rep], ["ãƒ¡ãƒ¼ãƒ«", selectedReferral.email], ["é›»è©±", selectedReferral.tel], ["ã‚µã‚¤ãƒˆURL", selectedReferral.url], ["æœˆé–“äºˆå®šæ±ºæ¸ˆé«˜", selectedReferral.sales], ["æ¥­ç¨®", selectedReferral.industry]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-24 text-slate-400">{l}</span><span className="font-bold text-slate-700">{v}</span></div>
                ))}
              </div>
            </div>

            {/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ */}
            <div>
              <p className="text-xs font-bold text-slate-700 mb-3">å¯©æŸ»ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</p>
              <div className="space-y-0">
                {selectedReferral.steps.map((step, i) => (
                  <div key={i} className="flex items-start gap-3">
                    <div className="flex flex-col items-center">
                      <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${step.done ? (step.label === "å¦æ±º" ? "bg-red-500 text-white" : "bg-emerald-500 text-white") : "bg-slate-200 text-slate-400"}`}>{step.done ? "âœ“" : i + 1}</div>
                      {i < selectedReferral.steps.length - 1 && <div className={`w-0.5 h-6 ${step.done ? "bg-emerald-300" : "bg-slate-200"}`} />}
                    </div>
                    <div className="pb-4">
                      <p className={`text-xs font-bold ${step.done ? "text-slate-700" : "text-slate-400"}`}>{step.label}</p>
                      <p className="text-xs text-slate-400">{step.date}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */}
            {selectedReferral.status === "å¯©æŸ»ä¸­" && (
              <div className="bg-amber-50 border border-amber-200 rounded p-3 text-xs text-amber-700">
                <p className="font-bold">ğŸ“‹ ç¾åœ¨å¯©æŸ»ä¸­</p>
                <p className="mt-1">é‹å–¶ã«ã‚ˆã‚‹å¯©æŸ»ãŒé€²è¡Œä¸­ã§ã™ã€‚çµæœã¯é€šå¸¸1ã€œ3å–¶æ¥­æ—¥ã§é€šçŸ¥ã•ã‚Œã¾ã™ã€‚</p>
              </div>
            )}
          </div>
        </div>
      </div>
    )}
  </div>
  );
};

// â”€â”€â”€ D05: ä»£ç†åº—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šï¼ˆAQUAGATESæº–æ‹ : ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ã‚¿ãƒ–è¿½åŠ ï¼‰ â”€â”€â”€
const AgentAccountSettings = () => {
  const toast = useToast();
  const [d05Tab, setD05Tab] = useState("account");
  const [showInviteD05, setShowInviteD05] = useState(false);
  const [showPasswordModal, setShowPasswordModal] = useState(false);
  const [showMfaModal, setShowMfaModal] = useState(false);
  const [selectedStaff, setSelectedStaff] = useState(null);
  const [pwStrength, setPwStrength] = useState(0);
  const [d05StaffTab, setD05StaffTab] = useState("search");
  const staffList = [
    { staffId: "STF-001", loginUser: "tanaka_t", name: "ç”°ä¸­å¤ªéƒ", role: "admin", state: "æœ‰åŠ¹", stateColor: "green", last: "2026-02-13", lastPwUpdate: "2026-01-15", email: "tanaka@digital-partners.jp", created: "2024-06-01", updated: "2026-02-13", mfa: true, dlPerm: true, editPerm: true, logs: [{ action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-13 09:15" }, { action: "ç´¹ä»‹ç”³è«‹é€ä¿¡", time: "2026-02-12 16:00" }] },
    { staffId: "STF-002", loginUser: "tanaka_j", name: "ç”°ä¸­æ¬¡éƒ", role: "viewer", state: "æœ‰åŠ¹", stateColor: "green", last: "2026-02-10", lastPwUpdate: "2025-12-01", email: "jiro@digital-partners.jp", created: "2025-03-15", updated: "2026-02-10", mfa: false, dlPerm: false, editPerm: false, logs: [{ action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2026-02-10 10:30" }, { action: "ãƒ¬ãƒãƒ¼ãƒˆé–²è¦§", time: "2026-02-10 10:35" }] },
    { staffId: "STF-003", loginUser: "suzuki_h", name: "éˆ´æœ¨èŠ±å­", role: "viewer", state: "ç„¡åŠ¹", stateColor: "red", last: "2025-11-20", lastPwUpdate: "2025-09-01", email: "suzuki@digital-partners.jp", created: "2025-01-10", updated: "2025-12-01", mfa: false, dlPerm: true, editPerm: false, logs: [{ action: "ãƒ­ã‚°ã‚¤ãƒ³", time: "2025-11-20 14:00" }] },
  ];
  return (
  <div className="p-5 space-y-4">
    <div className="flex items-center justify-between">
      <h2 className="text-sm font-bold text-slate-800">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</h2>
    </div>
    {/* ã‚¿ãƒ– */}
    <div className="flex gap-1 border-b">
      {[["account", "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±"], ["staff", "ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†"]].map(([k, l]) => (
        <button key={k} onClick={() => setD05Tab(k)} className={`px-4 py-2 text-xs font-semibold border-b-2 ${d05Tab === k ? "border-orange-500 text-orange-700" : "border-transparent text-slate-400 hover:text-slate-600"}`}>{l}</button>
      ))}
    </div>

    {d05Tab === "account" && (<>
    <div className="grid grid-cols-3 gap-4">
      <div className="bg-white rounded-lg border p-4 space-y-2">
        <p className="text-xs font-bold">ä»£ç†åº—æƒ…å ±ï¼ˆé–²è¦§ã®ã¿ï¼‰</p>
        {[["ä»£ç†åº—ã‚³ãƒ¼ãƒ‰", "AG-001"], ["ä»£ç†åº—å", "ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚º"], ["ä»£è¡¨è€…", "ç”°ä¸­å¤ªéƒ"], ["ãƒ¡ãƒ¼ãƒ«", "info@digital-partners.jp"], ["é›»è©±", "03-1234-5678"], ["å¥‘ç´„æ—¥", "2024-06-01"], ["å¥‘ç´„ç¨®åˆ¥", "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰"]].map(([l, v], i) => (
          <div key={i} className="flex text-xs"><span className="w-24 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
        ))}
        <p className="text-xs text-slate-400 mt-2">â€» å¤‰æ›´ã¯é‹å–¶ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„</p>
      </div>
      <div className="bg-white rounded-lg border p-4 space-y-2">
        <div className="flex items-center justify-between">
          <p className="text-xs font-bold">ã‚¹ã‚¿ãƒƒãƒ•æ¦‚è¦</p>
          <span className="text-xs text-slate-400">{staffList.length}å</span>
        </div>
        {staffList.slice(0, 3).map((s, i) => (
          <div key={i} className="flex items-center text-xs border-b py-1.5">
            <span className="flex-1 font-bold">{s.name}</span>
            <Badge text={s.role} color={s.role === "admin" ? "blue" : "gray"} />
            <Badge text={s.state} color={s.stateColor} />
          </div>
        ))}
        <button onClick={() => setD05Tab("staff")} className="w-full py-1.5 bg-orange-50 text-orange-600 rounded text-xs border border-orange-200 mt-2">ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ã‚’é–‹ã â†’</button>
      </div>
      <div className="bg-white rounded-lg border p-4 space-y-2">
        <p className="text-xs font-bold">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</p>
        <button onClick={() => setShowPasswordModal(true)} className="w-full py-1.5 bg-slate-50 rounded text-xs border hover:bg-slate-100">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</button>
        <button onClick={() => setShowMfaModal(true)} className="w-full py-1.5 bg-slate-50 rounded text-xs border hover:bg-slate-100">ğŸ“± MFAè¨­å®š</button>
        <div className="mt-2"><p className="text-xs text-slate-400 mb-1">æœ€è¿‘ã®ãƒ­ã‚°ã‚¤ãƒ³</p>
          {[["2026-02-13 09:15", "103.xx.xx.xx", "Chrome"], ["2026-02-12 14:30", "103.xx.xx.xx", "Chrome"], ["2026-02-11 10:00", "192.xx.xx.xx", "Safari"]].map(([d, ip, br], i) => (
            <div key={i} className="flex text-xs text-slate-500 py-0.5"><span className="flex-1">{d}</span><span className="w-14">{br}</span><span>{ip}</span></div>
          ))}
        </div>
      </div>
    </div>
    </>)}

    {d05Tab === "staff" && (<>
    {/* AQUAGATESæº–æ‹ : ã‚¹ã‚¿ãƒƒãƒ•æ¤œç´¢ãƒ»ç™»éŒ² */}
    <div className="flex gap-1 border-b">
      {[["search", "ã‚¹ã‚¿ãƒƒãƒ•æ¤œç´¢"], ["register", "ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²"]].map(([k, l]) => (
        <button key={k} onClick={() => setD05StaffTab(k)} className={`px-3 py-1.5 text-xs font-semibold border-b-2 ${d05StaffTab === k ? "border-orange-400 text-orange-600" : "border-transparent text-slate-400 hover:text-slate-600"}`}>{l}</button>
      ))}
    </div>

    {d05StaffTab === "search" && (<>
    {/* ã‚¹ã‚¿ãƒƒãƒ•æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆAQUAGATES D04æº–æ‹ ï¼‰ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-4">
      <p className="text-xs font-bold text-slate-700 mb-2">ğŸ” æ¤œç´¢æ¡ä»¶</p>
      <div className="grid grid-cols-5 gap-3">
        <div><label className="text-xs text-slate-500">ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="tanaka_t" /></div>
        <div><label className="text-xs text-slate-500">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="@digital-partners.jp" /></div>
        <div><label className="text-xs text-slate-500">æ°å</label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ç”°ä¸­" /></div>
        <div><label className="text-xs text-slate-500">çŠ¶æ…‹</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ã¦</option><option>æœ‰åŠ¹</option><option>ç„¡åŠ¹</option></select></div>
        <div><label className="text-xs text-slate-500">æ¨©é™è¨­å®š</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ã¦</option><option>ç®¡ç†è€…</option><option>é–²è¦§ã®ã¿</option></select></div>
      </div>
      <div className="flex justify-end mt-2 gap-2">
        <button onClick={() => toast("æ¤œç´¢æ¡ä»¶ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ", "info")} className="text-xs px-3 py-1.5 border rounded text-slate-500 hover:bg-slate-50">ãƒªã‚»ãƒƒãƒˆ</button>
        <button onClick={() => toast("ã‚¹ã‚¿ãƒƒãƒ•ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "info")} className="text-xs px-4 py-1.5 bg-orange-500 text-white rounded font-semibold hover:bg-orange-600">æ¤œç´¢</button>
      </div>
    </div>
    {/* ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆAQUAGATES D04æº–æ‹ : ã‚¹ã‚¿ãƒƒãƒ•ID/ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å/æ°å/ãƒ¡ãƒ¼ãƒ«/çŠ¶æ…‹/æ¨©é™è¨­å®š/æœ€çµ‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ›´æ–°æ—¥æ™‚/ç™»éŒ²æ—¥æ™‚/æ›´æ–°æ—¥æ™‚ï¼‰ */}
    <div className="flex items-center justify-between">
      <p className="text-xs text-slate-500">æ¤œç´¢çµæœ: <span className="font-bold text-slate-800">{staffList.length}ä»¶</span></p>
      <div className="flex gap-1">
        <button onClick={() => toast("ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ", "success")} className="text-xs bg-slate-100 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSVå‡ºåŠ›</button>
        <button onClick={() => setShowInviteD05(true)} className="text-xs bg-orange-500 text-white px-3 py-1 rounded font-semibold hover:bg-orange-600">+ æ–°è¦ç™»éŒ²</button>
      </div>
    </div>
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
      <TableHeader cols={[{ label: "ã‚¹ã‚¿ãƒƒãƒ•ID", w: "w-20" }, { label: "ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å", w: "w-28" }, { label: "æ°å", w: "w-20" }, { label: "ãƒ¡ãƒ¼ãƒ«", w: "w-36" }, { label: "çŠ¶æ…‹", w: "w-12" }, { label: "æ¨©é™", w: "w-14" }, { label: "æœ€çµ‚PWæ›´æ–°", w: "w-24" }, { label: "ç™»éŒ²æ—¥æ™‚", w: "w-20" }, { label: "æ›´æ–°æ—¥æ™‚", w: "w-20" }]}>
      {staffList.map((s, i) => (
        <tr key={i} onClick={() => setSelectedStaff(s)} className="border-b hover:bg-orange-50 cursor-pointer">
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20 font-mono text-blue-600">{s.staffId}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-28 font-mono">{s.loginUser}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20 font-bold">{s.name}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-36 text-slate-500">{s.email}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-12"><Badge text={s.state} color={s.stateColor} /></td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-14"><Badge text={s.role === "admin" ? "ç®¡ç†è€…" : "é–²è¦§"} color={s.role === "admin" ? "blue" : "gray"} /></td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-24 text-slate-400">{s.lastPwUpdate}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20 text-slate-400">{s.created}</td>
          <td className="px-3 py-2 whitespace-nowrap text-xs w-20 text-slate-400">{s.updated}</td>
        </tr>
      ))}
      </TableHeader>
    </div>
    </>)}

    {d05StaffTab === "register" && (<>
    {/* ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆAQUAGATES D05æº–æ‹ : åŸºæœ¬è¨­å®š+å€‹åˆ¥æ¨©é™è¨­å®šï¼‰ */}
    <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-5 space-y-5">
      <div>
        <p className="text-xs font-bold text-slate-700 mb-3">åŸºæœ¬è¨­å®š</p>
        <div className="grid grid-cols-2 gap-4">
          <div><label className="text-xs font-semibold text-slate-600">ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="ä¾‹: yamada_h" /></div>
          <div><label className="text-xs font-semibold text-slate-600">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="staff@digital-partners.jp" /></div>
          <div><label className="text-xs font-semibold text-slate-600">æ°å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="å±±ç”° èŠ±å­" /></div>
          <div><label className="text-xs font-semibold text-slate-600">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ <span className="text-rose-500">*</span></label><input type="password" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="8æ–‡å­—ä»¥ä¸Š" /></div>
          <div><label className="text-xs font-semibold text-slate-600">æ¨©é™è¨­å®š <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>é–²è¦§ã®ã¿</option><option>ç®¡ç†è€…</option></select></div>
          <div><label className="text-xs font-semibold text-slate-600">çŠ¶æ…‹</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>æœ‰åŠ¹</option><option>ç„¡åŠ¹</option></select></div>
        </div>
      </div>
      <div className="border-t pt-4">
        <p className="text-xs font-bold text-slate-700 mb-3">å€‹åˆ¥æ¨©é™è¨­å®š</p>
        <div className="space-y-3">
          <div className="flex items-center justify-between bg-slate-50 rounded p-3">
            <div>
              <p className="text-xs font-bold text-slate-700">ãƒ‡ãƒ¼ã‚¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
              <p className="text-xs text-slate-400 mt-0.5">CSVå‡ºåŠ›ãƒ»ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç­‰ã®ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›æ©Ÿèƒ½</p>
            </div>
            <div className="flex gap-2">
              <label className="flex items-center gap-1 text-xs"><input type="radio" name="dlPerm" defaultChecked className="accent-orange-500" /><span className="font-bold text-emerald-600">è¨±å¯</span></label>
              <label className="flex items-center gap-1 text-xs"><input type="radio" name="dlPerm" className="accent-orange-500" /><span className="font-bold text-red-500">ä¸å¯</span></label>
            </div>
          </div>
          <div className="flex items-center justify-between bg-slate-50 rounded p-3">
            <div>
              <p className="text-xs font-bold text-slate-700">ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²ãƒ»ç·¨é›†</p>
              <p className="text-xs text-slate-400 mt-0.5">ä»–ã‚¹ã‚¿ãƒƒãƒ•ã®æ–°è¦ç™»éŒ²ãƒ»æƒ…å ±ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½</p>
            </div>
            <div className="flex gap-2">
              <label className="flex items-center gap-1 text-xs"><input type="radio" name="editPerm" className="accent-orange-500" /><span className="font-bold text-emerald-600">è¨±å¯</span></label>
              <label className="flex items-center gap-1 text-xs"><input type="radio" name="editPerm" defaultChecked className="accent-orange-500" /><span className="font-bold text-red-500">ä¸å¯</span></label>
            </div>
          </div>
        </div>
      </div>
      <div className="flex justify-end gap-2">
        <button onClick={() => setShowInviteD05(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button onClick={() => { setShowInviteD05(false); toast("ã‚¹ã‚¿ãƒƒãƒ•ã‚’ç™»éŒ²ã—ã¾ã—ãŸ", "success"); }} className="px-6 py-2 text-xs bg-orange-500 text-white rounded font-semibold hover:bg-orange-600">ã‚¹ã‚¿ãƒƒãƒ•ã‚’ç™»éŒ²</button>
      </div>
    </div>
    </>)}
    </>)}

    {/* ã‚¹ã‚¿ãƒƒãƒ•è©³ç´°ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ãƒãƒ« */}
    {selectedStaff && (
      <div className="fixed inset-0 z-50 flex">
        <div className="flex-1 bg-black bg-opacity-30" onClick={() => setSelectedStaff(null)} />
        <div className="w-[480px] bg-white shadow-xl border-l overflow-y-auto">
          <div className="p-4 border-b bg-orange-50 flex justify-between items-center">
            <div>
              <h3 className="text-sm font-bold text-slate-800">{selectedStaff.name}</h3>
              <p className="text-xs text-slate-400 font-mono">{selectedStaff.staffId} / {selectedStaff.loginUser}</p>
            </div>
            <button onClick={() => setSelectedStaff(null)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className="flex items-center gap-3 mb-2">
              <div className="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-xl">ğŸ‘¤</div>
              <div>
                <p className="text-sm font-bold">{selectedStaff.name}</p>
                <p className="text-xs text-slate-400">{selectedStaff.email}</p>
                <div className="flex gap-1 mt-1"><Badge text={selectedStaff.state} color={selectedStaff.stateColor} /><Badge text={selectedStaff.role === "admin" ? "ç®¡ç†è€…" : "é–²è¦§ã®ã¿"} color={selectedStaff.role === "admin" ? "blue" : "gray"} /></div>
              </div>
            </div>
            <div>
              <p className="text-xs text-slate-400 mb-1">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</p>
              <div className="space-y-1.5">
                {[["ã‚¹ã‚¿ãƒƒãƒ•ID", selectedStaff.staffId], ["ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å", selectedStaff.loginUser], ["ãƒ¡ãƒ¼ãƒ«", selectedStaff.email], ["MFA", selectedStaff.mfa ? "æœ‰åŠ¹" : "ç„¡åŠ¹"], ["æœ€çµ‚PWæ›´æ–°", selectedStaff.lastPwUpdate], ["æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³", selectedStaff.last], ["ç™»éŒ²æ—¥æ™‚", selectedStaff.created], ["æ›´æ–°æ—¥æ™‚", selectedStaff.updated]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs"><span className="w-32 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
                ))}
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs text-slate-400 mb-2">å€‹åˆ¥æ¨©é™</p>
              <div className="grid grid-cols-2 gap-2">
                <div className={`rounded p-2 text-center ${selectedStaff.dlPerm ? "bg-emerald-50" : "bg-red-50"}`}><p className="text-xs text-slate-400">ãƒ‡ãƒ¼ã‚¿DL</p><p className="text-xs font-bold">{selectedStaff.dlPerm ? "âœ… è¨±å¯" : "âŒ ä¸å¯"}</p></div>
                <div className={`rounded p-2 text-center ${selectedStaff.editPerm ? "bg-emerald-50" : "bg-red-50"}`}><p className="text-xs text-slate-400">ã‚¹ã‚¿ãƒƒãƒ•ç·¨é›†</p><p className="text-xs font-bold">{selectedStaff.editPerm ? "âœ… è¨±å¯" : "âŒ ä¸å¯"}</p></div>
              </div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs font-bold text-slate-700 mb-2">æœ€è¿‘ã®æ“ä½œ</p>
              {selectedStaff.logs.map((log, i) => (
                <div key={i} className="flex text-xs py-1 border-b last:border-0"><span className="flex-1">{log.action}</span><span className="text-slate-400">{log.time}</span></div>
              ))}
            </div>
            <div className="flex gap-2 mt-3">
              <button onClick={() => toast(`${selectedStaff.name}ã‚’ç·¨é›†ä¸­`, "info")} className="text-xs px-3 py-1.5 bg-blue-50 text-blue-600 rounded border border-blue-200">ç·¨é›†</button>
              <button onClick={() => toast(`${selectedStaff.name}ã‚’${selectedStaff.state === "æœ‰åŠ¹" ? "ç„¡åŠ¹åŒ–" : "æœ‰åŠ¹åŒ–"}ã—ã¾ã—ãŸ`, "warning")} className="text-xs px-3 py-1.5 bg-amber-50 text-amber-600 rounded border border-amber-200">{selectedStaff.state === "æœ‰åŠ¹" ? "ç„¡åŠ¹åŒ–" : "æœ‰åŠ¹åŒ–"}</button>
              {selectedStaff.role !== "admin" && <button onClick={() => { toast(`${selectedStaff.name}ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, "error"); setSelectedStaff(null); }} className="text-xs px-3 py-1.5 bg-red-50 text-red-600 rounded border border-red-200">å‰Šé™¤</button>}
            </div>
          </div>
        </div>
      </div>
    )}

    {/* â”€â”€ Modal: ã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾… â”€â”€ */}
    {showInviteD05 && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowInviteD05(false)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[500px]">
          <div className="p-4 border-b bg-orange-50 rounded-t-xl flex justify-between items-center">
            <h3 className="text-sm font-bold text-slate-800">ğŸ“§ ã‚¹ã‚¿ãƒƒãƒ•ã‚’æ‹›å¾…</h3>
            <button onClick={() => setShowInviteD05(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
          </div>
          <div className="p-5 space-y-4">
            <div className="grid grid-cols-2 gap-3">
              <div><label className="text-xs font-semibold text-slate-600">ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="yamada_h" /></div>
              <div><label className="text-xs font-semibold text-slate-600">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="staff@agency.jp" /></div>
              <div><label className="text-xs font-semibold text-slate-600">æ°å <span className="text-rose-500">*</span></label><input className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" placeholder="å±±ç”° èŠ±å­" /></div>
              <div><label className="text-xs font-semibold text-slate-600">æ¨©é™ <span className="text-rose-500">*</span></label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>é–²è¦§ã®ã¿</option><option>ç®¡ç†è€…</option></select></div>
            </div>
            <div className="border-t pt-3">
              <p className="text-xs font-bold text-slate-700 mb-2">å€‹åˆ¥æ¨©é™</p>
              <div className="space-y-2">
                <div className="flex items-center justify-between bg-slate-50 rounded p-2">
                  <span className="text-xs font-bold">ãƒ‡ãƒ¼ã‚¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
                  <div className="flex gap-2"><label className="flex items-center gap-1 text-xs"><input type="radio" name="invDl" defaultChecked /><span>è¨±å¯</span></label><label className="flex items-center gap-1 text-xs"><input type="radio" name="invDl" /><span>ä¸å¯</span></label></div>
                </div>
                <div className="flex items-center justify-between bg-slate-50 rounded p-2">
                  <span className="text-xs font-bold">ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²ãƒ»ç·¨é›†</span>
                  <div className="flex gap-2"><label className="flex items-center gap-1 text-xs"><input type="radio" name="invEdit" /><span>è¨±å¯</span></label><label className="flex items-center gap-1 text-xs"><input type="radio" name="invEdit" defaultChecked /><span>ä¸å¯</span></label></div>
                </div>
              </div>
            </div>
          </div>
          <div className="p-4 border-t flex gap-2 justify-end">
            <button onClick={() => setShowInviteD05(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button onClick={() => setShowInviteD05(false)} className="px-4 py-2 text-xs bg-orange-500 text-white rounded font-semibold hover:bg-orange-600">ã‚¹ã‚¿ãƒƒãƒ•ã‚’ç™»éŒ²</button>
          </div>
        </div>
      </div>
    )}

    {/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showPasswordModal && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowPasswordModal(false)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[400px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</p>
            <button onClick={() => setShowPasswordModal(false)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-3">
            <div><label className="text-xs text-slate-500">ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label><input type="password" className="w-full border rounded px-2 py-1.5 text-xs mt-0.5" /></div>
            <div><label className="text-xs text-slate-500">æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label><input type="password" onChange={e => setPwStrength(Math.min(4, Math.floor(e.target.value.length / 3)))} className="w-full border rounded px-2 py-1.5 text-xs mt-0.5" />
              <div className="flex gap-1 mt-1">
                {[0,1,2,3].map(i => (
                  <div key={i} className={`flex-1 h-1 rounded ${i < pwStrength ? (pwStrength <= 1 ? "bg-red-400" : pwStrength <= 2 ? "bg-amber-400" : pwStrength <= 3 ? "bg-blue-400" : "bg-emerald-400") : "bg-slate-200"}`} />
                ))}
              </div>
              <p className="text-xs text-slate-400 mt-0.5">{["", "å¼±ã„", "æ™®é€š", "å¼·ã„", "éå¸¸ã«å¼·ã„"][pwStrength]}</p>
            </div>
            <div><label className="text-xs text-slate-500">æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰</label><input type="password" className="w-full border rounded px-2 py-1.5 text-xs mt-0.5" /></div>
            <div className="bg-slate-50 rounded p-2 text-xs text-slate-500">
              <p className="font-bold mb-1">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶:</p>
              <ul className="space-y-0.5 ml-2">
                <li>â€¢ 8æ–‡å­—ä»¥ä¸Š</li><li>â€¢ å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’å«ã‚€</li><li>â€¢ æ•°å­—ã‚’å«ã‚€</li><li>â€¢ è¨˜å·ã‚’å«ã‚€</li>
              </ul>
            </div>
            <div className="flex gap-2">
              <button onClick={() => setShowPasswordModal(false)} className="flex-1 py-2 border rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setShowPasswordModal(false)} className="flex-1 py-2 bg-orange-500 text-white rounded text-xs font-bold hover:bg-orange-600">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´</button>
            </div>
          </div>
        </div>
      </div>
    )}

    {/* MFAè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */}
    {showMfaModal && (
      <div className="fixed inset-0 z-50 flex items-center justify-center">
        <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowMfaModal(false)} />
        <div className="relative bg-white rounded-xl shadow-2xl w-[420px]">
          <div className="p-4 border-b flex items-center justify-between">
            <p className="text-sm font-bold">ğŸ“± äºŒè¦ç´ èªè¨¼ï¼ˆMFAï¼‰è¨­å®š</p>
            <button onClick={() => setShowMfaModal(false)} className="text-slate-400 hover:text-slate-600">âœ•</button>
          </div>
          <div className="p-4 space-y-4">
            <div className="text-center">
              <div className="w-40 h-40 mx-auto bg-slate-100 rounded-lg flex items-center justify-center text-slate-400 border-2 border-dashed">
                <div className="text-center"><p className="text-3xl mb-1">ğŸ“±</p><p className="text-xs">QRã‚³ãƒ¼ãƒ‰</p></div>
              </div>
              <p className="text-xs text-slate-500 mt-2">Google Authenticatorã¾ãŸã¯Authyã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„</p>
            </div>
            <div>
              <label className="text-xs text-slate-500">æ‰‹å‹•å…¥åŠ›ã‚­ãƒ¼:</label>
              <div className="flex items-center gap-1 mt-1">
                <p className="text-xs font-mono bg-slate-50 rounded p-1.5 flex-1 tracking-wider">JBSWY3DPEHPK3PXP</p>
                <button className="text-xs text-blue-600 px-2">ğŸ“‹</button>
              </div>
            </div>
            <div>
              <label className="text-xs text-slate-500">èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦æœ‰åŠ¹åŒ–:</label>
              <input className="w-full border rounded px-2 py-1.5 text-xs mt-0.5 text-center tracking-widest font-mono" placeholder="000000" maxLength={6} />
            </div>
            <div className="bg-amber-50 border border-amber-200 rounded p-3 text-xs text-amber-700">
              <p className="font-bold">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚³ãƒ¼ãƒ‰</p>
              <p className="mt-1">MFAè¨­å®šå¾Œã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚³ãƒ¼ãƒ‰ãŒç™ºè¡Œã•ã‚Œã¾ã™ã€‚å®‰å…¨ãªå ´æ‰€ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒã‚¤ã‚¹ç´›å¤±æ™‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚</p>
            </div>
            <div className="flex gap-2">
              <button onClick={() => setShowMfaModal(false)} className="flex-1 py-2 border rounded text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => setShowMfaModal(false)} className="flex-1 py-2 bg-orange-500 text-white rounded text-xs font-bold hover:bg-orange-600">MFAã‚’æœ‰åŠ¹åŒ–</button>
            </div>
          </div>
        </div>
      </div>
    )}
    </div>
  );
};

// â”€â”€â”€ M16: é¡§å®¢ç®¡ç†ï¼ˆé‹å–¶ï¼‰ â”€â”€â”€
const MasterCustomers = () => {
  const toast = useToast();
  const [tab, setTab] = useState("search");
  const [selectedCustomer, setSelectedCustomer] = useState(null);
  const [showM16CsvExport, setShowM16CsvExport] = useState(false);
  const tabs = [{ id: "search", label: "é¡§å®¢æ¤œç´¢" }, { id: "analysis", label: "é¡§å®¢åˆ†æ" }, { id: "cards", label: "ã‚«ãƒ¼ãƒ‰æƒ…å ±ç®¡ç†" }];
  const customers = [
    { id: "CUS-00001", email: "t***@example.com", card: "VISA *4242", merchant: "ABCå•†äº‹", txn: 47, ltv: "Â¥892,600", last: "02/13 14:22", sub: "èª²é‡‘ä¸­", risk: "low", segment: "ãƒ­ã‚¤ãƒ¤ãƒ«", pqId: "PQ-10234", recCount: 2, cardSave: "ä¿å­˜" },
    { id: "CUS-00002", email: "s***@gmail.com", card: "MC *1234", merchant: "XYZç‰©ç”£", txn: 12, ltv: "Â¥156,800", last: "02/12 09:45", sub: "ãªã—", risk: "low", segment: "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼", pqId: "â€”", recCount: 0, cardSave: "éä¿å­˜" },
    { id: "CUS-00003", email: "h***@yahoo.co.jp", card: "JCB *5678", merchant: "ABCå•†äº‹", txn: 3, ltv: "Â¥45,200", last: "02/10 18:30", sub: "åœæ­¢", risk: "medium", segment: "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼", pqId: "PQ-10567", recCount: 1, cardSave: "ä¿å­˜" },
    { id: "CUS-00004", email: "k***@company.jp", card: "VISA *9999", merchant: "DEFã‚µãƒ¼ãƒ“ã‚¹", txn: 1, ltv: "Â¥9,800", last: "02/08 11:00", sub: "ãªã—", risk: "high", segment: "åˆå›", pqId: "â€”", recCount: 0, cardSave: "éä¿å­˜" },
    { id: "CUS-00005", email: "m***@icloud.com", card: "AMEX *3456", merchant: "ABCå•†äº‹", txn: 89, ltv: "Â¥2,345,000", last: "02/13 16:05", sub: "èª²é‡‘ä¸­", risk: "low", segment: "ãƒ­ã‚¤ãƒ¤ãƒ«", pqId: "PQ-10012", recCount: 3, cardSave: "ä¿å­˜" },
  ];
  const riskColors = { low: "green", medium: "yellow", high: "red", blocked: "gray" };
  const segColors = { "ãƒ­ã‚¤ãƒ¤ãƒ«": "purple", "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼": "blue", "åˆå›": "gray" };
  return (
    <div className="p-5 space-y-4">
      <div className="flex items-center justify-between">
        <h2 className="text-sm font-bold text-slate-800">é¡§å®¢ç®¡ç†</h2>
        <button onClick={() => setShowM16CsvExport(true)} className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      </div>
      <div className="flex gap-1">{tabs.map(t => (
        <button key={t.id} onClick={() => { setTab(t.id); setSelectedCustomer(null); }} className={`px-3 py-1.5 text-xs rounded-t border-b-2 ${tab === t.id ? "border-blue-500 text-blue-700 bg-blue-50 font-bold" : "border-transparent text-slate-400"}`}>{t.label}</button>
      ))}</div>

      {tab === "search" && !selectedCustomer && (
        <div className="space-y-3">
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold mb-2">æ¤œç´¢æ¡ä»¶</p>
            <div className="grid grid-cols-4 gap-2">
              <div><label className="text-xs text-slate-400">ãƒ¡ãƒ¼ãƒ« / åå‰</label><input className="w-full border rounded px-2 py-1 text-xs mt-0.5" placeholder="æ¤œç´¢..." /></div>
              <div><label className="text-xs text-slate-400">ã‚«ãƒ¼ãƒ‰ä¸‹4æ¡</label><input className="w-full border rounded px-2 py-1 text-xs mt-0.5" placeholder="4242" /></div>
              <div><label className="text-xs text-slate-400">åŠ ç›Ÿåº—</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨åŠ ç›Ÿåº—</option><option>ABCå•†äº‹</option><option>XYZç‰©ç”£</option></select></div>
              <div><label className="text-xs text-slate-400">ãƒªã‚¹ã‚¯</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨ãƒ¬ãƒ™ãƒ«</option><option>ğŸŸ¢ ä½</option><option>ğŸŸ¡ ä¸­</option><option>ğŸ”´ é«˜</option></select></div>
            </div>
            <div className="grid grid-cols-4 gap-2 mt-2">
              <div><label className="text-xs text-slate-400">ã‚µãƒ–ã‚¹ã‚¯çŠ¶æ…‹</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨ã¦</option><option>èª²é‡‘ä¸­</option><option>åœæ­¢</option><option>ãªã—</option></select></div>
              <div><label className="text-xs text-slate-400">ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨ã¦</option><option>ãƒ­ã‚¤ãƒ¤ãƒ«</option><option>ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</option><option>åˆå›</option></select></div>
              <div><label className="text-xs text-slate-400">LTVç¯„å›²</label><div className="flex gap-1 mt-0.5"><input className="w-full border rounded px-2 py-1 text-xs" placeholder="Â¥0" /><span className="text-xs text-slate-400 mt-1">ã€œ</span><input className="w-full border rounded px-2 py-1 text-xs" placeholder="ä¸Šé™ãªã—" /></div></div>
              <div><label className="text-xs text-slate-400">ã‚«ãƒ¼ãƒ‰ä¿å­˜</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨ã¦</option><option>ä¿å­˜</option><option>éä¿å­˜</option></select></div>
            </div>
            <div className="grid grid-cols-4 gap-2 mt-2">
              <div><label className="text-xs text-slate-400">æœ€çµ‚åˆ©ç”¨æ—¥ï¼ˆFromï¼‰</label><input type="date" className="w-full border rounded px-2 py-1 text-xs mt-0.5" /></div>
              <div><label className="text-xs text-slate-400">æœ€çµ‚åˆ©ç”¨æ—¥ï¼ˆToï¼‰</label><input type="date" className="w-full border rounded px-2 py-1 text-xs mt-0.5" /></div>
              <div />
              <div className="flex items-end"><button onClick={() => toast("é¡§å®¢ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "success")} className="w-full py-1 bg-blue-600 text-white rounded text-xs font-bold">ğŸ” æ¤œç´¢</button></div>
            </div>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "é¡§å®¢ID", w: "w-24" }, { label: "ãƒ¡ãƒ¼ãƒ«", w: "flex-1" }, { label: "ã‚«ãƒ¼ãƒ‰", w: "w-24" }, { label: "åŠ ç›Ÿåº—", w: "w-24" }, { label: "å–å¼•å›æ•°", w: "w-16" }, { label: "LTV", w: "w-24" }, { label: "æœ€çµ‚å–å¼•", w: "w-24" }, { label: "PQ ID", w: "w-20" }, { label: "RCç´ä»˜", w: "w-12" }, { label: "ã‚µãƒ–ã‚¹ã‚¯", w: "w-14" }, { label: "ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ", w: "w-16" }, { label: "ãƒªã‚¹ã‚¯", w: "w-12" }]}>
            {customers.map((c, i) => (
              <tr key={i} onClick={() => setSelectedCustomer(c)} className="border-b hover:bg-blue-50 cursor-pointer">
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-blue-600">{c.id}</td>
                <td className="px-4 py-2 whitespace-nowrap">{c.email}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-xs">{c.card}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-500">{c.merchant}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-center">{c.txn}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-bold">{c.ltv}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400">{c.last}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20 font-mono text-xs text-slate-500">{c.pqId}</td>
                <td className="px-4 py-2 whitespace-nowrap w-12 text-center">{c.recCount > 0 ? <Badge text={`${c.recCount}ä»¶`} color="blue" /> : <span className="text-slate-300">â€”</span>}</td>
                <td className="px-4 py-2 whitespace-nowrap w-14"><Badge text={c.sub} color={c.sub === "èª²é‡‘ä¸­" ? "green" : c.sub === "åœæ­¢" ? "red" : "gray"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={c.segment} color={segColors[c.segment] || "gray"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-12"><Badge text={c.risk === "low" ? "ä½" : c.risk === "medium" ? "ä¸­" : "é«˜"} color={riskColors[c.risk]} /></td>
              </tr>
            ))}
            </TableHeader>
          </div>
          <div className="text-xs text-slate-400 text-right">5ä»¶è¡¨ç¤º / å…¨12,847ä»¶</div>
        </div>
      )}

      {tab === "search" && selectedCustomer && (
        <div className="grid grid-cols-5 gap-3">
          <div className="col-span-2 space-y-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs font-bold">ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</p>
                <button onClick={() => setSelectedCustomer(null)} className="text-xs text-blue-600">â† ä¸€è¦§ã«æˆ»ã‚‹</button>
              </div>
              <div className="space-y-2">
                {[["é¡§å®¢ID", selectedCustomer.id], ["ãƒ¡ãƒ¼ãƒ«", selectedCustomer.email], ["ã‚«ãƒ¼ãƒ‰", selectedCustomer.card], ["åŠ ç›Ÿåº—", selectedCustomer.merchant], ["åˆå›å–å¼•", "2024-08-15"], ["æœ€çµ‚å–å¼•", selectedCustomer.last]].map(([l, v], i) => (
                  <div key={i} className="flex text-xs items-center"><span className="w-20 text-slate-400">{l}</span><span className="font-bold">{v}</span>{l === "ãƒ¡ãƒ¼ãƒ«" && <button onClick={() => toast("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒã‚¹ã‚¯ã‚’è§£é™¤ã—ã¾ã—ãŸ", "info")} className="ml-2 px-1.5 py-0.5 bg-blue-50 text-blue-600 rounded border border-blue-200 text-xs">ğŸ”“ ãƒã‚¹ã‚¯è§£é™¤</button>}</div>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-2">ãƒªã‚¹ã‚¯ & ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</p>
              <div className="flex gap-2 mb-2">
                <Badge text={`ãƒªã‚¹ã‚¯: ${selectedCustomer.risk === "low" ? "ä½" : "ä¸­"}`} color={riskColors[selectedCustomer.risk]} />
                <Badge text={selectedCustomer.segment} color={segColors[selectedCustomer.segment] || "gray"} />
                {selectedCustomer.sub !== "ãªã—" && <Badge text={`ã‚µãƒ–ã‚¹ã‚¯: ${selectedCustomer.sub}`} color={selectedCustomer.sub === "èª²é‡‘ä¸­" ? "green" : "red"} />}
              </div>
              <div className="flex text-xs"><span className="w-20 text-slate-400">AIã‚¹ã‚³ã‚¢</span><span className="font-bold">23/100ï¼ˆä½ãƒªã‚¹ã‚¯ï¼‰</span></div>
              <div className="flex text-xs mt-1"><span className="w-20 text-slate-400">CBä»¶æ•°</span><span>0ä»¶</span></div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-2">ã‚¿ã‚°</p>
              <div className="flex gap-1 flex-wrap">
                {selectedCustomer.segment === "ãƒ­ã‚¤ãƒ¤ãƒ«" && <span className="text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full">VIP</span>}
                <span className="text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full">{selectedCustomer.segment}</span>
                <button onClick={() => toast("ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="text-xs px-2 py-0.5 bg-slate-100 text-slate-400 rounded-full border border-dashed">+ ã‚¿ã‚°è¿½åŠ </button>
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-2">ãƒ¡ãƒ¢</p>
              <div className="space-y-1.5">
                <div className="bg-slate-50 rounded p-2 text-xs"><p className="text-slate-400">2026-02-10 â€” adminç”°ä¸­</p><p>å•ã„åˆã‚ã›ã‚ã‚Šã€‚è¿”é‡‘å¯¾å¿œå®Œäº†ã€‚</p></div>
              </div>
              <div className="flex gap-1 mt-2"><input className="flex-1 border rounded px-2 py-1 text-xs" placeholder="ãƒ¡ãƒ¢ã‚’è¿½åŠ ..." /><button onClick={() => toast("ãƒ¡ãƒ¢ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="px-2 py-1 bg-blue-600 text-white rounded text-xs">è¿½åŠ </button></div>
            </div>
            <div className="flex gap-2">
              <button onClick={() => toast(`${selectedCustomer.id}ã‚’ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ`, "warning")} className="flex-1 py-1.5 bg-rose-50 text-rose-600 rounded text-xs border border-rose-200">ğŸš« ãƒ–ãƒ­ãƒƒã‚¯</button>
              <button onClick={() => toast(`${selectedCustomer.id}ã‚’ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ`, "success")} className="flex-1 py-1.5 bg-emerald-50 text-emerald-600 rounded text-xs border border-emerald-200">âœ… ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ</button>
              <button onClick={() => toast("ã“ã®é¡§å®¢ã®å–å¼•è©³ç´°ç”»é¢ã‚’é–‹ãã¾ã™", "info")} className="flex-1 py-1.5 bg-slate-50 text-slate-600 rounded text-xs border">ğŸ” å–å¼•è©³ç´°ã‚’é–‹ã</button>
            </div>
          </div>
          <div className="col-span-3 space-y-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs font-bold">å–å¼•çµ±è¨ˆ</p>
                <div className="flex gap-2 text-xs">
                  <span>å–å¼•: <b>{selectedCustomer.txn}ä»¶</b></span>
                  <span>æˆåŠŸç‡: <b className="text-emerald-600">97.8%</b></span>
                  <span>å¹³å‡å˜ä¾¡: <b>Â¥{Math.round(parseInt(selectedCustomer.ltv.replace(/[Â¥,]/g, "")) / selectedCustomer.txn).toLocaleString()}</b></span>
                  <span>LTV: <b className="text-blue-700">{selectedCustomer.ltv}</b></span>
                </div>
              </div>
              <div className="flex items-end gap-1 h-16 px-1">
                {[35, 42, 38, 55, 48, 62].map((h, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full bg-blue-400 rounded-t" style={{ height: `${h}%` }} />
                    <p className="text-xs text-slate-400 mt-0.5">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][i]}</p>
                  </div>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs font-bold">å–å¼•ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</p>
                <div className="flex gap-1">
                  <select className="border rounded px-1.5 py-0.5 text-xs"><option>å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option></select>
                  <select className="border rounded px-1.5 py-0.5 text-xs"><option>ç›´è¿‘30æ—¥</option></select>
                </div>
              </div>
              {[
                { date: "02/13 14:22", amt: "Â¥2,980", brand: "VISA", st: "æˆåŠŸ", stc: "green", note: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•æ±ºæ¸ˆï¼‰" },
                { date: "02/10 11:05", amt: "Â¥12,800", brand: "VISA", st: "æˆåŠŸ", stc: "green", note: "" },
                { date: "02/05 09:30", amt: "Â¥4,500", brand: "VISA", st: "è¿”é‡‘æ¸ˆ", stc: "purple", note: "ä¸€éƒ¨è¿”é‡‘ Â¥2,000" },
                { date: "01/28 16:45", amt: "Â¥2,980", brand: "VISA", st: "æˆåŠŸ", stc: "green", note: "æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•æ±ºæ¸ˆï¼‰" },
                { date: "01/15 13:20", amt: "Â¥35,000", brand: "VISA", st: "æˆåŠŸ", stc: "green", note: "" },
                { date: "01/08 10:00", amt: "Â¥2,980", brand: "VISA", st: "å¤±æ•—", stc: "red", note: "æ®‹é«˜ä¸è¶³â†’ãƒªãƒˆãƒ©ã‚¤æˆåŠŸ" },
              ].map((t, i) => (
                <div key={i} className="flex items-center py-1.5 border-b last:border-0 text-xs whitespace-nowrap overflow-hidden">
                  <div className="w-2 h-2 rounded-full mr-2 shrink-0" style={{ backgroundColor: t.stc === "green" ? "#22c55e" : t.stc === "red" ? "#ef4444" : "#a855f7" }} />
                  <div className="w-24 shrink-0 text-slate-400">{t.date}</div>
                  <div className="w-20 shrink-0 font-bold">{t.amt}</div>
                  <div className="w-10 shrink-0 font-mono text-slate-500">{t.brand}</div>
                  <div className="w-12 shrink-0"><Badge text={t.st} color={t.stc} /></div>
                  <div className="flex-1 text-slate-400 truncate min-w-0">{t.note}</div>
                </div>
              ))}
              <div className="text-center mt-2"><button onClick={() => toast("å–å¼•ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’å…¨ä»¶è¡¨ç¤ºã—ã¾ã™", "info")} className="text-xs text-blue-600">ã•ã‚‰ã«è¡¨ç¤º â†’</button></div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-2">ã‚«ãƒ¼ãƒ‰æƒ…å ±</p>
              <div className="flex gap-3">
                {[{ brand: "VISA", last4: "4242", exp: "12/27", lastUsed: "02/13", active: true }, { brand: "VISA", last4: "8888", exp: "03/25", lastUsed: "2024-12", active: false }].map((c, i) => (
                  <div key={i} className={`border rounded p-2 text-xs flex-1 ${c.active ? "border-blue-200 bg-blue-50" : "border-slate-200 bg-slate-50"}`}>
                    <div className="flex items-center justify-between"><span className="font-bold">{c.brand} *{c.last4}</span>{c.active && <Badge text="ãƒ¡ã‚¤ãƒ³" color="blue" />}{!c.active && <Badge text="æœªä½¿ç”¨" color="gray" />}</div>
                    <div className="text-slate-400 mt-1">æœ‰åŠ¹æœŸé™: {c.exp} | æœ€çµ‚ä½¿ç”¨: {c.lastUsed}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}

      {tab === "analysis" && (
        <div className="space-y-3">
          <div className="grid grid-cols-5 gap-3">
            <KPICard label="ç·é¡§å®¢æ•°" value="12,847" trend={5.2} color="blue" />
            <KPICard label="ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆ30æ—¥ï¼‰" value="4,231" sub="32.9%" color="green" />
            <KPICard label="å¹³å‡LTV" value="Â¥48,320" trend={3.1} color="blue" />
            <KPICard label="ãƒªãƒ”ãƒ¼ãƒˆç‡" value="34.7%" trend={1.8} color="green" />
            <KPICard label="ä»Šæœˆæ–°è¦" value="623" trend={-2.1} color="blue" />
          </div>
          <div className="grid grid-cols-3 gap-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-3">ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†å¸ƒ</p>
              <div className="space-y-2">
                {[{ seg: "ãƒ­ã‚¤ãƒ¤ãƒ«ï¼ˆ11å›ä»¥ä¸Šï¼‰", pct: 8, cnt: "1,028", color: "bg-purple-400" }, { seg: "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ï¼ˆ2-10å›ï¼‰", pct: 27, cnt: "3,469", color: "bg-blue-400" }, { seg: "åˆå›ï¼ˆ1å›ã®ã¿ï¼‰", pct: 45, cnt: "5,781", color: "bg-slate-300" }, { seg: "ä¼‘çœ ï¼ˆ90æ—¥+ï¼‰", pct: 15, cnt: "1,927", color: "bg-yellow-300" }, { seg: "é›¢è„±ï¼ˆ180æ—¥+ï¼‰", pct: 5, cnt: "642", color: "bg-rose-300" }].map((s, i) => (
                  <div key={i} className="text-xs">
                    <div className="flex justify-between mb-0.5"><span>{s.seg}</span><span className="text-slate-400">{s.cnt}äºº ({s.pct}%)</span></div>
                    <div className="w-full bg-slate-100 rounded-full h-2"><div className={`${s.color} h-2 rounded-full`} style={{ width: `${s.pct * 2}%` }} /></div>
                  </div>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-3">æœˆåˆ¥ æ–°è¦ vs ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</p>
              <div className="flex items-end gap-1 h-32 px-1">
                {[{ n: 580, r: 320 }, { n: 610, r: 340 }, { n: 550, r: 360 }, { n: 640, r: 380 }, { n: 670, r: 410 }, { n: 623, r: 395 }].map((d, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full flex flex-col">
                      <div className="w-full bg-blue-300 rounded-t" style={{ height: `${d.r / 10}px` }} />
                      <div className="w-full bg-slate-300" style={{ height: `${d.n / 10}px` }} />
                    </div>
                    <p className="text-xs text-slate-400 mt-1">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][i]}</p>
                  </div>
                ))}
              </div>
              <div className="flex justify-center gap-4 mt-2 text-xs"><span className="flex items-center gap-1"><span className="w-3 h-2 bg-slate-300 rounded" />æ–°è¦</span><span className="flex items-center gap-1"><span className="w-3 h-2 bg-blue-300 rounded" />ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</span></div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-3">LTVåˆ†å¸ƒ</p>
              <div className="flex items-end gap-1 h-32 px-1">
                {[{ range: "ã€œÂ¥1ä¸‡", h: 85 }, { range: "Â¥1-5ä¸‡", h: 60 }, { range: "Â¥5-10ä¸‡", h: 35 }, { range: "Â¥10-50ä¸‡", h: 20 }, { range: "Â¥50ä¸‡ã€œ", h: 8 }].map((d, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full bg-emerald-400 rounded-t" style={{ height: `${d.h}%` }} />
                    <p className="text-xs text-slate-400 mt-1 leading-tight text-center">{d.range}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold mb-2">åŠ ç›Ÿåº—åˆ¥ é¡§å®¢æ•°ï¼ˆTOP10ï¼‰</p>
            {[["ABCå•†äº‹", 3420, 34], ["XYZç‰©ç”£", 2150, 22], ["DEFã‚µãƒ¼ãƒ“ã‚¹", 1890, 19], ["GHIã‚ªãƒ³ãƒ©ã‚¤ãƒ³", 1240, 12], ["JKLãƒãƒ¼ã‚±ãƒƒãƒˆ", 980, 10]].map((r, i) => (
              <div key={i} className="flex items-center text-xs py-1">
                <div className="w-32 font-bold">{r[0]}</div>
                <div className="flex-1"><div className="w-full bg-slate-100 rounded-full h-3"><div className="bg-blue-500 h-3 rounded-full" style={{ width: `${r[2] * 3}%` }} /></div></div>
                <div className="w-20 text-right text-slate-500">{r[1].toLocaleString()}äºº</div>
              </div>
            ))}
          </div>
        </div>
      )}

      {tab === "cards" && (
        <div className="space-y-3">
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold mb-2">ğŸ” ãƒˆãƒ¼ã‚¯ãƒ³æ¤œç´¢</p>
            <div className="grid grid-cols-4 gap-2">
              <div><label className="text-xs text-slate-400">ãƒˆãƒ¼ã‚¯ãƒ³ID</label><input className="w-full border rounded px-2 py-1 text-xs mt-0.5" placeholder="TKN-..." /></div>
              <div><label className="text-xs text-slate-400">ãƒšã‚¤ã‚¯ã‚¤ãƒƒã‚¯ID</label><input className="w-full border rounded px-2 py-1 text-xs mt-0.5" placeholder="PQ-..." /></div>
              <div><label className="text-xs text-slate-400">ã‚«ãƒ¼ãƒ‰ä¸‹4æ¡</label><input className="w-full border rounded px-2 py-1 text-xs mt-0.5" placeholder="4242" /></div>
              <div><label className="text-xs text-slate-400">åŠ ç›Ÿåº—</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨åŠ ç›Ÿåº—</option><option>ABCå•†äº‹</option><option>XYZç‰©ç”£</option></select></div>
            </div>
            <div className="grid grid-cols-4 gap-2 mt-2">
              <div><label className="text-xs text-slate-400">ãƒ–ãƒ©ãƒ³ãƒ‰</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨ã¦</option><option>VISA</option><option>MC</option><option>JCB</option><option>AMEX</option></select></div>
              <div><label className="text-xs text-slate-400">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label><select className="w-full border rounded px-2 py-1 text-xs mt-0.5"><option>å…¨ã¦</option><option>æœ‰åŠ¹</option><option>æœŸé™åˆ‡ã‚Œ</option><option>ç„¡åŠ¹åŒ–æ¸ˆ</option></select></div>
              <div />
              <div className="flex items-end"><button onClick={() => toast("ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "success")} className="w-full py-1 bg-blue-600 text-white rounded text-xs font-bold">ğŸ” æ¤œç´¢</button></div>
            </div>
          </div>
          <div className="grid grid-cols-4 gap-3">
            <KPICard label="ãƒˆãƒ¼ã‚¯ãƒ³ç·æ•°" value="28,431" color="blue" />
            <KPICard label="æœ‰åŠ¹ãƒˆãƒ¼ã‚¯ãƒ³" value="24,102" sub="84.8%" color="green" />
            <KPICard label="æœŸé™åˆ‡ã‚Œ" value="3,892" sub="13.7%" color="yellow" />
            <KPICard label="ç„¡åŠ¹åŒ–æ¸ˆ" value="437" sub="1.5%" color="red" />
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "ãƒˆãƒ¼ã‚¯ãƒ³ID", w: "w-28" }, { label: "PQ ID", w: "w-24" }, { label: "ãƒ–ãƒ©ãƒ³ãƒ‰", w: "w-16" }, { label: "ã‚«ãƒ¼ãƒ‰æœ«å°¾", w: "w-16" }, { label: "æœ‰åŠ¹æœŸé™", w: "w-20" }, { label: "é¡§å®¢ID", w: "w-24" }, { label: "åŠ ç›Ÿåº—", w: "w-24" }, { label: "RCç´ä»˜", w: "w-14" }, { label: "æœ€çµ‚åˆ©ç”¨", w: "w-24" }, { label: "çŠ¶æ…‹", w: "w-16" }]}>
            {[
              { tkn: "TKN-A00123", pq: "PQ-10234", brand: "VISA", last4: "4242", exp: "12/27", cust: "CUS-00001", merchant: "ABCå•†äº‹", rc: 2, lastUsed: "02/13 14:22", st: "æœ‰åŠ¹" },
              { tkn: "TKN-A00124", pq: "PQ-10234", brand: "VISA", last4: "8888", exp: "03/25", cust: "CUS-00001", merchant: "ABCå•†äº‹", rc: 0, lastUsed: "2024-12-10", st: "æœŸé™åˆ‡ã‚Œ" },
              { tkn: "TKN-B00456", pq: "PQ-10567", brand: "JCB", last4: "5678", exp: "08/28", cust: "CUS-00003", merchant: "ABCå•†äº‹", rc: 1, lastUsed: "02/10 18:30", st: "æœ‰åŠ¹" },
              { tkn: "TKN-C00789", pq: "PQ-10012", brand: "AMEX", last4: "3456", exp: "11/27", cust: "CUS-00005", merchant: "ABCå•†äº‹", rc: 3, lastUsed: "02/13 16:05", st: "æœ‰åŠ¹" },
              { tkn: "TKN-D01012", pq: "â€”", brand: "MC", last4: "1234", exp: "06/26", cust: "CUS-00002", merchant: "XYZç‰©ç”£", rc: 0, lastUsed: "02/12 09:45", st: "æœ‰åŠ¹" },
              { tkn: "TKN-E01345", pq: "â€”", brand: "VISA", last4: "9999", exp: "01/25", cust: "CUS-00004", merchant: "DEFã‚µãƒ¼ãƒ“ã‚¹", rc: 0, lastUsed: "02/08 11:00", st: "ç„¡åŠ¹åŒ–æ¸ˆ" },
            ].map((t, i) => (
              <tr key={i} className={`border-b ${i % 2 ? "bg-slate-50" : ""}`}>
                <td className="px-4 py-2 whitespace-nowrap w-28 font-mono text-blue-600 text-xs">{t.tkn}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-xs text-slate-500">{t.pq}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-xs">{t.brand}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 font-mono text-xs">*{t.last4}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20 text-xs">{t.exp}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-blue-600 text-xs">{t.cust}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-500 text-xs">{t.merchant}</td>
                <td className="px-4 py-2 whitespace-nowrap w-14 text-center">{t.rc > 0 ? <Badge text={`${t.rc}ä»¶`} color="blue" /> : <span className="text-slate-300">â€”</span>}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400 text-xs">{t.lastUsed}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={t.st} color={t.st === "æœ‰åŠ¹" ? "green" : t.st === "æœŸé™åˆ‡ã‚Œ" ? "yellow" : "red"} /></td>
              </tr>
            ))}
            </TableHeader>
          </div>
          <div className="text-xs text-slate-400 text-right">6ä»¶è¡¨ç¤º / å…¨28,431ä»¶</div>
          <div className="bg-blue-50 rounded-lg border border-blue-200 p-3">
            <p className="text-xs font-bold text-blue-700 mb-1">ğŸ” ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã‚µãƒ¼ãƒ“ã‚¹</p>
            <div className="grid grid-cols-3 gap-3 text-xs">
              <div><span className="text-slate-500">PCI DSSæº–æ‹ :</span> <span className="font-bold text-emerald-600">Level 1 èªå®š</span></div>
              <div><span className="text-slate-500">æš—å·åŒ–æ–¹å¼:</span> <span className="font-bold">AES-256 + RSA-2048</span></div>
              <div><span className="text-slate-500">ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé–“:</span> <span className="font-bold">ã‚«ãƒ¼ãƒ‰æœ‰åŠ¹æœŸé™ã¾ã§</span></div>
              <div><span className="text-slate-500">è‡ªå‹•å‰Šé™¤:</span> <span className="font-bold">æœŸé™åˆ‡ã‚Œå¾Œ180æ—¥</span></div>
              <div><span className="text-slate-500">æœ€çµ‚ç›£æŸ»:</span> <span className="font-bold">2026-01-15</span></div>
              <div><span className="text-slate-500">æ¬¡å›ç›£æŸ»:</span> <span className="font-bold text-amber-600">2026-07-15</span></div>
            </div>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ â”€â”€ */}
      {showM16CsvExport && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowM16CsvExport(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[460px]">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">ğŸ“¥ é¡§å®¢ãƒ‡ãƒ¼ã‚¿CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
              <button onClick={() => setShowM16CsvExport(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨é¡§å®¢</option><option>ãƒ­ã‚¤ãƒ¤ãƒ«</option><option>ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</option><option>åˆå›</option></select></div>
                <div><label className="text-xs font-semibold text-slate-600">ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨ã¦</option><option>ä½</option><option>ä¸­</option><option>é«˜</option></select></div>
              </div>
              <div>
                <label className="text-xs font-semibold text-slate-600">å‡ºåŠ›ã‚«ãƒ©ãƒ </label>
                <div className="flex gap-2 flex-wrap mt-1">
                  {["é¡§å®¢ID", "ãƒ¡ãƒ¼ãƒ«", "ã‚«ãƒ¼ãƒ‰ï¼ˆãƒã‚¹ã‚¯ï¼‰", "åŠ ç›Ÿåº—", "å–å¼•å›æ•°", "LTV", "ãƒªã‚¹ã‚¯", "ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ", "PQ ID", "RCç´ä»˜æ•°", "ã‚µãƒ–ã‚¹ã‚¯"].map((c, i) => (
                    <label key={i} className="flex items-center gap-1 text-xs"><input type="checkbox" defaultChecked className="w-3 h-3" />{c}</label>
                  ))}
                </div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">æœ€çµ‚å–å¼•æ—¥ï¼ˆé–‹å§‹ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
                <div><label className="text-xs font-semibold text-slate-600">æœ€çµ‚å–å¼•æ—¥ï¼ˆçµ‚äº†ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
              </div>
              <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700">
                ğŸ’¡ æ¨å®šå‡ºåŠ›ä»¶æ•°: ç´„15,420ä»¶ / ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ç´„1.2MB
              </div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowM16CsvExport(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowM16CsvExport(false); toast("é¡§å®¢ãƒ‡ãƒ¼ã‚¿CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success"); }} className="px-4 py-2 text-xs bg-blue-600 text-white rounded font-semibold hover:bg-blue-700">CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ S11: é¡§å®¢ç®¡ç†ï¼ˆåŠ ç›Ÿåº—ï¼‰ â”€â”€â”€
const MerchantCustomers = () => {
  const toast = useToast();
  const [tab, setTab] = useState("list");
  const [detail, setDetail] = useState(null);
  const [showCsvExport, setShowCsvExport] = useState(false);
  const tabs = [{ id: "list", label: "é¡§å®¢ä¸€è¦§" }, { id: "analysis", label: "é¡§å®¢åˆ†æ" }];
  const customers = [
    { id: "CUS-00001", email: "t***@example.com", card: "VISA *4242", txn: 47, ltv: "Â¥892,600", repeat: "ãƒ­ã‚¤ãƒ¤ãƒ«", sub: "èª²é‡‘ä¸­", last: "02/13 14:22", tags: ["VIP"] },
    { id: "CUS-00002", email: "s***@gmail.com", card: "MC *1234", txn: 12, ltv: "Â¥156,800", repeat: "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼", sub: "ãªã—", last: "02/12 09:45", tags: [] },
    { id: "CUS-00003", email: "h***@yahoo.co.jp", card: "JCB *5678", txn: 3, ltv: "Â¥45,200", repeat: "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼", sub: "åœæ­¢", last: "02/10 18:30", tags: ["è¦ç¢ºèª"] },
    { id: "CUS-00004", email: "k***@company.jp", card: "VISA *9999", txn: 1, ltv: "Â¥9,800", repeat: "åˆå›", sub: "ãªã—", last: "02/08 11:00", tags: [] },
    { id: "CUS-00005", email: "m***@icloud.com", card: "AMEX *3456", txn: 89, ltv: "Â¥2,345,000", repeat: "ãƒ­ã‚¤ãƒ¤ãƒ«", sub: "èª²é‡‘ä¸­", last: "02/13 16:05", tags: ["VIP", "å¤§å£"] },
  ];
  const repeatColors = { "ãƒ­ã‚¤ãƒ¤ãƒ«": "purple", "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼": "blue", "åˆå›": "gray" };
  return (
    <div className="p-5 space-y-4">
      <div className="flex items-center justify-between">
        <h2 className="text-sm font-bold text-slate-800">é¡§å®¢ç®¡ç†</h2>
        <div className="flex items-center gap-2">
          <select className="border rounded px-2 py-1 text-xs"><option>ğŸ¢ ECã‚µã‚¤ãƒˆA</option><option>å…¨ã‚µã‚¤ãƒˆåˆç®—</option></select>
          <button onClick={() => setShowCsvExport(true)} className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200">ğŸ“¥ CSV</button>
        </div>
      </div>
      <div className="flex gap-1">{tabs.map(t => (
        <button key={t.id} onClick={() => { setTab(t.id); setDetail(null); }} className={`px-3 py-1.5 text-xs rounded-t border-b-2 ${tab === t.id ? "border-emerald-500 text-emerald-700 bg-emerald-50 font-bold" : "border-transparent text-slate-400"}`}>{t.label}</button>
      ))}</div>

      {tab === "list" && !detail && (
        <div className="space-y-3">
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <div className="flex gap-2">
              <input className="flex-1 border rounded px-2 py-1 text-xs" placeholder="ğŸ” ãƒ¡ãƒ¼ãƒ« / åå‰ / é¡§å®¢IDã§æ¤œç´¢" />
              <input className="w-24 border rounded px-2 py-1 text-xs" placeholder="ã‚«ãƒ¼ãƒ‰ä¸‹4æ¡" />
              <select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</option><option>ãƒ­ã‚¤ãƒ¤ãƒ«</option><option>ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</option><option>åˆå›</option></select>
              <select className="border rounded px-2 py-1 text-xs"><option>å…¨ã‚µãƒ–ã‚¹ã‚¯</option><option>èª²é‡‘ä¸­</option><option>åœæ­¢</option></select>
              <button onClick={() => toast("é¡§å®¢ã‚’æ¤œç´¢ã—ã¾ã—ãŸ", "success")} className="px-3 py-1 bg-emerald-600 text-white rounded text-xs">æ¤œç´¢</button>
            </div>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
            <TableHeader cols={[{ label: "é¡§å®¢ID", w: "w-24" }, { label: "ãƒ¡ãƒ¼ãƒ«", w: "flex-1" }, { label: "ã‚«ãƒ¼ãƒ‰", w: "w-24" }, { label: "å–å¼•å›æ•°", w: "w-16" }, { label: "LTV", w: "w-24" }, { label: "ãƒªãƒ”ãƒ¼ãƒˆ", w: "w-16" }, { label: "ã‚µãƒ–ã‚¹ã‚¯", w: "w-14" }, { label: "æœ€çµ‚å–å¼•", w: "w-24" }, { label: "ã‚¿ã‚°", w: "w-20" }]}>
            {customers.map((c, i) => (
              <tr key={i} onClick={() => setDetail(c)} className="border-b hover:bg-emerald-50 cursor-pointer">
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono text-emerald-700">{c.id}</td>
                <td className="px-4 py-2 whitespace-nowrap">{c.email}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-mono">{c.card}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16 text-center">{c.txn}</td>
                <td className="px-4 py-2 whitespace-nowrap w-24 font-bold">{c.ltv}</td>
                <td className="px-4 py-2 whitespace-nowrap w-16"><Badge text={c.repeat} color={repeatColors[c.repeat]} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-14"><Badge text={c.sub} color={c.sub === "èª²é‡‘ä¸­" ? "green" : c.sub === "åœæ­¢" ? "red" : "gray"} /></td>
                <td className="px-4 py-2 whitespace-nowrap w-24 text-slate-400">{c.last}</td>
                <td className="px-4 py-2 whitespace-nowrap w-20"><div className="flex gap-0.5">{c.tags.map((t, j) => <span key={j} className="text-xs px-1 py-0 bg-purple-100 text-purple-700 rounded">{t}</span>)}</div></td>
              </tr>
            ))}
            </TableHeader>
          </div>
        </div>
      )}

      {tab === "list" && detail && (
        <div className="grid grid-cols-5 gap-3">
          <div className="col-span-2 space-y-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs font-bold">é¡§å®¢ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</p>
                <button onClick={() => setDetail(null)} className="text-xs text-emerald-600">â† ä¸€è¦§ã«æˆ»ã‚‹</button>
              </div>
              {[["é¡§å®¢ID", detail.id], ["ãƒ¡ãƒ¼ãƒ«", detail.email], ["ã‚«ãƒ¼ãƒ‰", detail.card], ["åˆå›å–å¼•", "2024-08-15"], ["æœ€çµ‚å–å¼•", detail.last], ["å–å¼•å›æ•°", `${detail.txn}å›`], ["LTV", detail.ltv]].map(([l, v], i) => (
                <div key={i} className="flex text-xs py-0.5"><span className="w-20 text-slate-400">{l}</span><span className="font-bold">{v}</span></div>
              ))}
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-1">ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ & ã‚µãƒ–ã‚¹ã‚¯</p>
              <div className="flex gap-2 mt-1">
                <Badge text={detail.repeat} color={repeatColors[detail.repeat]} />
                {detail.sub !== "ãªã—" && <Badge text={`ã‚µãƒ–ã‚¹ã‚¯: ${detail.sub}`} color={detail.sub === "èª²é‡‘ä¸­" ? "green" : "red"} />}
              </div>
              {detail.sub === "èª²é‡‘ä¸­" && <div className="mt-2 text-xs text-slate-500 bg-emerald-50 rounded p-1.5">æœˆé¡ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ Â¥2,980/æœˆ<br/>æ¬¡å›: 2026-03-01 â†’ <button onClick={() => toast("S10 æ±ºæ¸ˆç®¡ç†ç”»é¢ã‚’é–‹ãã¾ã™", "info")} className="text-emerald-600 underline">S10ã§é–‹ã</button></div>}
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-1">ã‚¿ã‚°</p>
              <div className="flex gap-1 flex-wrap mt-1">
                {detail.tags.map((t, i) => <span key={i} className="text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full">{t}</span>)}
                <button onClick={() => toast("ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="text-xs px-2 py-0.5 bg-slate-100 text-slate-400 rounded-full border border-dashed">+ ã‚¿ã‚°è¿½åŠ </button>
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-1">ãƒ¡ãƒ¢</p>
              <div className="bg-slate-50 rounded p-2 text-xs"><p className="text-slate-400">2026-02-10 â€” adminå±±ç”°</p><p>é›»è©±ã§å•ã„åˆã‚ã›ã‚ã‚Šã€‚ã‚µãƒ–ã‚¹ã‚¯è§£ç´„æ–¹æ³•ã‚’ã”æ¡ˆå†…ã€‚</p></div>
              <div className="flex gap-1 mt-2"><input className="flex-1 border rounded px-2 py-1 text-xs" placeholder="ãƒ¡ãƒ¢ã‚’è¿½åŠ ..." /><button onClick={() => toast("ãƒ¡ãƒ¢ã‚’è¿½åŠ ã—ã¾ã—ãŸ", "success")} className="px-2 py-1 bg-emerald-600 text-white rounded text-xs">è¿½åŠ </button></div>
            </div>
            <div className="flex gap-2">
              <button onClick={() => toast("S02 æ³¨æ–‡ä¸€è¦§ç”»é¢ã‚’é–‹ãã¾ã™", "info")} className="flex-1 py-1.5 bg-slate-50 text-slate-600 rounded text-xs border">S02 æ³¨æ–‡ä¸€è¦§ã§é–‹ã</button>
              <button onClick={() => toast("é¡§å®¢ã®å–å¼•ãƒ‡ãƒ¼ã‚¿CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success")} className="flex-1 py-1.5 bg-slate-50 text-slate-600 rounded text-xs border">ğŸ“¥ CSVå‡ºåŠ›</button>
            </div>
          </div>
          <div className="col-span-3 space-y-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-2">æœˆåˆ¥åˆ©ç”¨æ¨ç§»</p>
              <div className="flex items-end gap-1 h-16 px-1">
                {[35, 42, 38, 55, 48, 62].map((h, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full bg-emerald-400 rounded-t" style={{ height: `${h}%` }} />
                    <p className="text-xs text-slate-400 mt-0.5">{["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ", "1æœˆ", "2æœˆ"][i]}</p>
                  </div>
                ))}
              </div>
              <div className="flex gap-4 mt-2 text-xs text-slate-500">
                <span>æˆåŠŸç‡: <b className="text-emerald-600">97.8%</b></span>
                <span>å¹³å‡å˜ä¾¡: <b>Â¥18,990</b></span>
                <span>CB: <b>0ä»¶</b></span>
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <div className="flex items-center justify-between mb-2">
                <p className="text-xs font-bold">å–å¼•å±¥æ­´</p>
                <select className="border rounded px-1.5 py-0.5 text-xs"><option>å…¨ã¦</option><option>æˆåŠŸã®ã¿</option><option>è¿”é‡‘/CB</option></select>
              </div>
              {[
                { date: "02/13 14:22", amt: "Â¥2,980", brand: "VISA", st: "æˆåŠŸ", stc: "green" },
                { date: "02/10 11:05", amt: "Â¥12,800", brand: "VISA", st: "æˆåŠŸ", stc: "green" },
                { date: "02/05 09:30", amt: "Â¥4,500", brand: "VISA", st: "è¿”é‡‘æ¸ˆ", stc: "purple" },
                { date: "01/28 16:45", amt: "Â¥2,980", brand: "VISA", st: "æˆåŠŸ", stc: "green" },
                { date: "01/15 13:20", amt: "Â¥35,000", brand: "VISA", st: "æˆåŠŸ", stc: "green" },
              ].map((t, i) => (
                <div key={i} className="flex items-center py-1.5 border-b last:border-0 text-xs">
                  <div className="w-2 h-2 rounded-full mr-2" style={{ backgroundColor: t.stc === "green" ? "#22c55e" : "#a855f7" }} />
                  <div className="w-24 text-slate-400">{t.date}</div>
                  <div className="w-20 font-bold">{t.amt}</div>
                  <div className="w-12 font-mono text-slate-500">{t.brand}</div>
                  <div className="flex-1"><Badge text={t.st} color={t.stc} /></div>
                </div>
              ))}
              <div className="text-center mt-2"><button onClick={() => toast(`å…¨${detail.txn}ä»¶ã®å–å¼•å±¥æ­´ã‚’è¡¨ç¤ºã—ã¾ã™`, "info")} className="text-xs text-emerald-600">å…¨{detail.txn}ä»¶ã‚’è¡¨ç¤º â†’</button></div>
            </div>
          </div>
        </div>
      )}

      {tab === "analysis" && (
        <div className="space-y-3">
          <div className="grid grid-cols-5 gap-3">
            <KPICard label="ç·é¡§å®¢æ•°" value="3,420" color="green" />
            <KPICard label="ã‚¢ã‚¯ãƒ†ã‚£ãƒ–" value="1,205" sub="35.2%" color="green" />
            <KPICard label="å¹³å‡LTV" value="Â¥52,140" trend={4.2} color="green" />
            <KPICard label="ãƒªãƒ”ãƒ¼ãƒˆç‡" value="38.5%" trend={2.1} color="green" />
            <KPICard label="ä»Šæœˆæ–°è¦" value="187" color="green" />
          </div>
          <div className="grid grid-cols-2 gap-3">
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-3">ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†å¸ƒ</p>
              <div className="flex items-center justify-center gap-6 py-3">
                {[{ seg: "ãƒ­ã‚¤ãƒ¤ãƒ«", cnt: 274, pct: "8%", color: "bg-purple-500" }, { seg: "ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼", cnt: 1044, pct: "30.5%", color: "bg-blue-500" }, { seg: "åˆå›", cnt: 1540, pct: "45%", color: "bg-slate-400" }, { seg: "ä¼‘çœ ", cnt: 432, pct: "12.6%", color: "bg-yellow-400" }, { seg: "é›¢è„±", cnt: 130, pct: "3.8%", color: "bg-rose-400" }].map((s, i) => (
                  <div key={i} className="text-center">
                    <div className={`w-12 h-12 rounded-full ${s.color} flex items-center justify-center text-white text-xs font-bold`}>{s.pct}</div>
                    <p className="text-xs mt-1 font-bold">{s.seg}</p>
                    <p className="text-xs text-slate-400">{s.cnt}äºº</p>
                  </div>
                ))}
              </div>
            </div>
            <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
              <p className="text-xs font-bold mb-3">ãƒªãƒ”ãƒ¼ãƒˆç‡æ¨ç§»ï¼ˆ12ãƒ¶æœˆï¼‰</p>
              <div className="flex items-end gap-0.5 h-24 px-1">
                {[30, 31, 32, 33, 34, 33, 34, 35, 36, 37, 38, 38.5].map((v, i) => (
                  <div key={i} className="flex-1 flex flex-col items-center">
                    <div className="w-full bg-emerald-400 rounded-t" style={{ height: `${v * 2.5}%` }} />
                    <p className="text-xs text-slate-400 mt-0.5" style={{ fontSize: "9px" }}>{["3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2"][i]}æœˆ</p>
                  </div>
                ))}
              </div>
            </div>
          </div>
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold mb-2">å–å¼•é »åº¦åˆ†å¸ƒ</p>
            <div className="grid grid-cols-4 gap-3">
              {[{ label: "1å›ã®ã¿", cnt: 1540, pct: 45 }, { label: "2-5å›", cnt: 820, pct: 24 }, { label: "6-10å›", cnt: 524, pct: 15 }, { label: "11å›ä»¥ä¸Š", cnt: 536, pct: 16 }].map((d, i) => (
                <div key={i} className="text-center">
                  <div className="w-full bg-slate-100 rounded-full h-4 mb-1"><div className="bg-emerald-500 h-4 rounded-full" style={{ width: `${d.pct * 2}%` }} /></div>
                  <p className="text-xs font-bold">{d.label}</p>
                  <p className="text-xs text-slate-400">{d.cnt.toLocaleString()}äºº ({d.pct}%)</p>
                </div>
              ))}
            </div>
          </div>

          {/* Cohort Analysis */}
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm p-3">
            <p className="text-xs font-bold mb-2">ğŸ“Š ã‚³ãƒ›ãƒ¼ãƒˆåˆ†æï¼ˆæœˆæ¬¡ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ï¼‰</p>
            <div className="overflow-x-auto">
              <table className="w-full text-xs">
                <thead><tr className="bg-slate-50 border-b">
                  <th className="text-left px-2 py-1 font-semibold text-slate-600">ç™»éŒ²æœˆ</th>
                  <th className="text-center px-2 py-1 font-semibold text-slate-600">æ–°è¦</th>
                  {["1M", "2M", "3M", "4M", "5M", "6M"].map(m => <th key={m} className="text-center px-2 py-1 font-semibold text-slate-600">{m}</th>)}
                </tr></thead>
                <tbody>
                  {[
                    { month: "2025å¹´9æœˆ", new: 320, rates: [68, 52, 45, 38, 35, 33] },
                    { month: "2025å¹´10æœˆ", new: 285, rates: [72, 55, 48, 42, 38, null] },
                    { month: "2025å¹´11æœˆ", new: 310, rates: [70, 54, 46, 40, null, null] },
                    { month: "2025å¹´12æœˆ", new: 350, rates: [75, 58, 50, null, null, null] },
                    { month: "2026å¹´1æœˆ", new: 290, rates: [71, 55, null, null, null, null] },
                    { month: "2026å¹´2æœˆ", new: 187, rates: [null, null, null, null, null, null] },
                  ].map((c, i) => (
                    <tr key={i} className="border-b">
                      <td className="px-2 py-1 font-semibold text-slate-700">{c.month}</td>
                      <td className="px-2 py-1 text-center font-bold">{c.new}</td>
                      {c.rates.map((r, j) => (
                        <td key={j} className="px-2 py-1 text-center">
                          {r !== null ? (
                            <span className={`px-1.5 py-0.5 rounded text-xs ${r >= 60 ? "bg-emerald-100 text-emerald-700" : r >= 40 ? "bg-blue-100 text-blue-700" : "bg-amber-100 text-amber-700"}`}>{r}%</span>
                          ) : <span className="text-slate-200">â€”</span>}
                        </td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <p className="text-xs text-slate-400 mt-2">â€» å„æœˆã®ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ç‡ï¼ˆåˆæœˆå–å¼•å¾Œã«Næœˆç›®ã«å†å–å¼•ãŒã‚ã£ãŸå‰²åˆï¼‰</p>
          </div>
        </div>
      )}

      {/* â”€â”€ Modal: CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ â”€â”€ */}
      {showCsvExport && (
        <div className="fixed inset-0 z-50 flex items-center justify-center">
          <div className="absolute inset-0 bg-black bg-opacity-30" onClick={() => setShowCsvExport(false)} />
          <div className="relative bg-white rounded-xl shadow-2xl w-[440px]">
            <div className="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
              <h3 className="text-sm font-bold text-slate-800">ğŸ“¥ é¡§å®¢ãƒ‡ãƒ¼ã‚¿CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
              <button onClick={() => setShowCsvExport(false)} className="text-slate-400 hover:text-slate-600 text-lg">âœ•</button>
            </div>
            <div className="p-5 space-y-4">
              <div><label className="text-xs font-semibold text-slate-600">ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</label><select className="w-full text-xs border rounded px-2 py-1.5 mt-0.5"><option>å…¨é¡§å®¢</option><option>ãƒ­ã‚¤ãƒ¤ãƒ«</option><option>ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</option><option>åˆå›</option><option>ä¼‘çœ </option></select></div>
              <div>
                <label className="text-xs font-semibold text-slate-600">å‡ºåŠ›ã‚«ãƒ©ãƒ </label>
                <div className="flex gap-2 flex-wrap mt-1">
                  {["é¡§å®¢ID", "ãƒ¡ãƒ¼ãƒ«", "ã‚«ãƒ¼ãƒ‰ï¼ˆãƒã‚¹ã‚¯ï¼‰", "å–å¼•å›æ•°", "LTV", "ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ", "ã‚µãƒ–ã‚¹ã‚¯çŠ¶æ…‹", "æœ€çµ‚å–å¼•æ—¥", "ã‚¿ã‚°"].map((c, i) => (
                    <label key={i} className="flex items-center gap-1 text-xs"><input type="checkbox" defaultChecked className="w-3 h-3" />{c}</label>
                  ))}
                </div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs font-semibold text-slate-600">æœ€çµ‚å–å¼•æ—¥ï¼ˆé–‹å§‹ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
                <div><label className="text-xs font-semibold text-slate-600">æœ€çµ‚å–å¼•æ—¥ï¼ˆçµ‚äº†ï¼‰</label><input type="date" className="w-full text-xs border rounded px-2 py-1.5 mt-0.5" /></div>
              </div>
              <div className="bg-blue-50 rounded border border-blue-200 p-2 text-xs text-blue-700">
                ğŸ’¡ æ¨å®šå‡ºåŠ›ä»¶æ•°: ç´„3,420ä»¶ / ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ç´„240KB
              </div>
            </div>
            <div className="p-4 border-t flex gap-2 justify-end">
              <button onClick={() => setShowCsvExport(false)} className="px-4 py-2 text-xs text-slate-500 border rounded hover:bg-slate-50">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
              <button onClick={() => { setShowCsvExport(false); toast("é¡§å®¢ãƒ‡ãƒ¼ã‚¿CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ", "success"); }} className="px-4 py-2 text-xs bg-emerald-600 text-white rounded font-semibold hover:bg-emerald-700">CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// â”€â”€â”€ P02: æ±ºæ¸ˆãƒšãƒ¼ã‚¸ â”€â”€â”€
// æ±ºæ¸ˆå‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
const PaymentProcessingFlow = ({ onComplete, onError }) => {
  const steps = [
    { id: 1, label: "ãƒˆãƒ¼ã‚¯ãƒ³åŒ–", desc: "ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’æš—å·åŒ–", icon: "ğŸ”‘", zone: "A" },
    { id: 2, label: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°", desc: "æœ€é©ãªæ¥ç¶šå…ˆã‚’é¸æŠ", icon: "ğŸ”€", zone: "A" },
    { id: 3, label: "ä¸æ­£æ¤œçŸ¥", desc: "ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢åˆ¤å®š", icon: "ğŸ›¡ï¸", zone: "A" },
    { id: 4, label: "æ¥ç¶šå…ˆé€šä¿¡", desc: "ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã¸é€ä¿¡", icon: "ğŸ“¡", zone: "A" },
    { id: 5, label: "çµæœåŒæœŸ", desc: "ç®¡ç†ç³»DBã«è¨˜éŒ²", icon: "ğŸ’¾", zone: "B" },
  ];
  const [currentStep, setCurrentStep] = useState(0);
  const [status, setStatus] = useState("processing"); // processing | success | error

  useEffect(() => {
    if (status !== "processing") return;
    if (currentStep >= steps.length) {
      setStatus("success");
      setTimeout(() => onComplete(), 800);
      return;
    }
    const timer = setTimeout(() => setCurrentStep(s => s + 1), 900 + Math.random() * 400);
    return () => clearTimeout(timer);
  }, [currentStep, status]);

  return (
    <div className="bg-white rounded-2xl shadow-xl border border-slate-200/60 overflow-hidden">
      <div className="bg-slate-900 text-white px-6 py-5">
        <div className="flex items-center gap-2"><span className="text-lg">ğŸ”’</span><span className="text-sm font-bold">æ±ºæ¸ˆå‡¦ç†ä¸­</span></div>
      </div>
      <div className="px-6 py-5">
        {/* Progress bar */}
        <div className="relative h-2 bg-slate-100 rounded-full overflow-hidden mb-6">
          <div className="absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out" style={{ width: `${(currentStep / steps.length) * 100}%` }} />
        </div>

        {/* Steps */}
        <div className="space-y-2">
          {steps.map((step, idx) => {
            const isDone = idx < currentStep;
            const isActive = idx === currentStep && status === "processing";
            return (
              <div key={step.id} className={`flex items-center gap-3 p-3 rounded-xl transition-all duration-300 ${isActive ? "bg-blue-50 border border-blue-200 shadow-sm" : isDone ? "bg-emerald-50/50" : "opacity-40"}`}>
                <div className={`w-9 h-9 rounded-lg flex items-center justify-center text-base shrink-0 ${isDone ? "bg-emerald-100" : isActive ? "bg-blue-100" : "bg-slate-100"}`}>
                  {isDone ? "âœ…" : isActive ? <span className="animate-pulse">{step.icon}</span> : step.icon}
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2">
                    <span className={`text-sm font-bold ${isDone ? "text-emerald-700" : isActive ? "text-blue-700" : "text-slate-400"}`}>{step.label}</span>
                    <span className={`text-[9px] font-bold px-1.5 py-0.5 rounded ${step.zone === "A" ? "bg-red-100 text-red-600" : "bg-blue-100 text-blue-600"}`}>Zone {step.zone}</span>
                  </div>
                  <p className={`text-xs ${isDone ? "text-emerald-500" : isActive ? "text-blue-500" : "text-slate-300"}`}>{isDone ? "å®Œäº†" : isActive ? "å‡¦ç†ä¸­..." : step.desc}</p>
                </div>
                {isActive && <div className="w-4 h-4 border-2 border-blue-300 border-t-blue-600 rounded-full animate-spin shrink-0" />}
                {isDone && <span className="text-emerald-500 text-xs font-bold shrink-0">âœ“</span>}
              </div>
            );
          })}
        </div>

        {/* Zone Legend */}
        <div className="flex items-center justify-center gap-4 mt-4 pt-3 border-t border-slate-100">
          <span className="flex items-center gap-1 text-[10px]"><span className="w-2 h-2 rounded bg-red-400"></span><span className="text-slate-400">Zone A (CDE)</span></span>
          <span className="flex items-center gap-1 text-[10px]"><span className="w-2 h-2 rounded bg-blue-400"></span><span className="text-slate-400">Zone B (ç®¡ç†ç³»)</span></span>
        </div>

        <p className="text-xs text-slate-400 text-center mt-3">ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ãªã„ã§ãã ã•ã„</p>

        {/* ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç”¨: æ‰‹å‹•é·ç§»ãƒœã‚¿ãƒ³ */}
        <div className="mt-4 flex gap-2 justify-center">
          <button onClick={onComplete} className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded text-xs">â†’ æˆåŠŸ</button>
          <button onClick={onError} className="px-3 py-1 bg-rose-100 text-rose-700 rounded text-xs">â†’ å¤±æ•—</button>
        </div>
      </div>
    </div>
  );
};

const PaymentPage = () => {
  const [screen, setScreen] = useState("input");
  return (
    <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4">
      <div className="w-full max-w-md">
        <div className="flex items-center justify-between mb-3">
          <h2 className="text-sm font-bold text-slate-800">æ±ºæ¸ˆãƒšãƒ¼ã‚¸</h2>
          <div className="flex gap-1">
            {[{ id: "input", label: "å…¥åŠ›" }, { id: "3ds", label: "3DSèªè¨¼" }, { id: "processing", label: "å‡¦ç†ä¸­" }, { id: "complete", label: "å®Œäº†" }, { id: "error", label: "ã‚¨ãƒ©ãƒ¼" }, { id: "link_error", label: "ãƒªãƒ³ã‚¯ç„¡åŠ¹" }].map(s => (
              <button key={s.id} onClick={() => setScreen(s.id)} className={`px-2 py-0.5 rounded text-xs ${screen === s.id ? "bg-blue-600 text-white" : "bg-slate-100 text-slate-500"}`}>{s.label}</button>
            ))}
          </div>
        </div>

        {screen === "input" && (
          <div className="bg-white rounded-2xl shadow-xl border border-slate-200/60 overflow-hidden">
            {/* PCI DSS v4.0 Req 6.4.3 / 11.6.1 ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Œå…¨æ€§ç®¡ç† */}
            <div className="bg-amber-50 border-b border-amber-200 px-4 py-1.5 text-xs text-amber-700">
              <span className="font-bold">âš¡ CDE iframeæ–¹å¼</span> â€” ã‚«ãƒ¼ãƒ‰å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã¯cde.aipayment.jpå†…ã®iframeã§å‹•ä½œã€‚ç®¡ç†ç³»JSã¯ã‚«ãƒ¼ãƒ‰ç•ªå·ã«è§¦ã‚Œã¾ã›ã‚“ã€‚
              <span className="ml-2 text-amber-500">CSP: script-src 'self' 'nonce-...' | SRI: å…¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«integrityå±æ€§ | é€±æ¬¡ãƒãƒƒã‚·ãƒ¥ç›£è¦–</span>
            </div>
            <div className="bg-slate-900 text-white px-6 py-5">
              <div className="flex items-center gap-2"><span className="text-lg">ğŸ”’</span><span className="text-sm font-bold">å®‰å…¨ãªãŠæ”¯æ‰•ã„</span></div>
            </div>
            <div className="px-6 py-5 bg-blue-50/70 border-b border-blue-100">
              <p className="text-xs text-slate-500">ãŠæ”¯æ‰•ã„å…ˆ: ã€‡ã€‡ã‚·ãƒ§ãƒƒãƒ—</p>
              <p className="text-sm font-bold mt-1">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³</p>
              <p className="text-3xl font-bold text-blue-600 tracking-tight mt-1">Â¥9,800</p>
            </div>
            <div className="px-6 py-4 space-y-3">
              <div><label className="text-xs text-slate-500">ã‚«ãƒ¼ãƒ‰ç•ªå·</label><input className="w-full border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 outline-none px-3 py-2 text-sm mt-0.5" placeholder="1234 5678 9012 3456" /></div>
              <div className="grid grid-cols-2 gap-3">
                <div><label className="text-xs text-slate-500">æœ‰åŠ¹æœŸé™</label><input className="w-full border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 outline-none px-3 py-2 text-sm mt-0.5" placeholder="MM/YY" /></div>
                <div><label className="text-xs text-slate-500">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‰</label><input className="w-full border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 outline-none px-3 py-2 text-sm mt-0.5" placeholder="CVC" /></div>
              </div>
              <div><label className="text-xs text-slate-500">ã‚«ãƒ¼ãƒ‰åç¾©</label><input className="w-full border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 outline-none px-3 py-2 text-sm mt-0.5" placeholder="TARO YAMADA" /></div>
              <button onClick={() => setScreen("3ds")} className="w-full py-3.5 bg-blue-600 text-white rounded-xl text-base font-bold shadow-lg shadow-blue-600/20 hover:bg-blue-700 hover:shadow-xl transition-all duration-200 mt-3">ğŸ’³ Â¥9,800 ã‚’æ”¯æ‰•ã†</button>
              <div className="flex items-center justify-center gap-3 text-xs text-slate-400 pt-2">
                <span>ğŸ”’ TLS 1.2+æš—å·åŒ–é€šä¿¡</span><span>|</span><span>PCI DSS v4.0æº–æ‹ </span>
              </div>
              <div className="flex justify-center gap-2 pt-1">
                {["VISA", "MC", "JCB", "AMEX"].map(b => (
                  <span key={b} className="text-xs px-1.5 py-0.5 bg-slate-100 rounded border border-slate-200">{b}</span>
                ))}
              </div>
            </div>
          </div>
        )}

        {screen === "3ds" && (
          <div className="bg-white rounded-2xl shadow-xl border border-slate-200/60 overflow-hidden">
            <div className="bg-slate-900 text-white px-6 py-5">
              <div className="flex items-center gap-2"><span className="text-lg">ğŸ”’</span><span className="text-sm font-bold">3Dã‚»ã‚­ãƒ¥ã‚¢èªè¨¼</span></div>
            </div>
            <div className="px-6 py-6">
              <div className="border-2 border-blue-200 rounded-lg p-5 bg-blue-50/50">
                <div className="text-center mb-4">
                  <div className="w-16 h-10 bg-blue-600 rounded mx-auto flex items-center justify-center text-white text-xs font-bold">VISA</div>
                  <p className="text-sm font-bold text-slate-800 mt-3">æœ¬äººèªè¨¼ã‚µãƒ¼ãƒ“ã‚¹</p>
                  <p className="text-xs text-slate-500 mt-1">Verified by VISA</p>
                </div>
                <div className="bg-white rounded border p-3 space-y-3">
                  <div className="text-xs">
                    <p className="text-slate-400">åŠ ç›Ÿåº—å</p>
                    <p className="font-semibold text-slate-700">ã€‡ã€‡ã‚·ãƒ§ãƒƒãƒ—</p>
                  </div>
                  <div className="text-xs">
                    <p className="text-slate-400">ãŠæ”¯æ‰•ã„é‡‘é¡</p>
                    <p className="font-bold text-slate-800">Â¥9,800</p>
                  </div>
                  <div>
                    <label className="text-xs text-slate-500">ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input className="w-full border rounded-lg px-3 py-2 text-sm mt-0.5 text-center tracking-widest" placeholder="â— â— â— â— â— â—" maxLength={6} />
                    <p className="text-xs text-slate-400 mt-1">ã”ç™»éŒ²ã®æºå¸¯ç•ªå·ã«SMSã§é€ä¿¡ã—ã¾ã—ãŸ</p>
                  </div>
                  <button onClick={() => setScreen("processing")} className="w-full py-2.5 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700">èªè¨¼ã™ã‚‹</button>
                  <button onClick={() => setScreen("input")} className="w-full py-2 bg-slate-100 text-slate-500 rounded-lg text-xs">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
              </div>
              <div className="mt-4 flex gap-2 justify-center">
                <button onClick={() => setScreen("processing")} className="px-3 py-1 bg-emerald-100 text-emerald-700 rounded text-xs">â†’ èªè¨¼æˆåŠŸ</button>
                <button onClick={() => setScreen("error")} className="px-3 py-1 bg-rose-100 text-rose-700 rounded text-xs">â†’ èªè¨¼å¤±æ•—</button>
              </div>
            </div>
          </div>
        )}

        {screen === "processing" && (
          <PaymentProcessingFlow onComplete={() => setScreen("complete")} onError={() => setScreen("error")} />
        )}

        {screen === "complete" && (
          <div className="bg-white rounded-xl shadow-lg border overflow-hidden">
            <div className="bg-emerald-600 text-white px-6 py-6 text-center">
              <div className="text-4xl mb-2">âœ…</div>
              <p className="text-lg font-bold">ãŠæ”¯æ‰•ã„å®Œäº†</p>
            </div>
            <div className="px-6 py-4">
              <div className="bg-slate-50 rounded-lg p-4 space-y-2">
                {[["å•†å“å", "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³"], ["ãŠæ”¯æ‰•ã„é‡‘é¡", "Â¥9,800"], ["æ³¨æ–‡ç•ªå·", "ORD-20260213-0042"], ["æ—¥æ™‚", "2026/02/13 14:30"], ["ã‚«ãƒ¼ãƒ‰", "VISA **** 4242"]].map(([k, v], i) => (
                  <div key={i} className="flex justify-between text-xs">
                    <span className="text-slate-500">{k}</span>
                    <span className="font-bold">{v}</span>
                  </div>
                ))}
              </div>
              <p className="text-xs text-slate-400 text-center mt-3">â€» æ±ºæ¸ˆå®Œäº†ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ</p>
              <button className="w-full py-2 bg-slate-100 text-slate-600 rounded-lg text-sm mt-3 border">ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã‚‹</button>
            </div>
            <div className="flex items-center justify-center gap-3 text-xs text-slate-400 py-3 border-t">
              <span>ğŸ”’ TLS 1.2+æš—å·åŒ–é€šä¿¡</span><span>|</span><span>PCI DSS v4.0æº–æ‹ </span>
            </div>
          </div>
        )}

        {screen === "error" && (
          <div className="bg-white rounded-xl shadow-lg border overflow-hidden">
            <div className="bg-rose-600 text-white px-6 py-6 text-center">
              <div className="text-4xl mb-2">âŒ</div>
              <p className="text-lg font-bold">ãŠæ”¯æ‰•ã„ã«å¤±æ•—ã—ã¾ã—ãŸ</p>
            </div>
            <div className="px-6 py-4 text-center">
              <div className="bg-rose-50 border border-rose-200 rounded-lg p-4 mt-2">
                <p className="text-sm text-rose-700">ã‚«ãƒ¼ãƒ‰ã®åˆ©ç”¨é™åº¦é¡ã‚’è¶…ãˆã¦ã„ã¾ã™</p>
                <p className="text-xs text-rose-500 mt-1">åˆ¥ã®ã‚«ãƒ¼ãƒ‰ã§ãŠè©¦ã—ã„ãŸã ãã‹ã€ã‚«ãƒ¼ãƒ‰ä¼šç¤¾ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„</p>
              </div>
              <div className="flex gap-2 mt-4">
                <button onClick={() => setScreen("input")} className="flex-1 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold">ã‚‚ã†ä¸€åº¦è©¦ã™</button>
                <button className="flex-1 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm border">ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã‚‹</button>
              </div>
            </div>
            <div className="flex items-center justify-center gap-3 text-xs text-slate-400 py-3 border-t">
              <span>ğŸ”’ TLS 1.2+æš—å·åŒ–é€šä¿¡</span><span>|</span><span>PCI DSS v4.0æº–æ‹ </span>
            </div>
          </div>
        )}

        {screen === "link_error" && (
          <div className="bg-white rounded-xl shadow-lg border overflow-hidden">
            <div className="bg-gray-900 text-white px-6 py-4">
              <div className="flex items-center gap-2"><span className="text-lg">ğŸ”’</span><span className="text-sm font-bold">å®‰å…¨ãªãŠæ”¯æ‰•ã„</span></div>
            </div>
            <div className="px-6 py-12 text-center">
              <div className="text-4xl mb-3">âš ï¸</div>
              <p className="text-sm font-bold text-slate-700">ã“ã®æ±ºæ¸ˆãƒªãƒ³ã‚¯ã¯ç„¡åŠ¹ã§ã™</p>
              <p className="text-xs text-slate-400 mt-2">ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒéãã¦ã„ã‚‹ã‹ã€åˆ©ç”¨å¯èƒ½å›æ•°ã«é”ã—ã¦ã„ã¾ã™</p>
              <div className="bg-slate-50 rounded-lg p-3 mt-4 text-xs text-slate-500">
                ãŠæ”¯æ‰•ã„å…ˆã«ãŠå•ã„åˆã‚ã›ãã ã•ã„
              </div>
            </div>
            <div className="flex items-center justify-center gap-3 text-xs text-slate-400 py-3 border-t">
              <span>ğŸ”’ TLS 1.2+æš—å·åŒ–é€šä¿¡</span><span>|</span><span>PCI DSS v4.0æº–æ‹ </span>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

const masterMenuItems = [
  { separator: true, label: "æ¦‚æ³" },
  { id: "dashboard", icon: "ğŸ“Š", label: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" },
  { id: "queue", icon: "âš¡", label: "ä¾‹å¤–ã‚­ãƒ¥ãƒ¼", badge: 3 },
  { separator: true, label: "ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°" },
  { id: "txn", icon: "ğŸ“¡", label: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–" },
  { separator: true, label: "å–å¼•" },
  { id: "orderSearch", icon: "ğŸ”", label: "æ³¨æ–‡æ¤œç´¢" },
  { id: "customers", icon: "ğŸ‘¤", label: "é¡§å®¢ç®¡ç†" },
  { id: "recurring", icon: "ğŸ”„", label: "ç¶™ç¶šèª²é‡‘ç®¡ç†" },
  { separator: true, label: "åŠ ç›Ÿåº—" },
  { id: "merchants", icon: "ğŸ¢", label: "åŠ ç›Ÿåº—ç®¡ç†" },
  { id: "applications", icon: "ğŸ“", label: "å¯©æŸ»ãƒ»ç”³è¾¼", badge: 2 },
  { id: "processors", icon: "ğŸ”Œ", label: "æ¥ç¶šå…ˆå¯©æŸ»", badge: 2 },
  { id: "agents", icon: "ğŸ¤", label: "ä»£ç†åº—ç®¡ç†" },
  { separator: true, label: "ç²¾ç®—" },
  { id: "settlement", icon: "ğŸ’°", label: "ç²¾ç®—ãƒ»å…¥é‡‘ç®¡ç†" },
  { id: "report", icon: "ğŸ“ˆ", label: "ãƒ¬ãƒãƒ¼ãƒˆ" },
  { separator: true, label: "æ±ºæ¸ˆã‚¤ãƒ³ãƒ•ãƒ©" },
  { id: "routing", icon: "ğŸ”€", label: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°" },
  { id: "fraud", icon: "ğŸ›¡ï¸", label: "ä¸æ­£æ¤œçŸ¥" },
  { separator: true, label: "é‹ç”¨" },
  { id: "ai", icon: "ğŸ¤–", label: "AIç›£è¦–" },
  { id: "users", icon: "ğŸ‘¥", label: "ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†" },
  { id: "settings", icon: "âš™ï¸", label: "ã‚·ã‚¹ãƒ†ãƒ è¨­å®š" },
];

const merchantMenuItems = [
  { separator: true, label: "ãƒ›ãƒ¼ãƒ " },
  { id: "m_dashboard", icon: "ğŸ“Š", label: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" },
  { separator: true, label: "æ³¨æ–‡" },
  { id: "m_transactions", icon: "ğŸ’³", label: "æ³¨æ–‡ä¸€è¦§" },
  { id: "m_customers", icon: "ğŸ‘¤", label: "é¡§å®¢ç®¡ç†" },
  { separator: true, label: "é›†é‡‘ãƒ„ãƒ¼ãƒ«" },
  { id: "m_links", icon: "ğŸ”—", label: "æ±ºæ¸ˆãƒªãƒ³ã‚¯" },
  { id: "m_subscriptions", icon: "ğŸ”„", label: "æ±ºæ¸ˆç®¡ç†" },
  { separator: true, label: "æ±ºæ¸ˆé«˜" },
  { id: "m_report", icon: "ğŸ“ˆ", label: "æ±ºæ¸ˆé«˜ãƒ¬ãƒãƒ¼ãƒˆ" },
  { id: "m_payout", icon: "ğŸ’°", label: "å…¥é‡‘ç¢ºèª" },
  { separator: true, label: "ã‚µã‚¤ãƒˆç®¡ç†" },
  { id: "m_site_apply", icon: "ğŸ“", label: "æ–°è¦ã‚µã‚¤ãƒˆç”³è«‹" },
  { separator: true, label: "è¨­å®š" },
  { id: "m_api", icon: "ğŸ”§", label: "APIãƒ»Webhook" },
  { id: "m_users", icon: "ğŸ‘¥", label: "ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†" },
  { id: "m_account", icon: "âš™ï¸", label: "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š" },
  { separator: true, label: "ã‚µãƒãƒ¼ãƒˆ" },
  { id: "m_chat", icon: "ğŸ¤–", label: "AIãƒãƒ£ãƒƒãƒˆ" },
];

const agentMenuItems = [
  { separator: true, label: "ãƒ›ãƒ¼ãƒ " },
  { id: "d_dashboard", icon: "ğŸ“Š", label: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" },
  { separator: true, label: "å–¶æ¥­æ´»å‹•" },
  { id: "d_merchants", icon: "ğŸ¢", label: "ç´¹ä»‹å…ˆä¸€è¦§" },
  { id: "d_referral", icon: "ğŸ“", label: "æ–°è¦ç´¹ä»‹" },
  { separator: true, label: "å ±é…¬" },
  { id: "d_reports", icon: "ğŸ’°", label: "å ±é…¬æ˜ç´°" },
  { separator: true, label: "è¨­å®š" },
  { id: "d_account", icon: "âš™ï¸", label: "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š" },
];

export default function Wireframes() {
  const [view, setView] = useState("master");
  const [masterPage, setMasterPage] = useState("dashboard");
  const [merchantPage, setMerchantPage] = useState("m_dashboard");
  const [agentPage, setAgentPage] = useState("d_dashboard");
  const [currentUserId, setCurrentUserId] = useState("U001"); // ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç¢ºèªç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡æ›¿

  // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
  const currentUser = SWITCHABLE_USERS.find(u => u.id === currentUserId) || SWITCHABLE_USERS[0];
  const masterUserProp = { name: currentUser.name, role: currentUser.roleLabel, initials: currentUser.initials };

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡æ›¿æ™‚ã«ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ãƒšãƒ¼ã‚¸ã«ã„ãŸå ´åˆã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸æˆ»ã™
  const handleSwitchUser = (userId) => {
    const newUser = SWITCHABLE_USERS.find(u => u.id === userId);
    if (newUser) {
      const currentSidebarId = masterPage;
      const menuEntry = Object.entries(MENU_TO_SIDEBAR).find(([, sid]) => sid === currentSidebarId);
      if (menuEntry && newUser.permissions[menuEntry[0]] === "none") {
        setMasterPage("dashboard");
      }
    }
    setCurrentUserId(userId);
  };

  const renderMaster = () => {
    switch (masterPage) {
      case "dashboard": return <MasterDashboard />;
      case "queue": return <MasterExceptionQueue />;
      case "merchants": return <MasterMerchants />;
      case "applications": return <MasterMerchantApplications />;
      case "ai": return <MasterAIMonitor />;
      case "settlement": return <MasterSettlement />;
      case "users": return <MasterUserManagement />;
      case "settings": return <MasterSystemSettings />;
      case "routing": return <MasterRouting />;
      case "processors": return <MasterProcessors />;
      case "txn": return <MasterTransactionMonitor />;
      case "orderSearch": return <MasterOrderSearch />;
      case "fraud": return <MasterFraudSettings />;
      case "report": return <MasterReport />;
      case "recurring": return <MasterRecurring />;
      case "agents": return <MasterAgents />;
      case "customers": return <MasterCustomers />;
      default: return <div className="p-4 text-sm text-slate-400 flex items-center justify-center h-64">ã“ã®ç”»é¢ã¯è©³ç´°è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã—ã¾ã™</div>;
    }
  };

  const renderMerchant = () => {
    switch (merchantPage) {
      case "m_dashboard": return <MerchantDashboard />;
      case "m_transactions": return <MerchantTransactions />;
      case "m_api": return <MerchantAPISettings />;
      case "m_chat": return <MerchantAIChat />;
      case "m_payout": return <MerchantPayouts />;
      case "m_users": return <MerchantUserManagement />;
      case "m_report": return <MerchantSalesReport />;
      case "m_account": return <MerchantAccountSettings />;
      case "m_links": return <MerchantPaymentLinks />;
      case "m_subscriptions": return <MerchantSubscriptions />;
      case "m_customers": return <MerchantCustomers />;
      case "m_site_apply": return <MerchantSiteApplication />;
      default: return <div className="p-4 text-sm text-slate-400 flex items-center justify-center h-64">ã“ã®ç”»é¢ã¯è©³ç´°è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã—ã¾ã™</div>;
    }
  };

  const renderAgent = () => {
    switch (agentPage) {
      case "d_dashboard": return <AgentDashboard />;
      case "d_merchants": return <AgentMerchants />;
      case "d_reports": return <AgentReports />;
      case "d_referral": return <AgentReferral />;
      case "d_account": return <AgentAccountSettings />;
      default: return <div className="p-4 text-sm text-slate-400 flex items-center justify-center h-64">ã“ã®ç”»é¢ã¯è©³ç´°è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã—ã¾ã™</div>;
    }
  };

  const navCtx = { setMasterPage, setMerchantPage, setAgentPage, setView };

  return (
    <ToastProvider>
    <NavigationContext.Provider value={navCtx}>
    <div className="h-screen flex flex-col bg-slate-50 font-sans overflow-hidden">
      {/* Top toggle */}
      <div className="bg-slate-900 px-5 py-3 flex items-center gap-4 shrink-0 border-b border-slate-700/50">
        <span className="text-xs font-medium text-slate-400 uppercase tracking-wider">ç”»é¢åˆ‡æ›¿:</span>
        <button onClick={() => setView("master")} className={`text-sm px-4 py-1.5 rounded-lg font-medium transition-colors duration-200 ${view === "master" ? "bg-blue-600 text-white" : "text-slate-400 hover:text-white hover:bg-slate-800"}`}>
          ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†ç”»é¢
        </button>
        <button onClick={() => setView("merchant")} className={`text-sm px-4 py-1.5 rounded-lg font-medium transition-colors duration-200 ${view === "merchant" ? "bg-emerald-600 text-white" : "text-slate-400 hover:text-white hover:bg-slate-800"}`}>
          åŠ ç›Ÿåº—ç®¡ç†ç”»é¢
        </button>
        <button onClick={() => setView("agent")} className={`text-sm px-4 py-1.5 rounded-lg font-medium transition-colors duration-200 ${view === "agent" ? "bg-orange-600 text-white" : "text-slate-400 hover:text-white hover:bg-slate-800"}`}>
          ä»£ç†åº—ç®¡ç†ç”»é¢
        </button>
        <button onClick={() => setView("apply")} className={`text-sm px-4 py-1.5 rounded-lg font-medium transition-colors duration-200 ${view === "apply" ? "bg-violet-600 text-white" : "text-slate-400 hover:text-white hover:bg-slate-800"}`}>
          åŠ ç›Ÿåº— æ–°è¦ç”³è¾¼
        </button>
        <button onClick={() => setView("agentApply")} className={`text-sm px-4 py-1.5 rounded-lg font-medium transition-colors duration-200 ${view === "agentApply" ? "bg-orange-600 text-white" : "text-slate-400 hover:text-white hover:bg-slate-800"}`}>
          ä»£ç†åº— æ–°è¦ç”³è¾¼
        </button>
        <button onClick={() => setView("payment")} className={`text-sm px-4 py-1.5 rounded-lg font-medium transition-colors duration-200 ${view === "payment" ? "bg-indigo-600 text-white" : "text-slate-400 hover:text-white hover:bg-slate-800"}`}>
          æ±ºæ¸ˆãƒšãƒ¼ã‚¸
        </button>
        <span className="text-xs text-slate-600/40 ml-auto">WIREFRAME v3 / å…¨36ç”»é¢å®Ÿè£…</span>
      </div>

      {/* Main content */}
      <div className="flex flex-1 min-h-0">
        {view === "master" ? (
          <>
            <Sidebar items={masterMenuItems} active={masterPage} onSelect={setMasterPage} title="ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†" color="#60A5FA" user={masterUserProp} switchableUsers={SWITCHABLE_USERS} currentUserId={currentUserId} onSwitchUser={handleSwitchUser} />
            <div className="flex-1 overflow-y-auto bg-slate-50">{renderMaster()}</div>
          </>
        ) : view === "merchant" ? (
          <>
            <Sidebar items={merchantMenuItems} active={merchantPage} onSelect={setMerchantPage} title="åŠ ç›Ÿåº—ç®¡ç†" color="#4ADE80" user={{ name: "å±±ç”° å¤ªéƒ", role: "ã‚ªãƒ¼ãƒŠãƒ¼", initials: "å±±" }} />
            <div className="flex-1 overflow-y-auto bg-slate-50">{renderMerchant()}</div>
          </>
        ) : view === "agent" ? (
          <>
            <Sidebar items={agentMenuItems} active={agentPage} onSelect={setAgentPage} title="ä»£ç†åº—ç®¡ç†" color="#FB923C" user={{ name: "ä½è—¤ å–¶æ¥­æ¬¡éƒ", role: "ä»£ç†åº—ç®¡ç†è€…", initials: "ä½" }} />
            <div className="flex-1 overflow-y-auto bg-slate-50">{renderAgent()}</div>
          </>
        ) : view === "payment" ? (
          <div className="flex-1 overflow-y-auto"><PaymentPage /></div>
        ) : view === "agentApply" ? (
          <div className="flex-1 overflow-y-auto"><AgentApplicationForm /></div>
        ) : (
          <div className="flex-1 overflow-y-auto"><MerchantApplicationForm /></div>
        )}
      </div>
    </div>
    </NavigationContext.Provider>
    </ToastProvider>
  );
}
